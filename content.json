{"meta":{"title":"èœ—ç‰›å›","subtitle":"ä¸€ä¸ªæŠ€æœ¯æ²‰æ·€çš„åœ°æ–¹","description":null,"author":"èœ—ç‰›å›","url":"","root":"/"},"pages":[{"title":"404 Not Found","date":"2019-10-20T07:30:53.075Z","updated":"2019-10-20T07:30:53.075Z","comments":true,"path":"404/index.html","permalink":"/404/index.html","excerpt":"","text":"**å¾ˆæŠ±æ­‰ï¼Œæ‚¨è®¿é—®çš„é¡µé¢ä¸å­˜åœ¨** å¯èƒ½æ˜¯è¾“å…¥åœ°å€æœ‰è¯¯æˆ–è¯¥åœ°å€å·²è¢«åˆ é™¤"},{"title":"å…³äº","date":"2019-11-03T13:54:58.336Z","updated":"2019-11-03T13:54:58.336Z","comments":true,"path":"about/index.html","permalink":"/about/index.html","excerpt":"","text":"ä¸ªäººä¿¡æ¯åŸºæœ¬èµ„æ–™å§“å: é™ˆæ¨ å¾®ä¿¡: 1349259823 é‚®ç®±: dmlys@live.com å·¥ä½œçŠ¶æ€: æ‰¾å·¥ä½œ å·¥ä½œæ–¹å‘ æœåŠ¡ç«¯ç ”å‘ å¾®æœåŠ¡ æ•°æ®æŒ–æ˜ é¡¹ç›®ç»å†å­¦æœ¯ç»å† Springer(EIæ£€ç´¢): A Distributed Big Data Discretization Algorithm under Spar è®¡ç®—æœºåº”ç”¨(æ ¸å¿ƒæœŸåˆŠ)ï¼šä¸€ç§Sparkä¸‹çš„åˆ†å¸ƒå¼ç²—ç³™é›†å±æ€§çº¦ç®€ç®—æ³•"},{"title":"æˆ‘çš„æœ‹å‹ä»¬","date":"2019-10-20T07:39:33.593Z","updated":"2019-10-20T07:39:33.593Z","comments":true,"path":"friends/index.html","permalink":"/friends/index.html","excerpt":"","text":"#è¿™é‡Œå¯ä»¥å†™å‹é“¾é¡µé¢ä¸‹æ–¹çš„æ–‡å­—å¤‡æ³¨ï¼Œä¾‹å¦‚è‡ªå·±çš„å‹é“¾è§„èŒƒã€ç¤ºä¾‹ç­‰ã€‚"},{"title":"contact","date":"2019-10-20T14:29:31.000Z","updated":"2019-10-20T06:29:31.584Z","comments":true,"path":"contact/index.html","permalink":"/contact/index.html","excerpt":"","text":""},{"title":"mylist","date":"2019-10-20T07:27:19.181Z","updated":"2019-10-20T07:27:19.181Z","comments":true,"path":"mylist/index.html","permalink":"/mylist/index.html","excerpt":"","text":""},{"title":"projects","date":"2019-10-20T15:04:07.000Z","updated":"2019-10-20T07:04:07.249Z","comments":true,"path":"projects/index.html","permalink":"/projects/index.html","excerpt":"","text":""},{"title":"æ‰€æœ‰åˆ†ç±»","date":"2019-10-20T07:28:14.801Z","updated":"2019-10-20T07:28:14.801Z","comments":true,"path":"categories/index.html","permalink":"/categories/index.html","excerpt":"","text":""},{"title":"æ‰€æœ‰æ ‡ç­¾","date":"2019-10-20T07:27:47.070Z","updated":"2019-10-20T07:27:47.070Z","comments":true,"path":"tags/index.html","permalink":"/tags/index.html","excerpt":"","text":""}],"posts":[{"title":"æµ…æè®¡ç®—æœºç½‘ç»œä¸ƒå±‚ç½‘ç»œæ¨¡å‹","slug":"æµ…æè®¡ç®—æœºç½‘ç»œä¸ƒå±‚ç½‘ç»œæ¨¡å‹","date":"2019-11-01T00:00:00.000Z","updated":"2019-11-01T06:04:35.624Z","comments":true,"path":"2019/11/01/æµ…æè®¡ç®—æœºç½‘ç»œä¸ƒå±‚ç½‘ç»œæ¨¡å‹/","link":"","permalink":"/2019/11/01/%E6%B5%85%E6%9E%90%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E4%B8%83%E5%B1%82%E7%BD%91%E7%BB%9C%E6%A8%A1%E5%9E%8B/","excerpt":"","text":"è®¡ç®—æœºç½‘ç»œä¸ƒå±‚ç½‘ç»œæ¨¡å‹ç®—æœºç½‘ç»œä¸ƒå±‚ç½‘ç»œæ¨¡å‹æµ…æè®¡ç®—æœºç½‘ç»œä¸ƒå±‚ç½‘ç»œæ¨¡å‹ä¸ƒå±‚ç½‘ç»œæ¨¡å‹OSI åŒ…æ‹¬ 7 å±‚ï¼Œå®ƒä»¬åˆ†åˆ«æ˜¯: ç‰©ç†å±‚ã€æ•°æ®é“¾è·¯å±‚ã€ç½‘ç»œå±‚ã€ä¼ è¾“å±‚ã€ä¼šè¯å±‚ã€è¡¨ç¤ºå±‚å’Œåº”ç”¨å±‚ å„å±‚ä¸»è¦åŠŸèƒ½ ç‰©ç†å±‚ï¼šå®ç°é€æ˜çš„æ¯”ç‰¹æµä¼ è¾“ã€‚ æ•°æ®é“¾è·¯å±‚ï¼šåœ¨ç½‘ç»œçš„ç›¸é‚»èŠ‚ç‚¹ä¹‹é—´å»ºç«‹ã€ç»´æŒå’Œé‡Šæ”¾æ•°æ®é“¾è·¯ã€‚ ç½‘ç»œå±‚ï¼šåœ¨ä¸¤ä¸ªç«¯ç³»ç»Ÿä¹‹é—´çš„é€šä¿¡å­ç½‘ä¸Šå»ºç«‹ã€ç»´æŒå’Œç»ˆæ­¢ç½‘ç»œè¿æ¥ã€‚ ä¼ è¾“å±‚ï¼šä¸ºä¼šè¯å±‚å®ä½“é—´çš„é€šä¿¡æä¾›ç«¯åˆ°ç«¯çš„é€æ˜çš„æ•°æ®ä¼ é€ã€‚ ä¼šè¯å±‚ï¼šç»„ç»‡ã€ç®¡ç†å’ŒåŒæ­¥ä¸¤ä¸ªå®ä½“ä¹‹é—´çš„ä¼šè¯è¿æ¥å’Œå®ƒä»¬ä¹‹é—´çš„æ•°æ®äº¤æ¢ã€‚ è¡¨ç¤ºå±‚ï¼šä¸ºåº”ç”¨å±‚å®ä½“æä¾›ä¿¡æ¯çš„å…¬å…±è¡¨ç¤ºæ–¹é¢çš„æœåŠ¡ã€‚ åº”ç”¨å±‚ï¼šä¸ºåº”ç”¨è¿›ç¨‹æä¾›è®¿é—® OSI çš„æ‰‹æ®µã€‚ å„å±‚çš„ä¸»è¦åè®®","categories":[{"name":"è®¡ç®—æœºç½‘ç»œ","slug":"è®¡ç®—æœºç½‘ç»œ","permalink":"/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/"}],"tags":[{"name":"é¢è¯•","slug":"é¢è¯•","permalink":"/tags/%E9%9D%A2%E8%AF%95/"}]},{"title":"è‹±è¯­è¯­æ³•/å‰¯è¯","slug":"è‹±è¯­è¯­æ³•/å‰¯è¯","date":"2019-10-30T06:56:02.543Z","updated":"2019-10-30T08:40:17.276Z","comments":true,"path":"2019/10/30/è‹±è¯­è¯­æ³•/å‰¯è¯/","link":"","permalink":"/2019/10/30/%E8%8B%B1%E8%AF%AD%E8%AF%AD%E6%B3%95/%E5%89%AF%E8%AF%8D/","excerpt":"","text":"123title: è‹±è¯­è¯­æ³•-å‰¯è¯date: 2019-10-22 19:17:37categories: è‹±è¯­è¯­æ³• å‰¯è¯1.å‰¯è¯çš„ç§ç±» æ—¶é—´å‰¯è¯: å¦‚ often åœ°ç‚¹å‰¯è¯: å¦‚here æ–¹å¼å‰¯è¯: å¦‚hard ç¨‹åº¦å‰¯è¯: å¦‚very ç–‘é—®å‰¯è¯(æ”¾åœ¨ç‰¹æ®Šç–‘é—®å¥çš„å¥é¦–): å¦‚how å…³ç³»å‰¯è¯(æ”¾åœ¨å®šè¯­ä»å¥ä¸¾æ‰‹): å¦‚ when è¿æ¥å‰¯è¯(æ”¾åœ¨åè¯æ€§ä»å¥å¥é¦–): å¦‚ how 2.å‰¯è¯çš„ä½œç”¨å‰¯è¯ä¿®é¥°åŠ¨è¯, å½¢å®¹è¯, åè¯, å‰¯è¯è·å…¨å¥, åœ¨å¥å­ä¸­ä½œçŠ¶è¯­, æ ‡è¯­, å®šè¯­å’Œè¡¥è¯­ 3.å‰¯è¯çš„ä½ç½® ä¿®é¥°å½¢å®¹è¯å’Œå‰¯è¯æ˜¯çš„ä½ç½®: å‰¯è¯ä¿®é¥°å½¢å®¹è¯å’Œå‰¯è¯æ˜¯, ä¸€èˆ¬ä½äºè¢«ä¿®é¥°è¯çš„å‰é¢ æ—¶é—´å‰¯è¯å’Œåœ°ç‚¹å‰¯è¯: è¡¨ç¤ºç¡®å®šæ—¶é—´çš„å‰¯è¯å’Œè¡¨ç¤ºåœ°ç‚¹çš„å‰¯è¯ä¸€èˆ¬æ”¾åœ¨å¥å°¾, è‹¥å¥å­ä¸­æº¶èš€æœ‰åœ°ç‚¹å‰¯è¯å’Œæ—¶é—´å‰¯è¯, åœ°ç‚¹å‰¯è¯é€šå¸¸åœ¨å‰, æ—¶é—´å‰¯è¯åœ¨å ç¨‹åº¦å‰¯è¯: ä¸€èˆ¬æ”¾åœ¨è¢«ä¿®é¥°çš„å½¢å®¹è¯å’Œå‰¯è¯ä¹‹å‰, å½“ä¿®é¥°ä½¿å®ä¹‰åŠ¨è¯æ—¶, æ”¾åœ¨å®ä¹‰åŠ¨è¯ä¹‹å enoughä½œå‰¯è¯, æ€»å®ä½è¯­è¢«ä¿®é¥°çš„å½¢å®¹è¯è·å‰¯è¯ä¹‹å æ–¹å¼å‰¯è¯: ä¿®é¥°ä¸åŠç‰©åŠ¨è¯æ—¶, è¦æ”¾åœ¨è¢«ä¿®é¥°è¯ä¹‹å ä¿®é¥°åŠç‰©åŠ¨è¯æ—¶, å¯æ”¾åœ¨è¢«ä¿®é¥°åŠ¨è¯ä¹‹å‰è·ç—…æ„ˆä¹‹å, å¦‚æœå¹¶ä¸è¾ƒé•¿, ä¹Ÿå¯ä»¥æ”¾åœ¨åŠ¨è¯å’Œå®¾è¯­ä¹‹é—´ â€œåŠ¨è¯â€+â€å‰¯è¯â€çŸ­è¯­: åœ¨è¿™ç§æƒ…å†µä¸‹, å¦‚æœå¹¶äºæ—¶äººç§°ä»£è¯, åˆ™ä»£æ¬¡è¦æ”¾åœ¨å‰¯è¯ä¹‹å‰, å®¾è¯­æ˜¯åè¯æ—¶, è¯¥åè¯æ”¾åœ¨å‰¯è¯å‰åå‡å¯, å®¾è¯­æ—¶å¥å­æ˜¯, å¥å­è¦æ”¾åœ¨å‰¯è¯ä¹‹å.","categories":[],"tags":[]},{"title":"Javaçš„å››ç§å¼•ç”¨æ–¹å¼","slug":"Javaçš„å››ç§å¼•ç”¨æ–¹å¼","date":"2019-10-22T21:36:06.000Z","updated":"2019-10-22T13:55:46.631Z","comments":true,"path":"2019/10/23/Javaçš„å››ç§å¼•ç”¨æ–¹å¼/","link":"","permalink":"/2019/10/23/Java%E7%9A%84%E5%9B%9B%E7%A7%8D%E5%BC%95%E7%94%A8%E6%96%B9%E5%BC%8F/","excerpt":"","text":"Javaçš„å››ç§å¼•ç”¨æ–¹å¼javaå†…å­˜ç®¡ç†åˆ†ä¸ºå†…å­˜åˆ†é…å’Œå†…å­˜å›æ”¶ï¼Œéƒ½ä¸éœ€è¦ç¨‹åºå‘˜è´Ÿè´£ï¼Œåƒåœ¾å›æ”¶çš„æœºåˆ¶ä¸»è¦æ˜¯çœ‹å¯¹è±¡æ˜¯å¦æœ‰å¼•ç”¨æŒ‡å‘è¯¥å¯¹è±¡ã€‚ javaå¯¹è±¡çš„å¼•ç”¨åŒ…æ‹¬ å¼ºå¼•ç”¨ è½¯å¼•ç”¨ å¼±å¼•ç”¨ è™šå¼•ç”¨ Javaä¸­æä¾›è¿™å››ç§å¼•ç”¨ç±»å‹ä¸»è¦æœ‰ä¸¤ä¸ªç›®çš„ï¼š ç¬¬ä¸€æ˜¯å¯ä»¥è®©ç¨‹åºå‘˜é€šè¿‡ä»£ç çš„æ–¹å¼å†³å®šæŸäº›å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸï¼› ç¬¬äºŒæ˜¯æœ‰åˆ©äºJVMè¿›è¡Œåƒåœ¾å›æ”¶ã€‚ å››ç§ç±»å‹å¼•ç”¨çš„æ¦‚å¿µ1. å¼ºå¼•ç”¨ æŒ‡åˆ›å»ºä¸€ä¸ªå¯¹è±¡å¹¶æŠŠè¿™ä¸ªå¯¹è±¡èµ‹ç»™ä¸€ä¸ªå¼•ç”¨å˜é‡ã€‚ 12Object object =new Object();String str =\"hello\"; å¼ºå¼•ç”¨æœ‰å¼•ç”¨å˜é‡æŒ‡å‘æ—¶æ°¸è¿œä¸ä¼šè¢«åƒåœ¾å›æ”¶ï¼ŒJVMå®æ„¿æŠ›å‡ºOutOfMemoryé”™è¯¯ä¹Ÿä¸ä¼šå›æ”¶è¿™ç§å¯¹è±¡ã€‚ 123456789&lt;pre name=\"code\" class=\"java\"&gt;public class Main &#123; public static void main(String[] args) &#123; new Main().fun1(); &#125; public void fun1() &#123; Object object = new Object(); Object[] objArr = new Object[1000]; &#125; å½“è¿è¡Œè‡³Object[] objArr = new Object[1000];è¿™å¥æ—¶ï¼Œå¦‚æœå†…å­˜ä¸è¶³ï¼ŒJVMä¼šæŠ›å‡ºOOMé”™è¯¯ä¹Ÿä¸ä¼šå›æ”¶objectæŒ‡å‘çš„å¯¹è±¡ã€‚ä¸è¿‡è¦æ³¨æ„çš„æ˜¯ï¼Œå½“fun1è¿è¡Œå®Œä¹‹åï¼Œobjectå’ŒobjArréƒ½å·²ç»ä¸å­˜åœ¨äº†ï¼Œæ‰€ä»¥å®ƒä»¬æŒ‡å‘çš„å¯¹è±¡éƒ½ä¼šè¢«JVMå›æ”¶ã€‚ å¦‚æœæƒ³ä¸­æ–­å¼ºå¼•ç”¨å’ŒæŸä¸ªå¯¹è±¡ä¹‹é—´çš„å…³è”ï¼Œå¯ä»¥æ˜¾ç¤ºåœ°å°†å¼•ç”¨èµ‹å€¼ä¸ºnullï¼Œè¿™æ ·ä¸€æ¥çš„è¯ï¼ŒJVMåœ¨åˆé€‚çš„æ—¶é—´å°±ä¼šå›æ”¶è¯¥å¯¹è±¡ã€‚ æ¯”å¦‚Vectorç±»çš„clearæ–¹æ³•ä¸­å°±æ˜¯é€šè¿‡å°†å¼•ç”¨èµ‹å€¼ä¸ºnullæ¥å®ç°æ¸…ç†å·¥ä½œçš„ï¼š 2. è½¯å¼•ç”¨ å¦‚æœä¸€ä¸ªå¯¹è±¡å…·æœ‰è½¯å¼•ç”¨ï¼Œå†…å­˜ç©ºé—´è¶³å¤Ÿï¼Œåƒåœ¾å›æ”¶å™¨å°±ä¸ä¼šå›æ”¶å®ƒï¼› å¦‚æœå†…å­˜ç©ºé—´ä¸è¶³äº†ï¼Œå°±ä¼šå›æ”¶è¿™äº›å¯¹è±¡çš„å†…å­˜ã€‚åªè¦åƒåœ¾å›æ”¶å™¨æ²¡æœ‰å›æ”¶å®ƒï¼Œè¯¥å¯¹è±¡å°±å¯ä»¥è¢«ç¨‹åºä½¿ç”¨ã€‚ è½¯å¼•ç”¨å¯ç”¨æ¥å®ç°å†…å­˜æ•æ„Ÿçš„é«˜é€Ÿç¼“å­˜,æ¯”å¦‚ç½‘é¡µç¼“å­˜ã€å›¾ç‰‡ç¼“å­˜ç­‰ã€‚ä½¿ç”¨è½¯å¼•ç”¨èƒ½é˜²æ­¢å†…å­˜æ³„éœ²ï¼Œå¢å¼ºç¨‹åºçš„å¥å£®æ€§ã€‚SoftReferenceçš„ç‰¹ç‚¹æ˜¯å®ƒçš„ä¸€ä¸ªå®ä¾‹ä¿å­˜å¯¹ä¸€ä¸ªJavaå¯¹è±¡çš„è½¯å¼•ç”¨ï¼Œ è¯¥è½¯å¼•ç”¨çš„å­˜åœ¨ä¸å¦¨ç¢åƒåœ¾æ”¶é›†çº¿ç¨‹å¯¹è¯¥Javaå¯¹è±¡çš„å›æ”¶ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸€æ—¦SoftReferenceä¿å­˜äº†å¯¹ä¸€ä¸ªJavaå¯¹è±¡çš„è½¯å¼•ç”¨åï¼Œåœ¨åƒåœ¾çº¿ç¨‹å¯¹ è¿™ä¸ªJavaå¯¹è±¡å›æ”¶å‰ï¼ŒSoftReferenceç±»æ‰€æä¾›çš„get()æ–¹æ³•è¿”å›Javaå¯¹è±¡çš„å¼ºå¼•ç”¨ã€‚ ä¸€æ—¦åƒåœ¾çº¿ç¨‹å›æ”¶è¯¥Javaå¯¹è±¡ä¹‹ åï¼Œget()æ–¹æ³•å°†è¿”å›nullã€‚ 12MyObject aRef = new MyObject(); SoftReference aSoftRef=new SoftReference(aRef); æ­¤æ—¶ï¼Œå¯¹äºè¿™ä¸ªMyObjectå¯¹è±¡ï¼Œæœ‰ä¸¤ä¸ªå¼•ç”¨è·¯å¾„ï¼Œä¸€ä¸ªæ˜¯æ¥è‡ªSoftReferenceå¯¹è±¡çš„è½¯å¼•ç”¨ï¼Œä¸€ä¸ªæ¥è‡ªå˜é‡aReferenceçš„å¼ºå¼•ç”¨ï¼Œæ‰€ä»¥è¿™ä¸ªMyObjectå¯¹è±¡æ˜¯å¼ºå¯åŠå¯¹è±¡ã€‚ éšå³ï¼Œæˆ‘ä»¬å¯ä»¥ç»“æŸaReferenceå¯¹è¿™ä¸ªMyObjectå®ä¾‹çš„å¼ºå¼•ç”¨: 1aRef = null; æ­¤åï¼Œè¿™ä¸ªMyObjectå¯¹è±¡æˆä¸ºäº†è½¯å¼•ç”¨å¯¹è±¡ã€‚å¦‚æœåƒåœ¾æ”¶é›†çº¿ç¨‹è¿›è¡Œå†…å­˜åƒåœ¾æ”¶é›†ï¼Œå¹¶ä¸ä¼šå› ä¸ºæœ‰ä¸€ä¸ªSoftReferenceå¯¹è¯¥å¯¹è±¡çš„å¼•ç”¨è€Œå§‹ç»ˆä¿ç•™è¯¥å¯¹è±¡ã€‚Javaè™šæ‹Ÿæœºçš„åƒåœ¾æ”¶é›†çº¿ç¨‹å¯¹è½¯å¯åŠå¯¹è±¡å’Œå…¶ä»–ä¸€èˆ¬Javaå¯¹è±¡è¿›è¡Œäº†åŒºåˆ«å¯¹å¾…:è½¯å¯åŠå¯¹è±¡çš„æ¸…ç†æ˜¯ç”±åƒåœ¾æ”¶é›†çº¿ç¨‹æ ¹æ®å…¶ç‰¹å®šç®—æ³•æŒ‰ç…§å†…å­˜éœ€æ±‚å†³å®šçš„ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œåƒåœ¾æ”¶é›†çº¿ç¨‹ä¼šåœ¨è™šæ‹ŸæœºæŠ›å‡ºOutOfMemoryErrorä¹‹å‰å›æ”¶è½¯å¯åŠå¯¹è±¡ï¼Œè€Œä¸”è™šæ‹Ÿæœºä¼šå°½å¯èƒ½ä¼˜å…ˆå›æ”¶é•¿æ—¶é—´é—²ç½®ä¸ç”¨çš„è½¯å¯åŠå¯¹è±¡ï¼Œå¯¹é‚£äº›åˆšåˆšæ„å»ºçš„æˆ–åˆšåˆšä½¿ç”¨è¿‡çš„â€œæ–°â€è½¯å¯åå¯¹è±¡ä¼šè¢«è™šæ‹Ÿæœºå°½å¯èƒ½ä¿ç•™ã€‚åœ¨å›æ”¶è¿™äº›å¯¹è±¡ä¹‹å‰ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡: 1MyObject anotherRef=(MyObject)aSoftRef.get(); é‡æ–°è·å¾—å¯¹è¯¥å®ä¾‹çš„å¼ºå¼•ç”¨ã€‚è€Œå›æ”¶ä¹‹åï¼Œè°ƒç”¨*get()æ–¹æ³•å°±åªèƒ½å¾—åˆ°*nulläº†ã€‚ä½¿ç”¨ReferenceQueueæ¸…é™¤å¤±å»äº†è½¯å¼•ç”¨å¯¹è±¡çš„SoftReferenceï¼š** 3. å¼±å¼•ç”¨ï¼ˆWeakReferenceï¼‰ å¼±å¼•ç”¨ä¹Ÿæ˜¯ç”¨æ¥æè¿°éå¿…éœ€å¯¹è±¡çš„ï¼Œå½“JVMè¿›è¡Œåƒåœ¾å›æ”¶æ—¶ï¼Œæ— è®ºå†…å­˜æ˜¯å¦å……è¶³ï¼Œéƒ½ä¼šå›æ”¶è¢«å¼±å¼•ç”¨å…³è”çš„å¯¹è±¡ã€‚ 1234567891011121314151617181920212223public class test &#123; public static void main(String[] args) &#123; WeakReference&lt;People&gt;reference=new WeakReference&lt;People&gt;(new People(\"zhouqian\",20)); System.out.println(reference.get()); System.gc();//é€šçŸ¥GVMå›æ”¶èµ„æº System.out.println(reference.get()); &#125; &#125; class People&#123; public String name; public int age; public People(String name,int age) &#123; this.name=name; this.age=age; &#125; @Override public String toString() &#123; return \"[name:\"+name+\",age:\"+age+\"]\"; &#125; &#125; è¾“å‡ºç»“æœï¼šname:zhouqian,age:20]null ç¬¬äºŒä¸ªè¾“å‡ºç»“æœæ˜¯nullï¼Œè¿™è¯´æ˜åªè¦JVMè¿›è¡Œåƒåœ¾å›æ”¶ï¼Œè¢«å¼±å¼•ç”¨å…³è”çš„å¯¹è±¡å¿…å®šä¼šè¢«å›æ”¶æ‰ã€‚ä¸è¿‡è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™é‡Œæ‰€è¯´çš„è¢«å¼±å¼•ç”¨å…³è”çš„å¯¹è±¡æ˜¯æŒ‡åªæœ‰å¼±å¼•ç”¨ä¸ä¹‹å…³è”ï¼Œå¦‚æœå­˜åœ¨å¼ºå¼•ç”¨åŒæ—¶ä¸ä¹‹å…³è”ï¼Œåˆ™è¿›è¡Œåƒåœ¾å›æ”¶æ—¶ä¹Ÿä¸ä¼šå›æ”¶è¯¥å¯¹è±¡ï¼ˆè½¯å¼•ç”¨ä¹Ÿæ˜¯å¦‚æ­¤ï¼‰ã€‚ è‹¥è¿›è¡Œå¦‚ä¸‹ä¿®æ”¹,ç»“æœåˆ™ä¸åŒ 1234567891011121314151617181920212223public class test &#123; public static void main(String[] args) &#123; People people=new People(\"zhouqian\",20); WeakReference&lt;People&gt;reference=new WeakReference&lt;People&gt;(people);//å…³è”å¼ºå¼•ç”¨ System.out.println(reference.get()); System.gc(); System.out.println(reference.get()); &#125; &#125; class People&#123; public String name; public int age; public People(String name,int age) &#123; this.name=name; this.age=age; &#125; @Override public String toString() &#123; return \"[name:\"+name+\",age:\"+age+\"]\"; &#125; &#125;//ç»“æœå‘ç”Ÿäº†å¾ˆå¤§çš„å˜åŒ– [name:zhouqian,age:20] [name:zhouqian,age:20] 4. è™šå¼•ç”¨ è™šå¼•ç”¨å’Œå‰é¢çš„è½¯å¼•ç”¨ã€å¼±å¼•ç”¨ä¸åŒï¼Œå®ƒå¹¶ä¸å½±å“å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸã€‚åœ¨javaä¸­ç”¨java.lang.ref.PhantomReferenceç±»è¡¨ç¤ºã€‚å¦‚æœä¸€ä¸ªå¯¹è±¡ä¸è™šå¼•ç”¨å…³è”ï¼Œåˆ™è·Ÿæ²¡æœ‰å¼•ç”¨ä¸ä¹‹å…³è”ä¸€æ ·ï¼Œåœ¨ä»»ä½•æ—¶å€™éƒ½å¯èƒ½è¢«åƒåœ¾å›æ”¶å™¨å›æ”¶ã€‚ è¦æ³¨æ„çš„æ˜¯ï¼Œè™šå¼•ç”¨å¿…é¡»å’Œå¼•ç”¨é˜Ÿåˆ—å…³è”ä½¿ç”¨ï¼Œå½“åƒåœ¾å›æ”¶å™¨å‡†å¤‡å›æ”¶ä¸€ä¸ªå¯¹è±¡æ—¶ï¼Œå¦‚æœå‘ç°å®ƒè¿˜æœ‰è™šå¼•ç”¨ï¼Œå°±ä¼šæŠŠè¿™ä¸ªè™šå¼•ç”¨åŠ å…¥åˆ°ä¸ä¹‹ å…³è”çš„å¼•ç”¨é˜Ÿåˆ—ä¸­ã€‚ç¨‹åºå¯ä»¥é€šè¿‡åˆ¤æ–­å¼•ç”¨é˜Ÿåˆ—ä¸­æ˜¯å¦å·²ç»åŠ å…¥äº†è™šå¼•ç”¨ï¼Œæ¥äº†è§£è¢«å¼•ç”¨çš„å¯¹è±¡æ˜¯å¦å°†è¦è¢«åƒåœ¾å›æ”¶ã€‚å¦‚æœç¨‹åºå‘ç°æŸä¸ªè™šå¼•ç”¨å·²ç»è¢«åŠ å…¥åˆ°å¼•ç”¨é˜Ÿåˆ—ï¼Œé‚£ä¹ˆå°±å¯ä»¥åœ¨æ‰€å¼•ç”¨çš„å¯¹è±¡çš„å†…å­˜è¢«å›æ”¶ä¹‹å‰é‡‡å–å¿…è¦çš„è¡ŒåŠ¨ã€‚ 123456public class Main &#123; public static void main(String[] args) &#123; ReferenceQueue&lt;String&gt; queue = new ReferenceQueue&lt;String&gt;(); PhantomReference&lt;String&gt; pr = new PhantomReference&lt;String&gt;(new String(\"hello\"), queue); System.out.println(pr.get()); &#125; è½¯å¼•ç”¨å’Œå¼±å¼•ç”¨ å¯¹äºå¼ºå¼•ç”¨ï¼Œæˆ‘ä»¬å¹³æ—¶åœ¨ç¼–å†™ä»£ç æ—¶ç»å¸¸ä¼šç”¨åˆ°ã€‚è€Œå¯¹äºå…¶ä»–ä¸‰ç§ç±»å‹çš„å¼•ç”¨ï¼Œä½¿ç”¨å¾—æœ€å¤šçš„å°±æ˜¯è½¯å¼•ç”¨å’Œå¼±å¼•ç”¨ï¼Œè¿™2ç§æ—¢æœ‰ç›¸ä¼¼ä¹‹å¤„åˆæœ‰åŒºåˆ«ã€‚å®ƒä»¬éƒ½æ˜¯ç”¨æ¥æè¿°éå¿…éœ€å¯¹è±¡çš„ï¼Œä½†æ˜¯è¢«è½¯å¼•ç”¨å…³è”çš„å¯¹è±¡åªæœ‰åœ¨å†…å­˜ä¸è¶³æ—¶æ‰ä¼šè¢«å›æ”¶ï¼Œè€Œè¢«å¼±å¼•ç”¨å…³è”çš„å¯¹è±¡åœ¨JVMè¿›è¡Œåƒåœ¾å›æ”¶æ—¶æ€»ä¼šè¢«å›æ”¶ã€‚ Javaæ˜¯å¦‚ä½•åˆ¤æ–­å¯¹è±¡æ˜¯å¦éœ€è¦å›æ”¶ å¸¸è§çš„ä¸¤ç§åˆ¤æ–­çš„ç®—æ³•ï¼š å¼•ç”¨è®¡æ•°ç®—æ³• å¯è¾¾æ€§åˆ†æç®—æ³•ï¼ˆJavaä½¿ç”¨çš„è¿™ä¸€ç§ï¼‰ å¼•ç”¨è®¡æ•°ç®—æ³•å¼•ç”¨è®¡æ•°ç®—æ³•æ˜¯åœ¨å¯¹è±¡ä¸­åŠ å…¥ä¸€ä¸ªè®¡æ•°å™¨ï¼Œå½“å¯¹è±¡è¢«å¼•ç”¨ï¼Œè®¡æ•°å™¨+1ï¼Œå½“å¼•ç”¨å¤±æ•ˆï¼Œè®¡æ•°å™¨-1 è¿™ç§ç®—æ³•å®ç°ç®€å•ï¼Œæ•ˆç‡é«˜ï¼Œä½†æ˜¯æœ‰ä¸€ä¸ªä¸¥é‡çš„é—®é¢˜ä¼šå¯¼è‡´å†…å­˜æ³„æ¼ï¼Œé‚£å°±æ˜¯å¯¹è±¡ä¹‹é—´å¾ªç¯å¼•ç”¨ï¼Œæ¯”å¦‚è¯´Aå¯¹è±¡æŒæœ‰Bå¯¹è±¡çš„å¼•ç”¨ï¼ŒBå¯¹è±¡æŒæœ‰Aå¯¹è±¡çš„å¼•ç”¨ï¼Œé‚£ä¹ˆAå’ŒBçš„è®¡æ•°å™¨å€¼æ°¸è¿œ&gt;=1ï¼Œä¹Ÿå°±æ˜¯è¯´è¿™ä¸¤ä¸ªå¯¹è±¡æ°¸è¿œä¸ä¼šè¢«å›æ”¶ å¯è¾¾æ€§åˆ†æç®—æ³•Javaä¸­å®šä¹‰äº†ä¸€äº›èµ·å§‹ç‚¹ï¼Œç§°ä¸ºGC Rootï¼Œå½“æœ‰å¯¹è±¡å¼•ç”¨å®ƒçš„æ—¶å€™ï¼Œå°±æŠŠå¯¹è±¡æŒ‚è½½åœ¨å®ƒä¸‹é¢ï¼Œå½¢æˆä¸€ä¸ªæ ‘çŠ¶ç»“æ„ï¼Œå½“ä¸€ä¸ªå¯¹è±¡å¤„äºä¸€ä¸ªè¿™æ ·çš„æ ‘é‡Œæ—¶ï¼Œå°±è®¤ä¸ºæ­¤å¯¹è±¡æ˜¯å¯è¾¾çš„ï¼Œåä¹‹æ˜¯ä¸å¯è¾¾ï¼Œå¦‚ä¸‹å›¾ å¦‚å›¾ Object1,Object2,Object3æ˜¯å¯¹è±¡å¯è¾¾çš„ï¼ŒObject4,Object5,Object6æ˜¯ä¸å¯è¾¾çš„ é‚£ä¹ˆæœ‰å“ªäº›å¯ä»¥ä½œä¸ºGC Rootå‘¢ï¼Ÿ é™æ€å±æ€§ï¼ˆè¢«staticä¿®é¥°çš„å±æ€§ï¼‰ å¸¸é‡ï¼ˆè¢«static finalä¿®é¥°çš„å±æ€§ï¼‰ è™šæ‹Ÿæœºæ ˆï¼ˆæœ¬åœ°å˜é‡è¡¨ï¼‰ä¸­å¼•ç”¨çš„å¯¹è±¡ æœ¬åœ°æ–¹æ³•æ ˆä¸­å¼•ç”¨çš„å¯¹è±¡","categories":[{"name":"Java","slug":"Java","permalink":"/categories/Java/"}],"tags":[{"name":"java","slug":"java","permalink":"/tags/java/"}]},{"title":"Have/Has çš„ä¸»è¦ç”¨æ³•","slug":"è‹±è¯­è¯­æ³•/havehasçš„ç”¨æ³•","date":"2019-10-22T19:17:37.000Z","updated":"2019-11-01T07:25:43.648Z","comments":true,"path":"2019/10/23/è‹±è¯­è¯­æ³•/havehasçš„ç”¨æ³•/","link":"","permalink":"/2019/10/23/%E8%8B%B1%E8%AF%AD%E8%AF%AD%E6%B3%95/havehas%E7%9A%84%E7%94%A8%E6%B3%95/","excerpt":"","text":"Have/Has çš„ä¸»è¦ç”¨æ³• ä¸»è¯­ä¸ºç¬¬ä¸‰äººç§°å•æ•°æ—¶ç”¨has ï¼Œå…¶ä½™äººç§°éƒ½ç”¨have ã€‚ å½“â€œæœ‰â€è®²ï¼Œåé¢è·Ÿåè¯ä½œå®¾è¯­ï¼Œå¦‚have a book å½“â€œåšæŸç§åŠ¨ä½œâ€è®²ï¼Œåé¢è·Ÿä¸åŠ¨è¯åŒå½¢çš„åè¯ï¼Œå¦‚have a lookã€have a talkã€have a rest å½“â€œè¿›è¡Œâ€è®²ï¼Œåé¢å¯è·Ÿmeetingï¼ˆçœ‹ä¼šï¼‰ã€classï¼ˆä¸Šè¯¾ï¼‰ã€a mealï¼ˆåƒé¥­ï¼‰ã€teaï¼ˆå–èŒ¶ï¼‰ç­‰åè¯ ç”¨ä½œä½¿å½¹åŠ¨è¯ï¼Œåé¢è·Ÿå¤åˆå®¾è¯­ï¼Œå¦‚have my hair cutã€have the door keep open ç”¨ä½œåŠ©åŠ¨è¯ï¼Œåé¢è·Ÿè¿‡å»åˆ†è¯è¡¨ç¤ºåŠ¨ä½œçš„å®Œæˆ","categories":[{"name":"è‹±è¯­è¯­æ³•","slug":"è‹±è¯­è¯­æ³•","permalink":"/categories/%E8%8B%B1%E8%AF%AD%E8%AF%AD%E6%B3%95/"}],"tags":[{"name":"è‹±è¯­","slug":"è‹±è¯­","permalink":"/tags/%E8%8B%B1%E8%AF%AD/"}]},{"title":"dockerå®¹å™¨å†…ç½‘ç»œè¯·æ±‚ç¼“æ…¢é—®é¢˜","slug":"dockerå®¹å™¨å†…ç½‘ç»œè¯·æ±‚ç¼“æ…¢é—®é¢˜","date":"2019-10-22T19:17:37.000Z","updated":"2019-10-24T12:10:58.073Z","comments":true,"path":"2019/10/23/dockerå®¹å™¨å†…ç½‘ç»œè¯·æ±‚ç¼“æ…¢é—®é¢˜/","link":"","permalink":"/2019/10/23/docker%E5%AE%B9%E5%99%A8%E5%86%85%E7%BD%91%E7%BB%9C%E8%AF%B7%E6%B1%82%E7%BC%93%E6%85%A2%E9%97%AE%E9%A2%98/","excerpt":"","text":"dockerå®¹å™¨å†…ç½‘ç»œè¯·æ±‚ç¼“æ…¢é—®é¢˜è§£å†³ åŸæ–‡é“¾æ¥:https://www.embbnux.com/2016/10/06/docker-container-network-too-slow-timeout/ ä¸€ã€dockerçš„ç½‘ç»œæ¨¡å¼1ã€noneå½“é…ç½®ä¸ºnoneæ—¶ï¼Œdockerå®¹å™¨ç½‘ç»œæ— æ³•è¾“å…¥è¾“å‡ºï¼Œä¸ä¸–éš”ç»ã€‚ 2ã€bridgeé»˜è®¤ä¸ºbridgeæ¨¡å¼ï¼Œdockeræœ‰è‡ªå·±çš„è™šæ‹Ÿç½‘å¡ï¼Œé€šè¿‡æ¡¥æ¥çš„æ–¹å¼ä»ä¸»æœºè·å¾—ç½‘ç»œã€‚ 3ã€hostå½“æŒ‡å®šä¸ºhostæ—¶ï¼Œä¸»æœºçš„ç½‘å¡ç›´æ¥æš´éœ²ç»™äº†å®¹å™¨ï¼Œç›´æ¥é€šè¿‡ä¸»æœºçš„ç½‘ç»œä¸Šç½‘ï¼Œæ¯”å¦‚è¦æ‹¿ä¸»æœºä¸Šçš„redisæœåŠ¡127.0.0.1:6357,å°±å¾—é€šè¿‡è¿™ç§æ–¹æ³•ï¼Œä¸è¿‡å°±æ¯”è¾ƒä¸å®‰å…¨äº†ã€‚ 4ã€containerä½¿ç”¨å…¶ä»–å®¹å™¨çš„ç½‘ç»œ äºŒã€dockerçš„dnsè§£æ dockerå®¹å™¨æœ¬è´¨ä¸Šä¹Ÿæ˜¯ä¸ªlinuxï¼Œæ‰€ä»¥dnsçš„è§£ææ–¹æ³•å’Œlinuxä¸€æ ·ï¼Œä¼˜å…ˆæ˜¯æ‰¾/etc/hostsæ–‡ä»¶ï¼Œåƒlocalhostè¿™ç§åŸŸåå°±æ˜¯å†™åœ¨è¿™ä¸ªæ–‡ä»¶é‡Œï¼Œæ¯”å¦‚: 123456789101112127.0.0.1 localhostå¦‚æœdockerå®¹å™¨linkäº†å…¶ä»–å®¹å™¨ï¼Œè¿™é‡Œä¹Ÿä¼šå¤šå‡ºlinkçš„åŸŸåï¼Œæ¯”å¦‚:docker run --name app --link app-redis:redis -d ubuntuå°±ä¼šåœ¨hostsé‡Œå¤šå‡º172.17.0.3 app-redis 038c8388e4a1æ‰¾å®Œ/etc/hostsæ–‡ä»¶ï¼Œç„¶åæ˜¯/etc/resolv.confæ–‡ä»¶:domain localnameserver 192.168.65.1nameserver 192.168.65.10 ä¸‰ã€è§£å†³dockerå®¹å™¨é‡Œç½‘ç»œè¯·æ±‚æ…¢çš„é—®é¢˜ ç»è¿‡æŠ“åŒ…æµ‹è¯•ç­‰åˆ†æï¼Œå‘ç°ç½‘ç»œè¯·æ±‚æ…¢ï¼Œä¸»è¦å‘ç”Ÿåœ¨dnsè§£æä¸­ï¼Œæ‰€ä»¥ä¸»è¦é‡‡å–dnsä¼˜åŒ–:å¦‚æœè¯·æ±‚çš„æ˜¯è‡ªå·±å†…ç½‘çš„api, å¯ä»¥ç›´æ¥ä¿®æ”¹/etc/hostsæ–‡ä»¶ï¼Œå¦‚æœæ˜¯å¤–ç½‘çš„è¯·æ±‚å¯ä»¥é€šè¿‡æ›´æ”¹/etc/resolv.confé‡Œçš„nameserverå®ç°ã€‚dockerå®¹å™¨è‚¯å®šä¸æ˜¯ç›´æ¥é€šè¿‡ä¿®æ”¹æ–‡ä»¶å®ç°çš„ï¼Œå¯ä»¥é€šè¿‡runçš„å‘½ä»¤ 1234# æ·»åŠ hostdocker run --name app --add-host='api.embbnux.com:10.98.10.98' -d ubuntu# æŒ‡å®šdns serverdocker run --name app --dns=223.5.5.5 --dns=8.8.8.8 -d ubuntu è¿™æ ·åœ¨dockerå®¹å™¨é‡Œdnsè§£æé˜¶æ®µçš„æ—¶é—´å°±è¢«åŠ é€Ÿäº†","categories":[{"name":"Docker","slug":"Docker","permalink":"/categories/Docker/"}],"tags":[]},{"title":"æŸ¥çœ‹mysqlä¸»ä»é…ç½®çš„çŠ¶æ€åŠä¿®æ­£ slaveä¸å¯åŠ¨é—®é¢˜","slug":"mysqlä¸»ä»é…ç½®çš„çŠ¶æ€åŠä¿®æ­£-slaveä¸å¯åŠ¨é—®é¢˜","date":"2019-10-22T19:17:37.000Z","updated":"2019-10-24T13:00:02.245Z","comments":true,"path":"2019/10/23/mysqlä¸»ä»é…ç½®çš„çŠ¶æ€åŠä¿®æ­£-slaveä¸å¯åŠ¨é—®é¢˜/","link":"","permalink":"/2019/10/23/mysql%E4%B8%BB%E4%BB%8E%E9%85%8D%E7%BD%AE%E7%9A%84%E7%8A%B6%E6%80%81%E5%8F%8A%E4%BF%AE%E6%AD%A3-slave%E4%B8%8D%E5%90%AF%E5%8A%A8%E9%97%AE%E9%A2%98/","excerpt":"","text":"æŸ¥çœ‹mysqlä¸»ä»é…ç½®çš„çŠ¶æ€åŠä¿®æ­£ slaveä¸å¯åŠ¨é—®é¢˜åŸæ–‡é“¾æ¥ 1ã€æŸ¥çœ‹masterçš„çŠ¶æ€123show master status; //Positionä¸åº”è¯¥ä¸º0show processlist; //stateçŠ¶æ€åº”è¯¥ä¸ºHas sent all binlog to slave; waiting for binlog to be updated 2ã€æŸ¥çœ‹slaveçŠ¶æ€123456show slave status;//Slave_IO_Running ä¸ Slave_SQL_Running çŠ¶æ€éƒ½è¦ä¸ºYesshow processlist;//åº”è¯¥æœ‰ä¸¤è¡Œstateå€¼ä¸ºï¼šHas read all relay log; waiting for the slave I/O thread to update itWaiting for master to send event 3ã€é”™è¯¯æ—¥å¿—MySQLå®‰è£…ç›®å½• /usr/local/mysql MySQLæ—¥å¿—ç›®å½• /usr/local/mysql/data/ å½¢å¦‚ï¼ŒHostname.err 4ã€Change master toå¦‚æœä»åº“çš„Slaveæœªå¯åŠ¨ï¼ŒSlave_IO_Runningä¸ºNOã€‚å¯èƒ½æ˜¯ä¸»åº“æ˜¯çš„masterçš„ä¿¡æ¯æœ‰å˜åŒ–ï¼ŒæŸ¥çœ‹ä¸»åº“show master status;è®°å½•ä¸‹File,Positionå­—æ®µï¼Œå‡è®¾ä¸ºâ€˜mysql-bin.000004â€™,98;åœ¨ä»åº“æ‰§è¡Œï¼š 123mysql&gt;stop slave; mysql&gt;change master to master_log_file=&apos;mysql-bin.000004&apos;,master_log_pos=98; mysql&gt;start slave; 5ã€SET global sql_slave_skip_counter=n;å¦‚æœä»åº“çš„slave_sql_runningä¸ºNOã€‚Erræ–‡ä»¶ä¸­è®°å½•ï¼šSlave:Error â€œDuplicate entry â€˜1â€™ for key 1â€ on queryâ€¦..å¯èƒ½æ˜¯masteræœªå‘slaveåŒæ­¥æˆåŠŸï¼Œä½†slaveä¸­å·²ç»æœ‰äº†è®°å½•ã€‚é€ æˆçš„å†²çªå¯ä»¥åœ¨ä»åº“ä¸Šæ‰§è¡Œset global sql_slave_skip_counter=n;è·³è¿‡å‡ æ­¥ã€‚å†restart slaveå°±å¯ä»¥äº†ã€‚ 6ã€åŒæ­¥é”™è¯¯å¤„ç†å‘ç°mysql slaveæœåŠ¡å™¨ç»å¸¸å› ä¸ºä¸€äº›ç‰¹æ®Šå­—ç¬¦æˆ–è€…ç¬¦å·äº§ç”Ÿçš„æ›´æ–°è¯­å¥æŠ¥é”™ï¼Œæ•´ä¸ªåŒæ­¥ä¹Ÿä¼šå› æ­¤è€Œå¡åœ¨é‚£ï¼Œæœ€åˆçš„åŠæ³•åªæ˜¯æ‰‹åŠ¨å»å‡ºé”™çš„æœºå™¨æ‰§è¡Œä¸‹é¢ä¸‰æ¡SQLè¯­å¥ï¼Œè·³è¿‡é”™è¯¯å³å¯ã€‚ 123mysql&gt;slave stop; mysql&gt;set GLOBAL SQL_SLAVE_SKIP_COUNTER=1; mysql&gt;slave start; PSï¼šæœ¬äººå¤šæ¬¡é‡åˆ°ä»æ•°æ®åº“çš„åŒæ­¥è¿›ç¨‹è‡ªåŠ¨åœæ‰çš„é—®é¢˜ï¼Œæœ‰æ—¶ç®€å•é€šè¿‡slave stop,slave startå³å¯è§£å†³ã€‚æœ‰æ—¶slave startå¯åŠ¨ååˆä¼šè‡ªåŠ¨åœæ‰ï¼Œè¿™æ—¶ä½¿ç”¨ change masteré‡è®¾ä¸»æ•°æ®åº“ä¿¡æ¯çš„æ–¹å¼è§£å†³äº†é—®é¢˜ã€‚ è¯´æ˜ï¼šSlave_IO_Runningï¼šè¿æ¥åˆ°ä¸»åº“ï¼Œå¹¶è¯»å–ä¸»åº“çš„æ—¥å¿—åˆ°æœ¬åœ°ï¼Œç”Ÿæˆæœ¬åœ°æ—¥å¿—æ–‡ä»¶ Slave_SQL_Running:è¯»å–æœ¬åœ°æ—¥å¿—æ–‡ä»¶ï¼Œå¹¶æ‰§è¡Œæ—¥å¿—é‡Œçš„SQLå‘½ä»¤ã€‚","categories":[{"name":"Docker","slug":"Docker","permalink":"/categories/Docker/"},{"name":"Mysql","slug":"Docker/Mysql","permalink":"/categories/Docker/Mysql/"}],"tags":[{"name":"mysql","slug":"mysql","permalink":"/tags/mysql/"},{"name":"Docker","slug":"Docker","permalink":"/tags/Docker/"}]},{"title":"éƒ¨ç½² MySQL 8.0 ä¸»ä»å¤åˆ¶","slug":"mysql8-0ä¸»ä»é›†ç¾¤é…ç½®","date":"2019-10-22T19:17:37.000Z","updated":"2019-11-03T06:45:25.843Z","comments":true,"path":"2019/10/23/mysql8-0ä¸»ä»é›†ç¾¤é…ç½®/","link":"","permalink":"/2019/10/23/mysql8-0%E4%B8%BB%E4%BB%8E%E9%9B%86%E7%BE%A4%E9%85%8D%E7%BD%AE/","excerpt":"","text":"éƒ¨ç½² MySQL 8.0 ä¸»ä»å¤åˆ¶ é•œåƒç‰ˆæœ¬ mysql:8.0 å‚è€ƒæ–‡çŒ®: https://blog.csdn.net/why15732625998/article/details/80463041 MySQL ä¸»ä»å¤åˆ¶ï¼ˆä¹Ÿç§° A/B å¤åˆ¶ï¼‰ çš„åŸç† Masterå°†æ•°æ®æ”¹å˜è®°å½•åˆ°äºŒè¿›åˆ¶æ—¥å¿—(binary log)ä¸­ï¼Œä¹Ÿå°±æ˜¯é…ç½®æ–‡ä»¶log-binæŒ‡å®šçš„æ–‡ä»¶ï¼Œè¿™äº›è®°å½•å«åšäºŒè¿›åˆ¶æ—¥å¿—äº‹ä»¶(binary log events)ï¼› Slave é€šè¿‡ I/O çº¿ç¨‹è¯»å– Master ä¸­çš„ binary log events å¹¶å†™å…¥åˆ°å®ƒçš„ä¸­ç»§æ—¥å¿—(relay log)ï¼› Slave é‡åšä¸­ç»§æ—¥å¿—ä¸­çš„äº‹ä»¶ï¼Œ æŠŠä¸­ç»§æ—¥å¿—ä¸­çš„äº‹ä»¶ä¿¡æ¯ä¸€æ¡ä¸€æ¡çš„åœ¨æœ¬åœ°æ‰§è¡Œä¸€æ¬¡ï¼Œå®Œæˆæ•°æ®åœ¨æœ¬åœ°çš„å­˜å‚¨ï¼Œ ä»è€Œå®ç°å°†æ”¹å˜åæ˜ åˆ°å®ƒè‡ªå·±çš„æ•°æ®(æ•°æ®é‡æ”¾)ã€‚ MySQLå®‰è£…åŸºç¡€1. å®‰è£…msyqlmsyql çš„ä¸€äº›å¸¸ç”¨é…ç½®ä¿¡æ¯ åœ¨è§£å‹çš„è·¯å¾„ä¸‹æŸ¥çœ‹æ˜¯å¦å«æœ‰my.iniçš„æ–‡ä»¶ï¼Œå¦‚æœæ²¡æœ‰åˆ™æ–°å»ºä¸€ä¸ª 12345678910111213141516171819202122232425[mysqld]# è®¾ç½®3306ç«¯å£port=8307# è®¾ç½®mysqlçš„å®‰è£…ç›®å½•basedir=D:\\Program Files\\MySQL# è®¾ç½®mysqlæ•°æ®åº“çš„æ•°æ®çš„å­˜æ”¾ç›®å½•datadir=D:\\Program Files\\MySQL\\Data# å…è®¸æœ€å¤§è¿æ¥æ•°max_connections=200# å…è®¸è¿æ¥å¤±è´¥çš„æ¬¡æ•°ã€‚max_connect_errors=10# æœåŠ¡ç«¯ä½¿ç”¨çš„å­—ç¬¦é›†é»˜è®¤ä¸ºUTF8character-set-server=utf8# åˆ›å»ºæ–°è¡¨æ—¶å°†ä½¿ç”¨çš„é»˜è®¤å­˜å‚¨å¼•æ“default-storage-engine=INNODB# é»˜è®¤ä½¿ç”¨â€œmysql_native_passwordâ€æ’ä»¶è®¤è¯#mysql_native_passworddefault_authentication_plugin=mysql_native_password[mysql]# è®¾ç½®mysqlå®¢æˆ·ç«¯é»˜è®¤å­—ç¬¦é›†default-character-set=utf8[client]# è®¾ç½®mysqlå®¢æˆ·ç«¯è¿æ¥æœåŠ¡ç«¯æ—¶é»˜è®¤ä½¿ç”¨çš„ç«¯å£port=8307default-character-set=utf8 2. æ›´æ”¹æ•°æ®åº“é»˜è®¤å¯†ç å¹¶æˆæƒè®¿é—®æ›´æ”¹å¯†ç å¦‚æœè®¾ç½®å¤„åˆå§‹å¯†ç ,å¯ä»¥ä¸æ›´æ”¹, è§†æƒ…å†µè€Œå®š è¾“å…¥mysql -u root -påä¼šè®©ä½ è¾“å…¥å¯†ç ï¼Œå¯†ç ä¸ºå‰é¢è®©ä½ è®°ä½çš„å¯†ç ï¼Œè¾“å…¥æ­£ç¡®åå°±ä¼šå‡ºç°å¦‚ä¸‹ç•Œé¢ï¼Œè¡¨ç¤ºè¿›å…¥äº†MySQLå‘½ä»¤æ¨¡å¼ã€‚ æ–°ç”¨æˆ·éœ€è¦ä¿®æ”¹å¯†ç å…ˆï¼Œè¾“å…¥ 123use mysql;ALTER USER &apos;root&apos;@&apos;%&apos; IDENTIFIED BY &apos;admin&apos; PASSWORD EXPIRE NEVER; #ä¿®æ”¹åŠ å¯†è§„åˆ™, 8.0 ä»¥ånavicatè¿æ¥ä¼šæŠ¥é”™, åŠ å¯†æ–¹æ¡ˆä¸æ”¯æŒALTER USER &apos;root&apos;@&apos;%&apos; IDENTIFIED WITH mysql_native_password BY &apos;admin&apos;; #æ›´æ–°ä¸€ä¸‹ç”¨æˆ·çš„å¯†ç  å‡ºç°å¦‚ä¸‹ç•Œé¢è¡¨ç¤ºæ›´æ”¹æˆåŠŸã€‚ åˆ°æ­¤ï¼ŒMySQL8.0.12æ•°æ®åº“å°±å®‰è£…å®Œæˆäº†ã€‚ æ›´æ”¹æƒé™æŸ¥è¯¢ç”¨æˆ·æƒé™æƒ…å†µ 12use mysql;select User,authentication_string,Host from user; å¯é€‰é…ç½®ï¼šä½¿ç”¨rootè¿œç¨‹ç™»å½•è¾“å…¥ 12grant all privileges on *.* to 'root'@'%';flush privileges; 3. æ•°æ®åº“ç›¸å…³é…ç½®æŸ¥çœ‹é»˜è®¤æ•°æ®åº“ï¼š 1show databases; é€‰æ‹©mysqlæ•°æ®åº“ï¼š 1use mysql; æŸ¥çœ‹é»˜è®¤MySQLç”¨æˆ·çš„æƒé™ä¸åŠ å¯†æƒ…å†µï¼š 1select host, user, authentication_string, plugin from user; åˆ›å»ºæ–°ç”¨æˆ·å¹¶æ·»åŠ æƒé™åˆ›å»ºæ–°ç”¨æˆ·ï¼š 1CREATE USER &apos;ç”¨æˆ·å&apos;@&apos;hoståç§°&apos; IDENTIFIED WITH mysql_native_password BY &apos;å¯†ç &apos;; ç»™æ–°ç”¨æˆ·æˆæƒï¼š 1GRANT ALL PRIVILEGES ON \\*.\\* TO &apos;ç”¨æˆ·å&apos;@&apos;hoståç§°&apos;; åˆ·æ–°æƒé™ï¼š 1FLUSH PRIVILEGES; åŸºç¡€å®‰è£…é—®é¢˜è¯¦è§£1. MySQL8.0.12ä¸èƒ½è¿æ¥NavicatåŸå› ï¼šMySQL8.0ä¸MySQL5.0æ‰€é‡‡ç”¨çš„åŠ å¯†æ–¹å¼è§„åˆ™ä¸ä¸€æ ·ï¼Œæ‰€ä»¥å¯¼è‡´ Navicatæ‰“ä¸å¼€ã€‚å¯ä¸€ä¸‹å‘½ä»¤æŸ¥çœ‹å¯†ç çš„è§„åˆ™ã€‚ 1select host, user, authentication_string, plugin from user; å¦‚ä¸Šå›¾ï¼Œpluginè¿™ä¸€åˆ—å°±æ˜¯å¯¹åº”ç”¨æˆ·çš„åŠ å¯†è§„åˆ™ï¼Œå¯ä»¥çœ‹åˆ°æˆ‘çš„rootç”¨æˆ·çš„åŠ å¯†è§„åˆ™æ˜¯ï¼šmysql_native_passwordï¼Œè¿™æ˜¯å› ä¸ºæˆ‘å·²ç»è®¾ç½®è¿‡äº†ï¼Œé»˜è®¤çš„æ˜¯ï¼šcaching_sha2_passwordï¼Œæ‰€ä»¥æˆ‘ä»¬åªéœ€è¦å°†é»˜è®¤çš„caching_sha2_passwordæ”¹ä¸ºmysql_native_passwordå³å¯ã€‚ è§£å†³æ–¹æ¡ˆï¼šè¾“å…¥ALTER USER â€˜rootâ€™@â€™localhostâ€™ IDENTIFIED WITH mysql_native_password BY â€˜æ–°å¯†ç â€™;å³å¯ä¿®æ”¹rootç”¨æˆ·çš„åŠ å¯†è§„åˆ™ä»¥åŠå¯†ç ã€‚ 1ALTER USER &apos;root&apos;@&apos;%&apos; IDENTIFIED WITH mysql_native_password BY &apos;admin&apos;; 2. æˆæƒå‡ºé”™æ˜¾ç¤ºYou are not allowed to create a user with GRANT åŸå› ï¼šåœ¨ç½‘ä¸Šæœ‰å¾ˆå¤šæ•™ç¨‹è¯´å½“å‡ºç°The user specified as a definer (â€˜rootâ€™@â€™%â€™) does not existæ—¶è¡¨ç¤ºrootç”¨æˆ·æƒé™ä¸è¶³ï¼Œåªéœ€è¦æ‰§è¡ŒGRANT ALL ON *.* TO â€˜rootâ€™@â€™%â€™;å°±å¯ä»¥äº†ï¼Œä½†æ˜¯å¾€å¾€åˆä¼šå‡ºç°You are not allowed to create a user with GRANTçš„é”™è¯¯æç¤ºã€‚è¿™æ˜¯å› ä¸ºGRANT ALL ON *.* TO â€˜rootâ€™@â€™%â€™;è¿™æ¡è¯­å¥ä¸­@â€™%â€™ä¸­çš„ç™¾åˆ†å·å…¶å®æ˜¯rootç”¨æˆ·å¯¹åº”hostçš„åç§°ï¼Œå¾ˆå¤šäººå¹¶æ²¡æœ‰æ³¨æ„åˆ°ä»–çš„rootç”¨æˆ·å¯¹åº”çš„å…¶å®æ˜¯localhostï¼Œç›´æ¥å°±æ‰§è¡Œäº†ä¸Šé¢çš„è¯­å¥ï¼Œæ‰€ä»¥æ‰ä¼šæŠ¥é”™ã€‚ è§£å†³æ–¹æ¡ˆï¼šåªè¦å°†GRANT ALL ON *.* TO â€˜rootâ€™@â€™%â€™;ä¸­çš„%æ”¹ä¸ºå¯¹åº”çš„hoståç§°å³å¯ï¼Œæœ€åè¿˜è¦åˆ·æ–°ä¸€ä¸‹æƒé™FLUSH PRIVILEGES; ã€‚ 12GRANT ALL ON *.* TO &apos;root&apos;@&apos;%&apos;;FLUSH PRIVILEGES; ç‰¹åˆ«è¯´æ˜ï¼šç½‘ä¸Šè¯´%è¡¨ç¤ºé€šé…æ‰€æœ‰çš„hostï¼Œä½†æ˜¯æ“ä½œæ—¶å¹¶ä¸æˆåŠŸï¼Œä¸æ˜ç™½æ˜¯ä¸ºä»€ä¹ˆï¼Œæˆ‘çŒœæƒ³å¯èƒ½ä¸MySQL8.0ç‰ˆæœ¬æœ‰å…³ç³»ã€‚ é…ç½®æ•°æ®åº“çš„ä¸»ä»å¤åˆ¶ 1.ä¸»ä»æœåŠ¡å™¨æ“ä½œç³»ç»Ÿç‰ˆæœ¬å’Œä½æ•°ä¸€è‡´ï¼› 2.Master å’Œ Slave æ•°æ®åº“çš„ç‰ˆæœ¬è¦ä¸€è‡´ï¼› 3.Master å’Œ Slave æ•°æ®åº“ä¸­çš„æ•°æ®è¦ä¸€è‡´ï¼› 4.Master å¼€å¯äºŒè¿›åˆ¶æ—¥å¿—ï¼Œ Master å’Œ Slave çš„ server_id åœ¨å±€åŸŸç½‘å†…å¿…é¡»å”¯ä¸€ï¼› !!!! å¦‚æœdocker å®¹å™¨ç¼ºå°‘viè½¯ä»¶, å¯å‚è€ƒè¿™ç¯‡æ–‡ç« Dockerå®ç”¨æŠ€å·§ä¹‹æ›´æ”¹è½¯ä»¶åŒ…æºæå‡æ„å»ºé€Ÿåº¦ 1. é…ç½®ä¸»åº“ æ³¨æ„ï¼æ³¨æ„ï¼æ³¨æ„ï¼ï¼šé…ç½®æ–‡ä»¶ä¸€å®šè¦ä¿å­˜æˆASNIå­˜å‚¨æ–¹å¼ï¼Œä¸ç„¶ä¼šæŠ¥é”™ åœ¨ä¸»ä»çš„æœåŠ¡å™¨ä¸Šåˆ†åˆ«æ‰¾åˆ°ä»¥ä¸‹è·¯å¾„çš„my.iniæ–‡ä»¶ 1.1 ä¸»åº“confé…ç½®æ–‡ä»¶çš„mysqldèŠ‚ç‚¹ä¸‹åŠ å…¥a) æ™®é€šæ¨¡å¼é…ç½®123456789[mysqld]log-bin=master-bin #å¼€å¯äºŒè¿›åˆ¶æ—¥å¿— binlog#binlog-do-db=mytest #ç”¨äºè¯»å†™åˆ†ç¦»çš„å…·ä½“æ•°æ®åº“ï¼Œè¿™é‡Œæˆ‘åˆ›å»ºäº†mytestä½œæµ‹è¯•log-bin-index=master-bin.index#binlog_ignore_db=mysql #ä¸ç”¨äºè¯»å†™åˆ†ç¦»çš„å…·ä½“æ•°æ®åº“#binlog_ignore_db=information_schema #å’Œbinlog-do-dbä¸€æ ·ï¼Œå¯ä»¥è®¾ç½®å¤šä¸ª#é€‰æ‹©rowæ¨¡å¼ #binlog-format=ROWserver-id=1 #é…ç½®å”¯ä¸€çš„server-id b) gitæ¨¡å¼é…ç½®123456-----ä½¿ç”¨gtidæ¨¡å¼ æ‰ä½¿ç”¨å¦‚ä¸‹é…ç½®---------[mysqld]server-id=1 #é™¤äº†server-idä¸åŒå¤–ï¼Œå…¶ä»–é…ç½®ä¸»ä»éƒ½ç›¸åŒlog-bin=master-bingtid-mode = onenforce-gtid-consistency = on 1.2 é‡å¯mysqlæœåŠ¡1.3 åœ¨ä¸»æ•°æ®åº“ä¸­åˆ›å»ºç”¨äºä»æ•°æ®è¿æ¥çš„ç”¨æˆ·123CREATE USER &apos;copy&apos;@&apos;%&apos; IDENTIFIED WITH mysql_native_password BY &apos;admin&apos;;GRANT REPLICATION SLAVE ON *.* TO &apos;copy&apos;@&apos;%&apos;;FLUSH PRIVILEGES; 1.4 è·å–ä¸»èŠ‚ç‚¹å½“å‰binary logæ–‡ä»¶åå’Œä½ç½®ï¼ˆpositionï¼‰æŸ¥è¯¢ä¸»æ•°æ®åº“çŠ¶æ€ï¼Œå¹¶è®°å½•ä¸‹Fileå’ŒPositionå­—æ®µçš„å€¼ ä»æ•°æ®åº“ä¸­ä¼šç”¨åˆ° 1234567mysql&gt; show master status;+------------------+----------+--------------+--------------------------+-------------------+| File | Position | Binlog_Do_DB | Binlog_Ignore_DB | Executed_Gtid_Set |+------------------+----------+--------------+--------------------------+-------------------+| mysql-bin.000002 | 155 | mytest | mysql,information_schema | |+------------------+----------+--------------+--------------------------+-------------------+row in set (0.02 sec) 2. é…ç½®ä»åº“2.1 ä»æ•°æ®åº“confé…ç½®ä»æ•°æ®åº“ (åŒä¸»åº“ï¼Œå¿…é¡»æŒ‡å®šä¸­ç»§æ—¥å¿—çš„åç§°) , ä»æ•°æ®åº“é…ç½®çš„mysqldèŠ‚ç‚¹ä¸‹åŠ å…¥ a) ä¼ ç»Ÿæ¨¡å¼12345678910111213[mysqld]#åœ¨[mysqld]ä¸­æ·»åŠ ï¼šserver-id=2relay-log=slave-relay-binrelay-log-index=slave-relay-bin.index#replicate-do-db=test#å¤‡æ³¨ï¼š#server-id æœåŠ¡å™¨å”¯ä¸€æ ‡è¯†ï¼Œå¦‚æœæœ‰å¤šä¸ªä»æœåŠ¡å™¨ï¼Œæ¯ä¸ªæœåŠ¡å™¨çš„server-idä¸èƒ½é‡å¤ï¼Œè·ŸIPä¸€æ ·æ˜¯å”¯ä¸€æ ‡è¯†ï¼Œå¦‚æœä½ æ²¡è®¾ç½®server-idæˆ–è€…è®¾ç½®ä¸º0ï¼Œåˆ™ä»æœåŠ¡å™¨ä¸ä¼šè¿æ¥åˆ°ä¸»æœåŠ¡å™¨ã€‚#relay-log å¯åŠ¨MySQLäºŒè¿›åˆ¶æ—¥å¿—ï¼Œå¯ä»¥ç”¨æ¥åšæ•°æ®å¤‡ä»½å’Œå´©æºƒæ¢å¤ï¼Œæˆ–ä¸»æœåŠ¡å™¨æŒ‚æ‰äº†ï¼Œå°†æ­¤ä»æœåŠ¡å™¨ä½œä¸ºå…¶ä»–ä»æœåŠ¡å™¨çš„ä¸»æœåŠ¡å™¨ã€‚#replicate-do-db æŒ‡å®šåŒæ­¥çš„æ•°æ®åº“ï¼Œå¦‚æœå¤åˆ¶å¤šä¸ªæ•°æ®åº“ï¼Œé‡å¤è®¾ç½®è¿™ä¸ªé€‰é¡¹å³å¯ã€‚è‹¥åœ¨masterç«¯ä¸æŒ‡å®šbinlog-do-dbï¼Œåˆ™åœ¨slaveç«¯å¯ç”¨replication-do-dbæ¥è¿‡æ»¤ã€‚#replicate-ignore-db ä¸éœ€è¦åŒæ­¥çš„æ•°æ®åº“ï¼Œå¦‚æœæœ‰å¤šä¸ªæ•°æ®åº“ï¼Œé‡å¤è®¾ç½®è¿™ä¸ªé€‰é¡¹å³å¯ã€‚#å…¶ä¸­éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œreplicate-do-dbå’Œreplicate-ignore-dbä¸ºäº’æ–¥é€‰é¡¹ï¼Œä¸€èˆ¬åªéœ€è¦ä¸€ä¸ªå³å¯ã€‚ ä¿®æ”¹å®Œserver-id ä¹‹åæœ€å¥½é‡å¯ä¸€ä¸‹ä»åº“, å› ä¸ºä»åº“é»˜è®¤çš„server-idå¯èƒ½æ˜¯1 ä¸ä¹‹å‰ä¸»åº“è®¾ç½®çš„idå†²çªäº†, ä»åº“è¿˜æ²¡æœ‰è¯»å–æ–°çš„è®¾ç½®é¡¹,éœ€è¦é‡å¯æ›´æ–°ä¸€ä¸‹ b) GITæ¨¡å¼1234567-----ä½¿ç”¨gtidæ¨¡å¼ æ‰ä½¿ç”¨å¦‚ä¸‹é…ç½®---------[mysqld]server-id=2 #é™¤äº†server-idä¸åŒå¤–ï¼Œå…¶ä»–é…ç½®ä¸»ä»éƒ½ç›¸åŒlog-bin=master-bingtid-mode=onenforce-gtid-consistency=on å¼€å¯ä»æ•°æ®åº“æœåŠ¡ï¼Œæ‰‹åŠ¨åˆ›å»ºæµ‹è¯•è¯»å†™åˆ†ç¦»çš„åº“ï¼Œè¿™è¾¹ä¸ä¼šå¸®ä½ è‡ªåŠ¨åˆ›å»ºï¼ŒåŒæ—¶ä¹Ÿåˆ›å»ºå’Œä¸»åº“ä¸€æ ·çš„ç”¨æˆ·ï¼Œæˆ‘è¿™é‡Œè¿˜æ˜¯å…ˆåœæ­¢ä»åº“ 2.2 åœ¨ä»æ•°æ®åº“çš„msyqlå‘½ä»¤æ¨¡å¼ç§æ‰§è¡Œä»¥ä¸‹å‘½ä»¤1stop slave; 2.3 ä»ï¼ˆSlaveï¼‰èŠ‚ç‚¹ä¸Šè®¾ç½®ä¸»èŠ‚ç‚¹å‚æ•°a)ä¼ ç»Ÿæ¨¡å¼(ä¸‹é¢çš„ä¿¡æ¯,ä¸€å®šè¦å’Œè‡ªå·±çš„masterçš„ä¿¡æ¯ä¸€ç›´æ‰è¡Œ) 1234567mysql&gt; change master to master_host=&apos;138.138.0.95&apos;, master_port=3307, master_user=&apos;copy&apos;, master_password=&apos;admin&apos;, master_log_file=&apos;master-bin.000006&apos;, master_log_pos=822; æ³¨ï¼šè¿™é‡Œçš„ master_log_fileå’Œmaster_log_poså°±æ˜¯é…ç½®ä¸»æ•°æ®åº“æŸ¥è¯¢åˆ°çš„Fileå’ŒPosition b) GITæ¨¡å¼å¦‚æœä½¿ç”¨äº†gtidæ¨¡å¼, åˆ™æ”¹ä¸º 12345mysql&gt; change master to MASTER_HOST=&apos;138.138.0.95&apos;, master_port=3307, MASTER_USER=&apos;copy&apos;, MASTER_PASSWORD=&apos;admin&apos;, MASTER_AUTO_POSITION=1; ä¸Šé¢çš„å‘½ä»¤æ˜¯ä¸ºäº†ç¤ºä¾‹çš„å®Œæ•´æ€§ï¼Œå¦‚æœä½¿ç”¨GITDé…ç½®ä¹‹å‰ï¼Œä¸¤å°æœåŠ¡å™¨å·²ç»æ˜¯ä¼ ç»Ÿçš„binlogä¸»ä»æœåŠ¡å™¨ï¼Œåˆ™å‘½ä»¤å¯ä»¥æ›´ç®€å•ï¼š å¦‚æœä¸Šè¿°æŠ¥é”™äº† å…³äº@@global.gtid_mode=off, åˆ™å…ˆæ‰§è¡Œ 1set @@GLOBAL.GTID_MODE = OFF_PERMISSIVE; c) ä¼ ç»Ÿè¯¥GITæ¨¡å¼å¦‚æœè®¾ç½®gtidæ¨¡å¼ä»¥å‰å·²ç»æ˜¯å¸¸è§„çš„binlogæ¨¡å¼,åˆ™åªæ‰§è¡Œä»¥ä¸‹è¯­å¥å³å¯ 1mysql&gt; change master to MASTER_AUTO_POSITION=1; #è‡ªåŠ¨è·Ÿè¸ªæ—¥å¿—åç§°å’Œä½ç½® 2.4 (SlaveèŠ‚ç‚¹)å¯åŠ¨ä»åº“1start slave; 2.5 (SlaveèŠ‚ç‚¹)æ£€æŸ¥æ˜¯å¦å¯åŠ¨æˆåŠŸ1show slave status\\G; å¦‚æœSlave_IO_Stateå­—æ®µæ˜¾ç¤º Waiting for master to send eventè¯´æ˜æˆåŠŸï¼Œå½“ç„¶ä½ ä¹Ÿå¯ä»¥åœ¨ä¸»åº“è¡¨ä¸­æ’å…¥ä¸€æ¡æ•°æ®ï¼Œçœ‹çœ‹ä»åº“æ˜¯å¦æœ‰åŒæ­¥ï¼Œåˆ°è¿™é‡Œï¼Œå·²ç»é…ç½®å¥½ä¸»ä»åŒæ­¥äº†ã€‚ Slave_IO_Runningå’ŒSlave_SQL_Runningçš„çŠ¶æ€éƒ½ä¸ºYESæ‰è¡¨ç¤ºåŒæ­¥æˆåŠŸï¼ï¼ï¼ï¼ èˆ¬ioçš„æŠ¥é”™ï¼Œéƒ½æ˜¯server_idé‡å¤äº† æŸ¥çœ‹server_idçš„æ–¹æ³• 1show variables like &apos;server_id&apos;; è‡³æ­¤ï¼Œä¸»ä»åŒæ­¥å®Œæˆã€‚å¯è‡ªè¡Œæµ‹è¯•åŒæ­¥æ•ˆæœã€‚ ==æ³¨æ„,ä»èŠ‚ç‚¹çš„åŒæ­¥,åªä¼šåŒæ­¥postionä¹‹åçš„æ“ä½œ, å¿…é¡»åœ¨è¿›è¡ŒåŒæ­¥ä¹‹å‰ä¿è¯ä¸»ä»çš„æ•°æ®æ˜¯ä¸€ç›´çš„, å¦åˆ™å°±ä¼šå¯¼è‡´ä¸»èŠ‚ç‚¹ä¸­çš„æ“ä½œåœ¨ä»èŠ‚ç‚¹ä¸­ä¸å­˜åœ¨æŸè¡¨æˆ–è€…æŸæ•°æ®å¯¼è‡´å¼‚å¸¸== 3. MySQLä¸»ä»å¤åˆ¶çš„å¤åˆ¶æ–¹å¼MySQLçš„ä¸»ä»å¤åˆ¶å¹¶ä¸å®Œç¾ï¼Œå­˜åœ¨ç€å‡ ä¸ªç”±æ¥å·²ä¹…çš„é—®é¢˜ï¼Œé¦–å…ˆä¸€ä¸ªé—®é¢˜æ˜¯å¤åˆ¶æ–¹å¼ï¼š åŸºäºSQLè¯­å¥çš„å¤åˆ¶ï¼ˆstatement-based replication,SBRï¼‰ åŸºäºè¡Œçš„å¤åˆ¶ï¼ˆrow-based replication,RBRï¼‰ æ··åˆæ¨¡å¼å¤åˆ¶ï¼ˆmixed-based replication,MBRï¼‰ å…¨å±€äº‹åŠ¡æ ‡è¯†ç¬¦ GTIDï¼ˆGlobal Transaction Identifier,GTIDï¼‰ åŸºäºSQLè¯­å¥çš„æ–¹å¼æ˜¯æœ€å¤è€çš„æ–¹å¼ï¼Œä¹Ÿæ˜¯ç›®å‰é»˜è®¤çš„å¤åˆ¶æ–¹å¼ï¼Œåæ¥çš„ä¸‰ç§æ˜¯MySQL 5ä»¥åæ‰å‡ºç°çš„å¤åˆ¶æ–¹å¼ã€‚ 3.1 SBRæ–¹å¼çš„ä¼˜ç¼ºç‚¹SBRçš„ä¼˜ç‚¹ å†å²æ‚ ä¹…ï¼ŒæŠ€æœ¯æˆç†Ÿbinlogæ–‡ä»¶è¾ƒå°binlogä¸­åŒ…å«äº†æ‰€æœ‰æ•°æ®åº“æ›´æ”¹ä¿¡æ¯ï¼Œå¯ä»¥æ®æ­¤æ¥å®¡æ ¸æ•°æ®åº“çš„å®‰å…¨ç­‰æƒ…å†µbinlogå¯ä»¥ç”¨äºå®æ—¶çš„è¿˜åŸï¼Œè€Œä¸ä»…ä»…ç”¨äºå¤åˆ¶ä¸»ä»ç‰ˆæœ¬å¯ä»¥ä¸ä¸€æ ·ï¼Œä»æœåŠ¡å™¨ç‰ˆæœ¬å¯ä»¥æ¯”ä¸»æœåŠ¡å™¨ç‰ˆæœ¬é«˜SBRçš„ç¼ºç‚¹ï¼š ä¸æ˜¯æ‰€æœ‰çš„UPDATEè¯­å¥éƒ½èƒ½è¢«å¤åˆ¶ï¼Œå°¤å…¶æ˜¯åŒ…å«ä¸ç¡®å®šæ“ä½œçš„æ—¶å€™å¤åˆ¶éœ€è¦è¿›è¡Œå…¨è¡¨æ‰«æ(WHERE è¯­å¥ä¸­æ²¡æœ‰ä½¿ç”¨åˆ°ç´¢å¼•)çš„ UPDATE æ—¶ï¼Œéœ€è¦æ¯” RBR è¯·æ±‚æ›´å¤šçš„è¡Œçº§é”å¯¹äºä¸€äº›å¤æ‚çš„è¯­å¥ï¼Œåœ¨ä»æœåŠ¡å™¨ä¸Šçš„è€—èµ„æºæƒ…å†µä¼šæ›´ä¸¥é‡ï¼Œè€Œ RBR æ¨¡å¼ä¸‹ï¼Œåªä¼šå¯¹é‚£ä¸ªå‘ç”Ÿå˜åŒ–çš„è®°å½•äº§ç”Ÿå½±å“æ•°æ®è¡¨å¿…é¡»å‡ ä¹å’Œä¸»æœåŠ¡å™¨ä¿æŒä¸€è‡´æ‰è¡Œï¼Œå¦åˆ™å¯èƒ½ä¼šå¯¼è‡´å¤åˆ¶å‡ºé”™æ‰§è¡Œå¤æ‚è¯­å¥å¦‚æœå‡ºé”™çš„è¯ï¼Œä¼šæ¶ˆè€—æ›´å¤šèµ„æº 3.2 RBRæ–¹å¼çš„ä¼˜ç¼ºç‚¹RBRçš„ä¼˜ç‚¹ ä»»ä½•æƒ…å†µéƒ½å¯ä»¥è¢«å¤åˆ¶ï¼Œè¿™å¯¹å¤åˆ¶æ¥è¯´æ˜¯æœ€å®‰å…¨å¯é çš„å’Œå…¶ä»–å¤§å¤šæ•°æ•°æ®åº“ç³»ç»Ÿçš„å¤åˆ¶æŠ€æœ¯ä¸€æ ·å¤šæ•°æƒ…å†µä¸‹ï¼Œä»æœåŠ¡å™¨ä¸Šçš„è¡¨å¦‚æœæœ‰ä¸»é”®çš„è¯ï¼Œå¤åˆ¶å°±ä¼šå¿«äº†å¾ˆå¤šRBR çš„ç¼ºç‚¹ï¼šbinlog å¤§äº†å¾ˆå¤š å¤æ‚çš„å›æ»šæ—¶ binlog ä¸­ä¼šåŒ…å«å¤§é‡çš„æ•°æ®ä¸»æœåŠ¡å™¨ä¸Šæ‰§è¡Œ UPDATE è¯­å¥æ—¶ï¼Œæ‰€æœ‰å‘ç”Ÿå˜åŒ–çš„è®°å½•éƒ½ä¼šå†™åˆ° binlog ä¸­ï¼Œè€Œ SBR åªä¼šå†™ä¸€æ¬¡ï¼Œè¿™ä¼šå¯¼è‡´é¢‘ç¹å‘ç”Ÿ binlog çš„å¹¶å‘å†™é—®é¢˜æ— æ³•ä» binlog ä¸­çœ‹åˆ°éƒ½å¤åˆ¶äº†å†™ä»€ä¹ˆè¯­å¥ 3.3 æ··åˆæ–¹å¼æ··åˆæ–¹å¼å°±æ˜¯æœ‰mysqlè‡ªåŠ¨é€‰æ‹©RBRæ–¹å¼å’ŒSBRæ–¹å¼ï¼Œèƒ½å¤Ÿå……åˆ†å‘æŒ¥ä¸¤ç§æ–¹å¼çš„ä¼˜ç‚¹ï¼Œä¸€èˆ¬æƒ…å†µä¸‹éƒ½ä½¿ç”¨è¯¥ç§æ–¹å¼å®ç°ä¸»ä»å¤åˆ¶ 3.4 å…¨å±€äº‹åŠ¡æ ‡è¯†ç¬¦ GTIDè¿™ç§æ–¹å¼è™½ç„¶èƒ½å¤Ÿå¤§å¤§æé«˜ä¸»ä»å¤åˆ¶çš„æ•ˆç‡ï¼Œå‡å°ä¸»ä»å¤åˆ¶çš„å»¶æ—¶ï¼Œä½†ä¹Ÿå­˜åœ¨é—®é¢˜ï¼Œå…·ä½“è¯·å‚çœ‹ä¸‹é¢çš„åšå®¢ã€‚https://blog.csdn.net/guotao521/article/details/45483833http://hamilton.duapp.com/detail?articleId=47 ä¸»ä»é…ç½®å¼‚å¸¸è§£å†³1. server-idæŠ¥é”™æŠ¥é”™å†…å®¹ï¼šThe slave I/O thread stops because master and slave have equal MySQL server idé—®é¢˜é‡ç° æ‰§è¡Œå‘½ä»¤ show slave status\\G; å¼‚å¸¸ç‚¹: Last_IO_Error: Fatal error: The slave I/O thread stops because master and slave have equal MySQL server UUIDs; these UUIDs must be different for replication to work 1.1 server-idæ’æŸ¥ ä¸»åº“ï¼š 1234567mysql&gt; show variables like &apos;server_id&apos;;+---------------+-------+| Variable_name | Value |+---------------+-------+| server_id | 1 |+---------------+-------+1 row in set (0.01 sec) ä»åº“ï¼š 1234567mysql&gt; show variables like &apos;server_id&apos;;+---------------+-------+| Variable_name | Value |+---------------+-------+| server_id | 2 |+---------------+-------+1 row in set (0.01 sec) è‹¥æ­¤å¤„idé‡å¤äº†, åˆ™æ˜¯é…ç½®é”™äº†, å»ä¿®æ”¹é…ç½®å³å¯, å‚è€ƒä¸Šæ–‡ç¬¬ä¸‰èŠ‚çš„é…ç½® 1.2 File æ’æŸ¥ä¸»åº“: 1234567mysql&gt; show master status;+------------------+----------+--------------+------------------+-------------------+| File | Position | Binlog_Do_DB | Binlog_Ignore_DB | Executed_Gtid_Set |+------------------+----------+--------------+------------------+-------------------+| mysql-bin.000001 | 154 | | | |+------------------+----------+--------------+------------------+-------------------+1 row in set (0.00 sec) ä»åº“ï¼š 1234567mysql&gt; show master status;+------------------+----------+--------------+------------------+-------------------+| File | Position | Binlog_Do_DB | Binlog_Ignore_DB | Executed_Gtid_Set |+------------------+----------+--------------+------------------+-------------------+| mysql-bin.000001 | 306 | | | |+------------------+----------+--------------+------------------+-------------------+1 row in set (0.00 sec) Fileä¸€æ ·ï¼Œæ’é™¤ã€‚ 1.3 auto.cnfä¸­çš„server-uuidæ’æŸ¥æœ€åæ£€æŸ¥å‘ç°ä»–ä»¬çš„auto.cnfä¸­çš„server-uuidæ˜¯ä¸€æ ·çš„ã€‚ã€‚ã€‚ 123[root@localhost ~]# vim /var/lib/mysql/auto.cnf[auto]server-uuid=4f37a731-9b79-11e8-8013-000c29f0700f é—®é¢˜è§£å†³åœæ­¢ä»åº“çš„mysqldæœåŠ¡ï¼Œåˆ é™¤ä»–çš„auto.cnfæ–‡ä»¶ï¼Œå†å¯åŠ¨æ•°æ®åº“æœåŠ¡å³å¯ï¼š 123[root@localhost mysql]# systemctl stop mysqld.service[root@localhost mysql]# mv /var/lib/mysql/auto.cnf /var/lib/mysql/auto.cnf.bak[root@localhost mysql]# systemctl start mysqld.service æ­¤æ—¶å†å»æŸ¥çœ‹ä»åº“auto.cnfï¼Œå·²è‡ªåŠ¨ç”Ÿæˆæ–°çš„server-uuidï¼š 123[root@localhost mysql]# vim /var/lib/mysql/auto.cnf[auto]server-uuid=2682888d-994a-11e8-aaf0-000c298cdafc å†æŸ¥çœ‹ä»åº“çŠ¶æ€ï¼Œå·²æ­£å¸¸ 2. é‡ç½®ä¸»åº“çš„bin-logæ‰‹åŠ¨åˆ é™¤ å¯ä»¥ç›´æ¥åˆ é™¤binlogæ–‡ä»¶ï¼Œä½†æ˜¯å¯ä»¥é€šè¿‡mysqlæä¾›çš„å·¥å…·æ¥åˆ é™¤æ›´å®‰å…¨ï¼Œå› ä¸ºpurgeä¼šæ›´æ–°mysql-bin.indexä¸­çš„æ¡ç›®ï¼Œè€Œç›´æ¥åˆ é™¤çš„è¯ï¼Œmysql-bin.indexæ–‡ä»¶ä¸ä¼šæ›´æ–°ã€‚mysql-bin.indexçš„ä½œç”¨æ˜¯åŠ å¿«æŸ¥æ‰¾binlogæ–‡ä»¶çš„é€Ÿåº¦ã€‚ ï¼ˆ1ï¼‰ç›´æ¥åˆ é™¤ æ‰¾åˆ°binlogæ‰€åœ¨ç›®å½•ï¼Œç”¨rm binglogå ç›´æ¥åˆ é™¤ ä¾‹ï¼šrm mysql-bin.010 ï¼ˆ2ï¼‰é€šè¿‡mysqlæä¾›çš„å·¥å…·æ¥åˆ é™¤ åˆ é™¤ä¹‹å‰å¯ä»¥å…ˆçœ‹ä¸€ä¸‹purgeçš„ç”¨æ³•ï¼šhelp purge; åˆ é™¤ä¸¾ä¾‹(3ç§æ–¹æ³•)ï¼š RESET MASTER;//åˆ é™¤æ‰€æœ‰binlogæ—¥å¿—ï¼Œæ–°æ—¥å¿—ç¼–å·ä»å¤´å¼€å§‹ flush logs PURGE MASTER LOGS TO â€˜mysql-bin.010â€™;//åˆ é™¤mysql-bin.010ä¹‹å‰æ‰€æœ‰æ—¥å¿— PURGE MASTER LOGS BEFORE â€˜2003-04-02 22:46:26â€™;// åˆ é™¤2003-04-02 22:46:26ä¹‹å‰äº§ç”Ÿçš„æ‰€æœ‰æ—¥å¿— 3. é‡ç½®ä»åº“12345678910MySQLå½»åº•æ¸…é™¤slaveä¿¡æ¯åœ¨æˆ‘ä»¬çš„MySQLï¼ŒMasterå’ŒSlaveè¿›è¡Œä¸»ä»åˆ‡æ¢çš„æ—¶å€™ï¼ŒSlaveæˆåŠŸå‡çº§ä¸ºä¸»åº“ï¼Œé‚£ä¹ˆè¿™ä¸ªæ—¶å€™å°±éœ€è¦å½»åº•æ¸…ç†ä»åº“çš„ä¿¡æ¯ï¼Œä¸ç„¶ç›‘æ§ç³»ç»Ÿä¼šè®¤ä¸ºè¿™å°æœåŠ¡å™¨æ˜¯Slaveï¼Œè€Œä¸”ä¼šæŠ¥ä¸»ä»åŒæ­¥å¤±è´¥ã€‚å…¶å®éå¸¸çš„ç®€å•ï¼Œåªéœ€è¦ä»¥ä¸‹ä¸¤æ­¥ï¼šmysql&gt; stop slave;mysql&gt; reset slave all;reset slave all;æ˜¯æ¸…é™¤ä»åº“çš„åŒæ­¥å¤åˆ¶ä¿¡æ¯ã€åŒ…æ‹¬è¿æ¥ä¿¡æ¯å’ŒäºŒè¿›åˆ¶æ–‡ä»¶åã€ä½ç½®ã€‚ä»åº“ä¸Šæ‰§è¡Œè¿™ä¸ªå‘½ä»¤åï¼Œä½¿ç”¨show slave statuså°†ä¸ä¼šæœ‰è¾“å‡ºã€‚","categories":[{"name":"Mysql","slug":"Mysql","permalink":"/categories/Mysql/"}],"tags":[{"name":"mysql","slug":"mysql","permalink":"/tags/mysql/"},{"name":"MySQLé›†ç¾¤","slug":"MySQLé›†ç¾¤","permalink":"/tags/MySQL%E9%9B%86%E7%BE%A4/"}]},{"title":"Dockerå®ç”¨æŠ€å·§ä¹‹æ›´æ”¹è½¯ä»¶åŒ…æºæå‡æ„å»ºé€Ÿåº¦","slug":"Dockerå®ç”¨æŠ€å·§ä¹‹æ›´æ”¹è½¯ä»¶åŒ…æºæå‡æ„å»ºé€Ÿåº¦","date":"2019-10-22T19:17:37.000Z","updated":"2019-11-03T05:46:28.036Z","comments":true,"path":"2019/10/23/Dockerå®ç”¨æŠ€å·§ä¹‹æ›´æ”¹è½¯ä»¶åŒ…æºæå‡æ„å»ºé€Ÿåº¦/","link":"","permalink":"/2019/10/23/Docker%E5%AE%9E%E7%94%A8%E6%8A%80%E5%B7%A7%E4%B9%8B%E6%9B%B4%E6%94%B9%E8%BD%AF%E4%BB%B6%E5%8C%85%E6%BA%90%E6%8F%90%E5%8D%87%E6%9E%84%E5%BB%BA%E9%80%9F%E5%BA%A6/","excerpt":"","text":"Dockerå®ç”¨æŠ€å·§ä¹‹æ›´æ”¹è½¯ä»¶åŒ…æºæå‡æ„å»ºé€Ÿåº¦æœ¬æ–‡åœ¨åŸæ–‡çš„åŸºç¡€ä¸Šåšäº†ä¸€äº›ä¿®æ”¹å’Œè¡¥å……,æœ‰é—®é¢˜çš„åœ°æ–¹æ¬¢è¿æŒ‡å‡º åŸæ–‡é“¾æ¥: https://www.cnblogs.com/stulzq/p/9339250.html ä¸€. é—®é¢˜è¯´æ˜æˆ‘çš„ä¸€ä¸ªå¼€æºé¡¹ç›®æä¾›äº†åœ¨çº¿ç¤ºä¾‹ï¼Œé¡¹ç›®ä»£ç åœ¨githubï¼Œæäº¤ä»£ç ä»¥åé€šè¿‡JenkinsæŒç»­é›†æˆï¼Œä»¥Dockerçš„æ–¹å¼è¿è¡Œã€‚å¤§å®¶ç”¨è¿‡.NET Coreçš„äººåº”è¯¥éƒ½çŸ¥é“ï¼Œ.NET Core é»˜è®¤æ˜¯ä¸å¸¦ System.Drawingçš„ï¼Œå‰æœŸæœ‰ç¬¬ä¸‰æ–¹çš„å®ç°ï¼Œä¸ºæˆ‘ä»¬æä¾›äº†ä¸€ä¸ªè§£å†³æ–¹æ¡ˆï¼Œç°åœ¨å®˜æ–¹ä¹Ÿæä¾›äº†ä¸€ä¸ªï¼Œä»¥nugetåŒ…çš„æ–¹å¼å‘å¸ƒï¼Œåä¸º System.Drawing.Commonï¼Œå®ç”¨è¿™ä¸ªåŒ…å¯ä»¥æ­£å¸¸çš„è¿›è¡Œå„ç§å›¾ç‰‡æ“ä½œï¼Œæ¯”å¦‚ç”Ÿæˆå›¾ç‰‡éªŒè¯ç ï¼ŒäºŒç»´ç ç­‰ç­‰ï¼Œä½†æ˜¯å¦‚æœæˆ‘ä»¬å°†å…¶å‘å¸ƒåˆ°linuxï¼Œå°†ä¼šå‡ºç°å¼‚å¸¸ï¼šUnable to load DLL &#39;libgdiplus&#39;ã€‚è§£å†³åŠæ³•æ˜¯ï¼Œæˆ‘ä»¬åœ¨æ„å»ºDockeré•œåƒçš„æ—¶å€™ï¼Œå¯ä»¥é€šè¿‡å‘½ä»¤è£…ä¸Šlibgdiplusï¼Œä½†æ˜¯å¦‚æœç›´æ¥å†™å‘½ä»¤apt-get install -y libgdiplus ï¼Œä½ ä¼šå‘ç°æ„å»ºä¼šå‡ºé”™ï¼Œæ‰¾ä¸åˆ°è¿™ä¸ªåŒ…ï¼Œæˆ‘ä»¬éœ€è¦åœ¨æ‰§è¡Œè¿™ä¸ªå‘½ä»¤ä¹‹å‰ï¼Œæ‰§è¡Œapt-get updateæ›´æ–°è½¯ä»¶åŒ…æºï¼Œé‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œæˆ‘åœ¨ç¬¬ä¸€æ¬¡æ„å»ºDockeré•œåƒï¼ˆæ²¡æœ‰ä½¿ç”¨Cacheï¼‰çš„æ‰§è¡Œ apt-get updateå‘½ä»¤æ—¶ï¼Œéå¸¸çš„æ…¢ã€‚æœ€åæ•´ä¸ªæ„å»ºè¿‡ç¨‹èŠ±äº†12åˆ†é’Ÿã€‚ æ„å»ºçš„ç¨‹åºä¸º ASP.NET Core 2.1 åº”ç”¨ç¨‹åºï¼Œä½¿ç”¨çš„åŸºç¡€é•œåƒä¸ºå¾®è½¯å®˜æ–¹æä¾›çš„ï¼šmicrosoft/dotnet:2.1-aspnetcore-runtime è¿™ä¸èƒ½å¿å•Šï¼Œç®€ç›´æ˜¯å¤ªæ…¢äº†ï¼ŒæŸ¥çœ‹æ—¥å¿—ï¼Œå‘ç°è¿™é‡Œæ‰§è¡Œéå¸¸æ…¢ï¼š 123456After this operation, 38.8 MB of additional disk space will be used.Get:1 http://cdn-fastly.deb.debian.org/debian stretch/main amd64 libxau6 amd64 1:1.0.8-1 [20.7 kB]Get:2 http://cdn-fastly.deb.debian.org/debian stretch/main amd64 sgml-base all 1.29 [14.8 kB]Get:3 http://cdn-fastly.deb.debian.org/debian stretch/main amd64 libxml2 amd64 2.9.4+dfsg1-2.2+deb9u2 [920 kB]Get:4 http://cdn-fastly.deb.debian.org/debian stretch/main amd64 ucf all 3.0036 [70.2 kB]...æ­¤å¤„çœç•¥28ä¸ªï¼Œä¸€å…±32ä¸ª åº”è¯¥æ˜¯ä» http://cdn-fastly.deb.debian.org/debianè·å–æ•°æ®å¤ªæ…¢å¯¼è‡´çš„ï¼Œæ‰€ä»¥ï¼Œå‡†å¤‡æ›¿æ¢æ„å»ºæ‰€ä½¿ç”¨çš„åŸºç¡€é•œåƒçš„è½¯ä»¶åŒ…æºï¼Œå‡†å¤‡æ›¿æ¢ä¸ºç½‘æ˜“æä¾›çš„åŒ…æº http://mirrors.163.com/ äºŒ.é—®é¢˜è§£å†³â€“æ›¿æ¢è½¯ä»¶åŒ…æºè½¯ä»¶åŒ…æºçš„é…ç½®æ–‡ä»¶åœ¨åŸºç¡€é•œåƒæ‰€ç”¨çš„Linuxç³»ç»Ÿä¸­è·¯å¾„ä¸º /etc/apt/sources.listï¼Œæˆ‘ä»¬åªéœ€åœ¨æ‰§è¡Œ apt-get updateå‘½ä»¤ä¹‹å‰ï¼Œå°†æˆ‘ä»¬ç¼–å†™å¥½çš„ä½¿ç”¨ç½‘æ˜“åŒ…æºçš„é…ç½®æ–‡ä»¶è¿›è¡Œæ›¿æ¢å°±è¡Œäº†ã€‚ ä½¿ç”¨ç½‘æ˜“åŒ…æºçš„é…ç½®æ–‡ä»¶ï¼š sources.list 12345678deb http://mirrors.163.com/debian/ jessie main non-free contribdeb http://mirrors.163.com/debian/ jessie-updates main non-free contribdeb http://mirrors.163.com/debian/ jessie-backports main non-free contribdeb-src http://mirrors.163.com/debian/ jessie main non-free contribdeb-src http://mirrors.163.com/debian/ jessie-updates main non-free contribdeb-src http://mirrors.163.com/debian/ jessie-backports main non-free contribdeb http://mirrors.163.com/debian-security/ jessie/updates main non-free contribdeb-src http://mirrors.163.com/debian-security/ jessie/updates main non-free contrib é‚£ä¹ˆæœ‰ä¸€ä¸ªé—®é¢˜,åˆå§‹çš„æ—¶å€™dockerçš„linuxè¿viméƒ½æ²¡æœ‰, æ€ä¹ˆæ›´æ”¹æ–‡ä»¶çš„ä¸­å†…å®¹å‘¢??? æ¢ä¸ªæ€è·¯,ä¸æ›´æ”¹æ–‡ä»¶äº† mv /etc/apt/sources.list /etc/apt/sources.list.bak å°†åŸæ¥çš„æºæ–‡ä»¶æ‹·è´ä¸€ä»½ æ‰¾åˆ°é€‚åˆè‡ªå·±å®¹å™¨ä¸­linuxçš„ç‰ˆæœ¬, ç„¶åå»é˜¿é‡Œæºæ‰¾ç›¸åº”çš„æ›¿æ¢æº, æ¯”å¦‚æˆ‘çš„dockerçš„linuxç‰ˆæœ¬æ˜¯deblian, ä½¿ç”¨echo å‘½ä»¤ 123456789echo \"deb http://mirrors.163.com/debian/ jessie main non-free contribdeb http://mirrors.163.com/debian/ jessie-updates main non-free contribdeb http://mirrors.163.com/debian/ jessie-backports main non-free contribdeb-src http://mirrors.163.com/debian/ jessie main non-free contribdeb-src http://mirrors.163.com/debian/ jessie-updates main non-free contribdeb-src http://mirrors.163.com/debian/ jessie-backports main non-free contribdeb http://mirrors.163.com/debian-security/ jessie/updates main non-free contribdeb-src http://mirrors.163.com/debian-security/ jessie/updates main non-free contrib\" &gt; sources.listmv sources.list /etc/apt/sources.list é‡å¯ä¸€ä¸‹å®¹å™¨, ç„¶åapt-get update ä¸€ä¸‹, å“ˆå“ˆå“ˆå“ˆå“ˆå“ˆå“ˆ, è¿™é€Ÿåº¦,å®‰è£…è½¯ä»¶å¼€å¿ƒåˆ°é£èµ·ğŸ˜ğŸ˜˜ Dockerfile: 123456FROM microsoft/dotnet:2.1-aspnetcore-runtimeWORKDIR /appCOPY . .RUN mv /etc/apt/sources.list /etc/apt/sources.list.bak &amp;&amp; mv sources.list /etc/apt/ &amp;&amp; apt-get update -y &amp;&amp; apt-get install -y libgdiplus &amp;&amp; apt-get clean &amp;&amp; ln -s /usr/lib/libgdiplus.so /usr/lib/gdiplus.dllEXPOSE 80ENTRYPOINT [&quot;dotnet&quot;, &quot;Alipay.Demo.PCPayment.dll&quot;] ä¸»è¦æ˜¯è¿™ä¸¤å¥å‘½ä»¤ï¼š 1234#å¤‡ä»½æ—§çš„é…ç½®æ–‡ä»¶mv /etc/apt/sources.list /etc/apt/sources.list.bak#æ›¿æ¢ä¸ºæˆ‘ä»¬è‡ªå®šä¹‰çš„é…ç½®æ–‡ä»¶mv sources.list /etc/apt/ éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œsources.list éœ€è¦æ”¾åœ¨æˆ‘ä»¬æ‰“åŒ…çš„ç›®å½•ï¼Œä¿è¯èƒ½å¤åˆ¶åˆ°é•œåƒé‡Œé¢ã€‚ ç„¶åæ„å»ºæ—¶é—´ç”±12åˆ†é’Ÿç¼©çŸ­åˆ°37ç§’ï¼Œè¿™ä¸ªè¿‡ç¨‹æ˜¯æ²¡æœ‰ä½¿ç”¨Docker Cacheæ‰€èŠ±çš„æ—¶é—´ï¼š ä¸‰.å…¶ä»–åŠ é€Ÿ1.è…¾è®¯äº‘æˆ‘çš„æœåŠ¡å™¨æ˜¯ä½¿ç”¨çš„è…¾è®¯äº‘ï¼Œè…¾è®¯äº‘ä¹Ÿæä¾›äº†è½¯ä»¶åŒ…æºï¼Œåˆ†ä¸ºå†…ç½‘å’Œå¤–ç½‘ï¼Œå¤–ç½‘æ˜¯æ‰€æœ‰äººéƒ½èƒ½ä½¿ç”¨ï¼Œå†…ç½‘åªèƒ½è…¾è®¯äº‘çš„æœåŠ¡å™¨ä½¿ç”¨ã€‚ä½¿ç”¨å†…ç½‘çš„åŒ…æºå°†ä¼šè·å¾—æ›´å¿«çš„é€Ÿåº¦ã€‚è¯¦ç»†è¯´æ˜ï¼šhttps://cloud.tencent.com/document/product/213/8623 ä½¿ç”¨å†…ç½‘çš„è…¾è®¯äº‘åŒ…æºé…ç½®æ–‡ä»¶ï¼š 12345678deb http://mirrors.tencentyun.com/debian/ jessie main non-free contribdeb http://mirrors.tencentyun.com/debian/ jessie-updates main non-free contribdeb http://mirrors.tencentyun.com/debian/ jessie-backports main non-free contribdeb-src http://mirrors.tencentyun.com/debian/ jessie main non-free contribdeb-src http://mirrors.tencentyun.com/debian/ jessie-updates main non-free contribdeb-src http://mirrors.tencentyun.com/debian/ jessie-backports main non-free contribdeb http://mirrors.tencentyun.com/debian-security/ jessie/updates main non-free contribdeb-src http://mirrors.tencentyun.com/debian-security/ jessie/updates main non-free contrib 2.é˜¿é‡Œäº‘é˜¿é‡Œäº‘ä½œä¸ºä¸€ä¸ªå…¨çƒç¬¬ä¸‰çš„äº‘å¹³å°è¿è¥å•†ï¼Œä¹Ÿæ˜¯å…·æœ‰æ­¤é¡¹æœåŠ¡çš„ã€‚å…¶åŒ…æºåœ°å€ä¸ºï¼šhttps://mirrors.aliyun.com é…ç½®æ–‡ä»¶ï¼š 12345678deb https://mirrors.aliyun.com/debian/ jessie main non-free contribdeb https://mirrors.aliyun.com/debian/ jessie-updates main non-free contribdeb https://mirrors.aliyun.com/debian/ jessie-backports main non-free contribdeb-src https://mirrors.aliyun.com/debian/ jessie main non-free contribdeb-src https://mirrors.aliyun.com/debian/ jessie-updates main non-free contribdeb-src https://mirrors.aliyun.com/debian/ jessie-backports main non-free contribdeb https://mirrors.aliyun.com/debian-security/ jessie/updates main non-free contribdeb-src https://mirrors.aliyun.com/debian-security/ jessie/updates main non-free contrib å››.å…¶ä»–Linuxç³»ç»Ÿé•œåƒæˆ‘ç”¨çš„Dockeré•œåƒæ‰€ä½¿ç”¨çš„Linuxç³»ç»Ÿä¸º debianï¼Œå¦‚æœä½ æ˜¯ç”¨çš„ä¸æ˜¯ debianï¼Œé‚£ä¹ˆä½ å¯ä»¥é€šè¿‡ä»¥ä¸‹å‡ ä¸ªæ­¥éª¤æ¥è¿›è¡ŒåŒ…æºçš„æ›´æ”¹ã€‚ æ–¹æ³•ä¸€1.é€šè¿‡ä½ æ‰€ä½¿ç”¨é•œåƒå®˜æ–¹æä¾›çš„èµ„æ–™ï¼ŒæŸ¥è¯¢å‡ºé•œåƒæ‰€ä½¿ç”¨çš„Linuxç³»ç»ŸåŒ…æºè·¯å¾„ä»¥åŠé…ç½®æ–‡ä»¶å†…å®¹ 2.æ›¿æ¢åŠ é€Ÿåœ°å€ æ–¹æ³•äºŒ1.ä½¿ç”¨ä½ éœ€è¦ä½¿ç”¨çš„é•œåƒæ„å»ºä¸€ä¸ªç®€å•çš„ç¨‹åºï¼Œç„¶åè¿è¡Œã€‚ 2.é€šè¿‡Dockeräº¤äº’æ¨¡å¼ï¼Œè¿›å…¥å®¹å™¨ã€‚ 3.æŸ¥è¯¢å‡ºä½¿ç”¨çš„ç³»ç»ŸLinuxé•œåƒç‰ˆæœ¬ 4.æ‰¾åˆ°å¹¶æŸ¥çœ‹åŒ…æºé…ç½®æ–‡ä»¶ 5.å¤åˆ¶é…ç½®æ–‡ä»¶å†…å®¹ï¼Œç„¶åå°†åœ°å€æ›¿æ¢ä¸ºå¯¹åº”çš„åŠ é€Ÿåœ°å€","categories":[{"name":"Docker","slug":"Docker","permalink":"/categories/Docker/"}],"tags":[]},{"title":"mysql8.0è¿æ¥æŠ¥2059é”™è¯¯","slug":"mysql8-0è¿æ¥æŠ¥2059é”™è¯¯","date":"2019-10-22T18:51:44.000Z","updated":"2019-10-22T11:15:58.176Z","comments":true,"path":"2019/10/23/mysql8-0è¿æ¥æŠ¥2059é”™è¯¯/","link":"","permalink":"/2019/10/23/mysql8-0%E8%BF%9E%E6%8E%A5%E6%8A%A52059%E9%94%99%E8%AF%AF/","excerpt":"","text":"1.ç¯å¢ƒè¯´æ˜å®¿ä¸»æœºï¼šwin10 dockerï¼šVersion 18.06.1-ce-win73 (19507) mysqlï¼š8.xï¼ˆdocker storeä¸­æœ€æ–°ç‰ˆï¼‰ 2.æŠ¥é”™æè¿°ä½¿ç”¨navicatè¿æ¥å·¥å…·ï¼Œè¿æ¥æŠ¥é”™å¦‚ä¸‹ï¼š 3.æŠ¥é”™åŸå› è¯´æ˜ç”±äºæ–°ç‰ˆæœ¬çš„MySQLæ–°ç‰¹æ€§å¯¼è‡´çš„ï¼Œé€šè¿‡æŸ¥è¯¢mysql 1mysql&gt; select Host,User,plugin from mysql.user; æŸ¥è¯¢ç»“æœ+â€”â€”â€”â€“+â€”â€”â€”â€”â€”â€”+â€”â€”â€”â€”â€”â€”â€”â€“+| Host | User | plugin |+â€”â€”â€”â€“+â€”â€”â€”â€”â€”â€”+â€”â€”â€”â€”â€”â€”â€”â€“+| % | root | caching_sha2_password || % | vuluser | caching_sha2_password | æŸ¥è¯¢ç»“æœå¦‚ä¸Šï¼Œåœ¨è€ç‰ˆæœ¬é‡Œï¼Œä¸€èˆ¬ä½¿ç”¨åŠ å¯†æ–¹å¼ä¸ºmysql_native_passwordï¼Œå› ä¸ºè®¤è¯æ–¹å¼æ”¹å˜å¯¼è‡´çš„ã€‚ 4.ä¿®æ”¹æ–¹æ¡ˆ ä¿®æ”¹åŠ å¯†æ–¹å¼ä¸ºè€ç‰ˆæœ¬åŠ å¯†æ–¹å¼ã€‚ 5.ä¿®æ”¹5.1 æŸ¥çœ‹dockerå®¹å™¨IDdocker ps -a 5.2 docker exec ï¼šåœ¨è¿è¡Œçš„å®¹å™¨ä¸­æ‰§è¡Œå‘½ä»¤ 1docker exec -it 236b2624632d bash # è¿›å…¥åˆ°è‡ªå·±çš„å®¹å™¨ä¸­æ“ä½œ 5.3 è¿æ¥mysql1mysql -u root -p 5.4 ä¿®æ”¹åŠ å¯†æ–¹å¼æ‰§è¡Œå‘½ä»¤ï¼Œå°†ç”¨æˆ·çš„åŠ å¯†æ–¹å¼æ”¹ä¸ºmysql_native_passwordï¼Œå¯†ç ä¸ºrootã€‚ 1alter user 'root'@'%' identified with mysql_native_password by 'admin'; 5.5 æ‰§è¡Œå‘½ä»¤flush privilegesä½¿æƒé™é…ç½®é¡¹ç«‹å³ç”Ÿæ•ˆ1flush privileges;","categories":[{"name":"MySQL","slug":"MySQL","permalink":"/categories/MySQL/"},{"name":"Docker","slug":"MySQL/Docker","permalink":"/categories/MySQL/Docker/"}],"tags":[{"name":"mysql","slug":"mysql","permalink":"/tags/mysql/"},{"name":"docker","slug":"docker","permalink":"/tags/docker/"},{"name":"é¿å‘","slug":"é¿å‘","permalink":"/tags/%E9%81%BF%E5%9D%91/"}]},{"title":"è¯¦è§£é‡è½½ä¸é‡å†™","slug":"è¯¦è§£é‡è½½ä¸é‡å†™","date":"2019-10-21T15:11:32.000Z","updated":"2019-10-21T07:32:42.119Z","comments":true,"path":"2019/10/21/è¯¦è§£é‡è½½ä¸é‡å†™/","link":"","permalink":"/2019/10/21/%E8%AF%A6%E8%A7%A3%E9%87%8D%E8%BD%BD%E4%B8%8E%E9%87%8D%E5%86%99/","excerpt":"","text":"è¯¦è§£é‡è½½ä¸é‡å†™ Overloadæ˜¯é‡è½½çš„æ„æ€ï¼ŒOverrideæ˜¯è¦†ç›–çš„æ„æ€ï¼Œä¹Ÿå°±æ˜¯é‡å†™ã€‚ é‡è½½Overload:è¡¨ç¤ºåŒä¸€ä¸ªç±»ä¸­å¯ä»¥æœ‰å¤šä¸ªåç§°ç›¸åŒçš„æ–¹æ³•ï¼Œä½†è¿™äº›æ–¹æ³•çš„å‚æ•°åˆ—è¡¨å„ä¸ç›¸åŒï¼ˆå³å‚æ•°ä¸ªæ•°æˆ–ç±»å‹ä¸åŒ) é‡å†™Override:è¡¨ç¤ºå­ç±»ä¸­çš„æ–¹æ³•å¯ä»¥ä¸çˆ¶ç±»ä¸­çš„æŸä¸ªæ–¹æ³•çš„åç§°å’Œå‚æ•°å®Œå…¨ç›¸åŒï¼Œé€šè¿‡å­ç±»åˆ›å»ºçš„å®ä¾‹å¯¹è±¡è°ƒç”¨è¿™ä¸ªæ–¹æ³•æ—¶ï¼Œå°†è°ƒç”¨å­ç±»ä¸­çš„å®šä¹‰æ–¹æ³•ï¼Œè¿™ç›¸å½“äºæŠŠçˆ¶ç±»ä¸­å®šä¹‰çš„é‚£ä¸ªå®Œå…¨ç›¸åŒçš„æ–¹æ³•ç»™è¦†ç›–äº†ï¼Œè¿™ä¹Ÿæ˜¯é¢å‘å¯¹è±¡ç¼–ç¨‹çš„å¤šæ€æ€§çš„ä¸€ç§è¡¨ç°ã€‚ é‡å†™å­ç±»æŠ›å‡ºçš„å¼‚å¸¸&lt;=çˆ¶ç±»** å­ç±»è¦†ç›–çˆ¶ç±»çš„æ–¹æ³•æ—¶ï¼Œåªèƒ½æ¯”çˆ¶ç±»æŠ›å‡ºæ›´å°‘çš„å¼‚å¸¸ï¼Œæˆ–è€…æ˜¯æŠ›å‡ºçˆ¶ç±»æŠ›å‡ºçš„å¼‚å¸¸çš„å­å¼‚å¸¸ï¼Œå› ä¸ºå­ç±»å¯ä»¥è§£å†³çˆ¶ç±»çš„ä¸€äº›é—®é¢˜ï¼Œä¸èƒ½æ¯”çˆ¶ç±»æœ‰æ›´å¤šçš„é—®é¢˜ã€‚ å­ç±»æƒé™&gt;= çˆ¶ç±» å­ç±»æ–¹æ³•çš„è®¿é—®æƒé™åªèƒ½æ¯”çˆ¶ç±»çš„æ›´å¤§ï¼Œä¸èƒ½æ›´å°ã€‚å¦‚æœçˆ¶ç±»çš„æ–¹æ³•æ˜¯privateç±»å‹ï¼Œé‚£ä¹ˆï¼Œå­ç±»åˆ™ä¸å­˜åœ¨è¦†ç›–çš„é™åˆ¶ï¼Œç›¸å½“äºå­ç±»ä¸­å¢åŠ äº†ä¸€ä¸ªå…¨æ–°çš„æ–¹æ³•ã€‚ è¿”å›å€¼å¿…é¡»ç›¸åŒ è‡³äºOverloadedçš„æ–¹æ³•æ˜¯å¦å¯ä»¥æ”¹å˜è¿”å›å€¼çš„ç±»å‹è¿™ä¸ªé—®é¢˜ï¼Œè¦çœ‹ä½ å€’åº•æƒ³é—®ä»€ä¹ˆå‘¢ï¼Ÿè¿™ä¸ªé¢˜ç›®å¾ˆæ¨¡ç³Šã€‚å¦‚æœå‡ ä¸ªOverloadedçš„æ–¹æ³•çš„å‚æ•°åˆ—è¡¨ä¸ä¸€æ ·ï¼Œå®ƒä»¬çš„è¿”å›è€…ç±»å‹å½“ç„¶ä¹Ÿå¯ä»¥ä¸ä¸€æ ·ã€‚ä½†æˆ‘ä¼°è®¡ä½ æƒ³é—®çš„é—®é¢˜æ˜¯ï¼šå¦‚æœä¸¤ä¸ªæ–¹æ³•çš„å‚æ•°åˆ—è¡¨å®Œå…¨ä¸€æ ·ï¼Œæ˜¯å¦å¯ä»¥è®©å®ƒä»¬çš„è¿”å›å€¼ä¸åŒæ¥å®ç°é‡è½½Overloadã€‚è¿™æ˜¯ä¸è¡Œçš„ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨åè¯æ³•æ¥è¯´æ˜è¿™ä¸ªé—®é¢˜ï¼Œå› ä¸ºæˆ‘ä»¬æœ‰æ—¶å€™è°ƒç”¨ä¸€ä¸ªæ–¹æ³•æ—¶ä¹Ÿå¯ä»¥ä¸å®šä¹‰è¿”å›ç»“æœå˜é‡ï¼Œå³ä¸è¦å…³å¿ƒå…¶è¿”å›ç»“æœï¼Œä¾‹å¦‚ï¼Œæˆ‘ä»¬è°ƒç”¨map.remove(key)æ–¹æ³•æ—¶ï¼Œè™½ç„¶removeæ–¹æ³•æœ‰è¿”å›å€¼ï¼Œä½†æ˜¯æˆ‘ä»¬é€šå¸¸éƒ½ä¸ä¼šå®šä¹‰æ¥æ”¶è¿”å›ç»“æœçš„å˜é‡ï¼Œè¿™æ—¶å€™å‡è®¾è¯¥ç±»ä¸­æœ‰ä¸¤ä¸ªåç§°å’Œå‚æ•°åˆ—è¡¨å®Œå…¨ç›¸åŒçš„æ–¹æ³•ï¼Œä»…ä»…æ˜¯è¿”å›ç±»å‹ä¸åŒï¼Œjavaå°±æ— æ³•ç¡®å®šç¼–ç¨‹è€…å€’åº•æ˜¯æƒ³è°ƒç”¨å“ªä¸ªæ–¹æ³•äº†ï¼Œå› ä¸ºå®ƒæ— æ³•é€šè¿‡è¿”å›ç»“æœç±»å‹æ¥åˆ¤æ–­ã€‚ é‡å†™æ³¨æ„äº‹é¡¹ 1ã€è¦†ç›–çš„æ–¹æ³•çš„æ ‡å¿—å¿…é¡»è¦å’Œè¢«è¦†ç›–çš„æ–¹æ³•çš„æ ‡å¿—å®Œå…¨åŒ¹é…ï¼Œæ‰èƒ½è¾¾åˆ°è¦†ç›–çš„æ•ˆæœï¼› 2ã€è¦†ç›–çš„æ–¹æ³•çš„è¿”å›å€¼å¿…é¡»å’Œè¢«è¦†ç›–çš„æ–¹æ³•çš„è¿”å›ä¸€è‡´ï¼› 3ã€è¦†ç›–çš„æ–¹æ³•æ‰€æŠ›å‡ºçš„å¼‚å¸¸å¿…é¡»å’Œè¢«è¦†ç›–æ–¹æ³•çš„æ‰€æŠ›å‡ºçš„å¼‚å¸¸ä¸€è‡´ï¼Œæˆ–è€…æ˜¯å…¶å­ç±»ï¼› 4ã€è¢«è¦†ç›–çš„æ–¹æ³•ä¸èƒ½ä¸ºprivateï¼Œå¦åˆ™åœ¨å…¶å­ç±»ä¸­åªæ˜¯æ–°å®šä¹‰äº†ä¸€ä¸ªæ–¹æ³•ï¼Œå¹¶æ²¡æœ‰å¯¹å…¶è¿›è¡Œè¦†ç›–ã€‚ é‡è½½overload å¯¹æˆ‘ä»¬æ¥è¯´å¯èƒ½æ¯”è¾ƒç†Ÿæ‚‰ï¼Œå¯ä»¥ç¿»è¯‘ä¸ºé‡è½½ï¼Œå®ƒæ˜¯æŒ‡æˆ‘ä»¬å¯ä»¥å®šä¹‰ä¸€äº›åç§°ç›¸åŒçš„æ–¹æ³•ï¼Œé€šè¿‡å®šä¹‰ä¸åŒçš„è¾“å…¥å‚æ•°æ¥åŒºåˆ†è¿™äº›æ–¹æ³•ï¼Œç„¶åå†è°ƒç”¨æ—¶ï¼ŒVMå°±ä¼šæ ¹æ®ä¸åŒçš„å‚æ•°æ ·å¼ï¼Œæ¥é€‰æ‹©åˆé€‚çš„æ–¹æ³•æ‰§è¡Œã€‚ é‡è½½è¦æ³¨æ„ä»¥ä¸‹çš„å‡ ç‚¹ï¼š 1ã€åœ¨ä½¿ç”¨é‡è½½æ—¶åªèƒ½é€šè¿‡ä¸åŒçš„å‚æ•°æ ·å¼ã€‚ä¾‹å¦‚ï¼Œä¸åŒçš„å‚æ•°ç±»å‹ï¼Œä¸åŒçš„å‚æ•°ä¸ªæ•°ï¼Œä¸åŒçš„å‚æ•°é¡ºåºï¼ˆå½“ç„¶ï¼ŒåŒä¸€æ–¹æ³•å†…çš„å‡ ä¸ªå‚æ•°ç±»å‹å¿…é¡»ä¸ä¸€æ ·ï¼Œä¾‹å¦‚å¯ä»¥æ˜¯fun(int,float)ï¼Œä½†æ˜¯ä¸èƒ½ä¸ºfun(int,int)ï¼‰ï¼› 2ã€ä¸èƒ½é€šè¿‡è®¿é—®æƒé™ã€è¿”å›ç±»å‹ã€æŠ›å‡ºçš„å¼‚å¸¸è¿›è¡Œé‡è½½ï¼› 3ã€æ–¹æ³•çš„å¼‚å¸¸ç±»å‹å’Œæ•°ç›®ä¸ä¼šå¯¹é‡è½½é€ æˆå½±å“ï¼› 4ã€å¯¹äºç»§æ‰¿æ¥è¯´ï¼Œå¦‚æœæŸä¸€æ–¹æ³•åœ¨çˆ¶ç±»ä¸­æ˜¯è®¿é—®æƒé™æ˜¯priavteï¼Œé‚£ä¹ˆå°±ä¸èƒ½åœ¨å­ç±»å¯¹å…¶è¿›è¡Œé‡è½½ï¼Œå¦‚æœå®šä¹‰çš„è¯ï¼Œä¹Ÿåªæ˜¯å®šä¹‰äº†ä¸€ä¸ªæ–°æ–¹æ³•ï¼Œè€Œä¸ä¼šè¾¾åˆ°é‡è½½çš„æ•ˆæœã€‚(å…¶æœ¬è´¨æ˜¯privateæ–¹æ³•æ˜¯å±äºçˆ¶ç±»çš„, å­ç±»æ— æ³•è®¿é—®åˆ°,ç›¸å½“äºå­ç±»æ ¹æœ¬æ²¡æœ‰è¯¥æ–¹æ³• ä¸èƒ½å¯¹å…¶é‡è½½) æ€»ç»“é‡å†™: å…³å¿ƒæ–¹æ³•çš„è®¿é—®æƒé™, æ–¹æ³•çš„å¼‚å¸¸æŠ›å‡ºç±»å‹, ä»¥åŠè¿”å›ç±»å‹æ˜¯å¦ä¸€è‡´ é‡è½½: åªå…³å¿ƒæ–¹æ³•å‚æ•°çš„ä¸ªæ•°, ç±»å‹, é¡ºåº","categories":[{"name":"Java","slug":"Java","permalink":"/categories/Java/"}],"tags":[{"name":"Java","slug":"Java","permalink":"/tags/Java/"}]},{"title":"Main","slug":"Main","date":"2019-10-21T08:27:40.103Z","updated":"2019-10-21T08:31:50.215Z","comments":true,"path":"2019/10/21/Main/","link":"","permalink":"/2019/10/21/Main/","excerpt":"","text":"typoraæµç¨‹å›¾ç”»æ³•1.1 æµç¨‹å›¾1.1 æ¨ªå‘æµç¨‹å›¾æºç æ ¼å¼:123456graph LRA[æ–¹å½¢] --&gt; B(åœ†è§’) B --&gt; C&#123;æ¡ä»¶a&#125; C --&gt; |a=1| D[ç»“æœ1] C --&gt; |a=2| E[ç»“æœ2] F[æ¨ªå‘æµç¨‹å›¾] 1.2 ç«–å‘æµç¨‹å›¾æºç æ ¼å¼:123456graph TDA[æ–¹å½¢] --&gt; B(åœ†è§’) B --&gt; C&#123;æ¡ä»¶a&#125; C --&gt; |a=1| D[ç»“æœ1] C --&gt; |a=2| E[ç»“æœ2]F[ç«–å‘æµç¨‹å›¾] 1.3 æ ‡å‡†æµç¨‹å›¾æºç æ ¼å¼:123456789st=&gt;start: å¼€å§‹æ¡†op=&gt;operation: å¤„ç†æ¡†cond=&gt;condition: åˆ¤æ–­æ¡†sub1=&gt;subroutine: å­æµç¨‹io=&gt;inputoutput: è¾“å…¥è¾“å‡ºæ¡†e=&gt;end: ç»“æŸæ¡†st-&gt;op-&gt;condcond(yes)-&gt;io-&gt;econd(no)-&gt;sub1(right)-&gt;op 1.4 æ ‡å‡†æµç¨‹å›¾æºç æ ¼å¼(æ¨ªå‘):123456789st=&gt;start: å¼€å§‹æ¡†op=&gt;operation: å¤„ç†æ¡†cond=&gt;condition: åˆ¤æ–­æ¡†(æ˜¯æˆ–å¦?)sub1=&gt;subroutine: å­æµç¨‹io=&gt;inputoutput: è¾“å…¥è¾“å‡ºæ¡†e=&gt;end: ç»“æŸæ¡†st(right)-&gt;op(right)-&gt;condcond(yes)-&gt;io(bottom)-&gt;econd(no)-&gt;sub1(right)-&gt;op 1.2 UMLæ—¶åºå›¾1.2.1 UMLæ—¶åºå›¾æºç æ ·ä¾‹:12345å¯¹è±¡A-&gt;å¯¹è±¡B: å¯¹è±¡Bä½ å¥½å—? (è¯·æ±‚)Note right of å¯¹è±¡B: å¯¹è±¡Bçš„æè¿°Note left of å¯¹è±¡A: å¯¹è±¡Açš„æè¿°(æç¤º)å¯¹è±¡B --&gt; å¯¹è±¡A: æˆ‘å¾ˆå¥½(å“åº”)å¯¹è±¡A --&gt; å¯¹è±¡B: ä½ çœŸçš„å¥½å—? 1.2.2 UMLæ—¶åºå›¾æºç å¤æ‚æ ·ä¾‹:1234567891011Title: æ ‡é¢˜: å¤æ‚ä½¿ç”¨å¯¹è±¡A -&gt; å¯¹è±¡B: å¯¹è±¡Bä½ å¥½å—? (è¯·æ±‚)Note right of å¯¹è±¡B: å¯¹è±¡Bçš„æè¿°Note right of å¯¹è±¡A: å¯¹è±¡Açš„æè¿°(æç¤º)å¯¹è±¡B --&gt; å¯¹è±¡A: æˆ‘å¾ˆå¥½(å“åº”)å¯¹è±¡B --&gt; å°ä¸‰: ä½ å¥½å—?å°ä¸‰ -&gt; å¯¹è±¡A: å¯¹è±¡Bæ‰¾æˆ‘äº†å¯¹è±¡A --&gt; å¯¹è±¡B: ä½ çœŸçš„å¥½å—?Note over å°ä¸‰, å¯¹è±¡B: æˆ‘ä»¬æ˜¯æœ‹å‹participant CNote right of C: æ²¡äººé™ªæˆ‘ç© 1.2.3 UMLæ ‡å‡†æ—¶åºå›¾æ ·ä¾‹:123456789101112%%æ—¶åºå›¾ä¾‹å­, -&gt; å®çº¿, --&gt; è™šçº¿, -&gt;&gt; å®çº¿ç®­å¤´ sequenceDiagram participant å¼ ä¸‰ participant æå›› å¼ ä¸‰ -&gt; ç‹äº”: ç‹äº”ä½ å¥½å—? loop å¥åº·æ£€æŸ¥ ç‹äº” -&gt; ç‹äº”: ä¸ç–¾ç—…æˆ˜æ–— end Note right of ç‹äº”: åˆç†é¥®é£Ÿ &lt;br/&gt;çœ‹åŒ»ç”Ÿ... æå›› -&gt;&gt; å¼ ä¸‰: å¾ˆå¥½! ç‹äº” -&gt; æå››: ä½ æ€ä¹ˆæ ·? æå›› --&gt; ç‹äº”: å¾ˆå¥½! 1.3 ç”˜ç‰¹å›¾æ ·ä¾‹:12345678910111213141516171819202122%%è¯­æ³•ç¤ºä¾‹ gantt dateFormat YYYY-MM-DD title è½¯ä»¶å¼€å‘ç”˜ç‰¹å›¾ section è®¾è®¡ éœ€æ±‚ :done, des1, 2014-01-06, 2014-01-08 åŸå‹ :active, des2, 2014-01-09, 3d UIè®¾è®¡ :des3, after des2, 5d æœªæ¥ä»»åŠ¡: :des4, after des3, 5d section å¼€å‘ å­¦ä¹ å‡†å¤‡ç†è§£éœ€æ±‚ :crit, done, 2014-01-06, 24h è®¾è®¡æ¡†æ¶ :crit, done, after des2, 2d å¼€å‘ :crit, active, 3d æœªæ¥ä»»åŠ¡ :crit, 5d è€ :2d section æµ‹è¯• åŠŸèƒ½æµ‹è¯• :active, a1, after des3, 3d å‹åŠ›æµ‹è¯• :after a1, 20h æµ‹è¯•æŠ¥å‘Š :48h","categories":[],"tags":[]},{"title":"Doubleå’ŒFloatçš„åŒºåˆ«","slug":"Doubleå’ŒFloatçš„åŒºåˆ«","date":"2019-10-20T20:55:32.000Z","updated":"2019-10-20T13:20:32.296Z","comments":true,"path":"2019/10/21/Doubleå’ŒFloatçš„åŒºåˆ«/","link":"","permalink":"/2019/10/21/Double%E5%92%8CFloat%E7%9A%84%E5%8C%BA%E5%88%AB/","excerpt":"","text":"Doubleå’ŒFloatçš„åŒºåˆ« å¯¹ç¼–ç¨‹äººå‘˜æ¥è¯´ï¼Œdouble å’Œ float çš„åŒºåˆ«æ˜¯doubleç²¾åº¦é«˜ï¼Œ å•ç²¾åº¦æµ®ç‚¹æ•°æœ‰æ•ˆæ•°å­—8ä½ï¼ŒåŒç²¾åº¦æµ®ç‚¹æ•°æœ‰æ•ˆæ•°å­—16ä½ã€‚ ä½†doubleæ¶ˆè€—å†…å­˜æ˜¯floatçš„ä¸¤å€ï¼Œdoubleçš„è¿ç®—é€Ÿåº¦æ¯”floatæ…¢å¾—å¤šï¼ŒCè¯­è¨€ä¸­æ•°å­¦å‡½æ•°åç§°double å’Œ floatä¸åŒï¼Œä¸è¦å†™é”™ï¼Œèƒ½ç”¨å•ç²¾åº¦æ—¶ä¸è¦ç”¨åŒç²¾åº¦ï¼ˆä»¥çœå†…å­˜ï¼ŒåŠ å¿«è¿ç®—é€Ÿåº¦ï¼‰ã€‚ Doubleä¸Floatçš„å­˜å‚¨æ–¹å¼javaè¯­è¨€ä¸­ï¼Œfloatç±»å‹æ•°å­—åœ¨è®¡ç®—æœºä¸­ç”¨4ä¸ªå­—èŠ‚ï¼ˆ32ä½ï¼‰æ¥å­˜å‚¨ã€‚doubleç±»å‹å ç”¨8ä¸ªå­—èŠ‚ï¼ˆ64ä½ï¼‰ã€‚ ä»å­˜å‚¨ç»“æ„å’Œç®—æ³•ä¸Šæ¥è®²ï¼Œdoubleå’Œfloatæ˜¯ä¸€æ ·çš„ï¼Œä¸ä¸€æ ·çš„åœ°æ–¹ä»…ä»…æ˜¯floatæ˜¯32ä½çš„ï¼Œdoubleæ˜¯64ä½çš„ï¼Œæ‰€ä»¥doubleèƒ½å­˜å‚¨æ›´é«˜çš„ç²¾åº¦ã€‚ æŒ‰ç…§IEEEåˆ¶å®šçš„æµ®ç‚¹æ•°è¡¨ç¤ºæ³•æ¥è¿›è¡Œfloat,doubleè¿ç®—ã€‚è¿™ç§ç»“æ„æ˜¯ä¸€ç§ç§‘å­¦è®¡æ•°æ³•ï¼šç”¨ç¬¦å·ã€æŒ‡æ•°å’Œå°¾æ•°æ¥è¡¨ç¤ºã€‚æŒ‡æ•°å¯æ­£å¯è´Ÿï¼Œæ‰€ä»¥ï¼ŒIEEEè§„å®šï¼Œæ­¤å¤„ç®—å‡ºçš„æ¬¡æ–¹å¿…é¡»å‡å»127æ‰æ˜¯çœŸæ­£çš„æŒ‡æ•°ã€‚åº•æ•°å®šä¸º2ï¼Œå³æŠŠä¸€ä¸ªæµ®ç‚¹æ•°è¡¨ç¤ºä¸ºå°¾æ•°ä¹˜ä»¥2çš„æŒ‡æ•°æ¬¡æ–¹å†æ·»ä¸Šç¬¦å·ã€‚ ä¸‹é¢æ˜¯å…·ä½“çš„è§„æ ¼ï¼š ç±»å‹ ç¬¦å·ä½ æŒ‡æ•° å°¾æ•° é•¿åº¦ float 1 8 23 32 double 1 11 52 64 ä»¥floatä¸ºä¾‹ï¼š å› ä¸ºæŒ‡æ•°éœ€è¦å‡å»127ï¼Œæ‰€ä»¥floatç±»å‹çš„æŒ‡æ•°å¯ä»-126åˆ°128ã€‚ ç§‘å­¦è®¡æ•°æ³•ï¼š SEEEEEEE EMMMMMMM MMMMMMMM MMMMMMMM Sè¡¨ç¤ºæµ®ç‚¹æ•°æ­£è´Ÿ Eè¡¨ç¤ºæŒ‡æ•°åŠ ä¸Š127çš„å€¼åå¾—åˆ°çš„äºŒè¿›åˆ¶æ•°æ® ==Mè¡¨ç¤ºå°¾æ•°ï¼Œæœ€é«˜ä½å›ºå®šä¸º1== ä¸¾ä¾‹ï¼š17.625åœ¨å†…å­˜ä¸­çš„å­˜å‚¨ä¸ºï¼š é¦–å…ˆè¦æŠŠ17.625æ¢ç®—æˆäºŒè¿›åˆ¶ï¼š10001.101ã€‚ æ•´æ•°éƒ¨åˆ†ï¼šé™¤ä»¥2ï¼Œç›´åˆ°å•†ä¸º0ï¼Œä½™æ•°åè½¬ã€‚ï¼ˆå³ï¼šæ¨¡2å–ä½™æ³•ï¼‰ 17 % 2 = 8 â€”&gt; 1 ä½ä½ 8 % 2 = 4 â€”&gt; 0 4 % 2 = 2 â€”&gt; 0 2 % 2 = 1 â€”&gt; 0 1 % 2 = 0 â€”&gt; 1 é«˜ä½ æ‰€ä»¥æ•´æ•°éƒ¨åˆ†çš„äºŒè¿›åˆ¶è¡¨ç¤º= 10001 å°æ•°éƒ¨åˆ†ï¼šä¹˜ä»¥2ï¼Œç›´åˆ°ä¹˜ä½ä¸º0ï¼Œè¿›ä½é¡ºåºå–ã€‚ï¼ˆå³ï¼šä¹˜2å–æ•´æ³•ï¼‰ æŒ‰å¦‚ä¸‹ç®—æ³•è¿›è¡Œï¼š 1ï¼‰é¦–å…ˆç»™å°æ•°éƒ¨åˆ†ä¹˜2ï¼Œå¾—åˆ°çš„æ•°ï¼Œå¦‚æœå°æ•°ç‚¹å‰ä¸º1ï¼›åˆ™è®¡1ï¼Œä¸º0ï¼Œåˆ™è®¡0ã€‚ 2ï¼‰å†å¯¹å‰©ä¸‹çš„å°æ•°éƒ¨åˆ†ä¹˜2ï¼Œå†è®¡å‡º1æˆ–0ã€‚ 3ï¼‰é‡å¤ä»¥ä¸Šæ­¥éª¤ï¼Œç›´è‡³è¾¾åˆ°éœ€è¦çš„ç²¾åº¦ã€‚ 0.625 x 2 = 1.25 â€”&gt; 1 -1ä½ 0.25 x 2 = 0.5 â€”&gt; 0 -2ä½ 0.5 x 2 = 1.0 â€”&gt; 1 -3ä½ 0.0 x 2 = 0.0 â€”&gt; 0 -4ä½ â€¦â€¦. æ‰€ä»¥å°æ•°éƒ¨åˆ†å¾—åˆ°çš„äºŒè¿›åˆ¶è¡¨ç¤º= 0101 å³101 ä»¥ä¸Šå¾—åˆ°17.625æ¢ç®—æˆäºŒè¿›åˆ¶ä¸º10001.101ã€‚ å†å°†10001.101å³ç§»ï¼Œç›´åˆ°å°æ•°ç‚¹å‰åªå‰©1ä½ï¼Œ1.0001101 * 2^4 ï¼Œå³ç§»åŠ¨äº†å››ä½ã€‚ æ­¤æ—¶ï¼Œåº•æ•°å’ŒæŒ‡æ•°å°±å‡ºæ¥äº†ã€‚ åº•æ•°ï¼šå› ä¸ºå°æ•°ç‚¹å‰å¿…ä¸º1ï¼Œæ‰€ä»¥IEEEè§„å®šåªè®°å½•å°æ•°ç‚¹åçš„å°±å¥½ã€‚æ‰€ä»¥ï¼Œæ­¤å¤„çš„åº•æ•°ä¸ºï¼š0001101 æŒ‡æ•°ï¼šå®é™…ä¸º4ï¼Œå¿…é¡»åŠ ä¸Š127(è½¬å‡ºçš„æ—¶å€™ï¼Œå‡å»127)ï¼Œæ‰€ä»¥ä¸º131ã€‚ä¹Ÿå°±æ˜¯10000011 ç¬¦å·ï¼šå› ä¸ºæ˜¯æ­£æ•°ï¼Œæ‰€ä»¥æ˜¯0 ç»¼ä¸Šæ‰€è¿°ï¼Œ17.625åœ¨å†…å­˜ä¸­çš„å­˜å‚¨æ ¼å¼æ˜¯ï¼š 0 (ç¬¦å·)+ 10000011 (æŒ‡æ•°)+ 0001101(åº•æ•°)+00000000 00000000 (è¡¥0, å‡‘æ»¡32ä½) å³=&gt;01000001 10001101 00000000 00000000","categories":[{"name":"Java","slug":"Java","permalink":"/categories/Java/"},{"name":"åŸºæœ¬ç±»å‹","slug":"Java/åŸºæœ¬ç±»å‹","permalink":"/categories/Java/%E5%9F%BA%E6%9C%AC%E7%B1%BB%E5%9E%8B/"}],"tags":[{"name":"Java","slug":"Java","permalink":"/tags/Java/"}]},{"title":"Javaä¿®é¥°ç¬¦è¯¦è§£","slug":"Javaä¿®é¥°ç¬¦è¯¦è§£","date":"2019-10-20T20:27:01.000Z","updated":"2019-10-20T13:32:12.113Z","comments":true,"path":"2019/10/21/Javaä¿®é¥°ç¬¦è¯¦è§£/","link":"","permalink":"/2019/10/21/Java%E4%BF%AE%E9%A5%B0%E7%AC%A6%E8%AF%A6%E8%A7%A3/","excerpt":"","text":"Javaä¿®é¥°ç¬¦Javaä¿®é¥°ç¬¦ç”¨æ¥å®šä¹‰ç±»ã€æ–¹æ³•ã€å˜é‡ï¼Œé€šå¸¸æ”¾åœ¨è¯­å¥çš„æœ€å‰ç«¯ï¼Œä¿®é¥°ç¬¦ä¸»è¦åˆ†ä¸ºä¸¤ç±»ï¼š è®¿é—®æ§åˆ¶ä¿®é¥°ç¬¦ éè®¿é—®ä¿®é¥°ç¬¦ è®¿é—®æ§åˆ¶ä¿®é¥°ç¬¦è®¿é—®æ§åˆ¶ä¿®é¥°ç¬¦å®šä¹‰ç±»ã€å˜é‡ã€æ–¹æ³•çš„è®¿é—®æƒé™ã€‚Javaæ”¯æŒ4ç§è®¿é—®æ§åˆ¶ä¿®é¥°ç¬¦ï¼špublic, protected, default, private. publicï¼šä¿®é¥°ç±»ã€æ¥å£ã€æ–¹æ³•ã€å˜é‡ï¼Œæ‰€ä¿®é¥°çš„å¯¹è±¡å¯¹æ‰€æœ‰ç±»å¯è§ã€‚ protectedï¼šä¿®é¥°å˜é‡å’Œæ–¹æ³•ï¼Œæ‰€ä¿®é¥°çš„å¯¹è±¡å¯¹åŒä¸€åŒ…å†…çš„ç±»å¯è§ï¼Œè‹¥å­ç±»ä¸åœ¨åŒä¸€ä¸ªåŒ…å†…ï¼Œåˆ™è¯¥å­ç±»åªèƒ½è®¿é—®å…¶ç»§æ‰¿çš„æˆå‘˜ã€‚ï¼ˆè¯¦æƒ…è§Java protected å…³é”®å­—è¯¦è§£ï¼‰ defaultï¼šä¿®é¥°ç±»ã€æ¥å£ã€æ–¹æ³•ã€å˜é‡ï¼Œå½“ç¼ºçœè®¿é—®æ§åˆ¶ä¿®é¥°ç¬¦æ—¶é»˜è®¤ä¸ºdefaultï¼Œæ‰€ä¿®é¥°çš„å¯¹è±¡åœ¨åŒä¸€åŒ…å†…å¯è§ã€‚ privateï¼šä¿®é¥°å˜é‡å’Œæ–¹æ³•ï¼Œæ‰€ä¿®é¥°çš„å¯¹è±¡åªåœ¨åŒä¸€ç±»å†…å¯è§ã€‚ç”¨privateä¿®é¥°çš„å˜é‡ä¸èƒ½è¢«å¤–éƒ¨ç›´æ¥è®¿é—®ï¼Œé€šå¸¸éœ€è¦é€šè¿‡getterå’Œsetteræ–¹æ³•é—´æ¥è®¿é—®ï¼Œå®ç°å¯¹å¯¹è±¡æˆå‘˜å˜é‡çš„ä¿æŠ¤ã€‚ ä¿®é¥°ç¬¦ å½“å‰ç±» åŒä¸€åŒ…å†… å­å­™ç±»ï¼ˆåŒä¸€åŒ…ï¼‰ å­å­™ç±»ï¼ˆä¸åŒåŒ…ï¼‰ å…¶ä»–åŒ… public Y Y Y Y Y protected Y Y Y Y/Nè¯¦è§£ N default Y Y Y N N private Y N N N N éè®¿é—®ä¿®é¥°ç¬¦éè®¿é—®ä¿®é¥°ç¬¦å®ç°ä¸€äº›å…¶ä»–åŠŸèƒ½ static ä¿®é¥°ç¬¦ï¼Œç”¨æ¥ä¿®é¥°ç±»æ–¹æ³•å’Œç±»å˜é‡ã€‚staticä¿®é¥°çš„å˜é‡å’Œæ–¹æ³•ç§°ä¸ºé™æ€å˜é‡å’Œé™æ€æ–¹æ³•ï¼Œä¹Ÿå«ç±»å˜é‡å’Œç±»æ–¹æ³•ï¼Œé™æ€å˜é‡å’Œé™æ€æ–¹æ³•ä¸éšç€åˆ›å»ºå¯¹è±¡è€Œåˆ›å»ºï¼Œå®ƒä»¬å±äºç±»æœ¬èº«æ‰€æœ‰ã€‚ final ä¿®é¥°ç¬¦ï¼Œç”¨æ¥ä¿®é¥°ç±»ã€æ–¹æ³•å’Œå˜é‡ã€‚ finalä¿®é¥°çš„ç±»ä¸èƒ½å¤Ÿè¢«ç»§æ‰¿ã€‚ finalä¿®é¥°çš„æ–¹æ³•å¯ä»¥è¢«ç»§æ‰¿ï¼Œä½†æ˜¯ä¸èƒ½è¢«å­ç±»é‡æ–°å®šä¹‰ã€‚ ä¿®é¥°çš„å˜é‡ä¸ºå¸¸é‡ï¼Œæ˜¯ä¸å¯ä¿®æ”¹çš„ï¼Œç”¨finalä¿®é¥°çš„å¸¸é‡åœ¨åˆ›å»ºæ—¶å¿…é¡»èµ‹å€¼ã€‚ æ³¨æ„!!! finalä¿®é¥°çš„å˜é‡å¦‚æœæ˜¯ä¸€ä¸ªåŸºæœ¬ç±»å‹,é‚£ä¹ˆå®ƒçš„å€¼ä¸èƒ½å¤Ÿå†æ”¹å˜,å¦åˆ™ç¼–è¯‘æŠ¥é”™, å¦‚æœfinalä¿®é¥°çš„å˜é‡æ˜¯ä¸€ä¸ªå¼•ç”¨ç±»å‹,å¦‚æ•°ç»„,é‚£ä¹ˆè¡¨ç¤ºæ”¹å˜é‡ä¸èƒ½å†æŒ‡å‘å…¶ä»–å˜é‡,ä½†æ”¹å˜é‡é‡Œçš„å€¼æ˜¯å¯ä»¥æ”¹å˜çš„ å¦‚final x []=new int[10], æˆ‘ä»¬ä¸ºx[1] èµ‹å€¼æ˜¯ä¸æ˜¯æŠ¥é”™çš„. 12345678910public class Test&#123; final int value = 10; // ä¸‹é¢æ˜¯å£°æ˜å¸¸é‡çš„å®ä¾‹ public static final int BOXWIDTH = 6; static final String TITLE = \"Manager\"; public void changeValue()&#123; value = 12; //å°†è¾“å‡ºä¸€ä¸ªé”™è¯¯ &#125;&#125; abstractä¿®é¥°ç¬¦ï¼Œç”¨æ¥åˆ›å»ºæŠ½è±¡ç±»å’ŒæŠ½è±¡æ–¹æ³•ã€‚ synchronizedä¿®é¥°ç¬¦å£°æ˜çš„æ–¹æ³•åŒä¸€æ—¶é—´åªèƒ½è¢«ä¸€ä¸ªçº¿ç¨‹è®¿é—®ã€‚ volatileä¿®é¥°çš„æˆå‘˜å˜é‡åœ¨æ¯æ¬¡è¢«çº¿ç¨‹è®¿é—®æ—¶ï¼Œéƒ½å¼ºåˆ¶ä»å…±äº«å†…å­˜ä¸­é‡æ–°è¯»å–è¯¥æˆå‘˜å˜é‡çš„å€¼ã€‚è€Œä¸”ï¼Œå½“æˆå‘˜å˜é‡å‘ç”Ÿå˜åŒ–æ—¶ï¼Œä¼šå¼ºåˆ¶çº¿ç¨‹å°†å˜åŒ–å€¼å›å†™åˆ°å…±äº«å†…å­˜ã€‚è¿™æ ·åœ¨ä»»ä½•æ—¶åˆ»ï¼Œä¸¤ä¸ªä¸åŒçš„çº¿ç¨‹æ€»æ˜¯çœ‹åˆ°æŸä¸ªæˆå‘˜å˜é‡çš„åŒä¸€ä¸ªå€¼ã€‚ transient åºåˆ—åŒ–çš„å¯¹è±¡åŒ…å«è¢« transient ä¿®é¥°çš„å®ä¾‹å˜é‡æ—¶ï¼Œjava è™šæ‹Ÿæœº(JVM)è·³è¿‡è¯¥ç‰¹å®šçš„å˜é‡ã€‚ ==ä¸€æ—¦ä¸€ä¸ªç±»è¢«staticä¿®é¥°, é‚£ä¹ˆå®ƒå°±å˜æˆäº†ä¸€ä¸ªé¡¶çº§ç±»==","categories":[{"name":"Java","slug":"Java","permalink":"/categories/Java/"}],"tags":[{"name":"Java","slug":"Java","permalink":"/tags/Java/"}]},{"title":"Javaé™æ€ä»£ç†ä¸åŠ¨æ€ä»£ç†çš„åŒºåˆ«","slug":"Javaé™æ€ä»£ç†ä¸åŠ¨æ€ä»£ç†çš„åŒºåˆ«","date":"2019-10-20T19:50:51.000Z","updated":"2019-10-20T12:05:48.145Z","comments":true,"path":"2019/10/21/Javaé™æ€ä»£ç†ä¸åŠ¨æ€ä»£ç†çš„åŒºåˆ«/","link":"","permalink":"/2019/10/21/Java%E9%9D%99%E6%80%81%E4%BB%A3%E7%90%86%E4%B8%8E%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86%E7%9A%84%E5%8C%BA%E5%88%AB/","excerpt":"","text":"Javaä¸­çš„é™æ€ä»£ç†å’ŒåŠ¨æ€ä»£ç†ä»€ä¹ˆæ˜¯ä»£ç†?ä»£ç†æ˜¯è®¾è®¡æ¨¡å¼çš„ä¸€ç§ï¼Œä»£ç†ç±»ä¸ºå§”æ‰˜ç±»æä¾›æ¶ˆæ¯é¢„å¤„ç†ï¼Œæ¶ˆæ¯è½¬å‘ï¼Œäº‹åæ¶ˆæ¯å¤„ç†ç­‰åŠŸèƒ½ã€‚Javaä¸­çš„ä»£ç†åˆ†ä¸ºä¸‰ç§è§’è‰²ï¼š ä»£ç†ç±»(ProxySubject) å§”æ‰˜ç±»(RealSubject) æ¥å£(Subject) ä¸‰è€…å…³ç³»å¯ä»¥è¡¨ç¤ºå¦‚ä¸‹å›¾: ä»£ç†æ¨¡å¼ Javaä¸­çš„ä»£ç†æŒ‰ç…§ä»£ç†ç±»ç”Ÿæˆæ—¶æœºä¸åŒåˆåˆ†ä¸ºé™æ€ä»£ç†å’ŒåŠ¨æ€ä»£ç†ã€‚ é™æ€ä»£ç†: ä»£ç†ç±»åœ¨ç¼–è¯‘æœŸå°±ç”Ÿæˆ åŠ¨æ€ä»£ç†: ä»£ç†ç±»åˆ™æ˜¯åœ¨Javaè¿è¡Œæ—¶åŠ¨æ€ç”Ÿæˆã€‚ é™æ€ä»£ç†Javaä¸­çš„é™æ€ä»£ç†è¦æ±‚ä»£ç†ç±»(ProxySubject)å’Œå§”æ‰˜ç±»(RealSubject)éƒ½å®ç°åŒä¸€ä¸ªæ¥å£(Subject)ã€‚é™æ€ä»£ç†ä¸­ä»£ç†ç±»åœ¨ç¼–è¯‘æœŸå°±å·²ç»ç¡®å®šï¼Œè€ŒåŠ¨æ€ä»£ç†åˆ™æ˜¯JVMè¿è¡Œæ—¶åŠ¨æ€ç”Ÿæˆï¼Œé™æ€ä»£ç†çš„æ•ˆç‡ç›¸å¯¹åŠ¨æ€ä»£ç†æ¥è¯´ç›¸å¯¹é«˜ä¸€äº›ï¼Œä½†æ˜¯é™æ€ä»£ç†ä»£ç å†—ä½™å¤§ï¼Œä¸€å•éœ€è¦ä¿®æ”¹æ¥å£ï¼Œä»£ç†ç±»å’Œå§”æ‰˜ç±»éƒ½éœ€è¦ä¿®æ”¹ã€‚ä¸¾ä¸ªä¾‹å­ï¼š æ¥å£(Subject)ï¼š 123interface HelloService &#123; void sayHello();&#125; å§”æ‰˜ç±»ï¼š 123456class HelloServiceImpl implements HelloService &#123; @Override public void sayHello() &#123; System.out.println(\"Hello World!\"); &#125;&#125; ä»£ç†ç±»ï¼š 1234567891011121314class HelloServiceProxy implements HelloService &#123; private HelloService helloService; public HelloServiceProxy(HelloService helloService) &#123; this.helloService = helloService; &#125; @Override public void sayHello() &#123; System.out.println(\"Before say hello...\"); helloService.sayHello(); System.out.println(\"After say hello...\"); &#125;&#125; æµ‹è¯•ç±»ï¼š 12345678public class HelloServiceProxyTest &#123; public static void main(String[] args) &#123; HelloService helloService = new HelloServiceImpl(); HelloServiceProxy proxy = new HelloServiceProxy(helloService); proxy.sayHello(); &#125;&#125; è¾“å‡ºç»“æœï¼š 123Before say hello...Hello World!After say hello... åŠ¨æ€ä»£ç† å®ç°åŸç†æ˜¯é€šè¿‡Javaçš„åå°„æœºåˆ¶,åœ¨è¿è¡Œçš„æ—¶å€™é€šè¿‡åå°„æœºåˆ¶,åŠ¨æ€çš„è°ƒç”¨æ–¹æ³• Javaä¸­çš„åŠ¨æ€ä»£ç†ä¾é åå°„æ¥å®ç°ï¼Œä»£ç†ç±»å’Œå§”æ‰˜ç±»ä¸éœ€è¦å®ç°åŒä¸€ä¸ªæ¥å£ã€‚å§”æ‰˜ç±»éœ€è¦å®ç°æ¥å£(InvocationHandler)ï¼Œå¦åˆ™æ— æ³•åˆ›å»ºåŠ¨æ€ä»£ç†ã€‚ä»£ç†ç±»åœ¨JVMè¿è¡Œæ—¶åŠ¨æ€ç”Ÿæˆï¼Œè€Œä¸æ˜¯ç¼–è¯‘æœŸå°±èƒ½ç¡®å®šã€‚JavaåŠ¨æ€ä»£ç†ä¸»è¦æ¶‰åŠåˆ°ä¸¤ä¸ªç±»ï¼šjava.lang.reflect.Proxyå’Œjava.lang.reflect.InvocationHandlerã€‚ä»£ç†ç±»éœ€è¦å®ç°InvocationHandleræ¥å£æˆ–è€…åˆ›å»ºåŒ¿åå†…éƒ¨ç±»ï¼Œè€ŒProxyç”¨äºåˆ›å»ºåŠ¨æ€åŠ¨æ€ã€‚æˆ‘ä»¬ç”¨åŠ¨æ€ä»£ç†æ¥å®ç°HelloServiceï¼š æ¥å£(Subject)ï¼š 123interface HelloService &#123; void sayHello();&#125; å§”æ‰˜ç±»ï¼š 123456class HelloServiceImpl implements HelloService &#123; @Override public void sayHello() &#123; System.out.println(\"Hello World!\"); &#125;&#125; åŠ¨æ€ä»£ç†ç±»ï¼š 12345678910111213141516171819class HelloServiceDynamicProxy &#123; private HelloService helloService; public HelloServiceDynamicProxy(HelloService helloService) &#123; this.helloService = helloService; &#125; public Object getProxyInstance() &#123; return Proxy.newProxyInstance(helloService.getClass().getClassLoader(), helloService.getClass().getInterfaces(), new InvocationHandler() &#123; @Override public Object invoke(Object proxy, Method method, Object[] args) throws Throwable &#123; System.out.println(\"Before say hello...\"); Object ret = method.invoke(helloService, args); System.out.println(\"After say hello...\"); return ret; &#125; &#125;); &#125;&#125; æµ‹è¯•ç±»ï¼š 1234567public class HelloServieDynamicProxyTest &#123; public static void main(String[] args)&#123; HelloService helloService = new HelloServiceImpl(); HelloService dynamicProxy = (HelloService) new HelloServiceDynamicProxy(helloService).getProxyInstance(); dynamicProxy.sayHello(); &#125;&#125; è¾“å‡ºç»“æœï¼š 123Before say hello...Hello World!After say hello... æ€»ç»“ é™æ€ä»£ç†å®ç°è¾ƒç®€å•ï¼Œä»£ç†ç±»åœ¨ç¼–è¯‘æœŸç”Ÿæˆï¼Œæ•ˆç‡é«˜ã€‚ç¼ºç‚¹æ˜¯ä¼šç”Ÿæˆå¤§é‡çš„ä»£ç†ç±», å¹¶ä¸”éœ€è¦ç‰¹å®šçš„ç¼–è¯‘å™¨ã€‚ JDKåŠ¨æ€ä»£ç†ä¸è¦æ±‚ä»£ç†ç±»å’Œå§”æ‰˜ç±»å®ç°åŒä¸€ä¸ªæ¥å£ï¼Œä½†æ˜¯å§”æ‰˜ç±»éœ€è¦å®ç°æ¥å£ï¼Œä»£ç†ç±»éœ€è¦å®ç°InvocationHandleræ¥å£ã€‚ åŠ¨æ€ä»£ç†è¦æ±‚ä»£ç†ç±»InvocationHandleræ¥å£ï¼Œé€šè¿‡åå°„ä»£ç†æ–¹æ³•ï¼Œæ¯”è¾ƒæ¶ˆè€—ç³»ç»Ÿæ€§èƒ½ï¼Œä½†å¯ä»¥å‡å°‘ä»£ç†ç±»çš„æ•°é‡ï¼Œä½¿ç”¨æ›´çµæ´», ä¸”ä¸éœ€è¦ç‰¹å®šçš„ç¼–è¯‘å™¨æ”¯æŒã€‚ è½¬è½½è‡ª: https://www.jianshu.com/p/f56e123817b5 , æœ¬æ–‡å¯¹å…¶è¿›è¡Œäº†ä¸€äº›è¡¥å……","categories":[{"name":"Java","slug":"Java","permalink":"/categories/Java/"},{"name":"ä»£ç†æ¨¡å¼","slug":"Java/ä»£ç†æ¨¡å¼","permalink":"/categories/Java/%E4%BB%A3%E7%90%86%E6%A8%A1%E5%BC%8F/"}],"tags":[{"name":"Java","slug":"Java","permalink":"/tags/Java/"},{"name":"ä»£ç†æ¨¡å¼","slug":"ä»£ç†æ¨¡å¼","permalink":"/tags/%E4%BB%A3%E7%90%86%E6%A8%A1%E5%BC%8F/"}]},{"title":"æ’åºç®—æ³•","slug":"æ’åºç®—æ³•","date":"2019-10-20T19:36:56.000Z","updated":"2019-10-20T11:38:07.588Z","comments":true,"path":"2019/10/21/æ’åºç®—æ³•/","link":"","permalink":"/2019/10/21/%E6%8E%92%E5%BA%8F%E7%AE%97%E6%B3%95/","excerpt":"","text":"æ’åºç®—æ³•æ’å…¥æ’åºåŸç†ç®—æ³•åŸç†ï¼šä»æ•´ä¸ªå¾…æ’åºåˆ—ä¸­é€‰å‡ºä¸€ä¸ªå…ƒç´ æ’å…¥åˆ°å·²ç»æœ‰åºçš„å­åºåˆ—ä¸­å»ï¼Œå¾—åˆ°ä¸€ä¸ªæœ‰åºçš„ã€å…ƒç´ åŠ ä¸€çš„å­åºåˆ—ï¼Œç›´åˆ°æ•´ä¸ªåºåˆ—çš„å¾…æ’å…¥å…ƒç´ ä¸º0ï¼Œåˆ™æ•´ä¸ªåºåˆ—å…¨éƒ¨æœ‰åºã€‚ å…·ä½“çš„å®ç°çš„æ—¶å€™ï¼Œæˆ‘ä»¬ä¸€èˆ¬é€‰æ‹©ç¬¬ä¸€ä¸ªå…ƒç´ ä½œä¸ºæœ‰åºçš„åºåˆ—ï¼Œå°†åé¢çš„å…ƒç´ æ’å…¥åˆ°å‰é¢æœ‰åºçš„åºåˆ—ç›´åˆ°æ•´ä¸ªåºåˆ—æœ‰åºã€‚ æ—¶é—´å¤æ‚åº¦ï¼šæ’å…¥æ’åºåœ¨æœ€å¥½æƒ…å†µä¸‹ï¼Œéœ€è¦æ¯”è¾ƒn-1æ¬¡ï¼Œæ— éœ€äº¤æ¢å…ƒç´ ï¼Œæ—¶é—´å¤æ‚åº¦ä¸ºO(n);åœ¨æœ€åæƒ…å†µä¸‹ï¼Œæ—¶é—´å¤æ‚åº¦ä¸ºO(n^2) 123456789101112131415161718192021222324252627282930#include&lt;iostream&gt;#include&lt;cstdio&gt;#include&lt;cmath&gt;#include&lt;algorithm&gt;using namespace std;const int len=15;int main()&#123; int a[len]=&#123;1,87,64,19,53,14,57,62,23,37,48,9,91,45,81&#125;; for(int i=1;i&lt;len;i++) &#123; int j=i; int temp=a[i]; while(j&gt;0) &#123; if(a[j-1]&lt;a[i])//æ‰¾åˆ°ç¬¬ä¸€ä¸ªæ¯”å®ƒå°çš„æ•°çš„ä½ç½® &#123; for(int k=i;k&gt;j;k--)//æ¯”å®ƒå¤§çš„æ•°å…¨éƒ¨åç§» a[k]=a[k-1]; a[j]=temp;//å°†æ•°å€¼é™„åˆ°è¯¥ä½ç½®ä¸Š break; &#125; j--; &#125; &#125; for(int i=0;i&lt;len;i++) printf(\"%d \",a[i]); printf(\"\\n\"); return 0;&#125; é€‰æ‹©æ’åºåŸç†ç®—æ³•åŸç†ï¼šä¸ºæ¯ä¸€è¶Ÿä»å¾…æ’åºçš„æ•°æ®å…ƒç´ ä¸­é€‰æ‹©æœ€å°ï¼ˆæˆ–æœ€å¤§ï¼‰çš„ä¸€ä¸ªå…ƒç´ ä½œä¸ºé¦–å…ƒç´ ï¼Œç›´åˆ°æ‰€æœ‰å…ƒç´ æ’å®Œä¸ºæ­¢ ç®—æ³•æ­¥éª¤ï¼š é¦–å…ˆåœ¨æœªæ’åºåºåˆ—ä¸­æ‰¾åˆ°æœ€å°ï¼ˆå¤§ï¼‰å…ƒç´ ï¼Œå­˜æ”¾åˆ°æ’åºåºåˆ—çš„èµ·å§‹ä½ç½® å†ä»å‰©ä½™æœªæ’åºå…ƒç´ ä¸­ç»§ç»­å¯»æ‰¾æœ€å°ï¼ˆå¤§ï¼‰å…ƒç´ ï¼Œç„¶åæ”¾åˆ°å·²æ’åºåºåˆ—çš„æœ«å°¾ã€‚ é‡å¤ç¬¬äºŒæ­¥ï¼Œç›´åˆ°æ‰€æœ‰å…ƒç´ å‡æ’åºå®Œæ¯•ã€‚ æ—¶é—´å¤æ‚åº¦ï¼šæ— è®ºæ•°ç»„åŸå§‹æ’åˆ—å¦‚ä½•ï¼Œæ¯”è¾ƒæ¬¡æ•°æ˜¯ä¸å˜çš„ï¼›å¯¹äºäº¤æ¢æ“ä½œï¼Œåœ¨æœ€å¥½æƒ…å†µä¸‹ä¹Ÿå°±æ˜¯æ•°ç»„å®Œå…¨æœ‰åºçš„æ—¶å€™ï¼Œæ— éœ€ä»»ä½•äº¤æ¢ç§»åŠ¨ï¼Œ åœ¨æœ€å·®æƒ…å†µä¸‹ï¼Œä¹Ÿå°±æ˜¯æ•°ç»„å€’åºçš„æ—¶å€™ï¼Œäº¤æ¢æ¬¡æ•°ä¸ºn-1æ¬¡ã€‚ç»¼åˆä¸‹æ¥ï¼Œæ—¶é—´å¤æ‚åº¦ä¸ºO(n^2) 12345678910111213141516171819202122232425#include&lt;iostream&gt;#include&lt;cstdio&gt;#include&lt;cmath&gt;#include&lt;algorithm&gt;using namespace std;const int len=15;int main()&#123; int a[len]=&#123;1,87,64,19,53,14,57,62,23,37,48,9,91,45,81&#125;; for(int i=0;i&lt;len-1;i++) &#123; int temp=i; for(int j=i+1;j&lt;len;j++) &#123; if(a[temp]&gt;a[j]) temp=j; &#125; if(temp!=i) swap(a[temp],a[i]); &#125; for(int i=0;i&lt;len;i++) printf(\"%d \",a[i]); printf(\"\\n\"); return 0;&#125; å†’æ³¡æ’åºåŸç†ç®—æ³•åŸç†ï¼šæ¯”è¾ƒç›¸é‚»çš„å…ƒç´ ã€‚å¦‚æœç¬¬ä¸€ä¸ªæ¯”ç¬¬äºŒä¸ªå¤§ï¼Œå°±äº¤æ¢ä»–ä»¬ä¸¤ä¸ª å¯¹æ¯ä¸€å¯¹ç›¸é‚»å…ƒç´ ä½œåŒæ ·çš„å·¥ä½œï¼Œä»å¼€å§‹ç¬¬ä¸€å¯¹åˆ°ç»“å°¾çš„æœ€åä¸€å¯¹ã€‚è¿™æ­¥åšå®Œåï¼Œæœ€åçš„å…ƒç´ ä¼šæ˜¯æœ€å¤§çš„æ•°ã€‚ é’ˆå¯¹æ‰€æœ‰çš„å…ƒç´ é‡å¤ä»¥ä¸Šçš„æ­¥éª¤ï¼Œé™¤äº†æœ€åä¸€ä¸ªã€‚æŒç»­æ¯æ¬¡å¯¹è¶Šæ¥è¶Šå°‘çš„å…ƒç´ é‡å¤ä¸Šé¢çš„æ­¥éª¤ï¼Œç›´åˆ°æ²¡æœ‰ä»»ä½•ä¸€å¯¹æ•°å­—éœ€è¦æ¯”è¾ƒã€‚ æ—¶é—´å¤æ‚åº¦åˆ†æï¼šæœ€ä¼˜æ—¶é—´O(nï¼‰ï¼Œæœ€å·®æ—¶é—´O(n^2)ã€‚ 12345678910111213141516171819202122232425262728#include&lt;iostream&gt;#include&lt;cstdio&gt;#include&lt;cmath&gt;#include&lt;algorithm&gt;using namespace std;const int len=15;int main()&#123; int a[len]=&#123;1,87,64,19,53,14,57,62,23,37,48,9,91,45,81&#125;; for(int i=0;i&lt;len-1;i++)//è¿›è¡Œå‡ è½®æ¯”è¾ƒï¼Œç¡®å®šä½ç½® &#123; bool flag=false;//è®¾å®šä¸€ä¸ªæ ‡è®°ï¼Œè‹¥ä¸ºtrueï¼Œåˆ™è¡¨ç¤ºæ­¤æ¬¡å¾ªç¯æ²¡æœ‰è¿›è¡Œäº¤æ¢ï¼Œä¹Ÿå°±æ˜¯å¾…æ’åºåˆ—å·²ç»æœ‰åºï¼Œæ’åºå·²ç„¶å®Œæˆã€‚ for(int j=0;j&lt;len-1-i;j++) &#123; if(a[j]&gt;a[j+1]) &#123; swap(a[j],a[j+1]); flag=true; &#125; &#125; if(flag==false) break; &#125; for(int i=0;i&lt;len;i++) printf(\"%d \",a[i]); printf(\"\\n\"); return 0;&#125; å½’å¹¶æ’åºåŸç†ç®—æ³•åŸç†ï¼šæ˜¯åˆ©ç”¨é€’å½’ä¸åˆ†æ²»çš„æŠ€æœ¯å°†æ•°æ®åºåˆ—åˆ’åˆ†ä¸ºè¶Šæ¥è¶Šå°çš„åŠå­è¡¨ï¼Œå†å¯¹åŠå­è¡¨æ’åºï¼Œæœ€åå†ç”¨é€’å½’æ–¹æ³•å°†æ’å¥½åºçš„åŠå­è¡¨åˆå¹¶æˆè¶Šæ¥è¶Šå¤§çš„æœ‰åºåºåˆ—ã€‚ æ—¶é—´å¤æ‚åº¦ï¼šO(nlognï¼‰ 1234567891011121314151617181920212223242526272829303132333435363738394041424344#include &lt;iostream&gt;#include &lt;cstdio&gt;using namespace std;int a[20]=&#123;5,6,9,15,4,-1,-9,5,-6,71,5,-36,2,15,48,-15,14,6,9,11&#125;;int l,r;void mergee(int l,int m,int r)&#123; int T[20]; int i=l,j=m+1; int k=0; while(i&lt;=m&amp;&amp;j&lt;=r) &#123; if(a[i]&lt;=a[j]) T[k++]=a[i++]; else T[k++]=a[j++]; &#125; while(i&lt;=m) T[k++]=a[i++]; while(j&lt;=r) T[k++]=a[j++]; for(int i=0;i&lt;k;i++) a[l+i]=T[i];&#125;int mergr_sort(int l,int r)&#123; if(r-l&gt;0) &#123; int mid=(l+r)/2; int p=l,q=mid,i=l; mergr_sort(l,mid); mergr_sort(mid+1,r); mergee(l,mid,r); &#125;&#125;int main()&#123; scanf(\"%d %d\",&amp;l,&amp;r); mergr_sort(l,r); for(int i=0;i&lt;20;i++) printf(\"%d \",a[i]); printf(\"\\n\"); return 0;&#125; å¿«é€Ÿæ’åºåŸç†é€šè¿‡ä¸€è½®çš„æ’åºå°†åºåˆ—åˆ†å‰²æˆç‹¬ç«‹çš„ä¸¤éƒ¨åˆ†ï¼Œå…¶ä¸­ä¸€éƒ¨åˆ†åºåˆ—çš„å…³é”®å­—ï¼ˆè¿™é‡Œä¸»è¦ç”¨å€¼æ¥è¡¨ç¤ºï¼‰å‡æ¯”å¦ä¸€éƒ¨åˆ†å…³é”®å­—å°ã€‚ç»§ç»­é€’å½’çš„å¯¹é•¿åº¦è¾ƒçŸ­çš„åºåˆ—è¿›è¡ŒåŒæ ·çš„åˆ†å‰²ï¼Œæœ€ååˆ°è¾¾æ•´ä½“æœ‰åºã€‚ä¸ºäº†å®ç°ä¸€æ¬¡åˆ’åˆ†ï¼Œæˆ‘ä»¬å¯ä»¥ä»æ•°ç»„ï¼ˆå‡å®šæ•°æ®æ˜¯å­˜åœ¨æ•°ç»„ä¸­ï¼‰çš„ä¸¤ç«¯ç§»åŠ¨ä¸‹æ ‡ï¼Œå¿…è¦æ—¶äº¤æ¢è®°å½•ï¼Œç›´åˆ°æ•°ç»„ä¸¤ç«¯çš„ä¸‹æ ‡ç›¸é‡ä¸ºæ­¢ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬é™„è®¾ä¸¤ä¸ªæŒ‡é’ˆï¼ˆä¸‹è§’æ ‡ï¼‰iå’Œjï¼Œ é€šè¿‡j ä»å½“å‰åºåˆ—çš„æœ‰æ®µå‘å·¦æ‰«æï¼Œè¶Šè¿‡ä¸å°äºåŸºå‡†å€¼çš„è®°å½•ã€‚å½“é‡åˆ°å°äºåŸºå‡†å€¼çš„è®°å½•æ—¶ï¼Œæ‰«æåœæ­¢ã€‚é€šè¿‡iä»å½“å‰åºåˆ—çš„å·¦ç«¯å‘å³æ‰«æï¼Œè¶Šè¿‡å°äºåŸºå‡†å€¼çš„è®°å½•ã€‚å½“é‡åˆ°ä¸å°äºåŸºå‡†å€¼çš„è®°å½•æ—¶ï¼Œæ‰«æåœæ­¢ã€‚äº¤æ¢ä¸¤ä¸ªæ–¹å‘æ‰«æåœæ­¢çš„è®°å½• a[j] ä¸ a[i]ã€‚ ç„¶åï¼Œç»§ç»­æ‰«æï¼Œç›´è‡³ iä¸j ç›¸é‡ä¸ºæ­¢ã€‚å®ƒçš„å¹³å‡æ—¶é—´å¤æ‚åº¦ä¸ºO(nlogn)ã€‚ å½“æˆ‘ä»¬æ¯æ¬¡è¿›è¡Œåˆ†åŒºåˆ’åˆ†æ—¶ï¼Œå¦‚æœæ¯æ¬¡é€‰æ‹©çš„åŸºå‡†å…ƒç´ éƒ½æ˜¯å½“å‰åºåˆ—ä¸­æœ€å¤§æˆ–æœ€å°çš„è®°å½•ï¼Œè¿™æ ·æ¯æ¬¡åˆ†åŒºçš„æ—¶å€™åªå¾—åˆ°äº†ä¸€ä¸ªæ–°åˆ†åŒºï¼Œå¦ä¸€ä¸ªåˆ†åŒºä¸ºç©ºï¼Œå¹¶ä¸”æ–°åˆ†åŒºåªæ˜¯æ¯”åˆ†åŒºå‰å°‘ä¸€ä¸ªå…ƒç´ ï¼Œè¿™æ˜¯å¿«é€Ÿæ’åºçš„æœ€åæƒ…å†µï¼Œæ—¶é—´å¤æ‚åº¦ä¸Šå‡ä¸ºO(n^2)ã€‚ 1234567891011121314151617181920212223242526272829303132333435#include&lt;iostream&gt;#include&lt;cstdio&gt;#include&lt;cmath&gt;#include&lt;algorithm&gt;using namespace std;const int len=15;int a[len]=&#123;1,87,64,19,53,14,57,62,23,37,48,9,91,45,81&#125;;void quicksort(int l,int r)&#123; if(l&gt;r) return; int temp=a[l]; int i=l;int j=r; while(i!=j) &#123; while(a[j]&gt;=temp&amp;&amp;i&lt;j) j--;/*ä¸ºä»€ä¹ˆè¦ä»å³è¾¹ï¼Œå› ä¸ºæˆ‘ä»¬é€‰æ‹©çš„åŸºæ•°æ˜¯ä»å·¦è¾¹å¼€å§‹é€‰æ‹©çš„ï¼Œå¼€å§‹çš„æ–¹å‘å¿…é¡»æ˜¯è¦ä»åŸºæ•°çš„å¯¹é¢å¼€å§‹ï¼Œå¦‚æœä½ è¦ä»å·¦è¾¹å¼€å§‹æ‰¾é‚£ä¹ˆé€‰æ‹©åŸºæ•°çš„æ—¶å€™å°±ä»å³è¾¹çš„æ•°ä½œä¸ºåŸºæ•°*/ while(a[i]&lt;=temp&amp;&amp;i&lt;j) i++; if(i&lt;j) swap(a[i],a[j]); &#125; a[l]=a[i]; a[i]=temp; quicksort(l,i-1); quicksort(i+1,r);&#125;int main()&#123; quicksort(0,14); for(int i=0;i&lt;len;i++) printf(\"%d \",a[i]); printf(\"\\n\"); return 0;&#125; å †æ’åºåŸç†åˆ©ç”¨å †è¿™ç§æ•°æ®ç»“æ„è€Œè®¾è®¡çš„ä¸€ç§æ’åºç®—æ³•ï¼Œå †æ’åºæ˜¯ä¸€ç§é€‰æ‹©æ’åºï¼Œå®ƒçš„æœ€åï¼Œæœ€å¥½ï¼Œå¹³å‡æ—¶é—´å¤æ‚åº¦å‡ä¸ºO(nlogn)ï¼Œå®ƒä¹Ÿæ˜¯ä¸ç¨³å®šæ’åºã€‚ è¯¥æ•°ç»„ä»é€»è¾‘ä¸Šè®²å°±æ˜¯ä¸€ä¸ªå †ç»“æ„ï¼Œæˆ‘ä»¬ç”¨ç®€å•çš„å…¬å¼æ¥æè¿°ä¸€ä¸‹å †çš„å®šä¹‰å°±æ˜¯ï¼š å¤§é¡¶å †ï¼šarr[i] &gt;= arr[2i+1] &amp;&amp; arr[i] &gt;= arr[2i+2] å°é¡¶å †ï¼šarr[i] &lt;= arr[2i+1] &amp;&amp; arr[i] &lt;= arr[2i+2] ç®—æ³•æ­¥éª¤ï¼š å°†æ— éœ€åºåˆ—æ„å»ºæˆä¸€ä¸ªå †ï¼Œæ ¹æ®å‡åºé™åºéœ€æ±‚é€‰æ‹©å¤§é¡¶å †æˆ–å°é¡¶å †; å°†å †é¡¶å…ƒç´ ä¸æœ«å°¾å…ƒç´ äº¤æ¢ï¼Œå°†æœ€å¤§å…ƒç´ â€æ²‰â€åˆ°æ•°ç»„æœ«ç«¯; é‡æ–°è°ƒæ•´ç»“æ„ï¼Œä½¿å…¶æ»¡è¶³å †å®šä¹‰ï¼Œç„¶åç»§ç»­äº¤æ¢å †é¡¶å…ƒç´ ä¸å½“å‰æœ«å°¾å…ƒç´ ï¼Œåå¤æ‰§è¡Œè°ƒæ•´+äº¤æ¢æ­¥éª¤ï¼Œç›´åˆ°æ•´ä¸ªåºåˆ—æœ‰åºã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152package sortdemo;import java.util.Arrays;public class HeapSort &#123; public static void main(String []args)&#123; int []arr = &#123;9,8,7,6,5,4,3,2,1&#125;; sort(arr); System.out.println(Arrays.toString(arr)); &#125; public static void sort(int []arr)&#123; //1.æ„å»ºå¤§é¡¶å † for(int i=arr.length/2-1;i&gt;=0;i--)&#123; //ä»ç¬¬ä¸€ä¸ªéå¶å­ç»“ç‚¹ä»ä¸‹è‡³ä¸Šï¼Œä»å³è‡³å·¦è°ƒæ•´ç»“æ„ adjustHeap(arr,i,arr.length); &#125; //2.è°ƒæ•´å †ç»“æ„+äº¤æ¢å †é¡¶å…ƒç´ ä¸æœ«å°¾å…ƒç´  for(int j=arr.length-1;j&gt;0;j--)&#123; swap(arr,0,j);//å°†å †é¡¶å…ƒç´ ä¸æœ«å°¾å…ƒç´ è¿›è¡Œäº¤æ¢ adjustHeap(arr,0,j);//é‡æ–°å¯¹å †è¿›è¡Œè°ƒæ•´ &#125; &#125; /** * è°ƒæ•´å¤§é¡¶å †ï¼ˆä»…æ˜¯è°ƒæ•´è¿‡ç¨‹ï¼Œå»ºç«‹åœ¨å¤§é¡¶å †å·²æ„å»ºçš„åŸºç¡€ä¸Šï¼‰ * @param arr * @param i * @param length */ public static void adjustHeap(int []arr,int i,int length)&#123; int temp = arr[i];//å…ˆå–å‡ºå½“å‰å…ƒç´ i for(int k=i*2+1;k&lt;length;k=k*2+1)&#123;//ä»iç»“ç‚¹çš„å·¦å­ç»“ç‚¹å¼€å§‹ï¼Œä¹Ÿå°±æ˜¯2i+1å¤„å¼€å§‹ if(k+1&lt;length &amp;&amp; arr[k]&lt;arr[k+1])&#123;//å¦‚æœå·¦å­ç»“ç‚¹å°äºå³å­ç»“ç‚¹ï¼ŒkæŒ‡å‘å³å­ç»“ç‚¹ k++; &#125; if(arr[k] &gt;temp)&#123;//å¦‚æœå­èŠ‚ç‚¹å¤§äºçˆ¶èŠ‚ç‚¹ï¼Œå°†å­èŠ‚ç‚¹å€¼èµ‹ç»™çˆ¶èŠ‚ç‚¹ï¼ˆä¸ç”¨è¿›è¡Œäº¤æ¢ï¼‰ arr[i] = arr[k]; i = k; &#125;else&#123; break; &#125; &#125; arr[i] = temp;//å°†tempå€¼æ”¾åˆ°æœ€ç»ˆçš„ä½ç½® &#125; /** * äº¤æ¢å…ƒç´  */ public static void swap(int []arr,int a ,int b)&#123; int temp=arr[a]; arr[a] = arr[b]; arr[b] = temp; &#125;&#125; å‡ ç§æ’åºç®—æ³•çš„æ¯”è¾ƒç¤ºæ„å›¾ æ’åºç¨³å®šæ€§çš„å®šä¹‰é€šä¿—åœ°è®²å°±æ˜¯èƒ½ä¿è¯æ’åºå‰ä¸¤ä¸ªç›¸ç­‰çš„æ•°å…¶åœ¨åºåˆ—çš„å‰åä½ç½®é¡ºåºå’Œæ’åºåå®ƒä»¬ä¸¤ä¸ªçš„å‰åä½ç½®é¡ºåºç›¸åŒã€‚åœ¨ç®€å•å½¢å¼åŒ–ä¸€ä¸‹ï¼Œå¦‚æœAi = Ajï¼ŒAiåŸæ¥åœ¨ä½ç½®å‰ï¼Œæ’åºåAiè¿˜æ˜¯è¦åœ¨Ajä½ç½®å‰ äºŒå‰å¹³è¡¡æ ‘ å·¦å³å­æ ‘çš„çš„é«˜åº¦å·®ä¸è¶…è¿‡1, å¦åˆ™è¦è¿›è¡Œæ ‘çš„è°ƒæ•´ äºŒå‰æŸ¥æ‰¾æ ‘ 1ï¼Œ å·¦å­æ ‘ä¸Šæ‰€æœ‰çš„èŠ‚ç‚¹çš„å€¼å‡å°äºæˆ–ç­‰äºä»–çš„æ ¹èŠ‚ç‚¹çš„å€¼ 2ï¼Œ å³å­æ•°ä¸Šæ‰€æœ‰çš„èŠ‚ç‚¹çš„å€¼å‡å¤§äºæˆ–ç­‰äºä»–çš„æ ¹èŠ‚ç‚¹çš„å€¼ 3ï¼Œ å·¦å³å­æ ‘ä¹Ÿä¸€å®šåˆ†åˆ«ä¸ºäºŒå‰æ’åºæ ‘ ä¼ ç»Ÿçš„æŸ¥æ‰¾æ ‘çš„ç¼ºç‚¹: å¦‚æœæ ‘å¤ªé«˜å°±ä¼šå¯¼è‡´æŸ¥æ‰¾æ•ˆç‡ä½ä¸‹, æ¥è¿‘çº¿æ€§æŸ¥æ‰¾çš„æ—¶é—´å¤æ‚åº¦ çº¢é»‘æ ‘ çº¢é»‘æ ‘å°±æ˜¯ä¸€ç§å¹³è¡¡çš„äºŒå‰æŸ¥æ‰¾æ ‘ï¼Œè¯´ä»–å¹³è¡¡çš„æ„æ€æ˜¯ä»–ä¸ä¼šå˜æˆâ€œç˜¸å­â€ï¼Œå·¦è…¿ç‰¹åˆ«é•¿æˆ–è€…å³è…¿ç‰¹åˆ«é•¿ã€‚é™¤äº†ç¬¦åˆäºŒå‰æŸ¥æ‰¾æ ‘çš„ç‰¹æ€§ä¹‹å¤–ï¼Œè¿˜å…·ä½“ä¸‹åˆ—çš„ç‰¹æ€§ï¼š \\1. èŠ‚ç‚¹æ˜¯çº¢è‰²æˆ–è€…é»‘è‰² \\2. æ ¹èŠ‚ç‚¹æ˜¯é»‘è‰² \\3. æ¯ä¸ªå¶å­çš„èŠ‚ç‚¹éƒ½æ˜¯é»‘è‰²çš„ç©ºèŠ‚ç‚¹ï¼ˆNULLï¼‰ \\4. æ¯ä¸ªçº¢è‰²èŠ‚ç‚¹çš„ä¸¤ä¸ªå­èŠ‚ç‚¹éƒ½æ˜¯é»‘è‰²çš„ã€‚ \\5. ä»ä»»æ„èŠ‚ç‚¹åˆ°å…¶æ¯ä¸ªå¶å­çš„æ‰€æœ‰è·¯å¾„éƒ½åŒ…å«ç›¸åŒçš„é»‘è‰²èŠ‚ç‚¹ã€‚","categories":[{"name":"æ•°æ®ç»“æ„","slug":"æ•°æ®ç»“æ„","permalink":"/categories/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"},{"name":"ç®—æ³•","slug":"æ•°æ®ç»“æ„/ç®—æ³•","permalink":"/categories/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/%E7%AE%97%E6%B3%95/"}],"tags":[{"name":"æ’åºç®—æ³•","slug":"æ’åºç®—æ³•","permalink":"/tags/%E6%8E%92%E5%BA%8F%E7%AE%97%E6%B3%95/"},{"name":"æ•°æ®ç»“æ„","slug":"æ•°æ®ç»“æ„","permalink":"/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}]},{"title":"æ·±å…¥ç†è§£è¯»å†™é”ReentrantReadWriteLock","slug":"æ·±å…¥ç†è§£è¯»å†™é”ReentrantReadWriteLock","date":"2019-10-20T19:19:36.000Z","updated":"2019-10-20T11:40:37.774Z","comments":true,"path":"2019/10/21/æ·±å…¥ç†è§£è¯»å†™é”ReentrantReadWriteLock/","link":"","permalink":"/2019/10/21/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AF%BB%E5%86%99%E9%94%81ReentrantReadWriteLock/","excerpt":"","text":"æ·±å…¥ç†è§£è¯»å†™é”ReentrantReadWriteLock 1.è¯»å†™é”çš„ä»‹ç» åœ¨å¹¶å‘åœºæ™¯ä¸­ç”¨äºè§£å†³çº¿ç¨‹å®‰å…¨çš„é—®é¢˜ï¼Œæˆ‘ä»¬å‡ ä¹ä¼šé«˜é¢‘ç‡çš„ä½¿ç”¨åˆ°ç‹¬å å¼é”ï¼Œé€šå¸¸ä½¿ç”¨javaæä¾›çš„å…³é”®å­—synchronizedï¼ˆå…³äºsynchronizedå¯ä»¥çœ‹è¿™ç¯‡æ–‡ç« ï¼‰æˆ–è€…concurrentsåŒ…ä¸­å®ç°äº†Lockæ¥å£çš„ReentrantLockã€‚å®ƒä»¬éƒ½æ˜¯ç‹¬å å¼è·å–é”ï¼Œä¹Ÿå°±æ˜¯åœ¨åŒä¸€æ—¶åˆ»åªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½å¤Ÿè·å–é”ã€‚è€Œåœ¨ä¸€äº›ä¸šåŠ¡åœºæ™¯ä¸­ï¼Œ==å¤§éƒ¨åˆ†åªæ˜¯è¯»æ•°æ®ï¼Œå†™æ•°æ®å¾ˆå°‘ï¼Œå¦‚æœä»…ä»…æ˜¯è¯»æ•°æ®çš„è¯å¹¶ä¸ä¼šå½±å“æ•°æ®æ­£ç¡®æ€§ï¼ˆå‡ºç°è„è¯»ï¼‰ï¼Œè€Œå¦‚æœåœ¨è¿™ç§ä¸šåŠ¡åœºæ™¯ä¸‹ï¼Œä¾ç„¶ä½¿ç”¨ç‹¬å é”çš„è¯ï¼Œå¾ˆæ˜¾ç„¶è¿™å°†æ˜¯å‡ºç°æ€§èƒ½ç“¶é¢ˆçš„åœ°æ–¹==ã€‚é’ˆå¯¹è¿™ç§è¯»å¤šå†™å°‘çš„æƒ…å†µï¼Œjavaè¿˜æä¾›äº†å¦å¤–ä¸€ä¸ªå®ç°Lockæ¥å£çš„ReentrantReadWriteLock(è¯»å†™é”)ã€‚è¯»å†™é”å…è®¸åŒä¸€æ—¶åˆ»è¢«å¤šä¸ªè¯»çº¿ç¨‹è®¿é—®ï¼Œä½†æ˜¯åœ¨å†™çº¿ç¨‹è®¿é—®æ—¶ï¼Œæ‰€æœ‰çš„è¯»çº¿ç¨‹å’Œå…¶ä»–çš„å†™çº¿ç¨‹éƒ½ä¼šè¢«é˜»å¡ã€‚åœ¨åˆ†æWirteLockå’ŒReadLockçš„äº’æ–¥æ€§æ—¶å¯ä»¥æŒ‰ç…§WriteLockä¸WriteLockä¹‹é—´ï¼ŒWriteLockä¸ReadLockä¹‹é—´ä»¥åŠReadLockä¸ReadLockä¹‹é—´è¿›è¡Œåˆ†æã€‚æ›´å¤šå…³äºè¯»å†™é”ç‰¹æ€§ä»‹ç»å¤§å®¶å¯ä»¥çœ‹æºç ä¸Šçš„ä»‹ç»ï¼ˆé˜…è¯»æºç æ—¶æœ€å¥½çš„ä¸€ç§å­¦ä¹ æ–¹å¼ï¼Œæˆ‘ä¹Ÿæ­£åœ¨å­¦ä¹ ä¸­ï¼Œä¸å¤§å®¶å…±å‹‰ï¼‰ï¼Œè¿™é‡Œåšä¸€ä¸ªå½’çº³æ€»ç»“ï¼š å…¬å¹³æ€§é€‰æ‹©ï¼šæ”¯æŒéå…¬å¹³æ€§ï¼ˆé»˜è®¤ï¼‰å’Œå…¬å¹³çš„é”è·å–æ–¹å¼ï¼Œååé‡è¿˜æ˜¯éå…¬å¹³ä¼˜äºå…¬å¹³ï¼› é‡å…¥æ€§ï¼šæ”¯æŒé‡å…¥ï¼Œè¯»é”è·å–åèƒ½å†æ¬¡è·å–ï¼Œå†™é”è·å–ä¹‹åèƒ½å¤Ÿå†æ¬¡è·å–å†™é”ï¼ŒåŒæ—¶ä¹Ÿèƒ½å¤Ÿè·å–è¯»é”ï¼› é”é™çº§ï¼šéµå¾ªè·å–å†™é”ï¼Œè·å–è¯»é”å†é‡Šæ”¾å†™é”çš„æ¬¡åºï¼Œå†™é”èƒ½å¤Ÿé™çº§æˆä¸ºè¯»é” è¦æƒ³èƒ½å¤Ÿå½»åº•çš„ç†è§£è¯»å†™é”å¿…é¡»èƒ½å¤Ÿç†è§£è¿™æ ·å‡ ä¸ªé—®é¢˜ï¼š è¯»å†™é”æ˜¯æ€æ ·å®ç°åˆ†åˆ«è®°å½•è¯»å†™çŠ¶æ€çš„ï¼Ÿ å†™é”æ˜¯æ€æ ·è·å–å’Œé‡Šæ”¾çš„ï¼Ÿ è¯»é”æ˜¯æ€æ ·è·å–å’Œé‡Šæ”¾çš„ï¼Ÿæˆ‘ä»¬å¸¦ç€è¿™æ ·çš„ä¸‰ä¸ªé—®é¢˜ï¼Œå†å»äº†è§£ä¸‹è¯»å†™é”ã€‚ 2.å†™é”è¯¦è§£2.1.å†™é”çš„è·å–åŒæ­¥ç»„ä»¶çš„å®ç°èšåˆäº†åŒæ­¥å™¨ï¼ˆAQSï¼‰ï¼Œå¹¶é€šè¿‡é‡å†™é‡å†™åŒæ­¥å™¨ï¼ˆAQSï¼‰ä¸­çš„æ–¹æ³•å®ç°åŒæ­¥ç»„ä»¶çš„åŒæ­¥è¯­ä¹‰ï¼ˆå…³äºåŒæ­¥ç»„ä»¶çš„å®ç°å±‚çº§ç»“æ„å¯ä»¥çœ‹è¿™ç¯‡æ–‡ç« ï¼ŒAQSçš„åº•å±‚å®ç°åˆ†æå¯ä»¥çœ‹è¿™ç¯‡æ–‡ç« ï¼‰ã€‚å› æ­¤ï¼Œå†™é”çš„å®ç°ä¾ç„¶ä¹Ÿæ˜¯é‡‡ç”¨è¿™ç§æ–¹å¼ã€‚åœ¨åŒä¸€æ—¶åˆ»å†™é”æ˜¯ä¸èƒ½è¢«å¤šä¸ªçº¿ç¨‹æ‰€è·å–ï¼Œå¾ˆæ˜¾ç„¶å†™é”æ˜¯ç‹¬å å¼é”ï¼Œè€Œå®ç°å†™é”çš„åŒæ­¥è¯­ä¹‰æ˜¯é€šè¿‡é‡å†™AQSä¸­çš„tryAcquireæ–¹æ³•å®ç°çš„ã€‚æºç ä¸º: 1234567891011121314151617181920212223242526protected final boolean tryAcquire(int acquires) &#123; Thread current = Thread.currentThread(); // 1. è·å–å†™é”å½“å‰çš„åŒæ­¥çŠ¶æ€ int c = getState(); // 2. è·å–å†™é”è·å–çš„æ¬¡æ•° int w = exclusiveCount(c); if (c != 0) &#123; // (Note: if c != 0 and w == 0 then shared count != 0) // 3.1 å½“è¯»é”å·²è¢«è¯»çº¿ç¨‹è·å–æˆ–è€…å½“å‰çº¿ç¨‹ä¸æ˜¯å·²ç»è·å–å†™é”çš„çº¿ç¨‹çš„è¯ // å½“å‰çº¿ç¨‹è·å–å†™é”å¤±è´¥ if (w == 0 || current != getExclusiveOwnerThread()) return false; if (w + exclusiveCount(acquires) &gt; MAX_COUNT) throw new Error(\"Maximum lock count exceeded\"); // Reentrant acquire // 3.2 å½“å‰çº¿ç¨‹è·å–å†™é”ï¼Œæ”¯æŒå¯é‡å¤åŠ é” setState(c + acquires); return true; &#125; // 3.3 å†™é”æœªè¢«ä»»ä½•çº¿ç¨‹è·å–ï¼Œå½“å‰çº¿ç¨‹å¯è·å–å†™é” if (writerShouldBlock() || !compareAndSetState(c, c + acquires)) return false; setExclusiveOwnerThread(current); return true;&#125; è¿™æ®µä»£ç çš„é€»è¾‘è¯·çœ‹æ³¨é‡Šï¼Œè¿™é‡Œæœ‰ä¸€ä¸ªåœ°æ–¹éœ€è¦é‡ç‚¹å…³æ³¨ï¼ŒexclusiveCount(c)æ–¹æ³•ï¼Œè¯¥æ–¹æ³•æºç ä¸ºï¼š 1static int exclusiveCount(int c) &#123; return c &amp; EXCLUSIVE_MASK; &#125; å…¶ä¸­EXCLUSIVE_MASKä¸º: static final int EXCLUSIVE_MASK = (1 &lt;&lt; SHARED_SHIFT) - 1; EXCLUSIVE _MASKä¸º1å·¦ç§»16ä½ç„¶åå‡1ï¼Œå³ä¸º0x0000FFFFã€‚è€ŒexclusiveCountæ–¹æ³•æ˜¯å°†åŒæ­¥çŠ¶æ€ï¼ˆstateä¸ºintç±»å‹ï¼‰ä¸0x0000FFFFç›¸ä¸ï¼Œå³å–åŒæ­¥çŠ¶æ€çš„ä½16ä½ã€‚é‚£ä¹ˆä½16ä½ä»£è¡¨ä»€ä¹ˆå‘¢ï¼Ÿæ ¹æ®exclusiveCountæ–¹æ³•çš„æ³¨é‡Šä¸ºç‹¬å å¼è·å–çš„æ¬¡æ•°å³å†™é”è¢«è·å–çš„æ¬¡æ•°ï¼Œç°åœ¨å°±å¯ä»¥å¾—å‡ºæ¥ä¸€ä¸ªç»“è®ºåŒæ­¥çŠ¶æ€çš„ä½16ä½ç”¨æ¥è¡¨ç¤ºå†™é”çš„è·å–æ¬¡æ•°ã€‚åŒæ—¶è¿˜æœ‰ä¸€ä¸ªæ–¹æ³•å€¼å¾—æˆ‘ä»¬æ³¨æ„ï¼š 1static int sharedCount(int c) &#123; return c &gt;&gt;&gt; SHARED_SHIFT; &#125; è¯¥æ–¹æ³•æ˜¯è·å–è¯»é”è¢«è·å–çš„æ¬¡æ•°ï¼Œæ˜¯å°†åŒæ­¥çŠ¶æ€ï¼ˆint cï¼‰å³ç§»16æ¬¡ï¼Œå³å–åŒæ­¥çŠ¶æ€çš„é«˜16ä½ï¼Œç°åœ¨æˆ‘ä»¬å¯ä»¥å¾—å‡ºå¦å¤–ä¸€ä¸ªç»“è®ºåŒæ­¥çŠ¶æ€çš„é«˜16ä½ç”¨æ¥è¡¨ç¤ºè¯»é”è¢«è·å–çš„æ¬¡æ•°ã€‚ç°åœ¨è¿˜è®°å¾—æˆ‘ä»¬å¼€ç¯‡è¯´çš„éœ€è¦å¼„æ‡‚çš„ç¬¬ä¸€ä¸ªé—®é¢˜å—ï¼Ÿè¯»å†™é”æ˜¯æ€æ ·å®ç°åˆ†åˆ«è®°å½•è¯»é”å’Œå†™é”çš„çŠ¶æ€çš„ï¼Œç°åœ¨è¿™ä¸ªé—®é¢˜çš„ç­”æ¡ˆå°±å·²ç»è¢«æˆ‘ä»¬å¼„æ¸…æ¥šäº†ï¼Œå…¶ç¤ºæ„å›¾å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š ç°åœ¨æˆ‘ä»¬å›è¿‡å¤´æ¥çœ‹å†™é”è·å–æ–¹æ³•tryAcquireï¼Œå…¶ä¸»è¦é€»è¾‘ä¸ºï¼šå½“è¯»é”å·²ç»è¢«è¯»çº¿ç¨‹è·å–æˆ–è€…å†™é”å·²ç»è¢«å…¶ä»–å†™çº¿ç¨‹è·å–ï¼Œåˆ™å†™é”è·å–å¤±è´¥ï¼›å¦åˆ™ï¼Œè·å–æˆåŠŸå¹¶æ”¯æŒé‡å…¥ï¼Œå¢åŠ å†™çŠ¶æ€ã€‚ 2.2.å†™é”çš„é‡Šæ”¾å†™é”é‡Šæ”¾é€šè¿‡é‡å†™AQSçš„tryReleaseæ–¹æ³•ï¼Œæºç ä¸ºï¼š 12345678910111213protected final boolean tryRelease(int releases) &#123; if (!isHeldExclusively()) throw new IllegalMonitorStateException(); //1. åŒæ­¥çŠ¶æ€å‡å»å†™çŠ¶æ€ int nextc = getState() - releases; //2. å½“å‰å†™çŠ¶æ€æ˜¯å¦ä¸º0ï¼Œä¸º0åˆ™é‡Šæ”¾å†™é” boolean free = exclusiveCount(nextc) == 0; if (free) setExclusiveOwnerThread(null); //3. ä¸ä¸º0åˆ™æ›´æ–°åŒæ­¥çŠ¶æ€ setState(nextc); return free;&#125; æºç çš„å®ç°é€»è¾‘è¯·çœ‹æ³¨é‡Šï¼Œä¸éš¾ç†è§£ä¸ReentrantLockåŸºæœ¬ä¸€è‡´ï¼Œè¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå‡å°‘å†™çŠ¶æ€int nextc = getState() - releases;åªéœ€è¦ç”¨å½“å‰åŒæ­¥çŠ¶æ€ç›´æ¥å‡å»å†™çŠ¶æ€çš„åŸå› æ­£æ˜¯æˆ‘ä»¬åˆšæ‰æ‰€è¯´çš„å†™çŠ¶æ€æ˜¯ç”±åŒæ­¥çŠ¶æ€çš„ä½16ä½è¡¨ç¤ºçš„ã€‚ 3.è¯»é”è¯¦è§£3.1.è¯»é”çš„è·å–çœ‹å®Œäº†å†™é”ï¼Œç°åœ¨æ¥çœ‹çœ‹è¯»é”ï¼Œè¯»é”ä¸æ˜¯ç‹¬å å¼é”ï¼Œå³åŒä¸€æ—¶åˆ»è¯¥é”å¯ä»¥è¢«å¤šä¸ªè¯»çº¿ç¨‹è·å–ä¹Ÿå°±æ˜¯ä¸€ç§å…±äº«å¼é”ã€‚æŒ‰ç…§ä¹‹å‰å¯¹AQSä»‹ç»ï¼Œå®ç°å…±äº«å¼åŒæ­¥ç»„ä»¶çš„åŒæ­¥è¯­ä¹‰éœ€è¦é€šè¿‡é‡å†™AQSçš„tryAcquireSharedæ–¹æ³•å’ŒtryReleaseSharedæ–¹æ³•ã€‚è¯»é”çš„è·å–å®ç°æ–¹æ³•ä¸ºï¼š 123456789101112131415161718192021222324252627282930313233protected final int tryAcquireShared(int unused) &#123; Thread current = Thread.currentThread(); int c = getState(); //1. å¦‚æœå†™é”å·²ç»è¢«è·å–å¹¶ä¸”è·å–å†™é”çš„çº¿ç¨‹ä¸æ˜¯å½“å‰çº¿ç¨‹çš„è¯ï¼Œå½“å‰ // çº¿ç¨‹è·å–è¯»é”å¤±è´¥è¿”å›-1 if (exclusiveCount(c) != 0 &amp;&amp; getExclusiveOwnerThread() != current) return -1; int r = sharedCount(c); if (!readerShouldBlock() &amp;&amp; r &lt; MAX_COUNT &amp;&amp; //2. å½“å‰çº¿ç¨‹è·å–è¯»é” compareAndSetState(c, c + SHARED_UNIT)) &#123; //3. ä¸‹é¢çš„ä»£ç ä¸»è¦æ˜¯æ–°å¢çš„ä¸€äº›åŠŸèƒ½ï¼Œæ¯”å¦‚getReadHoldCount()æ–¹æ³• //è¿”å›å½“å‰è·å–è¯»é”çš„æ¬¡æ•° if (r == 0) &#123; firstReader = current; firstReaderHoldCount = 1; &#125; else if (firstReader == current) &#123; firstReaderHoldCount++; &#125; else &#123; HoldCounter rh = cachedHoldCounter; if (rh == null || rh.tid != getThreadId(current)) cachedHoldCounter = rh = readHolds.get(); else if (rh.count == 0) readHolds.set(rh); rh.count++; &#125; return 1; &#125; //4. å¤„ç†åœ¨ç¬¬äºŒæ­¥ä¸­CASæ“ä½œå¤±è´¥çš„è‡ªæ—‹å·²ç»å®ç°é‡å…¥æ€§ return fullTryAcquireShared(current);&#125; ä»£ç çš„é€»è¾‘è¯·çœ‹æ³¨é‡Šï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ å½“å†™é”è¢«å…¶ä»–çº¿ç¨‹è·å–åï¼Œè¯»é”è·å–å¤±è´¥ï¼Œå¦åˆ™è·å–æˆåŠŸåˆ©ç”¨CASæ›´æ–°åŒæ­¥çŠ¶æ€ã€‚å¦å¤–ï¼Œå½“å‰åŒæ­¥çŠ¶æ€éœ€è¦åŠ ä¸ŠSHARED_UNITï¼ˆ(1 &lt;&lt; SHARED_SHIFT)å³0x00010000ï¼‰çš„åŸå› è¿™æ˜¯æˆ‘ä»¬åœ¨ä¸Šé¢æ‰€è¯´çš„åŒæ­¥çŠ¶æ€çš„é«˜16ä½ç”¨æ¥è¡¨ç¤ºè¯»é”è¢«è·å–çš„æ¬¡æ•°ã€‚å¦‚æœCASå¤±è´¥æˆ–è€…å·²ç»è·å–è¯»é”çš„çº¿ç¨‹å†æ¬¡è·å–è¯»é”æ—¶ï¼Œæ˜¯é fullTryAcquireSharedæ–¹æ³•å®ç°çš„ï¼Œè¿™æ®µä»£ç å°±ä¸å±•å¼€è¯´äº†ï¼Œæœ‰å…´è¶£å¯ä»¥çœ‹çœ‹ã€‚ 3.2.è¯»é”çš„é‡Šæ”¾è¯»é”é‡Šæ”¾çš„å®ç°ä¸»è¦é€šè¿‡æ–¹æ³•tryReleaseSharedï¼Œæºç å¦‚ä¸‹ï¼Œä¸»è¦é€»è¾‘è¯·çœ‹æ³¨é‡Šï¼š 1234567891011121314151617181920212223242526272829303132protected final boolean tryReleaseShared(int unused) &#123; Thread current = Thread.currentThread(); // å‰é¢è¿˜æ˜¯ä¸ºäº†å®ç°getReadHoldCountç­‰æ–°åŠŸèƒ½ if (firstReader == current) &#123; // assert firstReaderHoldCount &gt; 0; if (firstReaderHoldCount == 1) firstReader = null; else firstReaderHoldCount--; &#125; else &#123; HoldCounter rh = cachedHoldCounter; if (rh == null || rh.tid != getThreadId(current)) rh = readHolds.get(); int count = rh.count; if (count &lt;= 1) &#123; readHolds.remove(); if (count &lt;= 0) throw unmatchedUnlockException(); &#125; --rh.count; &#125; for (;;) &#123; int c = getState(); // è¯»é”é‡Šæ”¾ å°†åŒæ­¥çŠ¶æ€å‡å»è¯»çŠ¶æ€å³å¯ int nextc = c - SHARED_UNIT; if (compareAndSetState(c, nextc)) // Releasing the read lock has no effect on readers, // but it may allow waiting writers to proceed if // both read and write locks are now free. return nextc == 0; &#125;&#125; 4.é”é™çº§è¯»å†™é”æ”¯æŒé”é™çº§ï¼Œéµå¾ªæŒ‰ç…§è·å–å†™é”ï¼Œè·å–è¯»é”å†é‡Šæ”¾å†™é”çš„æ¬¡åºï¼Œå†™é”èƒ½å¤Ÿé™çº§æˆä¸ºè¯»é”ï¼Œä¸æ”¯æŒé”å‡çº§ï¼Œå…³äºé”é™çº§ä¸‹é¢çš„ç¤ºä¾‹ä»£ç æ‘˜è‡ªReentrantWriteReadLockæºç ä¸­ï¼š 123456789101112131415161718192021222324252627void processCachedData() &#123; rwl.readLock().lock(); if (!cacheValid) &#123; // Must release read lock before acquiring write lock rwl.readLock().unlock(); rwl.writeLock().lock(); try &#123; // Recheck state because another thread might have // acquired write lock and changed state before we did. if (!cacheValid) &#123; data = ... cacheValid = true; &#125; // Downgrade by acquiring read lock before releasing write lock rwl.readLock().lock(); &#125; finally &#123; rwl.writeLock().unlock(); // Unlock write, still hold read &#125; &#125; try &#123; use(data); &#125; finally &#123; rwl.readLock().unlock(); &#125; &#125;&#125;","categories":[{"name":"Java","slug":"Java","permalink":"/categories/Java/"},{"name":"ReentrantLock","slug":"Java/ReentrantLock","permalink":"/categories/Java/ReentrantLock/"}],"tags":[{"name":"Java","slug":"Java","permalink":"/tags/Java/"},{"name":"Lock","slug":"Lock","permalink":"/tags/Lock/"}]},{"title":"Javaé¢è¯•æŠ€æœ¯æ ˆ","slug":"Javaé¢è¯•æŠ€æœ¯æ ˆ","date":"2019-10-20T19:07:51.000Z","updated":"2019-10-20T11:18:07.345Z","comments":true,"path":"2019/10/21/Javaé¢è¯•æŠ€æœ¯æ ˆ/","link":"","permalink":"/2019/10/21/Java%E9%9D%A2%E8%AF%95%E6%8A%80%E6%9C%AF%E6%A0%88/","excerpt":"","text":"å‰‘æŒ‡offerjavaåŸºç¡€çŸ¥è¯†ï¼š 1.1å¸¸ç”¨apiï¼› 1.2 javaæ•°æ®ç»“æ„ï¼šArrayListæ‰©å®¹ï¼ŒHashMapç»“æ„ï¼ŒHashset/HashtableåŸç†ï¼ŒCollection.sortç”¨æ³•ï¼ŒBlockingQueueç”¨æ³•,å•é“¾è¡¨ç»“æ„,çº¢é»‘æ ‘ï¼› 1.3ç®—æ³•ï¼šå•é“¾è¡¨åè½¬ï¼Œæ’åºç®—æ³•ã€‚ javaé«˜çº§çŸ¥è¯†ï¼š1.1 JVMç›¸å…³ï¼šJVMå¦‚ä½•è¿›è¡Œgcï¼ŒJVMè°ƒä¼˜ï¼Œåƒåœ¾å›æ”¶ç®—æ³•ï¼ŒJVMå†…å­˜æ¨¡å‹ï¼Œç±»åŠ è½½æœºåˆ¶ï¼Œå†…å­˜æ³„æ¼ï¼Œå†…å­˜æº¢å‡ºï¼› 1.2jdkæä¾›çš„å‘½ä»¤ï¼› 1.3è®¾è®¡æ¨¡å¼ã€‚ å¤šçº¿ç¨‹ç›¸å…³ï¼š å¤šçº¿ç¨‹å®ç°æ–¹å¼ï¼Œå¯¹synchronizedçš„ç†è§£ï¼ŒConcurrentHashmapçš„ç»“æ„å’Œå®ç°åŸç†ï¼ŒThreadPoolExcuteråŸç†ï¼Œvolitaleå…³é”®å­—ï¼› Springæ¡†æ¶ç›¸å…³ï¼šIOCå’ŒAOPï¼ŒåŠ¨æ€ä»£ç†ï¼ŒSpringæ‹¦æˆªæœºåˆ¶ã€‚ æ•°æ®åº“ç›¸å…³ï¼š 5.1ç´¢å¼•åŸç†ï¼Œmysqlçš„æœ€å·¦åŒ¹é…åŸåˆ™ï¼› 5.2å¦‚ä½•åšè¯»å†™åˆ†ç¦»ï¼Œåˆ†åº“æ–¹æ³•ï¼ˆThreadLocalç”¨æ³•ï¼‰ï¼› 5.3äº‹åŠ¡ç›¸å…³ï¼šäº‹åŠ¡çš„4ä¸ªéš”ç¦»çº§åˆ«ï¼Œmysqlé»˜è®¤çš„éš”ç¦»çº§åˆ«ï¼Œæ•°æ®åº“é”ï¼ˆæ‚²è§‚é”ï¼Œä¹è§‚é”ï¼‰ï¼Œæ­»é”çš„æ¡ä»¶ï¼Œäº‹åŠ¡æ³¨è§£çš„ç”¨æ³•ï¼ŒOCIDç†è§£ï¼ˆåŸå­æ€§ï¼Œæœ‰åºæ€§ï¼Œå¯è§æ€§ï¼Œå¹‚ç­‰æ€§ï¼‰ã€‚ 5.4 mysqlè°ƒä¼˜ã€‚ å¼€æºæ¡†æ¶ï¼š 6.1æ•°æ®å­˜å‚¨ï¼šmemcacheï¼Œredisåˆ©å¼Šï¼Œredisé”ï¼Œredisçš„aofå’Œrdbè½ç›˜æ–¹å¼ï¼Œredisé›†ç¾¤éƒ¨ç½²ï¼Œä¸€è‡´æ€§å“ˆå¸Œç®—æ³•ï¼ŒMongoæ•°æ®åº“ï¼› 6.2RokectMqï¼ˆMQæ¶ˆæ¯ä¸¢å¤±ï¼ŒMQæ€æ ·ç›‘å¬ï¼ŒRoketMqé«˜å¯ç”¨éƒ¨ç½² ï¼‰ï¼› 6.3 DubboæœåŠ¡ï¼ˆdubboå’ŒHTTPçš„ä¼˜åŠ£ï¼‰ï¼ŒdubboæœåŠ¡çš„è°ƒç”¨è¿‡ç¨‹ï¼› 6.4Elasticjobï¼ˆæ¶æ„/æµç¨‹å›¾ï¼Œæ‰§è¡Œè¿‡ç¨‹ï¼Œé€‰ä¸¾ç®—æ³• ï¼‰ï¼Œå…¶ä»–ä½œä¸šè°ƒåº¦æ¡†æ¶ï¼ˆç»“åˆé¡¹ç›®ä¸­ç”¨çš„è°ƒåº¦æ–¹å¼ï¼‰ï¼Œ 6.5mybatisç”¨æ³•ï¼› 6.6å…³å¿ƒçš„æ–°æŠ€æœ¯æœ‰å“ªäº›ã€‚ å¸¸ç”¨linuxé«˜ç«¯å‘½ä»¤ï¼štopï¼Œnetstatç­‰ã€‚ WEBæœåŠ¡å™¨ï¼štomcatç”¨æ³•ï¼Œå¦‚ä½•æ’é™¤tomcaæ— å“åº”æ•…éšœï¼Œapacheï¼Œnginxï¼Œdockeräº†è§£ä¸€ä¸‹ï¼Œnginxå’Œlvsçš„åŒºåˆ«ã€‚ ç½‘ç»œç¼–ç¨‹æ–¹é¢ï¼š å¸¸è§çš„ç½‘ç»œè¶…æ—¶ï¼ˆCLOSE_WAIT,TIME_WAITï¼‰ï¼Œå¦‚ä½•é¿å…é‡è¯•çš„é—®é¢˜ï¼Œhttpçš„cookieæœºåˆ¶ï¼ŒCDNåŸç†ã€‚ å…¶ä»–é—®é¢˜ï¼š åœ¨é¡¹ç›®ä¸­é‡åˆ°çš„æœ€å¤§çš„é—®é¢˜æ˜¯ä»€ä¹ˆï¼Ÿæ€æ ·è§£å†³çš„ï¼Ÿ ä»é¡¹ç›®ä¸­å­¦åˆ°äº†ä»€ä¹ˆï¼Ÿ","categories":[{"name":"é¢è¯•","slug":"é¢è¯•","permalink":"/categories/%E9%9D%A2%E8%AF%95/"},{"name":"Java","slug":"é¢è¯•/Java","permalink":"/categories/%E9%9D%A2%E8%AF%95/Java/"}],"tags":[{"name":"Java","slug":"Java","permalink":"/tags/Java/"},{"name":"IT","slug":"IT","permalink":"/tags/IT/"},{"name":"æŠ€æœ¯ç¬”è®°","slug":"æŠ€æœ¯ç¬”è®°","permalink":"/tags/%E6%8A%80%E6%9C%AF%E7%AC%94%E8%AE%B0/"},{"name":"é¢è¯•","slug":"é¢è¯•","permalink":"/tags/%E9%9D%A2%E8%AF%95/"}]},{"title":"Hibernateé¢è¯•é¢˜","slug":"Hibernate","date":"2019-10-20T11:51:12.000Z","updated":"2019-10-20T06:00:16.682Z","comments":true,"path":"2019/10/20/Hibernate/","link":"","permalink":"/2019/10/20/Hibernate/","excerpt":"","text":"1ã€Hibernateå·¥ä½œåŸç†åŠä¸ºä»€ä¹ˆè¦ç”¨ï¼Ÿ Hibernateå·¥ä½œåŸç†åŠä¸ºä»€ä¹ˆè¦ç”¨ï¼Ÿ è¯»å–å¹¶è§£æé…ç½®æ–‡ä»¶ è¯»å–å¹¶è§£ææ˜ å°„ä¿¡æ¯ï¼Œåˆ›å»ºSessionFactory æ‰“å¼€Sesssion åˆ›å»ºäº‹åŠ¡Transation æŒä¹…åŒ–æ“ä½œ æäº¤äº‹åŠ¡ å…³é—­Session å…³é—­SesstionFactory ä½¿ç”¨Hibernateæ¡†æ¶å°±ä¸ç”¨æˆ‘ä»¬å†™å¾ˆå¤šç¹ççš„SQLè¯­å¥ã€‚Hibernateå®ç°äº†ORMï¼Œèƒ½å¤Ÿå°†å¯¹è±¡æ˜ å°„æˆæ•°æ®åº“è¡¨ï¼Œä»è€Œç®€åŒ–æˆ‘ä»¬çš„å¼€å‘ï¼ 2ã€Hibernateæ˜¯å¦‚ä½•å»¶è¿ŸåŠ è½½(æ‡’åŠ è½½)?é€šè¿‡è®¾ç½®å±æ€§lazyè¿›è¡Œè®¾ç½®æ˜¯å¦éœ€è¦æ‡’åŠ è½½ å½“Hibernateåœ¨æŸ¥è¯¢æ•°æ®çš„æ—¶å€™ï¼Œæ•°æ®å¹¶æ²¡æœ‰å­˜åœ¨äºå†…å­˜ä¸­ï¼Œå½“ç¨‹åºçœŸæ­£å¯¹æ•°æ®çš„æ“ä½œæ—¶ï¼Œå¯¹è±¡æ‰å­˜åœ¨ä¸å†…å­˜ä¸­ï¼Œå°±å®ç°äº†å»¶è¿ŸåŠ è½½ï¼Œä»–èŠ‚çœäº†æœåŠ¡å™¨çš„å†…å­˜å¼€é”€ï¼Œä»è€Œæé«˜äº†æœåŠ¡å™¨çš„æ€§èƒ½ã€‚ 3ã€Hibernateä¸­æ€æ ·å®ç°ç±»ä¹‹é—´çš„å…³ç³»?(å¦‚ï¼šä¸€å¯¹å¤šã€å¤šå¯¹å¤šçš„å…³ç³»)å®ƒä»¬é€šè¿‡é…ç½®æ–‡ä»¶ä¸­çš„many-to-oneã€one-to-manyã€many-to-manyæ¥å®ç°ç±»ä¹‹é—´çš„å…³è”å…³ç³»çš„ã€‚ 4ã€hibernateçš„ä¸‰ç§çŠ¶æ€ä¹‹é—´å¦‚ä½•è½¬æ¢Hibernateä¸­å¯¹è±¡çš„çŠ¶æ€ï¼š ä¸´æ—¶/ç¬æ—¶çŠ¶æ€: å¯¹è±¡åˆšnewå‡ºæ¥ï¼Œè¿˜æ²¡è®¾idï¼Œè®¾äº†å…¶ä»–å€¼ã€‚ è¯¥å¯¹è±¡è¿˜æ²¡æœ‰è¢«æŒä¹…åŒ–ã€æ²¡æœ‰ä¿å­˜åœ¨æ•°æ®åº“ä¸­ã€‘ ä¸å—Sessionçš„ç®¡ç† 1User user=new User();//å¤„äºç¬æ—¶æ€ æŒä¹…åŒ–çŠ¶æ€ è°ƒç”¨äº†save()ã€saveOrUpdate()ï¼Œå°±å˜æˆPersistentï¼Œæœ‰id. å½“ä¿å­˜åœ¨æ•°æ®åº“ä¸­çš„å¯¹è±¡å°±æ˜¯æŒä¹…åŒ–çŠ¶æ€äº† å½“è°ƒç”¨sessionçš„save/saveOrUpdate/get/load/listç­‰æ–¹æ³•çš„æ—¶å€™ï¼Œå¯¹è±¡å°±æ˜¯æŒä¹…åŒ–çŠ¶æ€ åœ¨æ•°æ®åº“æœ‰å¯¹åº”çš„æ•°æ® å—Sessionçš„ç®¡ç† å½“å¯¹å¯¹è±¡å±æ€§è¿›è¡Œæ›´æ”¹çš„æ—¶å€™ï¼Œä¼šåæ˜ åˆ°æ•°æ®åº“ä¸­! 12session.save(idCard);idCard.setIdCardName(\"æˆ‘æ˜¯æµ‹è¯•æŒä¹…åŒ–å¯¹è±¡\"); æ¸¸ç¦»çŠ¶æ€. å½“session close()å®Œä¹‹åï¼Œå˜æˆDetachedã€‚æ•°æ®åº“ä¸­æœ‰å¯¹åº”çš„è®°å½• newå‡ºæ¥çš„å¯¹è±¡æ˜¯ç¬æ—¶çŠ¶æ€-&gt;ä¿å­˜åˆ°æ•°æ®åº“ä¸­(å—Sessionç®¡ç†)å°±æ˜¯æŒä¹…åŒ–çŠ¶æ€-&gt;å°†session closeæ‰å°±æ˜¯æ¸¸ç¦»çŠ¶æ€ 5ã€æ¯”è¾ƒhibernateçš„ä¸‰ç§æ£€ç´¢ç­–ç•¥ä¼˜ç¼ºç‚¹ ç«‹å³æ£€ç´¢ï¼š ä¼˜ç‚¹ï¼š å¯¹åº”ç”¨ç¨‹åºå®Œå…¨é€æ˜ï¼Œä¸ç®¡å¯¹è±¡å¤„äºæŒä¹…åŒ–çŠ¶æ€ï¼Œè¿˜æ˜¯æ¸¸ç¦»çŠ¶æ€ï¼Œåº”ç”¨ç¨‹åºéƒ½å¯ä»¥æ–¹ä¾¿çš„ä»ä¸€ä¸ªå¯¹è±¡å¯¼èˆªåˆ°ä¸å®ƒå…³è”çš„å¯¹è±¡ï¼› ç¼ºç‚¹ï¼š 1.selectè¯­å¥å¤ªå¤šï¼›2.å¯èƒ½ä¼šåŠ è½½åº”ç”¨ç¨‹åºä¸éœ€è¦è®¿é—®çš„å¯¹è±¡ç™½ç™½æµªè´¹è®¸å¤šå†…å­˜ç©ºé—´ï¼› ç«‹å³æ£€ç´¢:lazy=falseï¼› å»¶è¿Ÿæ£€ç´¢ï¼š ä¼˜ç‚¹ï¼š ç”±åº”ç”¨ç¨‹åºå†³å®šéœ€è¦åŠ è½½å“ªäº›å¯¹è±¡ï¼Œå¯ä»¥é¿å…å¯æ‰§è¡Œå¤šä½™çš„selectè¯­å¥ï¼Œä»¥åŠé¿å…åŠ è½½åº”ç”¨ç¨‹åºä¸éœ€è¦è®¿é—®çš„å¯¹è±¡ã€‚å› æ­¤èƒ½æé«˜æ£€ç´¢æ€§èƒ½ï¼Œå¹¶ä¸”èƒ½èŠ‚çœå†…å­˜ç©ºé—´ï¼› ç¼ºç‚¹ï¼š åº”ç”¨ç¨‹åºå¦‚æœå¸Œæœ›è®¿é—®æ¸¸ç¦»çŠ¶æ€ä»£ç†ç±»å®ä¾‹ï¼Œå¿…é¡»ä¿è¯ä»–åœ¨æŒä¹…åŒ–çŠ¶æ€æ—¶å·²ç»è¢«åˆå§‹åŒ–ï¼› å»¶è¿ŸåŠ è½½ï¼šlazy=trueï¼› è¿«åˆ‡å·¦å¤–è¿æ¥æ£€ç´¢ï¼š ä¼˜ç‚¹ï¼š 1å¯¹åº”ç”¨ç¨‹åºå®Œå…¨é€æ˜ï¼Œä¸ç®¡å¯¹è±¡å¤„äºæŒä¹…åŒ–çŠ¶æ€ï¼Œè¿˜æ˜¯æ¸¸ç¦»çŠ¶æ€ï¼Œåº”ç”¨ç¨‹åºéƒ½å¯ä»¥æ–¹ä¾¿åœ°ä»ä¸€ä¸ªå¯¹è±¡å¯¼èˆªåˆ°ä¸å®ƒå…³è”çš„å¯¹è±¡ã€‚2ä½¿ç”¨äº†å¤–è¿æ¥ï¼Œselectè¯­å¥æ•°ç›®å°‘ï¼› ç¼ºç‚¹ï¼š 1 å¯èƒ½ä¼šåŠ è½½åº”ç”¨ç¨‹åºä¸éœ€è¦è®¿é—®çš„å¯¹è±¡ï¼Œç™½ç™½æµªè´¹è®¸å¤šå†…å­˜ç©ºé—´ï¼›2å¤æ‚çš„æ•°æ®åº“è¡¨è¿æ¥ä¹Ÿä¼šå½±å“æ£€ç´¢æ€§èƒ½ï¼› é¢„å…ˆæŠ“å–ï¼š fetch=â€œjoinâ€ï¼› 6ã€hibernateéƒ½æ”¯æŒå“ªäº›ç¼“å­˜ç­–ç•¥ hibernateéƒ½æ”¯æŒå“ªäº›ç¼“å­˜ç­–ç•¥ usageçš„å±æ€§æœ‰4ç§ï¼š æ”¾å…¥äºŒçº§ç¼“å­˜çš„å¯¹è±¡ï¼Œåªè¯»(Read-only); éä¸¥æ ¼çš„è¯»å†™(Nonstrict read/write) è¯»å†™ï¼› æ”¾å…¥äºŒçº§ç¼“å­˜çš„å¯¹è±¡å¯ä»¥è¯»ã€å†™(Read/write)ï¼› åŸºäºäº‹åŠ¡çš„ç­–ç•¥(Transactional) 7ã€hibernateé‡Œé¢çš„sorted collection å’Œordered collectionæœ‰ä»€ä¹ˆåŒºåˆ«sorted collection æ˜¯åœ¨å†…å­˜ä¸­é€šè¿‡Javaæ¯”è¾ƒå™¨è¿›è¡Œæ’åºçš„ ordered collection æ˜¯åœ¨æ•°æ®åº“ä¸­é€šè¿‡order byè¿›è¡Œæ’åºçš„ å¯¹äºæ¯”è¾ƒå¤§çš„æ•°æ®é›†ï¼Œä¸ºäº†é¿å…åœ¨å†…å­˜ä¸­å¯¹å®ƒä»¬è¿›è¡Œæ’åºè€Œå‡ºç° Javaä¸­çš„OutOfMemoryErrorï¼Œæœ€å¥½ä½¿ç”¨ordered collectionã€‚ 8ã€è¯´ä¸‹Hibernateçš„ç¼“å­˜æœºåˆ¶ ä¸€çº§ç¼“å­˜ï¼š Hibenateä¸­ä¸€çº§ç¼“å­˜ï¼Œä¹Ÿå«åšsessionçš„ç¼“å­˜ï¼Œå®ƒå¯ä»¥åœ¨sessionèŒƒå›´å†…å‡å°‘æ•°æ®åº“çš„è®¿é—®æ¬¡æ•°ï¼ åªåœ¨sessionèŒƒå›´æœ‰æ•ˆï¼ Sessionå…³é—­ï¼Œä¸€çº§ç¼“å­˜å¤±æ•ˆï¼ åªè¦æ˜¯æŒä¹…åŒ–å¯¹è±¡çŠ¶æ€çš„ï¼Œéƒ½å—Sessionç®¡ç†ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œéƒ½ä¼šåœ¨Sessionç¼“å­˜ä¸­ï¼ Sessionçš„ç¼“å­˜ç”±hibernateç»´æŠ¤ï¼Œç”¨æˆ·ä¸èƒ½æ“ä½œç¼“å­˜å†…å®¹ï¼› å¦‚æœæƒ³æ“ä½œç¼“å­˜å†…å®¹ï¼Œå¿…é¡»é€šè¿‡hibernateæä¾›çš„evit/clearæ–¹æ³•æ“ä½œã€‚ äºŒçº§ç¼“å­˜ï¼š äºŒçº§ç¼“å­˜æ˜¯åŸºäºåº”ç”¨ç¨‹åºçš„ç¼“å­˜ï¼Œæ‰€æœ‰çš„Sessionéƒ½å¯ä»¥ä½¿ç”¨ Hibernateæä¾›çš„äºŒçº§ç¼“å­˜æœ‰é»˜è®¤çš„å®ç°ï¼Œä¸”æ˜¯ä¸€ç§å¯æ’é…çš„ç¼“å­˜æ¡†æ¶ï¼å¦‚æœç”¨æˆ·æƒ³ç”¨äºŒçº§ç¼“å­˜ï¼Œåªéœ€è¦åœ¨hibernate.cfg.xmlä¸­é…ç½®å³å¯ï¼› ä¸æƒ³ç”¨ï¼Œç›´æ¥ç§»é™¤ï¼Œä¸å½±å“ä»£ç ã€‚ å¦‚æœç”¨æˆ·è§‰å¾—hibernateæä¾›çš„æ¡†æ¶æ¡†æ¶ä¸å¥½ç”¨ï¼Œè‡ªå·±å¯ä»¥æ¢å…¶ä»–çš„ç¼“å­˜æ¡†æ¶æˆ–è‡ªå·±å®ç°ç¼“å­˜æ¡†æ¶éƒ½å¯ä»¥ã€‚ HibernateäºŒçº§ç¼“å­˜ï¼šå­˜å‚¨çš„æ˜¯å¸¸ç”¨çš„ç±» 9ã€Hibernateçš„æŸ¥è¯¢æ–¹å¼æœ‰å‡ ç§ å¯¹è±¡å¯¼èˆªæŸ¥è¯¢(objectcomposition) HQLæŸ¥è¯¢ 1ã€ å±æ€§æŸ¥è¯¢ 2ã€ å‚æ•°æŸ¥è¯¢ã€å‘½åå‚æ•°æŸ¥è¯¢ 3ã€ å…³è”æŸ¥è¯¢ 4ã€ åˆ†é¡µæŸ¥è¯¢ 5ã€ ç»Ÿè®¡å‡½æ•° Criteria æŸ¥è¯¢ SQLQueryæœ¬åœ°SQLæŸ¥è¯¢ 10ã€å¦‚ä½•ä¼˜åŒ–Hibernateï¼Ÿ æ•°æ®åº“è®¾è®¡è°ƒæ•´ HQLä¼˜åŒ– APIçš„æ­£ç¡®ä½¿ç”¨(å¦‚æ ¹æ®ä¸åŒçš„ä¸šåŠ¡ç±»å‹é€‰ç”¨ä¸åŒçš„é›†åˆåŠæŸ¥è¯¢API) ä¸»é…ç½®å‚æ•°(æ—¥å¿—ï¼ŒæŸ¥è¯¢ç¼“å­˜ï¼Œfetch_size, batch_sizeç­‰) æ˜ å°„æ–‡ä»¶ä¼˜åŒ–(IDç”Ÿæˆç­–ç•¥ï¼ŒäºŒçº§ç¼“å­˜ï¼Œå»¶è¿ŸåŠ è½½ï¼Œå…³è”ä¼˜åŒ–) ä¸€çº§ç¼“å­˜çš„ç®¡ç† é’ˆå¯¹äºŒçº§ç¼“å­˜ï¼Œè¿˜æœ‰è®¸å¤šç‰¹æœ‰çš„ç­–ç•¥ è¯¦æƒ…å¯å‚è€ƒèµ„æ–™ï¼š https://www.cnblogs.com/xhj123/p/6106088.html 11ã€è°ˆè°ˆHibernateä¸­inverseçš„ä½œç”¨inverseå±æ€§é»˜è®¤æ˜¯false,å°±æ˜¯è¯´å…³ç³»çš„ä¸¤ç«¯éƒ½æ¥ç»´æŠ¤å…³ç³»ã€‚ æ¯”å¦‚Studentå’ŒTeacheræ˜¯å¤šå¯¹å¤šå…³ç³»ï¼Œç”¨ä¸€ä¸ªä¸­é—´è¡¨TeacherStudentç»´æŠ¤ã€‚Gp) å¦‚æœStudentè¿™è¾¹inverse=â€trueâ€, é‚£ä¹ˆå…³ç³»ç”±å¦ä¸€ç«¯Teacherç»´æŠ¤ï¼Œå°±æ˜¯è¯´å½“æ’å…¥Studentæ—¶ï¼Œä¸ä¼šæ“ä½œTeacherStudentè¡¨ï¼ˆä¸­é—´è¡¨ï¼‰ã€‚åªæœ‰Teacheræ’å…¥æˆ–åˆ é™¤æ—¶æ‰ä¼šè§¦å‘å¯¹ä¸­é—´è¡¨çš„æ“ä½œã€‚æ‰€ä»¥ä¸¤è¾¹éƒ½inverse=â€trueâ€æ˜¯ä¸å¯¹çš„ï¼Œä¼šå¯¼è‡´ä»»ä½•æ“ä½œéƒ½ä¸è§¦å‘å¯¹ä¸­é—´è¡¨çš„å½±å“ï¼›å½“ä¸¤è¾¹éƒ½inverse=â€falseâ€æˆ–é»˜è®¤æ—¶ï¼Œä¼šå¯¼è‡´åœ¨ä¸­é—´è¡¨ä¸­æ’å…¥ä¸¤æ¬¡å…³ç³»ã€‚ å¦‚æœè¡¨ä¹‹é—´çš„å…³è”å…³ç³»æ˜¯â€œä¸€å¯¹å¤šâ€çš„è¯ï¼Œé‚£ä¹ˆinverseåªèƒ½åœ¨â€œä¸€â€çš„ä¸€æ–¹æ¥é…ç½®ï¼ è¯¦æƒ…å¯å‚è€ƒï¼š https://zhongfucheng.bitcron.com/post/hibernate/hibernate-inversehe-cascadeshu-xing-zhi-shi-yao-dian 12ã€JDBCï¼Œhibernate å’Œ ibatis çš„åŒºåˆ«jdbc:æ‰‹åŠ¨ æ‰‹åŠ¨å†™sql deleteã€insertã€updateè¦å°†å¯¹è±¡çš„å€¼ä¸€ä¸ªä¸€ä¸ªå–å‡ºä¼ åˆ°sqlä¸­,ä¸èƒ½ç›´æ¥ä¼ å…¥ä¸€ä¸ªå¯¹è±¡ã€‚ select:è¿”å›çš„æ˜¯ä¸€ä¸ªresultsetï¼Œè¦ä»ResultSetä¸­ä¸€è¡Œä¸€è¡Œã€ä¸€ä¸ªå­—æ®µä¸€ä¸ªå­—æ®µçš„å–å‡ºï¼Œç„¶åå°è£…åˆ°ä¸€ä¸ªå¯¹è±¡ä¸­ï¼Œä¸ç›´æ¥è¿”å›ä¸€ä¸ªå¯¹è±¡ã€‚ ibatisçš„ç‰¹ç‚¹:åŠè‡ªåŠ¨åŒ– sqlè¦æ‰‹åŠ¨å†™ deleteã€insertã€update:ç›´æ¥ä¼ å…¥ä¸€ä¸ªå¯¹è±¡ select:ç›´æ¥è¿”å›ä¸€ä¸ªå¯¹è±¡ hibernate:å…¨è‡ªåŠ¨ ä¸å†™sql,è‡ªåŠ¨å°è£… deleteã€insertã€update:ç›´æ¥ä¼ å…¥ä¸€ä¸ªå¯¹è±¡ select:ç›´æ¥è¿”å›ä¸€ä¸ªå¯¹è±¡ 13ã€åœ¨æ•°æ®åº“ä¸­æ¡ä»¶æŸ¥è¯¢é€Ÿåº¦å¾ˆæ…¢çš„æ—¶å€™,å¦‚ä½•ä¼˜åŒ–? å»ºç´¢å¼• å‡å°‘è¡¨ä¹‹é—´çš„å…³è” ä¼˜åŒ–sqlï¼Œå°½é‡è®©sqlå¾ˆå¿«å®šä½æ•°æ®ï¼Œä¸è¦è®©sqlåšå…¨è¡¨æŸ¥è¯¢ï¼Œåº”è¯¥èµ°ç´¢å¼•,æŠŠæ•°æ®é‡å¤§çš„è¡¨æ’åœ¨å‰é¢ ç®€åŒ–æŸ¥è¯¢å­—æ®µï¼Œæ²¡ç”¨çš„å­—æ®µä¸è¦ï¼Œå·²ç»å¯¹è¿”å›ç»“æœçš„æ§åˆ¶ï¼Œå°½é‡è¿”å›å°‘é‡æ•°æ® è¯¦æƒ…å¯å‚è€ƒï¼š https://mp.weixin.qq.com/s?timestamp=1520300404&amp;src=3&amp;ver=1&amp;signature=W6Fo7aDHiJtK4ecUcnSJ4h9bN0vRAcTPKBTgLWSJDsMcdQReJC487RYzUIU9UFYQdmgLFyss9cKifM*GFp*CEVLtaLlwjj2HaDOjsCRkTnwfVlUY5cDhSyRi-c8leheofZJVnu6wYQ3IvT*hYyVB1pQCqqnuXIWERaksjXuyNP8= 14ã€ä»€ä¹ˆæ˜¯SessionFactory,æ˜¯çº¿ç¨‹å®‰å…¨ä¹ˆ?SessionFactory æ˜¯Hibrenateå•ä¾‹æ•°æ®å­˜å‚¨å’Œçº¿ç¨‹å®‰å…¨çš„ï¼Œä»¥è‡³äºå¯ä»¥å¤šçº¿ç¨‹åŒæ—¶è®¿é—®ã€‚ä¸€ä¸ªSessionFactory åœ¨å¯åŠ¨çš„æ—¶å€™åªèƒ½å»ºç«‹ä¸€æ¬¡ã€‚SessionFactoryåº”è¯¥åŒ…è£…å„ç§å•ä¾‹ä»¥è‡³äºå®ƒèƒ½å¾ˆç®€å•çš„åœ¨ä¸€ä¸ªåº”ç”¨ä»£ç ä¸­å‚¨å­˜. 15ã€getå’ŒloadåŒºåˆ«get()ç«‹å³æŸ¥è¯¢ load()æ‡’åŠ è½½ getå¦‚æœæ²¡æœ‰æ‰¾åˆ°ä¼šè¿”å›nullï¼Œ loadå¦‚æœæ²¡æœ‰æ‰¾åˆ°ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚ getä¼šå…ˆæŸ¥ä¸€çº§ç¼“å­˜ï¼Œ å†æŸ¥äºŒçº§ç¼“å­˜ï¼Œç„¶åæŸ¥æ•°æ®åº“ï¼›loadä¼šå…ˆæŸ¥ä¸€çº§ç¼“å­˜ï¼Œå¦‚æœæ²¡æœ‰æ‰¾åˆ°ï¼Œå°±åˆ›å»ºä»£ç†å¯¹è±¡ï¼Œ ==ç­‰éœ€è¦çš„æ—¶å€™å»æŸ¥è¯¢äºŒçº§ç¼“å­˜å’Œæ•°æ®åº“==ã€‚ 16ã€mergeçš„å«ä¹‰ï¼š mergeçš„å«ä¹‰ï¼š(è¿”å›æœ€æ–°çš„å®ä¾‹æ•°æ®) å¦‚æœsessionä¸­å­˜åœ¨ç›¸åŒæŒä¹…åŒ–æ ‡è¯†(identifier)çš„å®ä¾‹ï¼Œç”¨ç”¨æˆ·ç»™å‡ºçš„å¯¹è±¡çš„çŠ¶æ€è¦†ç›–æ—§æœ‰çš„æŒä¹…å®ä¾‹ å¦‚æœsessionæ²¡æœ‰ç›¸åº”çš„æŒä¹…å®ä¾‹ï¼Œåˆ™å°è¯•ä»æ•°æ®åº“ä¸­åŠ è½½ï¼Œæˆ–åˆ›å»ºæ–°çš„æŒä¹…åŒ–å®ä¾‹,æœ€åè¿”å›è¯¥æŒä¹…å®ä¾‹ ç”¨æˆ·ç»™å‡ºçš„è¿™ä¸ªå¯¹è±¡æ²¡æœ‰è¢«å…³è”åˆ°sessionä¸Šï¼Œå®ƒä¾æ—§æ˜¯è„±ç®¡çš„ è¯¦æƒ…å¯å‚è€ƒï¼š http://cp3.iteye.com/blog/786019 17ã€persistå’Œsaveçš„åŒºåˆ« persistä¸ä¿è¯ç«‹å³æ‰§è¡Œï¼Œå¯èƒ½è¦ç­‰åˆ°flushï¼› persistä¸æ›´æ–°ç¼“å­˜ï¼› save, æŠŠä¸€ä¸ªç¬æ€çš„å®ä¾‹æŒä¹…åŒ–æ ‡è¯†ç¬¦ï¼ŒåŠæ—¶çš„äº§ç”Ÿ,å®ƒè¦è¿”å›æ ‡è¯†ç¬¦ï¼Œæ‰€ä»¥å®ƒä¼šç«‹å³æ‰§è¡ŒSql insert ä½¿ç”¨ save() æ–¹æ³•ä¿å­˜æŒä¹…åŒ–å¯¹è±¡æ—¶ï¼Œè¯¥æ–¹æ³•è¿”å›è¯¥æŒä¹…åŒ–å¯¹è±¡çš„æ ‡è¯†å±æ€§å€¼(å³å¯¹åº”è®°å½•çš„ä¸»é”®å€¼)ï¼› ä½¿ç”¨ persist() æ–¹æ³•æ¥ä¿å­˜æŒä¹…åŒ–å¯¹è±¡æ—¶ï¼Œè¯¥æ–¹æ³•æ²¡æœ‰ä»»ä½•è¿”å›å€¼ã€‚ å‚è€ƒèµ„æ–™ï¼š http://blog.csdn.net/u010739551/article/details/47253881 18ã€ä¸»é”®ç”Ÿæˆ ç­–ç•¥æœ‰å“ªäº›ä¸»é”®çš„è‡ªåŠ¨ç”Ÿæˆç­–ç•¥ identity è‡ªå¢é•¿(mysql,db2) sequence è‡ªå¢é•¿(åºåˆ—)ï¼Œ oracleä¸­è‡ªå¢é•¿æ˜¯ä»¥åºåˆ—æ–¹æ³•å®ç°** native è‡ªå¢é•¿ã€==ä¼šæ ¹æ®åº•å±‚æ•°æ®åº“è‡ªå¢é•¿çš„æ–¹å¼==é€‰æ‹©identityæˆ–sequenceã€‘ å¦‚æœæ˜¯mysqlæ•°æ®åº“, é‡‡ç”¨çš„è‡ªå¢é•¿æ–¹å¼æ˜¯identity å¦‚æœæ˜¯oracleæ•°æ®åº“ï¼Œ ä½¿ç”¨sequenceåºåˆ—çš„æ–¹å¼å®ç°è‡ªå¢é•¿ increment è‡ªå¢é•¿(ä¼šæœ‰å¹¶å‘è®¿é—®çš„é—®é¢˜ï¼Œä¸€èˆ¬åœ¨æœåŠ¡å™¨é›†ç¾¤ç¯å¢ƒä½¿ç”¨ä¼šå­˜åœ¨é—®é¢˜ã€‚) æŒ‡å®šä¸»é”®ç”Ÿæˆç­–ç•¥ä¸ºæ‰‹åŠ¨æŒ‡å®šä¸»é”®çš„å€¼ assigned æŒ‡å®šä¸»é”®ç”Ÿæˆç­–ç•¥ä¸ºUUIDç”Ÿæˆçš„å€¼ uuid foreign(å¤–é”®çš„æ–¹å¼) 19ã€ç®€è¿°hibernateä¸­getCurrentSessionå’ŒopenSessionåŒºåˆ« getCurrentSessionä¼šç»‘å®šå½“å‰çº¿ç¨‹ï¼Œè€ŒopenSessionä¸ä¼šï¼Œå› ä¸ºæˆ‘ä»¬æŠŠhibernateäº¤ç»™æˆ‘ä»¬çš„springæ¥ç®¡ç†ä¹‹åï¼Œæˆ‘ä»¬æ˜¯æœ‰äº‹åŠ¡é…ç½®ï¼Œè¿™ä¸ªæœ‰äº‹åŠ¡çš„çº¿ç¨‹å°±ä¼šç»‘å®šå½“å‰çš„å·¥å‚é‡Œé¢çš„æ¯ä¸€ä¸ªsessionï¼Œè€ŒopenSessionæ˜¯åˆ›å»ºä¸€ä¸ªæ–°sessionã€‚ getCurrentSessionäº‹åŠ¡æ˜¯æœ‰springæ¥æ§åˆ¶çš„ï¼Œè€ŒopenSessionéœ€è¦æˆ‘ä»¬æ‰‹åŠ¨å¼€å¯å’Œæ‰‹åŠ¨æäº¤äº‹åŠ¡ï¼Œ getCurrentSessionæ˜¯ä¸éœ€è¦æˆ‘ä»¬æ‰‹åŠ¨å…³é—­çš„ï¼Œå› ä¸ºå·¥å‚ä¼šè‡ªå·±ç®¡ç†ï¼Œè€ŒopenSessionéœ€è¦æˆ‘ä»¬æ‰‹åŠ¨å…³é—­ã€‚ è€ŒgetCurrentSessionéœ€è¦æˆ‘ä»¬æ‰‹åŠ¨è®¾ç½®ç»‘å®šäº‹åŠ¡çš„æœºåˆ¶ï¼Œæœ‰ä¸‰ç§è®¾ç½®æ–¹å¼ï¼Œ jdbcæœ¬åœ°çš„Thread JTA ç¬¬ä¸‰ç§æ˜¯springæä¾›çš„äº‹åŠ¡ç®¡ç†æœºåˆ¶ï¼Œ org.springframework.orm.hibernate4.SpringSessionContextï¼Œè€Œä¸”srpingé»˜è®¤ä½¿ç”¨è¯¥ç§äº‹åŠ¡ç®¡ç†æœºåˆ¶ 20ã€Hibernateä¸­çš„å‘½åSQLæŸ¥è¯¢æŒ‡çš„æ˜¯ä»€ä¹ˆ? å‘½åæŸ¥è¯¢æŒ‡çš„æ˜¯ç”¨&lt;sql-query&gt;æ ‡ç­¾åœ¨æ˜ å°„æ–‡æ¡£ä¸­å®šä¹‰çš„SQLæŸ¥è¯¢ï¼Œå¯ä»¥é€šè¿‡ä½¿ç”¨Session.getNamedQuery()æ–¹æ³•å¯¹å®ƒè¿›è¡Œè°ƒç”¨ã€‚å‘½åæŸ¥è¯¢ä½¿ä½ å¯ä»¥ä½¿ç”¨ä½ æ‰€æŒ‡å®šçš„ä¸€ä¸ªåå­—æ‹¿åˆ°æŸä¸ªç‰¹å®šçš„æŸ¥è¯¢ã€‚ Hibernateä¸­çš„å‘½åæŸ¥è¯¢å¯ä»¥ä½¿ç”¨æ³¨è§£æ¥å®šä¹‰ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨æˆ‘å‰é¢æåˆ°çš„xmlæ˜ å°„æ–‡ä»¶æ¥å®šä¹‰ã€‚åœ¨Hibernateä¸­ï¼Œ@NameQueryç”¨æ¥å®šä¹‰å•ä¸ªçš„å‘½åæŸ¥è¯¢ï¼Œ@NameQueriesç”¨æ¥å®šä¹‰å¤šä¸ªå‘½åæŸ¥è¯¢ã€‚ 21ã€ä¸ºä»€ä¹ˆåœ¨Hibernateçš„å®ä½“ç±»ä¸­è¦æä¾›ä¸€ä¸ªæ— å‚æ•°çš„æ„é€ å™¨è¿™ä¸€ç‚¹éå¸¸é‡è¦ï¼Ÿæ¯ä¸ª==Hibernateå®ä½“ç±»å¿…é¡»åŒ…å«ä¸€ä¸ª æ— å‚æ•°çš„æ„é€ å™¨==, è¿™æ˜¯å› ä¸ºHibernateæ¡†æ¶è¦ä½¿ç”¨Reflection APIï¼Œé€šè¿‡è°ƒç”¨Class.newInstance()æ¥åˆ›å»ºè¿™äº›å®ä½“ç±»çš„å®ä¾‹ã€‚å¦‚æœåœ¨å®ä½“ç±»ä¸­æ‰¾ä¸åˆ°æ— å‚æ•°çš„æ„é€ å™¨ï¼Œè¿™ä¸ªæ–¹æ³•å°±ä¼šæŠ›å‡ºä¸€ä¸ªInstantiationExceptionå¼‚å¸¸ã€‚ 22ã€å¯ä¸å¯ä»¥å°†Hibernateçš„å®ä½“ç±»å®šä¹‰ä¸ºfinalç±»?ä½ å¯ä»¥å°†Hibernateçš„å®ä½“ç±»å®šä¹‰ä¸ºfinalç±»ï¼Œä½†è¿™ç§åšæ³•å¹¶ä¸å¥½ã€‚å› ä¸ºHibernateä¼šä½¿ç”¨ä»£ç†æ¨¡å¼åœ¨å»¶è¿Ÿå…³è”çš„æƒ…å†µä¸‹æé«˜æ€§èƒ½ï¼Œå¦‚æœä½ æŠŠå®ä½“ç±»å®šä¹‰æˆfinalç±»ä¹‹åï¼Œå› ä¸º Javaä¸å…è®¸å¯¹finalç±»è¿›è¡Œæ‰©å±•ï¼Œæ‰€ä»¥Hibernateå°±æ— æ³•å†ä½¿ç”¨ä»£ç†äº†ï¼Œ å¦‚æ­¤ä¸€æ¥å°±é™åˆ¶äº†ä½¿ç”¨å¯ä»¥æå‡æ€§èƒ½çš„æ‰‹æ®µã€‚==ä¸èƒ½ä»£ç†å°±ä¸èƒ½ä½¿ç”¨å»¶è¿ŸåŠ è½½äº†== æœ€åå‚è€ƒèµ„æ–™ï¼š http://blog.csdn.net/qq1137623160/article/details/71194677 http://blog.csdn.net/u013842976/article/details/52518218 http://blog.csdn.net/yubotianxiao/article/details/52238200","categories":[],"tags":[{"name":"IT","slug":"IT","permalink":"/tags/IT/"},{"name":"æŠ€æœ¯ç¬”è®°","slug":"æŠ€æœ¯ç¬”è®°","permalink":"/tags/%E6%8A%80%E6%9C%AF%E7%AC%94%E8%AE%B0/"},{"name":"æ•°æ®åº“","slug":"æ•°æ®åº“","permalink":"/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/"},{"name":"Hibernate","slug":"Hibernate","permalink":"/tags/Hibernate/"},{"name":"Job","slug":"Job","permalink":"/tags/Job/"}]},{"title":"ç¼“å­˜","slug":"ç¼“å­˜","date":"2019-10-20T11:51:12.000Z","updated":"2019-10-20T13:40:18.008Z","comments":true,"path":"2019/10/20/ç¼“å­˜/","link":"","permalink":"/2019/10/20/%E7%BC%93%E5%AD%98/","excerpt":"","text":"ç¼“å­˜ ç¼“å­˜æ˜¯ç°åœ¨ç³»ç»Ÿä¸­å¿…ä¸å¯å°‘çš„æ¨¡å—ï¼Œå¹¶ä¸”å·²ç»æˆä¸ºäº†é«˜å¹¶å‘é«˜æ€§èƒ½æ¶æ„çš„ä¸€ä¸ªå…³é”®ç»„ä»¶ ç¼“å­˜æ˜¯é€šè¿‡ç‰ºç‰²å¼ºä¸€è‡´æ€§æ¥æé«˜æ€§èƒ½çš„ã€‚æ‰€ä»¥ä½¿ç”¨ç¼“å­˜æå‡æ€§èƒ½ï¼Œå°±æ˜¯ä¼šæœ‰æ•°æ®æ›´æ–°çš„å»¶è¿Ÿã€‚è¿™éœ€è¦æˆ‘ä»¬åœ¨è®¾è®¡æ—¶ç»“åˆä¸šåŠ¡ä»”ç»†æ€è€ƒæ˜¯å¦é€‚åˆç”¨ç¼“å­˜ã€‚ç„¶åç¼“å­˜ä¸€å®šè¦è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œè¿™ä¸ªæ—¶é—´å¤ªçŸ­å¤ªé•¿éƒ½ä¸å¥½ï¼Œå¤ªçŸ­çš„è¯è¯·æ±‚å¯èƒ½ä¼šæ¯”è¾ƒå¤šçš„è½åˆ°æ•°æ®åº“ä¸Šï¼Œè¿™ä¹Ÿæ„å‘³ç€å¤±å»äº†ç¼“å­˜çš„ä¼˜åŠ¿ã€‚å¤ªé•¿çš„è¯ç¼“å­˜ä¸­çš„è„æ•°æ®ä¼šä½¿ç³»ç»Ÿé•¿æ—¶é—´å¤„äºä¸€ä¸ªå»¶è¿Ÿçš„çŠ¶æ€ï¼Œè€Œä¸”ç³»ç»Ÿä¸­é•¿æ—¶é—´æ²¡æœ‰äººè®¿é—®çš„æ•°æ®ä¸€ç›´å­˜åœ¨å†…å­˜ä¸­ä¸è¿‡æœŸï¼Œæµªè´¹å†…å­˜ã€‚ ç¼“å­˜èƒ½è§£å†³çš„é—®é¢˜ æå‡æ€§èƒ½ ç»å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œselect æ˜¯å‡ºç°æ€§èƒ½é—®é¢˜æœ€å¤§çš„åœ°æ–¹ã€‚ ä¸€æ–¹é¢ï¼Œselect ä¼šæœ‰å¾ˆå¤šåƒ joinã€groupã€orderã€like ç­‰è¿™æ ·ä¸°å¯Œçš„è¯­ä¹‰ï¼Œè€Œè¿™äº›è¯­ä¹‰æ˜¯éå¸¸è€—æ€§èƒ½çš„ï¼› å¦ä¸€æ–¹é¢ï¼Œå¤§å¤š æ•°åº”ç”¨éƒ½æ˜¯è¯»å¤šå†™å°‘ï¼Œæ‰€ä»¥åŠ å‰§äº†æ…¢æŸ¥è¯¢çš„é—®é¢˜ã€‚ åˆ†å¸ƒå¼ç³»ç»Ÿä¸­è¿œç¨‹è°ƒç”¨ä¹Ÿä¼šè€—å¾ˆå¤šæ€§èƒ½ï¼Œå› ä¸ºæœ‰ç½‘ç»œå¼€é”€ï¼Œä¼šå¯¼è‡´æ•´ä½“çš„å“åº”æ—¶é—´ä¸‹é™ã€‚ä¸ºäº†æŒ½æ•‘è¿™æ ·çš„æ€§èƒ½å¼€é”€ï¼Œåœ¨ä¸šåŠ¡å…è®¸çš„æƒ…å†µï¼ˆä¸éœ€è¦å¤ªå®æ—¶çš„æ•°æ®ï¼‰ä¸‹ï¼Œä½¿ç”¨ç¼“å­˜æ˜¯éå¸¸å¿…è¦çš„äº‹æƒ…ã€‚ ç¼“è§£æ•°æ®åº“å‹åŠ›å½“ç”¨æˆ·è¯·æ±‚å¢å¤šæ—¶ï¼Œæ•°æ®åº“çš„å‹åŠ›å°†å¤§å¤§å¢åŠ ï¼Œé€šè¿‡ç¼“å­˜èƒ½å¤Ÿå¤§å¤§é™ä½æ•°æ®åº“çš„å‹åŠ›ã€‚ ç¼“å­˜çš„é€‚ç”¨åœºæ™¯ å¯¹äºæ•°æ®å®æ—¶æ€§è¦æ±‚ä¸é«˜ å¯¹äºä¸€äº›ç»å¸¸è®¿é—®ä½†æ˜¯å¾ˆå°‘æ”¹å˜çš„æ•°æ®ï¼Œè¯»æ˜æ˜¾å¤šäºå†™ï¼Œé€‚ç”¨ç¼“å­˜å°±å¾ˆæœ‰å¿…è¦ã€‚æ¯”å¦‚ä¸€äº›ç½‘ç«™é…ç½®é¡¹ã€‚ å¯¹äºæ€§èƒ½è¦æ±‚é«˜ æ¯”å¦‚ä¸€äº›ç§’æ€æ´»åŠ¨åœºæ™¯ã€‚ ç¼“å­˜ä¸‰ç§æ¨¡å¼ä¸€èˆ¬æ¥è¯´ï¼Œç¼“å­˜æœ‰ä»¥ä¸‹ä¸‰ç§æ¨¡å¼ï¼š è¿™ä¸‰ç§æ¨¡å¼å„æœ‰ä¼˜åŠ£ï¼Œå¯ä»¥æ ¹æ®ä¸šåŠ¡åœºæ™¯é€‰æ‹©ä½¿ç”¨ã€‚ Cache Aside æ›´æ–°æ¨¡å¼ åŒæ—¶æ›´æ–°ç¼“å­˜å’Œæ•°æ®åº“ï¼ˆCache Aside æ›´æ–°æ¨¡å¼ï¼‰ Read/Write Through æ›´æ–°æ¨¡å¼ å…ˆæ›´æ–°ç¼“å­˜ï¼Œç¼“å­˜è´Ÿè´£åŒæ­¥æ›´æ–°æ•°æ®åº“ï¼ˆRead/Write Through æ›´æ–°æ¨¡å¼ï¼‰ Write Behind Caching æ›´æ–°æ¨¡å¼ å…ˆæ›´æ–°ç¼“å­˜ï¼Œç¼“å­˜å®šæ—¶å¼‚æ­¥æ›´æ–°æ•°æ®åº“ï¼ˆWrite Behind Caching æ›´æ–°æ¨¡å¼ï¼‰ä¼˜ç‚¹æ˜¯ç›´æ¥æ“ä½œå†…å­˜é€Ÿåº¦å¿«ï¼Œå¤šæ¬¡æ“ä½œå¯ä»¥åˆå¹¶æŒä¹…åŒ–åˆ°æ•°æ®åº“ã€‚ç¼ºç‚¹æ˜¯æ•°æ®å¯èƒ½ä¼šä¸¢å¤±ï¼Œä¾‹å¦‚ç³»ç»Ÿæ–­ç”µç­‰ã€‚ Cache Aside æ›´æ–°æ¨¡å¼è¿™æ˜¯æœ€å¸¸ç”¨çš„ç¼“å­˜æ¨¡å¼äº†ï¼Œå…·ä½“çš„æµç¨‹æ˜¯ï¼š å¤±æ•ˆï¼šåº”ç”¨ç¨‹åºå…ˆä» cache å–æ•°æ®ï¼Œæ²¡æœ‰å¾—åˆ°ï¼Œåˆ™==ä»æ•°æ®åº“ä¸­å–æ•°æ®ï¼ŒæˆåŠŸåï¼Œæ”¾åˆ°ç¼“å­˜ä¸­==ã€‚ å‘½ä¸­ï¼šåº”ç”¨ç¨‹åºä» cache ä¸­å–æ•°æ®ï¼Œå–åˆ°åè¿”å›ã€‚ æ›´æ–°ï¼šå…ˆæŠŠæ•°æ®å­˜åˆ°æ•°æ®åº“ä¸­ï¼ŒæˆåŠŸåï¼Œå†è®©ç¼“å­˜å¤±æ•ˆã€‚ ==ä¸ºäº†é˜²æ­¢é«˜è¿¸å‘, å¯¼è‡´æ•°æ®ä¸ä¸€è‡´, æ‰€ä»¥ç›´æ¥å†™å…¥åˆ°åº“ä¸­== æ³¨æ„æˆ‘ä»¬ä¸Šé¢æ‰€æåˆ°çš„ï¼Œç¼“å­˜æ›´æ–°æ—¶å…ˆæ›´æ–°æ•°æ®åº“ï¼Œç„¶ååœ¨è®©ç¼“å­˜å¤±æ•ˆã€‚é‚£ä¹ˆä¸ºä»€ä¹ˆä¸æ˜¯ç›´æ¥æ›´æ–°ç¼“å­˜å‘¢ï¼Ÿè¿™é‡Œæœ‰ä¸€äº›ç¼“å­˜æ›´æ–°çš„å‘ï¼Œæˆ‘ä»¬éœ€è¦é¿å…å…¥å‘ã€‚ é¿å‘æŒ‡å—ä¸€å…ˆæ›´æ–°æ•°æ®åº“ï¼Œå†æ›´æ–°ç¼“å­˜ã€‚è¿™ç§åšæ³•æœ€å¤§çš„é—®é¢˜å°±æ˜¯ä¸¤ä¸ªå¹¶å‘çš„å†™æ“ä½œå¯¼è‡´è„æ•°æ®ã€‚å¦‚ä¸‹å›¾ï¼ˆä»¥Rediså’ŒMysqlä¸ºä¾‹ï¼‰ï¼Œä¸¤ä¸ªå¹¶å‘æ›´æ–°æ“ä½œï¼Œæ•°æ®åº“å…ˆæ›´æ–°çš„åè€Œåæ›´æ–°ç¼“å­˜ï¼Œæ•°æ®åº“åæ›´æ–°çš„åè€Œå…ˆæ›´æ–°ç¼“å­˜ã€‚è¿™æ ·å°±ä¼šé€ æˆæ•°æ®åº“å’Œç¼“å­˜ä¸­çš„æ•°æ®ä¸ä¸€è‡´ï¼Œåº”ç”¨ç¨‹åºä¸­è¯»å–çš„éƒ½æ˜¯è„æ•°æ®ã€‚ é¿å‘æŒ‡å—äºŒå…ˆåˆ é™¤ç¼“å­˜ï¼Œå†æ›´æ–°æ•°æ®åº“ã€‚è¿™ä¸ªé€»è¾‘æ˜¯é”™è¯¯çš„ï¼Œå› ä¸ºä¸¤ä¸ªå¹¶å‘çš„è¯»å’Œå†™æ“ä½œå¯¼è‡´è„æ•°æ®ã€‚å¦‚ä¸‹å›¾ï¼ˆä»¥Rediså’ŒMysqlä¸ºä¾‹ï¼‰ã€‚å‡è®¾æ›´æ–°æ“ä½œå…ˆåˆ é™¤äº†ç¼“å­˜ï¼Œæ­¤æ—¶æ­£å¥½æœ‰ä¸€ä¸ªå¹¶å‘çš„è¯»æ“ä½œï¼Œæ²¡æœ‰å‘½ä¸­ç¼“å­˜åä»æ•°æ®åº“ä¸­å–å‡ºè€æ•°æ®å¹¶ä¸”æ›´æ–°å›ç¼“å­˜ï¼Œè¿™ä¸ªæ—¶å€™æ›´æ–°æ“ä½œä¹Ÿå®Œæˆäº†æ•°æ®åº“æ›´æ–°ã€‚æ­¤æ—¶ï¼Œæ•°æ®åº“å’Œç¼“å­˜ä¸­çš„æ•°æ®ä¸ä¸€è‡´ï¼Œåº”ç”¨ç¨‹åºä¸­è¯»å–çš„éƒ½æ˜¯åŸæ¥çš„æ•°æ®ï¼ˆè„æ•°æ®ï¼‰ã€‚ é¿å‘æŒ‡å—ä¸‰å…ˆæ›´æ–°æ•°æ®åº“ï¼Œå†åˆ é™¤ç¼“å­˜ã€‚è¿™ç§åšæ³•å…¶å®ä¸èƒ½ç®—æ˜¯å‘ï¼Œåœ¨å®é™…çš„ç³»ç»Ÿä¸­ä¹Ÿæ¨èä½¿ç”¨è¿™ç§æ–¹å¼ã€‚ä½†æ˜¯è¿™ç§æ–¹å¼ç†è®ºä¸Šè¿˜æ˜¯å¯èƒ½å­˜åœ¨é—®é¢˜ã€‚å¦‚ä¸‹å›¾ï¼ˆä»¥Rediså’ŒMysqlä¸ºä¾‹ï¼‰ï¼ŒæŸ¥è¯¢æ“ä½œæ²¡æœ‰å‘½ä¸­ç¼“å­˜ï¼Œç„¶åæŸ¥è¯¢å‡ºæ•°æ®åº“çš„è€æ•°æ®ã€‚æ­¤æ—¶æœ‰ä¸€ä¸ªå¹¶å‘çš„æ›´æ–°æ“ä½œï¼Œæ›´æ–°æ“ä½œåœ¨è¯»æ“ä½œä¹‹åæ›´æ–°äº†æ•°æ®åº“ä¸­çš„æ•°æ®å¹¶ä¸”åˆ é™¤äº†ç¼“å­˜ä¸­çš„æ•°æ®ã€‚ç„¶è€Œè¯»æ“ä½œå°†ä»æ•°æ®åº“ä¸­è¯»å–å‡ºçš„è€æ•°æ®æ›´æ–°å›äº†ç¼“å­˜ã€‚è¿™æ ·å°±ä¼šé€ æˆæ•°æ®åº“å’Œç¼“å­˜ä¸­çš„æ•°æ®ä¸ä¸€è‡´ï¼Œåº”ç”¨ç¨‹åºä¸­è¯»å–çš„éƒ½æ˜¯åŸæ¥çš„æ•°æ®ï¼ˆè„æ•°æ®ï¼‰ã€‚ ä½†æ˜¯ï¼Œä»”ç»†æƒ³ä¸€æƒ³ï¼Œè¿™ç§å¹¶å‘çš„æ¦‚ç‡æä½ã€‚å› ä¸ºè¿™ä¸ªæ¡ä»¶éœ€è¦å‘ç”Ÿåœ¨è¯»ç¼“å­˜æ—¶ç¼“å­˜å¤±æ•ˆï¼Œè€Œä¸”æœ‰ä¸€ä¸ªå¹¶å‘çš„å†™æ“ä½œã€‚å®é™…ä¸Šæ•°æ®åº“çš„å†™æ“ä½œä¼šæ¯”è¯»æ“ä½œæ…¢å¾—å¤šï¼Œè€Œä¸”è¿˜è¦åŠ é”ï¼Œè€Œè¯»æ“ä½œå¿…éœ€åœ¨å†™æ“ä½œå‰è¿›å…¥æ•°æ®åº“æ“ä½œï¼Œåˆè¦æ™šäºå†™æ“ä½œæ›´æ–°ç¼“å­˜ï¼Œæ‰€æœ‰è¿™äº›æ¡ä»¶éƒ½å…·å¤‡çš„æ¦‚ç‡å¹¶ä¸å¤§ã€‚ä½†æ˜¯ä¸ºäº†é¿å…è¿™ç§æç«¯æƒ…å†µé€ æˆè„æ•°æ®æ‰€äº§ç”Ÿçš„å½±å“ï¼Œæˆ‘ä»¬è¿˜æ˜¯è¦ä¸ºç¼“å­˜è®¾ç½®è¿‡æœŸæ—¶é—´ã€‚ Read/Write Through æ›´æ–°æ¨¡å¼åœ¨ä¸Šé¢çš„ Cache Aside æ›´æ–°æ¨¡å¼ä¸­ï¼Œåº”ç”¨ä»£ç éœ€è¦ç»´æŠ¤ä¸¤ä¸ªæ•°æ®å­˜å‚¨ï¼Œä¸€ä¸ªæ˜¯ç¼“å­˜ï¼ˆCacheï¼‰ï¼Œä¸€ä¸ªæ˜¯æ•°æ®åº“ï¼ˆRepositoryï¼‰ã€‚è€Œåœ¨Read/Write Through æ›´æ–°æ¨¡å¼ä¸­ï¼Œåº”ç”¨ç¨‹åºåªéœ€è¦ç»´æŠ¤ç¼“å­˜ï¼Œæ•°æ®åº“çš„ç»´æŠ¤å·¥ä½œç”±ç¼“å­˜ä»£ç†äº†ã€‚ Read ThroughRead Through æ¨¡å¼å°±æ˜¯åœ¨æŸ¥è¯¢æ“ä½œä¸­æ›´æ–°ç¼“å­˜ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå½“ç¼“å­˜å¤±æ•ˆçš„æ—¶å€™ï¼ŒCache Aside æ¨¡å¼æ˜¯ç”±è°ƒç”¨æ–¹è´Ÿè´£æŠŠæ•°æ®åŠ è½½å…¥ç¼“å­˜ï¼Œè€Œ Read Through åˆ™ç”¨ç¼“å­˜æœåŠ¡è‡ªå·±æ¥åŠ è½½ã€‚ Write ThroughWrite Through æ¨¡å¼å’Œ Read Through ç›¸ä»¿ï¼Œä¸è¿‡æ˜¯åœ¨æ›´æ–°æ•°æ®æ—¶å‘ç”Ÿã€‚å½“æœ‰æ•°æ®æ›´æ–°çš„æ—¶å€™ï¼Œå¦‚æœæ²¡æœ‰å‘½ä¸­ç¼“å­˜ï¼Œç›´æ¥æ›´æ–°æ•°æ®åº“ï¼Œç„¶åè¿”å›ã€‚å¦‚æœå‘½ä¸­äº†ç¼“å­˜ï¼Œåˆ™æ›´æ–°ç¼“å­˜ï¼Œç„¶åç”±ç¼“å­˜è‡ªå·±æ›´æ–°æ•°æ®åº“ï¼ˆè¿™æ˜¯ä¸€ä¸ªåŒæ­¥æ“ä½œï¼‰ã€‚ Write Behind Caching æ›´æ–°æ¨¡å¼Write Behind Caching æ›´æ–°æ¨¡å¼å°±æ˜¯åœ¨æ›´æ–°æ•°æ®çš„æ—¶å€™ï¼Œåªæ›´æ–°ç¼“å­˜ï¼Œä¸æ›´æ–°æ•°æ®åº“ï¼Œè€Œæˆ‘ä»¬çš„ç¼“å­˜ä¼šå¼‚æ­¥åœ°æ‰¹é‡æ›´æ–°æ•°æ®åº“ã€‚è¿™ä¸ªè®¾è®¡çš„å¥½å¤„å°±æ˜¯ç›´æ¥æ“ä½œå†…å­˜é€Ÿåº¦å¿«ã€‚å› ä¸ºå¼‚æ­¥ï¼ŒWrite Behind Caching æ›´æ–°æ¨¡å¼è¿˜å¯ä»¥åˆå¹¶å¯¹åŒä¸€ä¸ªæ•°æ®çš„å¤šæ¬¡æ“ä½œåˆ°æ•°æ®åº“ï¼Œæ‰€ä»¥æ€§èƒ½çš„æé«˜æ˜¯ç›¸å½“å¯è§‚çš„ã€‚ ä½†==å…¶å¸¦æ¥çš„é—®é¢˜æ˜¯ï¼Œæ•°æ®ä¸æ˜¯å¼ºä¸€è‡´æ€§çš„ï¼Œè€Œä¸”å¯èƒ½ä¼šä¸¢å¤±==ã€‚å¦å¤–ï¼ŒWrite Behind Caching æ›´æ–°æ¨¡å¼å®ç°é€»è¾‘æ¯”è¾ƒå¤æ‚ï¼Œå› ä¸ºå®ƒéœ€è¦ç¡®è®¤æœ‰å“ªäº›æ•°æ®æ˜¯è¢«æ›´æ–°äº†çš„ï¼Œå“ªäº›æ•°æ®éœ€è¦åˆ·åˆ°æŒä¹…å±‚ä¸Šã€‚åªæœ‰åœ¨ç¼“å­˜éœ€è¦å¤±æ•ˆçš„æ—¶å€™ï¼Œæ‰ä¼šæŠŠå®ƒçœŸæ­£æŒä¹…èµ·æ¥ã€‚ ç¼“å­˜å¤±æ•ˆç­–ç•¥ ä¸€èˆ¬è€Œè¨€ï¼Œç¼“å­˜ç³»ç»Ÿä¸­éƒ½ä¼šå¯¹ç¼“å­˜çš„å¯¹è±¡è®¾ç½®ä¸€ä¸ªè¶…æ—¶æ—¶é—´ï¼Œé¿å…æµªè´¹ç›¸å¯¹æ¯”è¾ƒç¨€ç¼ºçš„ç¼“å­˜èµ„æºã€‚å¯¹äºç¼“å­˜æ—¶é—´çš„å¤„ç†æœ‰ä¸¤ç§ï¼Œåˆ†åˆ«æ˜¯ä¸»åŠ¨å¤±æ•ˆå’Œè¢«åŠ¨å¤±æ•ˆã€‚ ä¸»åŠ¨å¤±æ•ˆä¸»åŠ¨å¤±æ•ˆæ˜¯æŒ‡ç³»ç»Ÿæœ‰ä¸€ä¸ªä¸»åŠ¨æ£€æŸ¥ç¼“å­˜æ˜¯å¦å¤±æ•ˆçš„æœºåˆ¶ï¼Œæ¯”å¦‚é€šè¿‡å®šæ—¶ä»»åŠ¡æˆ–è€…å•ç‹¬çš„çº¿ç¨‹ä¸æ–­çš„å»æ£€æŸ¥ç¼“å­˜é˜Ÿåˆ—ä¸­çš„å¯¹è±¡æ˜¯å¦å¤±æ•ˆï¼Œå¦‚æœå¤±æ•ˆå°±æŠŠä»–ä»¬æ¸…é™¤æ‰ï¼Œé¿å…æµªè´¹ã€‚ä¸»åŠ¨å¤±æ•ˆçš„å¥½å¤„æ˜¯èƒ½å¤Ÿé¿å…å†…å­˜çš„æµªè´¹ï¼Œä½†æ˜¯ä¼šå ç”¨é¢å¤–çš„CPUæ—¶é—´ã€‚ è¢«åŠ¨å¤±æ•ˆè¢«åŠ¨å¤±æ•ˆæ˜¯é€šè¿‡è®¿é—®ç¼“å­˜å¯¹è±¡çš„æ—¶å€™æ‰å»æ£€æŸ¥ç¼“å­˜å¯¹è±¡æ˜¯å¦å¤±æ•ˆï¼Œè¿™æ ·çš„å¥½å¤„æ˜¯ç³»ç»Ÿå ç”¨çš„CPUæ—¶é—´æ›´å°‘ï¼Œä½†æ˜¯é£é™©æ˜¯é•¿æœŸä¸è¢«è®¿é—®çš„ç¼“å­˜å¯¹è±¡ä¸ä¼šè¢«ç³»ç»Ÿæ¸…é™¤ã€‚ ç¼“å­˜æ·˜æ±°ç­–ç•¥ ç¼“å­˜æ·˜æ±°ï¼Œåˆç§°ä¸ºç¼“å­˜é€å‡º(cache replacement algorithmsæˆ–è€…cache replacement policies)ï¼Œæ˜¯æŒ‡åœ¨å­˜å‚¨ç©ºé—´ä¸è¶³çš„æƒ…å†µä¸‹ï¼Œç¼“å­˜ç³»ç»Ÿä¸»åŠ¨é‡Šæ”¾ä¸€äº›ç¼“å­˜å¯¹è±¡è·å–æ›´å¤šçš„å­˜å‚¨ç©ºé—´ã€‚ä¸€èˆ¬LRUç”¨çš„æ¯”è¾ƒå¤šï¼Œå¯ä»¥é‡ç‚¹äº†è§£ä¸€ä¸‹ã€‚ FIFOå…ˆè¿›å…ˆå‡ºï¼ˆFirst In First Outï¼‰æ˜¯ä¸€ç§ç®€å•çš„æ·˜æ±°ç­–ç•¥ï¼Œç¼“å­˜å¯¹è±¡ä»¥é˜Ÿåˆ—çš„å½¢å¼å­˜åœ¨ï¼Œå¦‚æœç©ºé—´ä¸è¶³ï¼Œå°±é‡Šæ”¾é˜Ÿåˆ—å¤´éƒ¨çš„ï¼ˆå…ˆç¼“å­˜ï¼‰å¯¹è±¡ã€‚ä¸€èˆ¬ç”¨é“¾è¡¨å®ç°ã€‚ LRUæœ€è¿‘æœ€ä¹…æœªä½¿ç”¨ï¼ˆLeast Recently Usedï¼‰ï¼Œè¿™ç§ç­–ç•¥æ˜¯æ ¹æ®è®¿é—®çš„æ—¶é—´å…ˆåæ¥è¿›è¡Œæ·˜æ±°çš„ï¼Œå¦‚æœç©ºé—´ä¸è¶³ï¼Œä¼šé‡Šæ”¾æœ€ä¹…æ²¡æœ‰è®¿é—®çš„å¯¹è±¡ï¼ˆä¸Šæ¬¡è®¿é—®æ—¶é—´æœ€æ—©çš„å¯¹è±¡ï¼‰ã€‚æ¯”è¾ƒå¸¸è§çš„æ˜¯é€šè¿‡ä¼˜å…ˆé˜Ÿåˆ—æ¥å®ç°ã€‚ LFUæœ€è¿‘æœ€å°‘ä½¿ç”¨ï¼ˆLeast Frequently Usedï¼‰ï¼Œè¿™ç§ç­–ç•¥æ ¹æ®æœ€è¿‘è®¿é—®çš„é¢‘ç‡æ¥è¿›è¡Œæ·˜æ±°ï¼Œå¦‚æœç©ºé—´ä¸è¶³ï¼Œä¼šé‡Šæ”¾æœ€è¿‘è®¿é—®é¢‘ç‡æœ€ä½çš„å¯¹è±¡ã€‚è¿™ä¸ªç®—æ³•ä¹Ÿæ˜¯ç”¨ä¼˜å…ˆé˜Ÿåˆ—å®ç°çš„æ¯”è¾ƒå¸¸è§ã€‚7 åˆ†å¸ƒå¼ç¼“å­˜çš„å¸¸è§é—®é¢˜ç¼“å­˜ç©¿é€ DBä¸­ä¸å­˜åœ¨æ•°æ®ï¼Œ==æ¯æ¬¡éƒ½ç©¿è¿‡ç¼“å­˜æŸ¥DB==ï¼Œé€ æˆDBçš„å‹åŠ›ã€‚ä¸€èˆ¬æ˜¯ç½‘ç»œæ”»å‡» è§£å†³æ–¹æ¡ˆï¼šæ”¾å…¥ä¸€ä¸ªç‰¹æ®Šå¯¹è±¡ï¼ˆæ¯”å¦‚ç‰¹å®šçš„æ— æ•ˆå¯¹è±¡ï¼Œå½“ç„¶æ¯”è¾ƒå¥½çš„æ–¹å¼æ˜¯ä½¿ç”¨åŒ…è£…å¯¹è±¡ï¼‰ 12345678910111213141516171819# æˆ‘ä»¬å…ˆçœ‹çœ‹æœ€ç®€å•çš„é’é“œå§¿åŠ¿value = cache.get(key)if value is None: value = db.get(key) # ç”±äºvalueä¸ºç©ºï¼Œå®é™…ä¸Šç¼“å­˜å¹¶æ²¡æœ‰å†™è¿›å»ï¼Œä¸€æ—¦è¿™ä¸ªkeyæˆä¸ºçƒ­ç‚¹ï¼Œdbçš„å‹åŠ›å°†ä¼šæå¤§ cache.put(key, value, expire) return valueelse: return value# ç®€å•ä¼˜åŒ–ä¸€ä¸‹ï¼Œå‡çº§æˆä¸ºç™½é“¶å§¿åŠ¿wrapped_value = cache.get(key)if wrapped_value is None: value = db.get(key) # å³ä½¿æ˜¯ç©ºå¯¹è±¡ä¹Ÿé€šè¿‡åŒ…è£…å¯¹è±¡æ”¾åˆ°ç¼“å­˜ï¼Œå½“ç„¶è€ƒè™‘åˆ°ç©ºé—´è¿˜å¯ä»¥é‡‡ç”¨ç‰¹æ®Šå€¼ï¼ˆæ¯”å¦‚-1ä»£è¡¨ä¸å­˜åœ¨ï¼‰çš„æ–¹å¼ cache.put(key, wrapped_value(value), expire) return wrapped_value.valueelse: return wrapped_value.value ç¼“å­˜å‡»ç©¿ åœ¨ç¼“å­˜å¤±æ•ˆçš„ç¬é—´å¤§é‡è¯·æ±‚ï¼Œé€ æˆDBçš„å‹åŠ›ç¬é—´å¢å¤§ è§£å†³æ–¹æ¡ˆï¼šæ›´æ–°ç¼“å­˜æ—¶ä½¿ç”¨åˆ†å¸ƒå¼é”é”ä½æœåŠ¡ï¼Œé˜²æ­¢è¯·æ±‚ç©¿é€ç›´è¾¾DB 1234567891011121314151617181920212223242526# ç™½é“¶å§¿åŠ¿wrapped_value = cache.get(key)if wrapped_value is None: value = db.get(key) # åœ¨å†™å…¥ç¼“å­˜ä¹‹å‰ï¼Œå¤§é‡çš„è¯·æ±‚çªç„¶æ¶Œå…¥ï¼Œdbç¬é—´è¢«æ‰“å® cache.put(key, wrapped_value(value), expire) return wrapped_value.valueelse: return wrapped_value.value # åœ¨ç™½é“¶å§¿åŠ¿çš„åŸºç¡€ä¸Šæˆ‘ä»¬å†ä¼˜åŒ–æˆé»„é‡‘å§¿åŠ¿wrapped_value = cache.get(key)if wrapped_value is None: # æŸ¥dbä¹‹å‰åŠ ä¸€æŠŠé” while wrapped_value is None: if try_lock(key): value = db.get(key) cache.put(key, wrapped_value(value), expire) return wrapped_value.value else: # ç­‰å¾…10æ¯«ç§’ä¹‹åé‡è¯• sleep(0.01) wrapped_value = cache.get(key) return wrapped_value.valueelse: return wrapped_value.value ç¼“å­˜é›ªå´© å¤§é‡ç¼“å­˜è®¾ç½®äº†ç›¸åŒçš„å¤±æ•ˆæ—¶é—´ï¼ŒåŒä¸€æ—¶é—´å¤±æ•ˆï¼Œé€ æˆæœåŠ¡ç¬é—´æ€§èƒ½æ€¥å‰§ä¸‹é™ è§£å†³æ–¹æ¡ˆï¼šç¼“å­˜æ—¶é—´ä½¿ç”¨åŸºæœ¬æ—¶é—´åŠ ä¸Šéšæœºæ—¶é—´ 1234567891011121314151617# é€šè¿‡éšæœºå¤±æ•ˆæ—¶é—´ç™»ä¸Šç‹è€…å§¿åŠ¿wrapped_value = cache.get(key)if wrapped_value is None: # æŸ¥dbä¹‹å‰åŠ ä¸€æŠŠé” while wrapped_value is None: if try_lock(key): value = db.get(key) # å—¯ï¼Œå°±æ˜¯ä¸€ä¸ªéšæœºå¤±æ•ˆæ—¶é—´ï¼Œæœ€å¥½æ˜¯åœ¨æŸä¸ªåŒºé—´ cache.put(key, wrapped_value(value), random_expire()) return wrapped_value.value else: # ç­‰å¾…10æ¯«ç§’ä¹‹åé‡è¯• sleep(0.01) wrapped_value = cache.get(key) return wrapped_value.valueelse: return wrapped_value.value","categories":[{"name":"ç¼“å­˜","slug":"ç¼“å­˜","permalink":"/categories/%E7%BC%93%E5%AD%98/"}],"tags":[{"name":"æŠ€æœ¯ç¬”è®°","slug":"æŠ€æœ¯ç¬”è®°","permalink":"/tags/%E6%8A%80%E6%9C%AF%E7%AC%94%E8%AE%B0/"},{"name":"ç¼“å­˜","slug":"ç¼“å­˜","permalink":"/tags/%E7%BC%93%E5%AD%98/"}]},{"title":"Javaé«˜çº§æ ¸å¿ƒ","slug":"Javaé«˜çº§","date":"2019-10-20T11:51:12.000Z","updated":"2019-10-20T13:47:17.964Z","comments":true,"path":"2019/10/20/Javaé«˜çº§/","link":"","permalink":"/2019/10/20/Java%E9%AB%98%E7%BA%A7/","excerpt":"","text":"é˜Ÿåˆ—ç­‰å¾…é˜Ÿåˆ—ï¼ˆCondition Queueï¼‰ æˆ‘ä»¬éƒ½ç†Ÿæ‚‰wait/notifyï¼Œå®ƒä¸»è¦æ˜¯å®ç°çº¿ç¨‹é—´åä½œçš„ï¼Œå…¶å¸¸ç”¨çš„ä½¿ç”¨æ¨¡å¼å¦‚ä¸‹ï¼š 123456789101112131415public synchronized void produce(T t) throws InterruptedException &#123; while (isFull())&#123; wait(); &#125; produce(t); notifyAll();&#125;public synchronized T consume() throws InterruptedException &#123;while (isEmpty())&#123; wait();&#125;T t = consume();notifyAll();return t;&#125; å½“æ¡ä»¶æ»¡è¶³ï¼ŒåŸæ¥ç­‰å¾…çš„çº¿ç¨‹å°±ä¼šç«‹å³è¢«å”¤é†’ï¼Œè¿™å°±è¦æ¶‰åŠåˆ°ç­‰å¾…é˜Ÿåˆ—ï¼Œç­‰å¾…é˜Ÿåˆ—ä¸­çš„æ˜¯ç­‰å¾…æŸç±»æ¡ä»¶å‘ç”Ÿçš„çº¿ç¨‹ã€‚æ¯ä¸€ä¸ªå¯¹è±¡éƒ½å¯ä»¥ä½œä¸ºé”å¯¹è±¡ï¼Œä¹ŸåŒæ—¶è¢«å½“ä½œä¸€ä¸ªç­‰å¾…é˜Ÿåˆ—ï¼Œå¹¶å…·æœ‰waitï¼Œnotifyï¼Œnotifyallæ–¹æ³•ï¼Œå¦è§å›¾ï¼š åˆ¤æ–­æ¡ä»¶æ€»æ˜¯æ¶‰åŠåˆ°ä¸€äº›çŠ¶æ€ï¼Œå¦‚é›†åˆæ˜¯å¦å·²æ»¡ï¼Œæ˜¯å¦ä¸ºç©ºç­‰ç­‰ï¼Œè¿™äº›çŠ¶æ€å˜é‡å¿…é¡»è¢«é”ç›‘æ§ï¼Œå› ä¸ºçº¿ç¨‹åœ¨ç­‰å¾…æˆ–è€…å”¤é†’å¦ä¸€ä¸ªçº¿ç¨‹å‰ï¼Œéœ€è¦è®¿é—®ã€æ“ä½œè¿™äº›ä¸æ¡ä»¶ç›¸å…³çš„çŠ¶æ€å˜é‡ï¼Œè€ŒåŠ é”å¯ä»¥ä¿è¯çŠ¶æ€çš„ä¸€è‡´æ€§ã€‚å¦å¤–ï¼Œæ­£å¦‚ä¸Šä¾‹æ‰€ç¤ºï¼Œwaitæ–¹æ³•å¿…é¡»åŒ…å«åœ¨whileå¾ªç¯ä¸­ï¼ŒåŸå› æœ‰äºŒï¼š 1ã€ä»çº¿ç¨‹è¢«å”¤é†’åˆ°é‡æ–°è·å¾—é”çš„é—´éš™ï¼Œå…¶ä»–çº¿ç¨‹è·å–äº†é”å¹¶ä¸”æ”¹å˜äº†çŠ¶æ€ï¼Œä½¿å¾—æ¡ä»¶é‡æ–°å˜ä¸ºfalseã€‚ 2ã€å¦‚æœå¤šç§æ¡ä»¶ä¸ä¸€ä¸ªç­‰å¾…é˜Ÿåˆ—å…³è”ï¼Œå¿…é¡»ä½¿ç”¨notifyAll,ä¸€ä¸ªçº¿ç¨‹å¯èƒ½åœ¨æ¡ä»¶ä¸æ»¡è¶³çš„æƒ…å†µä¸‹è¢«å”¤é†’ï¼Œè¿™æ—¶å€™éœ€è¦é‡æ–°æ£€æŸ¥æ¡ä»¶ã€‚ å¯¹è±¡çš„å†…ç½®é”åªæœ‰ä¸€ä¸ªå†…ç½®ç­‰å¾…é˜Ÿåˆ—ä¸å…¶å…³è”ï¼Œè¿™æ ·å¤šä¸ªå”¤é†’æ¡ä»¶ä¸åŒçš„çº¿ç¨‹å°±å¿…é¡»åœ¨åŒä¸€ä¸ªç­‰å¾…é˜Ÿåˆ—ä¸Šï¼Œå”¤é†’çº¿ç¨‹æ—¶å¿…é¡»ä½¿ç”¨notifyAllï¼Œå¯¼è‡´å¤§éƒ¨åˆ†ä¸ç¬¦åˆæ¡ä»¶çš„çº¿ç¨‹å°†è¢«å”¤é†’å¹¶ä¸”å‚ä¸é”ç«äº‰ï¼Œä¸Šä¸‹æ–‡åˆ‡æ¢é¢‘ç¹ï¼Œæ€§èƒ½ä¸‹é™ï¼Œå½“ç„¶ï¼ŒnotifyAllæ˜¯ä¸€ç§æ¯”è¾ƒå®‰å…¨ä¿é™©çš„åšæ³•ã€‚ä¸Šæ¬¡æˆ‘ä»¬æè¿‡è¿˜æœ‰å¦ä¸€ç§å®ç°é”çš„å½¢å¼ï¼Œå³Lockï¼Œä¸å…¶å¯¹åº”çš„æ˜¯Conditionï¼Œå®ƒå¯ä»¥æ ¹æ®ä¸åŒçš„æ¡ä»¶æä¾›å¯¹åº”çš„conditionï¼Œå¯å°†ä¸Šè¿°ä½¿ç”¨æ¨¡å¼æ”¹è£…ä¸€ä¸‹ï¼š 12345678910111213141516171819202122232425262728protected final Lock lock = new ReentrantLock(); private final Condition notFull = lock.newCondition(); private final Condition notEmpty = lock.newCondition(); public void produce(T t) throws InterruptedException &#123; lock.lock(); try &#123; while (isFull()) &#123; notFull.await(); &#125; produce(t); notEmpty.signal(); &#125; finally &#123; lock.unlock(); &#125; &#125; public T consume() throws InterruptedException &#123; lock.lock(); try &#123; while (isEmpty()) &#123; notEmpty.await(); &#125; T t = consume(); notFull.signal(); return t; &#125; finally &#123; lock.unlock(); &#125; &#125; é€šè¿‡wait/notifyå®ç°çº¿ç¨‹é—´åä½œï¼Œæ˜¯éœ€è¦ä¸€å®šçš„æŠ€å·§çš„ï¼Œåˆçº§çš„å¼€å‘äººå‘˜ä¸ä¸€å®šèƒ½æ­£ç¡®ä½¿ç”¨ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸€äº›å¹¶å‘å·¥å…·ç±»ï¼ŒåƒLinkedBlockingQueueï¼ŒConcurrentHashMapï¼ŒCountDownLatchå®ç°ç›¸åº”çš„åŠŸèƒ½ BlockingQueue åœ¨æ–°å¢çš„ConcurrentåŒ…ä¸­ï¼ŒBlockingQueueå¾ˆå¥½çš„è§£å†³äº†å¤šçº¿ç¨‹ä¸­ï¼Œå¦‚ä½•é«˜æ•ˆå®‰å…¨â€œä¼ è¾“â€æ•°æ®çš„é—®é¢˜ â€‹ å¸¸ç”¨çš„é˜Ÿåˆ—ä¸»è¦æœ‰ä»¥ä¸‹ä¸¤ç§ï¼šï¼ˆå½“ç„¶é€šè¿‡ä¸åŒçš„å®ç°æ–¹å¼ï¼Œè¿˜å¯ä»¥å»¶ä¼¸å‡ºå¾ˆå¤šä¸åŒç±»å‹çš„é˜Ÿåˆ—ï¼ŒDelayQueueå°±æ˜¯å…¶ä¸­çš„ä¸€ç§ï¼‰ å…ˆè¿›å…ˆå‡ºï¼ˆFIFOï¼‰ï¼šå…ˆæ’å…¥çš„é˜Ÿåˆ—çš„å…ƒç´ ä¹Ÿæœ€å…ˆå‡ºé˜Ÿåˆ—ï¼Œç±»ä¼¼äºæ’é˜Ÿçš„åŠŸèƒ½ã€‚ä»æŸç§ç¨‹åº¦ä¸Šæ¥è¯´è¿™ç§é˜Ÿåˆ—ä¹Ÿä½“ç°äº†ä¸€ç§å…¬å¹³æ€§ã€‚ åè¿›å…ˆå‡ºï¼ˆLIFOï¼‰ï¼šåæ’å…¥é˜Ÿåˆ—çš„å…ƒç´ æœ€å…ˆå‡ºé˜Ÿåˆ—ï¼Œè¿™ç§é˜Ÿåˆ—ä¼˜å…ˆå¤„ç†æœ€è¿‘å‘ç”Ÿçš„äº‹ä»¶ã€‚ â€‹ å½“é˜Ÿåˆ—ä¸­æ²¡æœ‰æ•°æ®çš„æƒ…å†µä¸‹ï¼Œæ¶ˆè´¹è€…ç«¯çš„æ‰€æœ‰çº¿ç¨‹éƒ½ä¼šè¢«è‡ªåŠ¨é˜»å¡ï¼ˆæŒ‚èµ·ï¼‰ï¼Œç›´åˆ°æœ‰æ•°æ®æ”¾å…¥é˜Ÿåˆ—ã€‚ å½“é˜Ÿåˆ—ä¸­å¡«æ»¡æ•°æ®çš„æƒ…å†µä¸‹ï¼Œç”Ÿäº§è€…ç«¯çš„æ‰€æœ‰çº¿ç¨‹éƒ½ä¼šè¢«è‡ªåŠ¨é˜»å¡ï¼ˆæŒ‚èµ·ï¼‰ï¼Œç›´åˆ°é˜Ÿåˆ—ä¸­æœ‰ç©ºçš„ä½ç½®ï¼Œçº¿ç¨‹è¢«è‡ªåŠ¨å”¤é†’ã€‚BlockingQueueçš„æ ¸å¿ƒæ–¹æ³•: offer(anObject):è¡¨ç¤ºå¦‚æœå¯èƒ½çš„è¯,å°†anObjectåŠ åˆ°BlockingQueueé‡Œ,å³å¦‚æœBlockingQueueå¯ä»¥å®¹çº³,åˆ™è¿”å›true,å¦åˆ™è¿”å›false.ï¼ˆæœ¬æ–¹æ³•ä¸é˜»å¡å½“å‰æ‰§è¡Œæ–¹æ³•çš„çº¿ç¨‹ï¼‰ put(anObject):æŠŠanObjectåŠ åˆ°BlockingQueueé‡Œ,å¦‚æœBlockQueueæ²¡æœ‰ç©ºé—´,åˆ™è°ƒç”¨æ­¤æ–¹æ³•çš„çº¿ç¨‹è¢«é˜»æ–­,ç›´åˆ°BlockingQueueé‡Œé¢æœ‰ç©ºé—´å†ç»§ç»­. è·å–æ•°æ® poll(long timeout, TimeUnit unit)ï¼šä»BlockingQueueå–å‡ºä¸€ä¸ªé˜Ÿé¦–çš„å¯¹è±¡ï¼Œå¦‚æœåœ¨æŒ‡å®šæ—¶é—´å†…ï¼Œé˜Ÿåˆ—ä¸€æ—¦æœ‰æ•°æ®å¯å–ï¼Œåˆ™ç«‹å³è¿”å›é˜Ÿåˆ—ä¸­çš„æ•°æ®ã€‚å¦åˆ™çŸ¥é“æ—¶é—´è¶…æ—¶è¿˜æ²¡æœ‰æ•°æ®å¯å–ï¼Œè¿”å›å¤±è´¥ã€‚ take():å–èµ°BlockingQueueé‡Œæ’åœ¨é¦–ä½çš„å¯¹è±¡,è‹¥BlockingQueueä¸ºç©º,é˜»æ–­è¿›å…¥ç­‰å¾…çŠ¶æ€ç›´åˆ°BlockingQueueæœ‰æ–°çš„æ•°æ®è¢«åŠ å…¥; å¸¸è§BlockingQueue 1. ArrayBlockingQueue åŸºäºæ•°ç»„çš„é˜»å¡é˜Ÿåˆ—å®ç°ï¼Œåœ¨ArrayBlockingQueueå†…éƒ¨ï¼Œç»´æŠ¤äº†ä¸€ä¸ªå®šé•¿æ•°ç»„ï¼Œä»¥ä¾¿ç¼“å­˜é˜Ÿåˆ—ä¸­çš„æ•°æ®å¯¹è±¡ï¼Œè¿™æ˜¯ä¸€ä¸ªå¸¸ç”¨çš„é˜»å¡é˜Ÿåˆ—ï¼Œé™¤äº†ä¸€ä¸ªå®šé•¿æ•°ç»„å¤–ï¼ŒArrayBlockingQueueå†…éƒ¨è¿˜ä¿å­˜ç€ä¸¤ä¸ªæ•´å½¢å˜é‡ï¼Œåˆ†åˆ«æ ‡è¯†ç€é˜Ÿåˆ—çš„å¤´éƒ¨å’Œå°¾éƒ¨åœ¨æ•°ç»„ä¸­çš„ä½ç½®ã€‚ ArrayBlockingQueueåœ¨ç”Ÿäº§è€…æ”¾å…¥æ•°æ®å’Œæ¶ˆè´¹è€…è·å–æ•°æ®ï¼Œéƒ½æ˜¯å…±ç”¨åŒä¸€ä¸ªé”å¯¹è±¡ï¼Œç”±æ­¤ä¹Ÿæ„å‘³ç€ä¸¤è€…æ— æ³•çœŸæ­£å¹¶è¡Œè¿è¡Œï¼Œè¿™ç‚¹å°¤å…¶ä¸åŒäºLinkedBlockingQueueï¼›æŒ‰ç…§å®ç°åŸç†æ¥åˆ†æï¼ŒArrayBlockingQueueå®Œå…¨å¯ä»¥é‡‡ç”¨åˆ†ç¦»é”ï¼Œä»è€Œå®ç°ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…æ“ä½œçš„å®Œå…¨å¹¶è¡Œè¿è¡Œã€‚Doug Leaä¹‹æ‰€ä»¥æ²¡è¿™æ ·å»åšï¼Œä¹Ÿè®¸æ˜¯å› ä¸ºArrayBlockingQueueçš„æ•°æ®å†™å…¥å’Œè·å–æ“ä½œå·²ç»è¶³å¤Ÿè½»å·§ï¼Œä»¥è‡³äºå¼•å…¥ç‹¬ç«‹çš„é”æœºåˆ¶ï¼Œé™¤äº†ç»™ä»£ç å¸¦æ¥é¢å¤–çš„å¤æ‚æ€§å¤–ï¼Œå…¶åœ¨æ€§èƒ½ä¸Šå®Œå…¨å ä¸åˆ°ä»»ä½•ä¾¿å®œã€‚ ArrayBlockingQueueå’ŒLinkedBlockingQueueé—´è¿˜æœ‰ä¸€ä¸ªæ˜æ˜¾çš„ä¸åŒä¹‹å¤„åœ¨äºï¼Œå‰è€…åœ¨æ’å…¥æˆ–åˆ é™¤å…ƒç´ æ—¶ä¸ä¼šäº§ç”Ÿæˆ–é”€æ¯ä»»ä½•é¢å¤–çš„å¯¹è±¡å®ä¾‹ï¼Œè€Œåè€…åˆ™ä¼šç”Ÿæˆä¸€ä¸ªé¢å¤–çš„Nodeå¯¹è±¡ã€‚è¿™åœ¨é•¿æ—¶é—´å†…éœ€è¦é«˜æ•ˆå¹¶å‘åœ°å¤„ç†å¤§æ‰¹é‡æ•°æ®çš„ç³»ç»Ÿä¸­ï¼Œå…¶å¯¹äºGCçš„å½±å“è¿˜æ˜¯å­˜åœ¨ä¸€å®šçš„åŒºåˆ«ã€‚è€Œåœ¨åˆ›å»ºArrayBlockingQueueæ—¶ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥æ§åˆ¶å¯¹è±¡çš„å†…éƒ¨é”æ˜¯å¦é‡‡ç”¨å…¬å¹³é”ï¼Œé»˜è®¤é‡‡ç”¨éå…¬å¹³é”ã€‚ 2. LinkedBlockingQueue åŸºäºé“¾è¡¨çš„é˜»å¡é˜Ÿåˆ—ï¼ŒåŒArrayListBlockingQueueç±»ä¼¼ï¼Œå…¶å†…éƒ¨ä¹Ÿç»´æŒç€ä¸€ä¸ªæ•°æ®ç¼“å†²é˜Ÿåˆ—ï¼ˆè¯¥é˜Ÿåˆ—ç”±ä¸€ä¸ªé“¾è¡¨æ„æˆï¼‰ï¼Œå½“ç”Ÿäº§è€…å¾€é˜Ÿåˆ—ä¸­æ”¾å…¥ä¸€ä¸ªæ•°æ®æ—¶ï¼Œé˜Ÿåˆ—ä¼šä»ç”Ÿäº§è€…æ‰‹ä¸­è·å–æ•°æ®ï¼Œå¹¶ç¼“å­˜åœ¨é˜Ÿåˆ—å†…éƒ¨ï¼Œè€Œç”Ÿäº§è€…ç«‹å³è¿”å›ï¼›åªæœ‰å½“é˜Ÿåˆ—ç¼“å†²åŒºè¾¾åˆ°æœ€å¤§å€¼ç¼“å­˜å®¹é‡æ—¶ï¼ˆLinkedBlockingQueueå¯ä»¥é€šè¿‡æ„é€ å‡½æ•°æŒ‡å®šè¯¥å€¼ï¼‰ï¼Œæ‰ä¼šé˜»å¡ç”Ÿäº§è€…é˜Ÿåˆ—ï¼Œç›´åˆ°æ¶ˆè´¹è€…ä»é˜Ÿåˆ—ä¸­æ¶ˆè´¹æ‰ä¸€ä»½æ•°æ®ï¼Œç”Ÿäº§è€…çº¿ç¨‹ä¼šè¢«å”¤é†’ï¼Œåä¹‹å¯¹äºæ¶ˆè´¹è€…è¿™ç«¯çš„å¤„ç†ä¹ŸåŸºäºåŒæ ·çš„åŸç†ã€‚è€ŒLinkedBlockingQueueä¹‹æ‰€ä»¥èƒ½å¤Ÿé«˜æ•ˆçš„å¤„ç†å¹¶å‘æ•°æ®ï¼Œè¿˜å› ä¸ºå…¶å¯¹äºç”Ÿäº§è€…ç«¯å’Œæ¶ˆè´¹è€…ç«¯åˆ†åˆ«é‡‡ç”¨äº†ç‹¬ç«‹çš„é”æ¥æ§åˆ¶æ•°æ®åŒæ­¥ï¼Œè¿™ä¹Ÿæ„å‘³ç€åœ¨é«˜å¹¶å‘çš„æƒ…å†µä¸‹ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…å¯ä»¥å¹¶è¡Œåœ°æ“ä½œé˜Ÿåˆ—ä¸­çš„æ•°æ®ï¼Œä»¥æ­¤æ¥æé«˜æ•´ä¸ªé˜Ÿåˆ—çš„å¹¶å‘æ€§èƒ½ã€‚ ä½œä¸ºå¼€å‘è€…ï¼Œæˆ‘ä»¬éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœæ„é€ ä¸€ä¸ªLinkedBlockingQueueå¯¹è±¡ï¼Œè€Œæ²¡æœ‰æŒ‡å®šå…¶å®¹é‡å¤§å°ï¼ŒLinkedBlockingQueueä¼šé»˜è®¤ä¸€ä¸ªç±»ä¼¼æ— é™å¤§å°çš„å®¹é‡ï¼ˆInteger.MAX_VALUEï¼‰ï¼Œè¿™æ ·çš„è¯ï¼Œå¦‚æœç”Ÿäº§è€…çš„é€Ÿåº¦ä¸€æ—¦å¤§äºæ¶ˆè´¹è€…çš„é€Ÿåº¦ï¼Œä¹Ÿè®¸è¿˜æ²¡æœ‰ç­‰åˆ°é˜Ÿåˆ—æ»¡é˜»å¡äº§ç”Ÿï¼Œç³»ç»Ÿå†…å­˜å°±æœ‰å¯èƒ½å·²è¢«æ¶ˆè€—æ®†å°½äº†ã€‚ ArrayBlockingQueueå’ŒLinkedBlockingQueueæ˜¯ä¸¤ä¸ªæœ€æ™®é€šä¹Ÿæ˜¯æœ€å¸¸ç”¨çš„é˜»å¡é˜Ÿåˆ—ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ï¼Œåœ¨å¤„ç†å¤šçº¿ç¨‹é—´çš„ç”Ÿäº§è€…æ¶ˆè´¹è€…é—®é¢˜ï¼Œä½¿ç”¨è¿™ä¸¤ä¸ªç±»è¶³ä»¥ã€‚ 3. DelayQueue DelayQueueä¸­çš„å…ƒç´ åªæœ‰å½“å…¶æŒ‡å®šçš„å»¶è¿Ÿæ—¶é—´åˆ°äº†ï¼Œæ‰èƒ½å¤Ÿä»é˜Ÿåˆ—ä¸­è·å–åˆ°è¯¥å…ƒç´ ã€‚DelayQueueæ˜¯ä¸€ä¸ªæ²¡æœ‰å¤§å°é™åˆ¶çš„é˜Ÿåˆ—ï¼Œå› æ­¤å¾€é˜Ÿåˆ—ä¸­æ’å…¥æ•°æ®çš„æ“ä½œï¼ˆç”Ÿäº§è€…ï¼‰æ°¸è¿œä¸ä¼šè¢«é˜»å¡ï¼Œè€Œåªæœ‰è·å–æ•°æ®çš„æ“ä½œï¼ˆæ¶ˆè´¹è€…ï¼‰æ‰ä¼šè¢«é˜»å¡ã€‚ ä½¿ç”¨åœºæ™¯ï¼š DelayQueueä½¿ç”¨åœºæ™¯è¾ƒå°‘ï¼Œä½†éƒ½ç›¸å½“å·§å¦™ï¼Œå¸¸è§çš„ä¾‹å­æ¯”å¦‚ä½¿ç”¨ä¸€ä¸ªDelayQueueæ¥ç®¡ç†ä¸€ä¸ªè¶…æ—¶æœªå“åº”çš„è¿æ¥é˜Ÿåˆ—ã€‚ 4. PriorityBlockingQueue åŸºäºä¼˜å…ˆçº§çš„é˜»å¡é˜Ÿåˆ—ï¼ˆä¼˜å…ˆçº§çš„åˆ¤æ–­é€šè¿‡æ„é€ å‡½æ•°ä¼ å…¥çš„Compatorå¯¹è±¡æ¥å†³å®šï¼‰ï¼Œä½†éœ€è¦æ³¨æ„çš„æ˜¯PriorityBlockingQueueå¹¶ä¸ä¼šé˜»å¡æ•°æ®ç”Ÿäº§è€…ï¼Œè€Œåªä¼šåœ¨æ²¡æœ‰å¯æ¶ˆè´¹çš„æ•°æ®æ—¶ï¼Œé˜»å¡æ•°æ®çš„æ¶ˆè´¹è€…ã€‚å› æ­¤ä½¿ç”¨çš„æ—¶å€™è¦ç‰¹åˆ«æ³¨æ„ï¼Œç”Ÿäº§è€…ç”Ÿäº§æ•°æ®çš„é€Ÿåº¦ç»å¯¹ä¸èƒ½å¿«äºæ¶ˆè´¹è€…æ¶ˆè´¹æ•°æ®çš„é€Ÿåº¦ï¼Œå¦åˆ™æ—¶é—´ä¸€é•¿ï¼Œä¼šæœ€ç»ˆè€—å°½æ‰€æœ‰çš„å¯ç”¨å †å†…å­˜ç©ºé—´ã€‚åœ¨å®ç°PriorityBlockingQueueæ—¶ï¼Œå†…éƒ¨æ§åˆ¶çº¿ç¨‹åŒæ­¥çš„é”é‡‡ç”¨çš„æ˜¯å…¬å¹³é”ã€‚ 5. SynchronousQueue ä¸€ç§æ— ç¼“å†²çš„ç­‰å¾…é˜Ÿåˆ—ï¼Œç±»ä¼¼äºæ— ä¸­ä»‹çš„ç›´æ¥äº¤æ˜“ï¼Œæœ‰ç‚¹åƒåŸå§‹ç¤¾ä¼šä¸­çš„ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…ï¼Œç”Ÿäº§è€…æ‹¿ç€äº§å“å»é›†å¸‚é”€å”®ç»™äº§å“çš„æœ€ç»ˆæ¶ˆè´¹è€…ï¼Œè€Œæ¶ˆè´¹è€…å¿…é¡»äº²è‡ªå»é›†å¸‚æ‰¾åˆ°æ‰€è¦å•†å“çš„ç›´æ¥ç”Ÿäº§è€…ï¼Œå¦‚æœä¸€æ–¹æ²¡æœ‰æ‰¾åˆ°åˆé€‚çš„ç›®æ ‡ï¼Œé‚£ä¹ˆå¯¹ä¸èµ·ï¼Œå¤§å®¶éƒ½åœ¨é›†å¸‚ç­‰å¾…ã€‚ç›¸å¯¹äºæœ‰ç¼“å†²çš„BlockingQueueæ¥è¯´ï¼Œå°‘äº†ä¸€ä¸ªä¸­é—´ç»é”€å•†çš„ç¯èŠ‚ï¼ˆç¼“å†²åŒºï¼‰ï¼Œå¦‚æœæœ‰ç»é”€å•†ï¼Œç”Ÿäº§è€…ç›´æ¥æŠŠäº§å“æ‰¹å‘ç»™ç»é”€å•†ï¼Œè€Œæ— éœ€åœ¨æ„ç»é”€å•†æœ€ç»ˆä¼šå°†è¿™äº›äº§å“å–ç»™é‚£äº›æ¶ˆè´¹è€…ï¼Œç”±äºç»é”€å•†å¯ä»¥åº“å­˜ä¸€éƒ¨åˆ†å•†å“ï¼Œå› æ­¤ç›¸å¯¹äºç›´æ¥äº¤æ˜“æ¨¡å¼ï¼Œæ€»ä½“æ¥è¯´é‡‡ç”¨ä¸­é—´ç»é”€å•†çš„æ¨¡å¼ä¼šååé‡é«˜ä¸€äº›ï¼ˆå¯ä»¥æ‰¹é‡ä¹°å–ï¼‰ï¼›ä½†å¦ä¸€æ–¹é¢ï¼Œåˆå› ä¸ºç»é”€å•†çš„å¼•å…¥ï¼Œä½¿å¾—äº§å“ä»ç”Ÿäº§è€…åˆ°æ¶ˆè´¹è€…ä¸­é—´å¢åŠ äº†é¢å¤–çš„äº¤æ˜“ç¯èŠ‚ï¼Œå•ä¸ªäº§å“çš„åŠæ—¶å“åº”æ€§èƒ½å¯èƒ½ä¼šé™ä½ã€‚ å£°æ˜ä¸€ä¸ªSynchronousQueueæœ‰ä¸¤ç§ä¸åŒçš„æ–¹å¼ï¼Œå®ƒä»¬ä¹‹é—´æœ‰ç€ä¸å¤ªä¸€æ ·çš„è¡Œä¸ºã€‚å…¬å¹³æ¨¡å¼å’Œéå…¬å¹³æ¨¡å¼çš„åŒºåˆ«: å¦‚æœé‡‡ç”¨å…¬å¹³æ¨¡å¼ï¼šSynchronousQueueä¼šé‡‡ç”¨å…¬å¹³é”ï¼Œå¹¶é…åˆä¸€ä¸ªFIFOé˜Ÿåˆ—æ¥é˜»å¡å¤šä½™çš„ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…ï¼Œä»è€Œä½“ç³»æ•´ä½“çš„å…¬å¹³ç­–ç•¥ï¼› ä½†å¦‚æœæ˜¯éå…¬å¹³æ¨¡å¼ï¼ˆSynchronousQueueé»˜è®¤ï¼‰ï¼šSynchronousQueueé‡‡ç”¨éå…¬å¹³é”ï¼ŒåŒæ—¶é…åˆä¸€ä¸ªLIFOé˜Ÿåˆ—æ¥ç®¡ç†å¤šä½™çš„ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…ï¼Œè€Œåä¸€ç§æ¨¡å¼ï¼Œå¦‚æœç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…çš„å¤„ç†é€Ÿåº¦æœ‰å·®è·ï¼Œåˆ™å¾ˆå®¹æ˜“å‡ºç°é¥¥æ¸´çš„æƒ…å†µï¼Œå³å¯èƒ½æœ‰æŸäº›ç”Ÿäº§è€…æˆ–è€…æ˜¯æ¶ˆè´¹è€…çš„æ•°æ®æ°¸è¿œéƒ½å¾—ä¸åˆ°å¤„ç†ã€‚ è®¾è®¡æ¨¡å¼ å¸¸è§: å•ä¾‹æ¨¡å¼ã€å·¥å‚æ¨¡å¼ã€å»ºé€ æ¨¡å¼ã€è§‚å¯Ÿè€…æ¨¡å¼ã€é€‚é…å™¨æ¨¡å¼ã€ä»£ç†æ¨¡å¼ã€è£…é¥°æ¨¡å¼. è®¾è®¡æ¨¡å¼çš„å…­å¤§åŸåˆ™åŠå…¶å«ä¹‰: å•ä¸€èŒè´£åŸåˆ™ï¼šä¸€ä¸ªç±»åªè´Ÿè´£ä¸€ä¸ªåŠŸèƒ½é¢†åŸŸä¸­çš„ç›¸åº”èŒè´£ï¼Œæˆ–è€…å¯ä»¥å®šä¹‰ä¸ºï¼šå°±ä¸€ä¸ªç±»è€Œè¨€ï¼Œåº”è¯¥åªæœ‰ä¸€ä¸ªå¼•èµ·å®ƒå˜åŒ–çš„åŸå› ã€‚ä¸»è¦ä½œç”¨å®ç°ä»£ç é«˜å†…èšï¼Œä½è€¦åˆã€‚ å¼€é—­åŸåˆ™ï¼šä¸€ä¸ªè½¯ä»¶å®ä½“åº”å½“å¯¹æ‰©å±•å¼€æ”¾ï¼Œå¯¹ä¿®æ”¹å…³é—­ã€‚å³è½¯ä»¶å®ä½“åº”å°½é‡åœ¨ä¸ä¿®æ”¹åŸæœ‰ä»£ç çš„æƒ…å†µä¸‹è¿›è¡Œæ‰©å±•ã€‚ é‡Œæ°æ›¿æ¢åŸåˆ™ï¼šæ‰€æœ‰å¼•ç”¨åŸºç±»ï¼ˆçˆ¶ç±»ï¼‰çš„åœ°æ–¹å¿…é¡»èƒ½é€æ˜åœ°ä½¿ç”¨å…¶å­ç±»çš„å¯¹è±¡ã€‚é‡Œæ°æ›¿æ¢åŸåˆ™æ˜¯å®ç°å¼€é—­åŸåˆ™çš„æ–¹å¼ä¹‹ä¸€ ä¾èµ–å€’ç½®åŸåˆ™ï¼šæŠ½è±¡ä¸åº”è¯¥ä¾èµ–äºç»†èŠ‚ï¼Œç»†èŠ‚åº”å½“ä¾èµ–äºæŠ½è±¡ã€‚æ¢è¨€ä¹‹ï¼Œè¦é’ˆå¯¹æ¥å£ç¼–ç¨‹ï¼Œè€Œä¸æ˜¯é’ˆå¯¹å®ç°ç¼–ç¨‹ã€‚ æ¥å£éš”ç¦»åŸåˆ™ï¼šä½¿ç”¨å¤šä¸ªä¸“é—¨çš„æ¥å£ï¼Œè€Œä¸ä½¿ç”¨å•ä¸€çš„æ€»æ¥å£ï¼Œå³å®¢æˆ·ç«¯ä¸åº”è¯¥ä¾èµ–é‚£äº›å®ƒä¸éœ€è¦çš„æ¥å£ã€‚ è¿ªç±³ç‰¹æ³•åˆ™ï¼šä¸€ä¸ªè½¯ä»¶å®ä½“åº”å½“å°½å¯èƒ½å°‘åœ°ä¸å…¶ä»–å®ä½“å‘ç”Ÿç›¸äº’ä½œç”¨ã€‚ å¸¸è§æ¨¡å¼åŠä¼˜ç¼ºç‚¹ï¼š é¥¿æ±‰å¼ï¼š ä¼˜ç‚¹ï¼šä¸ç”¨åŠ é”å¯ä»¥ç¡®ä¿å¯¹è±¡çš„å”¯ä¸€æ€§ï¼Œçº¿ç¨‹å®‰å…¨ã€‚ ç¼ºç‚¹ï¼šåˆå§‹åŒ–å¯¹è±¡ä¼šæµªè´¹ä¸å¿…è¦çš„èµ„æºï¼Œæœªå®ç°å»¶è¿ŸåŠ è½½ã€‚ æ‡’æ±‰å¼ï¼š ä¼˜ç‚¹ï¼šå®ç°äº†å»¶æ—¶åŠ è½½ã€‚ ç¼ºç‚¹ï¼šçº¿ç¨‹ä¸å®‰å…¨ï¼Œæƒ³å®ç°çº¿ç¨‹å®‰å…¨ï¼Œå¾—åŠ é”ï¼ˆsynchronizedï¼‰ï¼Œè¿™æ ·ä¼šæµªè´¹ä¸€äº›ä¸å¿…è¦çš„èµ„æºã€‚ åŒé‡æ£€æµ‹é”å¼ï¼ˆ Double Check Lock â€“DCLï¼‰ï¼š ä¼˜ç‚¹ï¼šèµ„æºåˆ©ç”¨ç‡é«˜ï¼Œæ•ˆç‡é«˜ã€‚ ç¼ºç‚¹ï¼šç¬¬ä¸€æ¬¡åŠ è½½ç¨æ…¢ï¼Œç”±äºjavaå¤„ç†å™¨å…è®¸ä¹±åºæ‰§è¡Œï¼Œå¶å°”ä¼šå¤±è´¥ã€‚ é™æ€å†…éƒ¨å¼ï¼š ä¼˜ç‚¹ï¼šç¬¬ä¸€æ¬¡è°ƒç”¨æ–¹æ³•æ—¶æ‰åŠ è½½ç±»ï¼Œä¸ä»…ä¿è¯çº¿ç¨‹å®‰å…¨è¿˜èƒ½ä¿è¯å¯¹è±¡çš„å”¯ä¸€ï¼Œè¿˜å»¶è¿Ÿäº†å•ä¾‹çš„å®ä¾‹åŒ– ç¼ºç‚¹ï¼šæ— ç¡®å®š æšä¸¾å®ç°å•ä¾‹æ¨¡å¼ ä¼˜ç‚¹: çº¿ç¨‹å®‰å…¨, ä»»ä½•æ¨¡å¼ä¸‹éƒ½æ˜¯å•ä¾‹çš„, åŒ…æ‹¬åºåˆ—åŒ– æ¨èä½¿ç”¨é™æ€å†…éƒ¨å¼ 1234567891011121314155) public class Singleton4 &#123; /* *å½“ç¬¬ä¸€æ¬¡åŠ è½½Singletonç±»æ—¶å¹¶ä¸ä¼šåˆå§‹åŒ–SINGLRTON,åªæœ‰ç¬¬ä¸€æ¬¡è°ƒç”¨getInstanceæ–¹æ³•çš„æ—¶å€™æ‰ä¼šåˆå§‹åŒ–SINGLETON *ç¬¬ä¸€æ¬¡è°ƒç”¨getInstance æ–¹æ³•çš„æ—¶å€™è™šæ‹Ÿæœºæ‰ä¼šåŠ è½½SingletonHoderç±»,è¿™ç§æ–¹å¼ä¸ä»…èƒ½å¤Ÿä¿è¯çº¿ç¨‹å®‰å…¨,ä¹Ÿèƒ½å¤Ÿä¿è¯å¯¹è±¡çš„å”¯ä¸€, *è¿˜å»¶è¿Ÿäº†å•ä¾‹çš„å®ä¾‹åŒ–,æ‰€æœ‰æ¨èä½¿ç”¨è¿™ç§æ–¹å¼ * */ private Singleton4() &#123; &#125; public Singleton4 getInstance() &#123; return SingletonHolder.SINGLETON; &#125; private static class SingletonHolder &#123; private static final Singleton4 SINGLETON = new Singleton4(); &#125;&#125; è®¾è®¡æ¨¡å¼åœ¨å®é™…åœºæ™¯çš„åº”ç”¨å•ä¾‹ï¼šè¿æ¥æ•°æ®åº“ï¼Œè®°å½•æ—¥å¿— ==Springä¸­ç”¨åˆ°äº†å“ªäº›è®¾è®¡æ¨¡å¼== å·¥å‚æ¨¡å¼ï¼šspringä¸­çš„BeanFactoryå°±æ˜¯ç®€å•å·¥å‚æ¨¡å¼çš„ä½“ç°ï¼Œæ ¹æ®ä¼ å…¥ä¸€ä¸ªå”¯ä¸€çš„æ ‡è¯†æ¥è·å¾—beanå¯¹è±¡ï¼Œä½†æ˜¯å¦æ˜¯åœ¨ä¼ å…¥å‚æ•°ååˆ›å»ºè¿˜æ˜¯ä¼ å…¥å‚æ•°å‰åˆ›å»ºè¿™ä¸ªè¦æ ¹æ®å…·ä½“æƒ…å†µæ¥å®šã€‚ ä»£ç†æ¨¡å¼ï¼šSpringçš„AOPå°±æ˜¯ä»£ç†æ¨¡å¼çš„ä½“ç°ã€‚ è§‚å¯Ÿè€…æ¨¡å¼ï¼šå¸¸ç”¨çš„åœ°æ–¹æ˜¯Listenerçš„å®ç°ï¼Œspringä¸­ApplicationListenerå°±æ˜¯è§‚å¯Ÿè€…çš„ä½“ç°ã€‚ ç­–ç•¥æ¨¡å¼ï¼šspringåœ¨å®ä¾‹åŒ–å¯¹è±¡çš„æ—¶å€™ä½¿ç”¨åˆ°äº†ã€‚ å·¥å‚æ–¹æ³•ï¼šSpringä¸­çš„FactoryBeanå°±æ˜¯å…¸å‹çš„å·¥å‚æ–¹æ³•æ¨¡å¼ã€‚ å•ä¾‹æ¨¡å¼: å‚è€ƒï¼šhttps://www.cnblogs.com/hwaggLee/p/4510687.html ==MyBatisä¸­ç”¨åˆ°äº†å“ªäº›è®¾è®¡æ¨¡å¼== Builderæ¨¡å¼ï¼Œä¾‹å¦‚SqlSessionFactoryBuilderã€XMLConfigBuilderã€XMLMapperBuilderã€XMLStatementBuilderã€CacheBuilderï¼› å·¥å‚æ¨¡å¼ï¼Œä¾‹å¦‚SqlSessionFactoryã€ObjectFactoryã€MapperProxyFactoryï¼› å•ä¾‹æ¨¡å¼ï¼Œä¾‹å¦‚ErrorContextå’ŒLogFactoryï¼› ä»£ç†æ¨¡å¼ï¼ŒMybatiså®ç°çš„æ ¸å¿ƒï¼Œæ¯”å¦‚MapperProxyã€ConnectionLoggerï¼Œç”¨çš„jdkçš„åŠ¨æ€ä»£ç†ï¼›è¿˜æœ‰executor.loaderåŒ…ä½¿ç”¨äº†cglibæˆ–è€…javassistè¾¾åˆ°å»¶è¿ŸåŠ è½½çš„æ•ˆæœï¼› ç»„åˆæ¨¡å¼ï¼Œä¾‹å¦‚SqlNodeå’Œå„ä¸ªå­ç±»ChooseSqlNodeç­‰ï¼› æ¨¡æ¿æ–¹æ³•æ¨¡å¼ï¼Œä¾‹å¦‚BaseExecutorå’ŒSimpleExecutorï¼Œè¿˜æœ‰BaseTypeHandlerå’Œæ‰€æœ‰çš„å­ç±»ä¾‹å¦‚IntegerTypeHandlerï¼› é€‚é…å™¨æ¨¡å¼ï¼Œä¾‹å¦‚Logçš„Mybatisæ¥å£å’Œå®ƒå¯¹jdbcã€log4jç­‰å„ç§æ—¥å¿—æ¡†æ¶çš„é€‚é…å®ç°ï¼› è£…é¥°è€…æ¨¡å¼ï¼Œä¾‹å¦‚CacheåŒ…ä¸­çš„cache.decoratorså­åŒ…ä¸­ç­‰å„ä¸ªè£…é¥°è€…çš„å®ç°ï¼› è¿­ä»£å™¨æ¨¡å¼ï¼Œä¾‹å¦‚è¿­ä»£å™¨æ¨¡å¼PropertyTokenizerï¼› å‚è€ƒï¼šhttps://www.cnblogs.com/shuchen007/p/9193179.html ä»£ç†æ¨¡å¼(Proxy)é™æ€ä»£ç†: AspectJ åŠ¨æ€ä»£ç†: cglib(é™æ€) jdk(åŠ¨æ€) ç±»åŠ è½½å™¨ é¡¾åæ€ä¹‰ï¼Œç±»åŠ è½½å™¨ï¼ˆclass loaderï¼‰ç”¨æ¥åŠ è½½ Java ç±»åˆ° Java è™šæ‹Ÿæœºä¸­ã€‚ç±»åŠ è½½å™¨è´Ÿè´£è¯»å– Java å­—èŠ‚ä»£ç ï¼Œå¹¶è½¬æ¢æˆ java.lang.Classç±»çš„ä¸€ä¸ªå®ä¾‹ã€‚ æœ‰ä¸‰ç±»ç±»åŠ è½½å™¨: å¯åŠ¨ç±»åŠ è½½å™¨ BootStrap ClassLoader æ‰©å±•ç±»åŠ è½½å™¨ Extension ClassLoader åº”ç”¨ç±»åŠ è½½å™¨ Application ClassLoader ClassLoaderClassLoaderç±»æ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œå®ƒå®šä¹‰äº†ç±»åŠ è½½å™¨çš„åŸºæœ¬æ–¹æ³•ã€‚ æ–¹æ³• è¯´æ˜ getParent() è¿”å›è¯¥ç±»åŠ è½½å™¨çš„çˆ¶ç±»åŠ è½½å™¨ã€‚ loadClass(String name) åŠ è½½åç§°ä¸º nameçš„ç±»ï¼Œè¿”å›çš„ç»“æœæ˜¯ java.lang.Classç±»çš„å®ä¾‹ã€‚ findClass(String name) æŸ¥æ‰¾åç§°ä¸º nameçš„ç±»ï¼Œè¿”å›çš„ç»“æœæ˜¯ java.lang.Classç±»çš„å®ä¾‹ã€‚ findLoadedClass(String name) æŸ¥æ‰¾åç§°ä¸º nameçš„å·²ç»è¢«åŠ è½½è¿‡çš„ç±»ï¼Œè¿”å›çš„ç»“æœæ˜¯ java.lang.Classç±»çš„å®ä¾‹ã€‚ defineClass(String name, byte[] b, int off, int len) æŠŠå­—èŠ‚æ•°ç»„ bä¸­çš„å†…å®¹è½¬æ¢æˆ Java ç±»ï¼Œè¿”å›çš„ç»“æœæ˜¯ java.lang.Classç±»çš„å®ä¾‹ã€‚è¿™ä¸ªæ–¹æ³•è¢«å£°æ˜ä¸º finalçš„ã€‚ æ¥çœ‹çœ‹ loadClass æ–¹æ³•çš„ä»£ç ï¼šåŒäº²å§”æ‰˜æœºåˆ¶è‡ªå®šä¹‰ç±»åŠ è½½å™¨ä¸€èˆ¬åªé‡å†™findClassæ–¹æ³•å³å¯ 1234567891011121314protected Class&lt;?&gt; loadClass(String name, boolean resolve)&#123; Class c = findLoadedClass(name);//æ˜¯å¦å·²ç»åŠ è½½ if (c == null) &#123;//æ²¡æœ‰åŠ è½½ if (parent != null) &#123; //ä½¿ç”¨çˆ¶åŠ è½½å™¨åŠ è½½æ­¤ç±» c = parent.loadClass(name, false); &#125; if (c == null) &#123; // å¦‚æœçˆ¶åŠ è½½å™¨æ²¡æœ‰æˆåŠŸåŠ è½½ï¼Œåˆ™è‡ªå·±å°è¯•åŠ è½½ c = findClass(name); &#125; &#125; return c;&#125; IOJavaçš„ioï¼Œnioï¼ŒbioåŒºåˆ« Java IOï¼ˆJavaæ•°æ®æµï¼‰ä¸»è¦å°±æ˜¯Javaç”¨æ¥è¯»å–å’Œè¾“å‡ºæ•°æ®æµ è¯»å–çº¯æ–‡æœ¬æ•°æ®ä¼˜é€‰ç”¨å­—ç¬¦æµï¼Œå…¶ä»–ä½¿ç”¨å­—èŠ‚æµ Javaä¸­IOä¸»è¦æœ‰ä¸¤ç±» |â€”â€”&gt;å­—èŠ‚æµï¼ˆè¯»å†™ä»¥å­—èŠ‚ï¼ˆ8bitï¼‰ä¸ºå•ä½ï¼ŒInputStreamå’ŒOutputStreamä¸ºä¸»è¦ä»£è¡¨ |â€”â€”&gt;å­—ç¬¦æµï¼ˆè¯»å†™ä»¥å­—ç¬¦ä¸ºå•ä½ï¼ŒReaderå’ŒWriterä¸ºä¸»è¦ä»£è¡¨ï¼‰ BIO, NIO, AIOçš„åŒºåˆ« BIO: åŒæ­¥å¹¶é˜»å¡, æœåŠ¡å™¨æ¨¡å¼ä¸ºä¸€ä¸ªè¿æ¥ä¸€ä¸ªçº¿ç¨‹, å®¢æˆ·ç«¯æœ‰è¿æ¥è¯·æ±‚æ—¶,å°±å¿…é¡»å¼€å¯ä¸€ä¸ªçº¿ç¨‹è¿›è¡Œå¤„ç†, ä¼šé€ æˆå¾ˆå¤§çš„çº¿ç¨‹å¼€é”€â€“æ•°æ®çš„è¯»å–å†™å…¥å¿…é¡»é˜»å¡åœ¨ä¸€ä¸ªçº¿ç¨‹å†…ç­‰å¾…å…¶å®Œæˆã€‚åœ¨æ´»åŠ¨è¿æ¥æ•°ä¸æ˜¯ç‰¹åˆ«é«˜ï¼ˆå°äºå•æœº1000ï¼‰çš„æƒ…å†µä¸‹ NIO: åŒæ­¥éé˜»å¡,æœåŠ¡å™¨æ¨¡å¼ä¸º: ä¸€ä¸ªè¯·æ±‚ä¸€ä¸ªçº¿ç¨‹, å³å®¢æˆ·ç«¯çš„è¯·æ±‚éƒ½ä¼šæ³¨å†Œåˆ°å¤šè·¯å¤ç”¨æœº,è½®è¯¢åˆ°æœ‰ioè¯·æ±‚æ—¶æ‰å¯åŠ¨ä¸€ä¸ªçº¿ç¨‹è¿›è¡Œå¤„ç†.æŠŠä¸€äº›æ— æ•ˆçš„è¿æ¥æŒ¡åœ¨äº†å¯åŠ¨çº¿ç¨‹ä¹‹å‰ï¼Œå‡å°‘äº†è¿™éƒ¨åˆ†èµ„æºçš„æµªè´¹ â€“å¯¹äºé«˜è´Ÿè½½ã€é«˜å¹¶å‘çš„ï¼ˆç½‘ç»œï¼‰åº”ç”¨ï¼Œåº”ä½¿ç”¨ NIO çš„éé˜»å¡æ¨¡å¼æ¥å¼€å‘ AIO: ä¸€éƒ¨éé˜»å¡, ä¸€ä¸ªæœ‰æ•ˆçš„è¯·æ±‚ä¸€ä¸ªçº¿ç¨‹, å®¢æˆ·ç«¯çš„ioè¯·æ±‚éƒ½æ˜¯oså…ˆå®Œæˆäº†åœ¨é€šçŸ¥æœåŠ¡å™¨åº”ç”¨å–å¯åŠ¨çº¿ç¨‹è¿›è¡Œå¤„ç†å°†ä¸€äº›æš‚æ—¶å¯èƒ½æ— æ•ˆçš„è¯·æ±‚æŒ¡åœ¨äº†å¯åŠ¨çº¿ç¨‹ä¹‹å‰ I/O æ¨¡å‹ä¸€ä¸ªè¾“å…¥æ“ä½œé€šå¸¸åŒ…æ‹¬ä¸¤ä¸ªé˜¶æ®µï¼š ç­‰å¾…æ•°æ®å‡†å¤‡å¥½(æ•°æ®å¤åˆ¶åˆ°å†…æ ¸ç¼“å†²åŒº) ä»å†…æ ¸å‘è¿›ç¨‹å¤åˆ¶æ•°æ® å¯¹äºä¸€ä¸ªå¥—æ¥å­—ä¸Šçš„è¾“å…¥æ“ä½œï¼Œç¬¬ä¸€æ­¥é€šå¸¸æ¶‰åŠç­‰å¾…æ•°æ®ä»ç½‘ç»œä¸­åˆ°è¾¾ã€‚å½“æ‰€ç­‰å¾…æ•°æ®åˆ°è¾¾æ—¶ï¼Œå®ƒè¢«å¤åˆ¶åˆ°å†…æ ¸ä¸­çš„æŸä¸ªç¼“å†²åŒºã€‚ç¬¬äºŒæ­¥å°±æ˜¯æŠŠæ•°æ®ä»å†…æ ¸ç¼“å†²åŒºå¤åˆ¶åˆ°åº”ç”¨è¿›ç¨‹ç¼“å†²åŒºã€‚ Unix æœ‰äº”ç§ I/O æ¨¡å‹ï¼š é˜»å¡å¼ I/O (BIO) éé˜»å¡å¼ I/O (NIO) I/O å¤ç”¨ï¼ˆselect å’Œ pollï¼‰ ä¿¡å·é©±åŠ¨å¼ I/Oï¼ˆSIGIOï¼‰ å¼‚æ­¥ I/Oï¼ˆAIOï¼‰ é˜»å¡å¼ I/O åº”ç”¨è¿›ç¨‹è¢«é˜»å¡ï¼Œç›´åˆ°æ•°æ®ä»å†…æ ¸ç¼“å†²åŒºå¤åˆ¶åˆ°åº”ç”¨è¿›ç¨‹ç¼“å†²åŒºä¸­æ‰è¿”å›ã€‚ åº”è¯¥æ³¨æ„åˆ°ï¼Œåœ¨é˜»å¡çš„è¿‡ç¨‹ä¸­ï¼Œå…¶å®ƒåº”ç”¨è¿›ç¨‹è¿˜å¯ä»¥æ‰§è¡Œï¼Œå› æ­¤é˜»å¡ä¸æ„å‘³ç€æ•´ä¸ªæ“ä½œç³»ç»Ÿéƒ½è¢«é˜»å¡ã€‚å› ä¸ºå…¶å®ƒåº”ç”¨è¿›ç¨‹è¿˜å¯ä»¥æ‰§è¡Œï¼Œæ‰€ä»¥ä¸æ¶ˆè€— CPU æ—¶é—´ï¼Œè¿™ç§æ¨¡å‹çš„ CPU åˆ©ç”¨ç‡ä¼šæ¯”è¾ƒé«˜ã€‚ ä¸‹å›¾ä¸­ï¼Œrecvfrom() ç”¨äºæ¥æ”¶ Socket ä¼ æ¥çš„æ•°æ®ï¼Œå¹¶å¤åˆ¶åˆ°åº”ç”¨è¿›ç¨‹çš„ç¼“å†²åŒº buf ä¸­ã€‚è¿™é‡ŒæŠŠ recvfrom() å½“æˆç³»ç»Ÿè°ƒç”¨ã€‚ 1ssize_t recvfrom(int sockfd, void *buf, size_t len, int flags, struct sockaddr *src_addr, socklen_t *addrlen);Copy to clipboardErrorCopied éé˜»å¡å¼ I/O åº”ç”¨è¿›ç¨‹æ‰§è¡Œç³»ç»Ÿè°ƒç”¨ä¹‹åï¼Œå†…æ ¸è¿”å›ä¸€ä¸ªé”™è¯¯ç ã€‚åº”ç”¨è¿›ç¨‹å¯ä»¥ç»§ç»­æ‰§è¡Œï¼Œä½†æ˜¯éœ€è¦ä¸æ–­çš„æ‰§è¡Œç³»ç»Ÿè°ƒç”¨æ¥è·çŸ¥ I/O æ˜¯å¦å®Œæˆï¼Œè¿™ç§æ–¹å¼ç§°ä¸ºè½®è¯¢ï¼ˆpollingï¼‰ã€‚ ç”±äº CPU è¦å¤„ç†æ›´å¤šçš„ç³»ç»Ÿè°ƒç”¨ï¼Œå› æ­¤è¿™ç§æ¨¡å‹çš„ CPU åˆ©ç”¨ç‡æ¯”è¾ƒä½-å› ä¸ºè¦å»ä¸æ–­çš„è½®è¯¢æ˜¯å¦æ•°æ®å‡†å¤‡å¥½ã€‚ ==æ­¤æ—¶æ•°æ®å‡†å¤‡é˜¶æ®µä¸ä¼šé˜»å¡, è€Œæ•°æ®å¤åˆ¶é˜¶æ®µä¸€æ ·ä¼šé˜»å¡== I/O å¤ç”¨ ä½¿ç”¨ select æˆ–è€… poll ç­‰å¾…æ•°æ®ï¼Œå¹¶ä¸”å¯ä»¥ç­‰å¾…å¤šä¸ªå¥—æ¥å­—ä¸­çš„ä»»ä½•ä¸€ä¸ªå˜ä¸ºå¯è¯»ã€‚è¿™ä¸€è¿‡ç¨‹ä¼šè¢«é˜»å¡ï¼Œå½“æŸä¸€ä¸ªå¥—æ¥å­—å¯è¯»æ—¶è¿”å›ï¼Œä¹‹åå†ä½¿ç”¨ recvfrom æŠŠæ•°æ®ä»å†…æ ¸å¤åˆ¶åˆ°è¿›ç¨‹ä¸­ã€‚ å®ƒå¯ä»¥è®©å•ä¸ªè¿›ç¨‹å…·æœ‰å¤„ç†å¤šä¸ª I/O äº‹ä»¶çš„èƒ½åŠ›ã€‚åˆè¢«ç§°ä¸º Event Driven I/Oï¼Œå³äº‹ä»¶é©±åŠ¨ I/Oã€‚ I/Oå¤ç”¨å¯ä»¥é¿å…é¢‘ç¹åˆ›å»ºå’Œé”€æ¯çº¿ç¨‹, ä»¥åŠåˆ‡æ¢çº¿ç¨‹çš„å¼€é”€ å¦‚æœä¸€ä¸ª Web æœåŠ¡å™¨æ²¡æœ‰ I/O å¤ç”¨ï¼Œé‚£ä¹ˆæ¯ä¸€ä¸ª Socket è¿æ¥éƒ½éœ€è¦åˆ›å»ºä¸€ä¸ªçº¿ç¨‹å»å¤„ç†ã€‚å¦‚æœåŒæ—¶æœ‰å‡ ä¸‡ä¸ªè¿æ¥ï¼Œé‚£ä¹ˆå°±éœ€è¦åˆ›å»ºç›¸åŒæ•°é‡çš„çº¿ç¨‹ã€‚ç›¸æ¯”äºå¤šè¿›ç¨‹å’Œå¤šçº¿ç¨‹æŠ€æœ¯ï¼ŒI/O å¤ç”¨ä¸éœ€è¦è¿›ç¨‹çº¿ç¨‹åˆ›å»ºå’Œåˆ‡æ¢çš„å¼€é”€ï¼Œç³»ç»Ÿå¼€é”€æ›´å°ã€‚ ==åœ¨æ•°æ®å‡†å¤‡é˜¶æ®µselectæ˜¯é˜»å¡çš„== ä¿¡å·é©±åŠ¨ I/O åº”ç”¨è¿›ç¨‹ä½¿ç”¨ sigaction ç³»ç»Ÿè°ƒç”¨ï¼Œå†…æ ¸ç«‹å³è¿”å›ï¼Œåº”ç”¨è¿›ç¨‹å¯ä»¥ç»§ç»­æ‰§è¡Œï¼Œä¹Ÿå°±æ˜¯è¯´ç­‰å¾…æ•°æ®é˜¶æ®µåº”ç”¨è¿›ç¨‹æ˜¯éé˜»å¡çš„ã€‚å†…æ ¸åœ¨æ•°æ®åˆ°è¾¾æ—¶å‘åº”ç”¨è¿›ç¨‹å‘é€ SIGIO ä¿¡å·ï¼Œåº”ç”¨è¿›ç¨‹æ”¶åˆ°ä¹‹ååœ¨ä¿¡å·å¤„ç†ç¨‹åºä¸­è°ƒç”¨ recvfrom å°†æ•°æ®ä»å†…æ ¸å¤åˆ¶åˆ°åº”ç”¨è¿›ç¨‹ä¸­ã€‚ ç›¸æ¯”äºéé˜»å¡å¼ I/O çš„è½®è¯¢æ–¹å¼ï¼Œä¿¡å·é©±åŠ¨ I/O çš„ CPU åˆ©ç”¨ç‡æ›´é«˜-æ•°æ®å‡†å¤‡é˜¶æ®µä¸é˜»å¡ã€‚ å¼‚æ­¥ I/O (AIO) åº”ç”¨è¿›ç¨‹æ‰§è¡Œ aio_read ç³»ç»Ÿè°ƒç”¨ä¼šç«‹å³è¿”å›ï¼Œåº”ç”¨è¿›ç¨‹å¯ä»¥ç»§ç»­æ‰§è¡Œï¼Œä¸ä¼šè¢«é˜»å¡ï¼Œå†…æ ¸ä¼šåœ¨æ‰€æœ‰æ“ä½œå®Œæˆä¹‹åå‘åº”ç”¨è¿›ç¨‹å‘é€ä¿¡å·ã€‚ å¼‚æ­¥ I/O ä¸ä¿¡å·é©±åŠ¨ I/O çš„åŒºåˆ«åœ¨äºï¼Œå¼‚æ­¥ I/O çš„ä¿¡å·æ˜¯é€šçŸ¥åº”ç”¨è¿›ç¨‹ I/O å®Œæˆï¼Œè€Œä¿¡å·é©±åŠ¨ I/O çš„ä¿¡å·æ˜¯é€šçŸ¥åº”ç”¨è¿›ç¨‹å¯ä»¥å¼€å§‹ I/Oã€‚ äº”å¤§ I/O æ¨¡å‹æ¯”è¾ƒ åŒæ­¥ I/Oï¼šå°†æ•°æ®ä»å†…æ ¸ç¼“å†²åŒºå¤åˆ¶åˆ°åº”ç”¨è¿›ç¨‹ç¼“å†²åŒºçš„é˜¶æ®µï¼ˆç¬¬äºŒé˜¶æ®µï¼‰ï¼Œåº”ç”¨è¿›ç¨‹ä¼šé˜»å¡ã€‚ å¼‚æ­¥ I/Oï¼šç¬¬äºŒé˜¶æ®µåº”ç”¨è¿›ç¨‹ä¸ä¼šé˜»å¡ã€‚ åŒæ­¥ I/O åŒ…æ‹¬é˜»å¡å¼ I/Oã€éé˜»å¡å¼ I/Oã€I/O å¤ç”¨å’Œä¿¡å·é©±åŠ¨ I/O ï¼Œå®ƒä»¬çš„ä¸»è¦åŒºåˆ«åœ¨ç¬¬ä¸€ä¸ªé˜¶æ®µã€‚ éé˜»å¡å¼ I/O ã€ä¿¡å·é©±åŠ¨ I/O å’Œå¼‚æ­¥ I/O åœ¨ç¬¬ä¸€é˜¶æ®µä¸ä¼šé˜»å¡ã€‚ I/O å¤ç”¨ è¯¦ç»†è®²è§£select/poll/epoll éƒ½æ˜¯ I/O å¤šè·¯å¤ç”¨çš„å…·ä½“å®ç°ï¼Œselect å‡ºç°çš„æœ€æ—©ï¼Œä¹‹åæ˜¯ pollï¼Œå†æ˜¯ epollã€‚ select1int select(int n, fd_set *readfds, fd_set *writefds, fd_set *exceptfds, struct timeval *timeout);Copy to clipboardErrorCopied select å…è®¸åº”ç”¨ç¨‹åºç›‘è§†ä¸€ç»„æ–‡ä»¶æè¿°ç¬¦ï¼Œç­‰å¾…ä¸€ä¸ªæˆ–è€…å¤šä¸ªæè¿°ç¬¦æˆä¸ºå°±ç»ªçŠ¶æ€ï¼Œä»è€Œå®Œæˆ I/O æ“ä½œã€‚ fd_set ä½¿ç”¨æ•°ç»„å®ç°ï¼Œæ•°ç»„å¤§å°ä½¿ç”¨ FD_SETSIZE å®šä¹‰ï¼Œæ‰€ä»¥åªèƒ½ç›‘å¬å°‘äº FD_SETSIZE æ•°é‡çš„æè¿°ç¬¦ã€‚æœ‰ä¸‰ç§ç±»å‹çš„æè¿°ç¬¦ç±»å‹ï¼šreadsetã€writesetã€exceptsetï¼Œåˆ†åˆ«å¯¹åº”è¯»ã€å†™ã€å¼‚å¸¸æ¡ä»¶çš„æè¿°ç¬¦é›†åˆã€‚ timeout ä¸ºè¶…æ—¶å‚æ•°ï¼Œè°ƒç”¨ select ä¼šä¸€ç›´é˜»å¡ç›´åˆ°æœ‰æè¿°ç¬¦çš„äº‹ä»¶åˆ°è¾¾æˆ–è€…ç­‰å¾…çš„æ—¶é—´è¶…è¿‡ timeoutã€‚ æˆåŠŸè°ƒç”¨è¿”å›ç»“æœå¤§äº 0ï¼Œå‡ºé”™è¿”å›ç»“æœä¸º -1ï¼Œè¶…æ—¶è¿”å›ç»“æœä¸º 0ã€‚ poll1int poll(struct pollfd *fds, unsigned int nfds, int timeout);Copy to clipboardErrorCopied poll çš„åŠŸèƒ½ä¸ select ç±»ä¼¼ï¼Œä¹Ÿæ˜¯ç­‰å¾…ä¸€ç»„æè¿°ç¬¦ä¸­çš„ä¸€ä¸ªæˆä¸ºå°±ç»ªçŠ¶æ€ã€‚ poll ä¸­çš„æè¿°ç¬¦æ˜¯ pollfd ç±»å‹çš„æ•°ç»„ï¼Œpollfd çš„å®šä¹‰å¦‚ä¸‹ï¼š æ¯”è¾ƒ1. åŠŸèƒ½select å’Œ poll çš„åŠŸèƒ½åŸºæœ¬ç›¸åŒï¼Œä¸è¿‡åœ¨ä¸€äº›å®ç°ç»†èŠ‚ä¸Šæœ‰æ‰€ä¸åŒã€‚ select ä¼šä¿®æ”¹æè¿°ç¬¦ï¼Œè€Œ poll ä¸ä¼šï¼› select çš„æè¿°ç¬¦ç±»å‹ä½¿ç”¨æ•°ç»„å®ç°ï¼ŒFD_SETSIZE å¤§å°é»˜è®¤ä¸º 1024ï¼Œå› æ­¤é»˜è®¤åªèƒ½ç›‘å¬ 1024 ä¸ªæè¿°ç¬¦ã€‚å¦‚æœè¦ç›‘å¬æ›´å¤šæè¿°ç¬¦çš„è¯ï¼Œéœ€è¦ä¿®æ”¹ FD_SETSIZE ä¹‹åé‡æ–°ç¼–è¯‘ï¼›è€Œ poll æ²¡æœ‰æè¿°ç¬¦æ•°é‡çš„é™åˆ¶ï¼› poll æä¾›äº†æ›´å¤šçš„äº‹ä»¶ç±»å‹ï¼Œå¹¶ä¸”å¯¹æè¿°ç¬¦çš„é‡å¤åˆ©ç”¨ä¸Šæ¯” select é«˜ã€‚ å¦‚æœä¸€ä¸ªçº¿ç¨‹å¯¹æŸä¸ªæè¿°ç¬¦è°ƒç”¨äº† select æˆ–è€… pollï¼Œå¦ä¸€ä¸ªçº¿ç¨‹å…³é—­äº†è¯¥æè¿°ç¬¦ï¼Œä¼šå¯¼è‡´è°ƒç”¨ç»“æœä¸ç¡®å®šã€‚ 2. é€Ÿåº¦select å’Œ poll é€Ÿåº¦éƒ½æ¯”è¾ƒæ…¢ï¼Œæ¯æ¬¡è°ƒç”¨éƒ½éœ€è¦å°†å…¨éƒ¨æè¿°ç¬¦ä»åº”ç”¨è¿›ç¨‹ç¼“å†²åŒºå¤åˆ¶åˆ°å†…æ ¸ç¼“å†²åŒºã€‚ 3. å¯ç§»æ¤æ€§å‡ ä¹æ‰€æœ‰çš„ç³»ç»Ÿéƒ½æ”¯æŒ selectï¼Œä½†æ˜¯åªæœ‰æ¯”è¾ƒæ–°çš„ç³»ç»Ÿæ”¯æŒ pollã€‚ epoll123int epoll_create(int size);int epoll_ctl(int epfd, int op, int fd, struct epoll_event *event)ï¼›int epoll_wait(int epfd, struct epoll_event * events, int maxevents, int timeout);Copy to clipboardErrorCopied epoll_ctl() ç”¨äºå‘å†…æ ¸æ³¨å†Œæ–°çš„æè¿°ç¬¦æˆ–è€…æ˜¯æ”¹å˜æŸä¸ªæ–‡ä»¶æè¿°ç¬¦çš„çŠ¶æ€ã€‚å·²æ³¨å†Œçš„æè¿°ç¬¦åœ¨å†…æ ¸ä¸­ä¼šè¢«ç»´æŠ¤åœ¨ä¸€æ£µçº¢é»‘æ ‘ä¸Šï¼Œé€šè¿‡å›è°ƒå‡½æ•°å†…æ ¸ä¼šå°† I/O å‡†å¤‡å¥½çš„æè¿°ç¬¦åŠ å…¥åˆ°ä¸€ä¸ªé“¾è¡¨ä¸­ç®¡ç†ï¼Œè¿›ç¨‹è°ƒç”¨ epoll_wait() ä¾¿å¯ä»¥å¾—åˆ°äº‹ä»¶å®Œæˆçš„æè¿°ç¬¦ã€‚ ä»ä¸Šé¢çš„æè¿°å¯ä»¥çœ‹å‡ºï¼Œepoll åªéœ€è¦å°†æè¿°ç¬¦ä»è¿›ç¨‹ç¼“å†²åŒºå‘å†…æ ¸ç¼“å†²åŒºæ‹·è´ä¸€æ¬¡ï¼Œå¹¶ä¸”è¿›ç¨‹ä¸éœ€è¦é€šè¿‡è½®è¯¢æ¥è·å¾—äº‹ä»¶å®Œæˆçš„æè¿°ç¬¦ã€‚ epoll ä»…é€‚ç”¨äº Linux OSã€‚ epoll æ¯” select å’Œ poll æ›´åŠ çµæ´»è€Œä¸”æ²¡æœ‰æè¿°ç¬¦æ•°é‡é™åˆ¶ã€‚ epoll å¯¹å¤šçº¿ç¨‹ç¼–ç¨‹æ›´æœ‰å‹å¥½ï¼Œä¸€ä¸ªçº¿ç¨‹è°ƒç”¨äº† epoll_wait() å¦ä¸€ä¸ªçº¿ç¨‹å…³é—­äº†åŒä¸€ä¸ªæè¿°ç¬¦ä¹Ÿä¸ä¼šäº§ç”Ÿåƒ select å’Œ poll çš„ä¸ç¡®å®šæƒ…å†µã€‚ å·¥ä½œæ¨¡å¼epoll çš„æè¿°ç¬¦äº‹ä»¶æœ‰ä¸¤ç§è§¦å‘æ¨¡å¼ï¼šLTï¼ˆlevel triggerï¼‰å’Œ ETï¼ˆedge triggerï¼‰ã€‚ 1. LT æ¨¡å¼ å½“ epoll_wait() æ£€æµ‹åˆ°æè¿°ç¬¦äº‹ä»¶åˆ°è¾¾æ—¶ï¼Œå°†æ­¤äº‹ä»¶é€šçŸ¥è¿›ç¨‹ï¼Œè¿›ç¨‹å¯ä»¥ä¸ç«‹å³å¤„ç†è¯¥äº‹ä»¶ï¼Œä¸‹æ¬¡è°ƒç”¨ epoll_wait() ä¼šå†æ¬¡é€šçŸ¥è¿›ç¨‹ã€‚æ˜¯é»˜è®¤çš„ä¸€ç§æ¨¡å¼ï¼Œå¹¶ä¸”åŒæ—¶æ”¯æŒ Blocking å’Œ No-Blockingã€‚ 2. ET æ¨¡å¼ å’Œ LT æ¨¡å¼ä¸åŒçš„æ˜¯ï¼Œé€šçŸ¥ä¹‹åè¿›ç¨‹å¿…é¡»ç«‹å³å¤„ç†äº‹ä»¶ï¼Œä¸‹æ¬¡å†è°ƒç”¨ epoll_wait() æ—¶ä¸ä¼šå†å¾—åˆ°äº‹ä»¶åˆ°è¾¾çš„é€šçŸ¥ã€‚ å¾ˆå¤§ç¨‹åº¦ä¸Šå‡å°‘äº† epoll äº‹ä»¶è¢«é‡å¤è§¦å‘çš„æ¬¡æ•°ï¼Œå› æ­¤æ•ˆç‡è¦æ¯” LT æ¨¡å¼é«˜ã€‚åªæ”¯æŒ No-Blockingï¼Œä»¥é¿å…ç”±äºä¸€ä¸ªæ–‡ä»¶å¥æŸ„çš„é˜»å¡è¯»/é˜»å¡å†™æ“ä½œæŠŠå¤„ç†å¤šä¸ªæ–‡ä»¶æè¿°ç¬¦çš„ä»»åŠ¡é¥¿æ­»ã€‚ åº”ç”¨åœºæ™¯å¾ˆå®¹æ˜“äº§ç”Ÿä¸€ç§é”™è§‰è®¤ä¸ºåªè¦ç”¨ epoll å°±å¯ä»¥äº†ï¼Œselect å’Œ poll éƒ½å·²ç»è¿‡æ—¶äº†ï¼Œå…¶å®å®ƒä»¬éƒ½æœ‰å„è‡ªçš„ä½¿ç”¨åœºæ™¯ã€‚ 1. select åº”ç”¨åœºæ™¯select çš„ timeout å‚æ•°ç²¾åº¦ä¸º 1nsï¼Œè€Œ poll å’Œ epoll ä¸º 1msï¼Œå› æ­¤ select æ›´åŠ é€‚ç”¨äºå®æ—¶æ€§è¦æ±‚æ¯”è¾ƒé«˜çš„åœºæ™¯ï¼Œæ¯”å¦‚æ ¸ååº”å †çš„æ§åˆ¶ã€‚ select å¯ç§»æ¤æ€§æ›´å¥½ï¼Œå‡ ä¹è¢«æ‰€æœ‰ä¸»æµå¹³å°æ‰€æ”¯æŒã€‚ 2. poll åº”ç”¨åœºæ™¯poll æ²¡æœ‰æœ€å¤§æè¿°ç¬¦æ•°é‡çš„é™åˆ¶ï¼Œå¦‚æœå¹³å°æ”¯æŒå¹¶ä¸”å¯¹å®æ—¶æ€§è¦æ±‚ä¸é«˜ï¼Œåº”è¯¥ä½¿ç”¨ poll è€Œä¸æ˜¯ selectã€‚ 3. epoll åº”ç”¨åœºæ™¯åªéœ€è¦è¿è¡Œåœ¨ Linux å¹³å°ä¸Šï¼Œæœ‰å¤§é‡çš„æè¿°ç¬¦éœ€è¦åŒæ—¶è½®è¯¢ï¼Œå¹¶ä¸”è¿™äº›è¿æ¥æœ€å¥½æ˜¯é•¿è¿æ¥ã€‚ éœ€è¦åŒæ—¶ç›‘æ§å°äº 1000 ä¸ªæè¿°ç¬¦ï¼Œå°±æ²¡æœ‰å¿…è¦ä½¿ç”¨ epollï¼Œå› ä¸ºè¿™ä¸ªåº”ç”¨åœºæ™¯ä¸‹å¹¶ä¸èƒ½ä½“ç° epoll çš„ä¼˜åŠ¿ã€‚ éœ€è¦ç›‘æ§çš„æè¿°ç¬¦çŠ¶æ€å˜åŒ–å¤šï¼Œè€Œä¸”éƒ½æ˜¯éå¸¸çŸ­æš‚çš„ï¼Œä¹Ÿæ²¡æœ‰å¿…è¦ä½¿ç”¨ epollã€‚å› ä¸º epoll ä¸­çš„æ‰€æœ‰æè¿°ç¬¦éƒ½å­˜å‚¨åœ¨å†…æ ¸ä¸­ï¼Œé€ æˆæ¯æ¬¡éœ€è¦å¯¹æè¿°ç¬¦çš„çŠ¶æ€æ”¹å˜éƒ½éœ€è¦é€šè¿‡ epoll_ctl() è¿›è¡Œç³»ç»Ÿè°ƒç”¨ï¼Œé¢‘ç¹ç³»ç»Ÿè°ƒç”¨é™ä½æ•ˆç‡ã€‚å¹¶ä¸” epoll çš„æè¿°ç¬¦å­˜å‚¨åœ¨å†…æ ¸ï¼Œä¸å®¹æ˜“è°ƒè¯•ã€‚ I/O å¤ç”¨ï¼ˆselect å’Œ pollï¼‰ ä¿¡å·é©±åŠ¨å¼ I/Oï¼ˆSIGIOï¼‰ å¼‚æ­¥ I/Oï¼ˆAIOï¼‰ å¤šçº¿ç¨‹è¿›ç¨‹å’Œçº¿ç¨‹åŒºåˆ« è¿›ç¨‹æ˜¯èµ„æºï¼ˆCPUã€å†…å­˜ç­‰ï¼‰åˆ†é…çš„åŸºæœ¬å•ä½ï¼Œå®ƒæ˜¯ç¨‹åºæ‰§è¡Œæ—¶çš„ä¸€ä¸ªå®ä¾‹ çº¿ç¨‹æ˜¯ç¨‹åºæ‰§è¡Œæ—¶çš„æœ€å°å•ä½ï¼Œå®ƒæ˜¯è¿›ç¨‹çš„ä¸€ä¸ªæ‰§è¡Œæµï¼Œæ˜¯CPUè°ƒåº¦å’Œåˆ†æ´¾çš„åŸºæœ¬å•ä½ï¼Œä¸€ä¸ªè¿›ç¨‹å¯ä»¥ç”±å¾ˆå¤šä¸ªçº¿ç¨‹ç»„æˆï¼Œçº¿ç¨‹é—´å…±äº«è¿›ç¨‹çš„æ‰€æœ‰èµ„æºï¼Œæ¯ä¸ªçº¿ç¨‹æœ‰è‡ªå·±çš„å †æ ˆå’Œå±€éƒ¨å˜é‡,æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„æ‰§è¡Œå•å…ƒä¸»è¦ç”¨äºè§£å†³ç¨‹åºæ‰§è¡Œçš„æ•ˆç‡ å®ˆæŠ¤çº¿ç¨‹&amp;éå®ˆæŠ¤çº¿ç¨‹ GCçº¿ç¨‹å±äºå®ˆæŠ¤çº¿ç¨‹, å’Œä¸»çº¿ç¨‹åŒç”Ÿå…±æ­» ç”¨æˆ·çº¿ç¨‹ä¹Ÿå«éå®ˆæŠ¤çº¿ç¨‹, ç”¨æˆ·è‡ªå·±åˆ›å»ºçš„çº¿ç¨‹, å¦‚æœä¸»çº¿ç¨‹åœæ­¢æ‰,ä¸ä¼šå½±å“ç”¨æˆ·çº¿ç¨‹. ç”¨æˆ·çº¿ç¨‹éå®ˆæŠ¤çº¿ç¨‹ çº¿ç¨‹çš„çŠ¶æ€è½¬æ¢ çº¿ç¨‹å®‰å…¨coout++ count++ è¿™è¡Œä»£ç å®é™…ä¸Šéœ€è¦æ‰§è¡Œä¸‰ä¸ªæŒ‡ä»¤ï¼š getfieldï¼šä»å†…å­˜ä¸­è·å–å˜é‡ count çš„å€¼iaddï¼šå°† count åŠ  1putfieldï¼šå°†åŠ  1 åçš„ç»“æœèµ‹å€¼ç»™ count å˜é‡è¿™ä¹Ÿå°±æ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„åŸå› æ‰€åœ¨ï¼Œå› ä¸º count++ æ“ä½œä¸å…·å¤‡åŸå­æ€§ã€‚ åŸå­æ€§æ“ä½œæŒ‡çš„æ˜¯ä¸å¯è¢«ä¸­æ–­çš„ä¸€ä¸ªæˆ–ä¸€ç³»åˆ—æ“ä½œã€‚ä¸‹å›¾æè¿°äº†ä¸ºä»€ä¹ˆéåŸå­æ“ä½œé€ æˆäº†è¿™é‡Œçš„çº¿ç¨‹ä¸å®‰å…¨é—®é¢˜ å‡è®¾æœ‰ä¸¤ä¸ªçº¿ç¨‹å»æ‰§è¡Œ add æ“ä½œï¼Œæ­¤æ—¶ count æ˜¯ 0ï¼Œé‚£ä¹ˆå­˜åœ¨ä¸Šå›¾ä¸­çš„è¿™ç§å¯èƒ½ï¼Œåœ¨çº¿ç¨‹ A æ‰§è¡Œè¿™ä¸‰æ­¥çš„è¿‡ç¨‹ä¸­ cpu æ—¶é—´ç‰‡è€—å°½çº¿ç¨‹ B è¢«è°ƒåº¦ï¼Œæ­¤æ—¶ç”±äºå†…å­˜ä¸­ count çš„å€¼ä»ä¸º 0ï¼ˆå› ä¸ºçº¿ç¨‹ A çš„æ“ä½œç»“æœè¿˜æœªåˆ·æ–°åˆ°å†…å­˜ä¸­ï¼‰ï¼Œæ‰€ä»¥çº¿ç¨‹ B ä»æ˜¯åœ¨ 0 çš„åŸºç¡€ä¸Šæ‰§è¡Œè‡ªå¢ï¼Œæ‰€ä»¥å¯¼è‡´æœ€ç»ˆå†…å­˜ä¸­çš„ count æ˜¯ 1ï¼Œè€Œä¸æ˜¯ 2. ä¸ºä»€ä¹ˆè¦ç”¨çº¿ç¨‹æ± ? çº¿ç¨‹æ± ä½œç”¨å°±æ˜¯é™åˆ¶ç³»ç»Ÿä¸­æ‰§è¡Œçº¿ç¨‹çš„æ•°é‡ã€‚æ ¹æ®ç³»ç»Ÿçš„ç¯å¢ƒæƒ…å†µ, å¯ä»¥æ‰‹åŠ¨æˆ–è€…è‡ªåŠ¨çš„è®¾ç½®çº¿ç¨‹æ•°é‡, é¿å…æµªè´¹ç³»ç»Ÿèµ„æº, é€ æˆç³»ç»Ÿæ‹¥æŒ¤, å½“ä¸€ä¸ªæ–°ä»»åŠ¡éœ€è¦è¿è¡Œæ—¶ï¼Œå¦‚æœçº¿ç¨‹æ±  ä¸­æœ‰ç­‰å¾…çš„å·¥ä½œçº¿ç¨‹ï¼Œå°±å¯ä»¥å¼€å§‹è¿è¡Œäº†ï¼›å¦åˆ™è¿›å…¥ç­‰å¾…é˜Ÿåˆ—ã€‚ å‡å°‘äº†åˆ›å»ºå’Œé”€æ¯çº¿ç¨‹çš„æ¬¡æ•°, æ¯ä¸ªå·¥ä½œçº¿ç¨‹éƒ½å¯ä»¥è¢«é‡å¤åˆ©ç”¨, å¯æ‰§è¡Œå¤šä¸ªä»»åŠ¡ å¯ä»¥æ ¹æ®ç³»ç»Ÿçš„æ‰¿å—èƒ½åŠ›, è°ƒæ•´çº¿ç¨‹æ± ä¸­å·¥ä½œçº¿ç¨‹çš„æ•°ç›®, é˜²æ­¢å› ä¸ºæ¶ˆè€—è¿‡å¤šçš„å†…å­˜, (æ¯ä¸ªçº¿ç¨‹éœ€è¦å¤§çº¦1MBå†…å­˜ï¼Œçº¿ç¨‹å¼€çš„è¶Šå¤šï¼Œæ¶ˆè€—çš„å†…å­˜ä¹Ÿå°±è¶Šå¤§ï¼Œæœ€åæ­»æœº)ã€‚ Javaé‡Œè¾¹çº¿ç¨‹æ± çš„é¡¶çº§æ¥å£æ—¶Executor, ä½†æ˜¯ä¸¥æ ¼æ„ä¹‰ä¸Šå°†Executorå¹¶ä¸æ˜¯ä¸€ä¸ªçº¿ç¨‹æ± , è€Œæ˜¯ä¸€ä¸ªæ‰§è¡Œå·¥å…·,çœŸæ­£çš„çº¿ç¨‹æ± æ¥å£æ—¶ExecutorService çº¿ç¨‹ä¸­é‡è¦çš„å‡ ä¸ªç±» ExecutorService çœŸæ­£çš„çº¿ç¨‹æ± æ¥å£ã€‚ ScheduledExecutorServiceèƒ½å’ŒTimer/TimerTaskç±»ä¼¼ï¼Œè§£å†³é‚£äº›éœ€è¦ä»»åŠ¡é‡å¤æ‰§è¡Œçš„é—®é¢˜ã€‚ ThreadPoolExecutorExecutorServiceçš„é»˜è®¤å®ç°ã€‚ ScheduledThreadPoolExecutorç»§æ‰¿ThreadPoolExecutorçš„ScheduledExecutorServiceæ¥å£å®ç°ï¼Œå‘¨æœŸæ€§ä»»åŠ¡è°ƒåº¦çš„ç±»å®ç°ã€‚ new Threadçš„å¼Šç«¯ æ¯æ¬¡new Threadæ–°å»ºå¯¹è±¡æ€§èƒ½å·®ã€‚ çº¿ç¨‹ç¼ºä¹ç»Ÿä¸€ç®¡ç†ï¼Œå¯èƒ½æ— é™åˆ¶æ–°å»ºçº¿ç¨‹ï¼Œç›¸äº’ä¹‹é—´ç«äº‰ï¼ŒåŠå¯èƒ½å ç”¨è¿‡å¤šç³»ç»Ÿèµ„æºå¯¼è‡´æ­»æœºæˆ–oomã€‚ ç¼ºä¹æ›´å¤šåŠŸèƒ½ï¼Œå¦‚å®šæ—¶æ‰§è¡Œã€å®šæœŸæ‰§è¡Œã€çº¿ç¨‹ä¸­æ–­ã€‚ Javaæä¾›çš„å››ç§çº¿ç¨‹æ± çš„å¥½å¤„åœ¨äºï¼š é‡ç”¨å­˜åœ¨çš„çº¿ç¨‹ï¼Œå‡å°‘å¯¹è±¡åˆ›å»ºã€æ¶ˆäº¡çš„å¼€é”€ï¼Œæ€§èƒ½ä½³ã€‚ å¯æœ‰æ•ˆæ§åˆ¶æœ€å¤§å¹¶å‘çº¿ç¨‹æ•°ï¼Œæé«˜ç³»ç»Ÿèµ„æºçš„ä½¿ç”¨ç‡ï¼ŒåŒæ—¶é¿å…è¿‡å¤šèµ„æºç«äº‰ï¼Œé¿å…å µå¡ã€‚ æä¾›å®šæ—¶æ‰§è¡Œã€å®šæœŸæ‰§è¡Œã€å•çº¿ç¨‹ã€å¹¶å‘æ•°æ§åˆ¶ç­‰åŠŸèƒ½ã€‚ å››ç§çº¿ç¨‹æ± Javaé€šè¿‡Executorsæä¾›å››ç§çº¿ç¨‹æ± ,åˆ†åˆ«ä¸º: newCachedThreadPool åˆ›å»ºä¸€ä¸ªå¯ç¼“å­˜çš„çº¿ç¨‹æ± , å¦‚æœçº¿ç¨‹æ± é•¿åº¦è¶…è¿‡å¤„ç†éœ€è¦, å¯ä»¥çµæ´»å›æ”¶ç©ºé—²çº¿ç¨‹, è‹¥æ— å¯å›æ”¶,åˆ™æ–°å»ºçº¿ç¨‹ ==é€‚åº”åœºæ™¯: åˆ›å»ºä¸€ä¸ªå¯ä»¥æ— é™æ‰©å¤§çš„çº¿ç¨‹æ± ï¼Œé€‚ç”¨äºæœåŠ¡å™¨è´Ÿè½½è¾ƒè½»ï¼Œæ‰§è¡Œå¾ˆå¤šçŸ­æœŸå¼‚æ­¥ä»»åŠ¡ã€‚== newFixedThreadPool åˆ›å»ºä¸€ä¸ªå®šé•¿çº¿ç¨‹æ± ,å¯æ§åˆ¶çº¿ç¨‹æœ€å¤§å¹¶å‘æ•°, é‡‡ç”¨æ— ç•Œçš„é˜»å¡é˜Ÿåˆ—ï¼Œæ‰€ä»¥å®é™…çº¿ç¨‹æ•°é‡æ°¸è¿œä¸ä¼šå˜åŒ–,è¶…å‡ºçš„çº¿ç¨‹ä¼šåœ¨é˜Ÿåˆ—ä¸­ç­‰å¾… é€‚åº”åœºæ™¯:é€‚ç”¨äºå¯ä»¥é¢„æµ‹çº¿ç¨‹æ•°é‡çš„ä¸šåŠ¡ä¸­ï¼Œæˆ–è€…æœåŠ¡å™¨è´Ÿè½½è¾ƒé‡ï¼Œå¯¹å½“å‰çº¿ç¨‹æ•°é‡è¿›è¡Œé™åˆ¶ã€‚ newScheduledThreadPool åˆ›å»ºä¸€ä¸ªå®šé•¿çº¿ç¨‹æ± , è‡³æ­¤å®šæ—¶åŠå‘¨æœŸæ€§ä»»åŠ¡æ‰§è¡Œ ==é€‚åº”åœºæ™¯: é€‚ç”¨äºéœ€è¦å¤šä¸ªåå°çº¿ç¨‹æ‰§è¡Œå‘¨æœŸä»»åŠ¡çš„åœºæ™¯ã€‚== newSingleThreadExecutor åˆ›å»ºä¸€ä¸ªå•çº¿ç¨‹åŒ–çš„çº¿ç¨‹æ± , å®ƒåªä¼šç”¨å”¯ä¸€çš„å·¥ä½œçº¿ç¨‹æ¥æ‰§è¡Œä»»åŠ¡, ä¿è¯æ‰€æœ‰ä»»åŠ¡æŒ‰ç…§æŒ‡å®šé¡ºåº(FIFO, LIFO,ä¼˜å…ˆçº§)æ‰§è¡Œ ==é€‚åº”åœºæ™¯: é€‚ç”¨äºéœ€è¦ä¿è¯é¡ºåºæ‰§è¡Œå„ä¸ªä»»åŠ¡ï¼Œå¹¶ä¸”åœ¨ä»»æ„æ—¶é—´ç‚¹ï¼Œä¸ä¼šæœ‰å¤šä¸ªçº¿ç¨‹æ˜¯æ´»åŠ¨çš„åœºæ™¯ã€‚== submit()å’Œexecute()çš„ä»¥åŠshutdown()å’ŒshutdownNow()çš„åŒºåˆ« submit()ï¼Œæäº¤ä¸€ä¸ªçº¿ç¨‹ä»»åŠ¡ï¼Œå¯ä»¥æ¥å—å›è°ƒå‡½æ•°çš„è¿”å›å€¼å—ï¼Œé€‚ç”¨äºéœ€è¦å¤„ç†è¿”å›ç€æˆ–è€…å¼‚å¸¸çš„ä¸šåŠ¡åœºæ™¯ execute()ï¼Œæ‰§è¡Œä¸€ä¸ªä»»åŠ¡ï¼Œæ²¡æœ‰è¿”å›å€¼ shutdown()ï¼Œè¡¨ç¤ºä¸å†æ¥å—æ–°ä»»åŠ¡ï¼Œä½†ä¸ä¼šå¼ºè¡Œç»ˆæ­¢å·²ç»æäº¤æˆ–è€…æ­£åœ¨æ‰§è¡Œä¸­çš„ä»»åŠ¡ shutdownNow()ï¼Œå¯¹äºå°šæœªæ‰§è¡Œçš„ä»»åŠ¡å…¨éƒ¨å–æ¶ˆï¼Œæ­£åœ¨æ‰§è¡Œçš„ä»»åŠ¡å…¨éƒ¨å‘å‡ºinterrupt()ï¼Œåœæ­¢æ‰§è¡Œ RejectedExecutionHandler çº¿ç¨‹æ± å››ç§æ‹’ç»ä»»åŠ¡ç­–ç•¥ çº¿ç¨‹æ± æœ‰ä¸€ä¸ªä»»åŠ¡é˜Ÿåˆ—ï¼Œç”¨äºç¼“å­˜æ‰€æœ‰å¾…å¤„ç†çš„ä»»åŠ¡ï¼Œæ­£åœ¨å¤„ç†çš„ä»»åŠ¡å°†ä»ä»»åŠ¡é˜Ÿåˆ—ä¸­ç§»é™¤ã€‚å› æ­¤åœ¨ä»»åŠ¡é˜Ÿåˆ—é•¿åº¦æœ‰é™çš„æƒ…å†µä¸‹å°±ä¼šå‡ºç°æ–°ä»»åŠ¡çš„æ‹’ç»å¤„ç†é—®é¢˜ï¼Œéœ€è¦æœ‰ä¸€ç§ç­–ç•¥æ¥å¤„ç†åº”è¯¥åŠ å…¥ä»»åŠ¡é˜Ÿåˆ—å´å› ä¸ºé˜Ÿåˆ—å·²æ»¡æ— æ³•åŠ å…¥çš„æƒ…å†µã€‚å¦å¤–åœ¨çº¿ç¨‹æ± å…³é—­çš„æ—¶å€™ä¹Ÿéœ€è¦å¯¹ä»»åŠ¡åŠ å…¥é˜Ÿåˆ—æ“ä½œè¿›è¡Œé¢å¤–çš„åè°ƒå¤„ç†ã€‚ RejectedExecutionHandleræä¾›äº†å››ç§æ–¹å¼æ¥å¤„ç†ä»»åŠ¡æ‹’ç»ç­–ç•¥: -&gt;==è¿™å››ç§ç­–ç•¥æ˜¯ç‹¬ç«‹æ— å…³çš„== 1ã€ç›´æ¥ä¸¢å¼ƒï¼ˆDiscardPolicyï¼‰ 2ã€ä¸¢å¼ƒé˜Ÿåˆ—ä¸­æœ€è€çš„ä»»åŠ¡(DiscardOldestPolicy)ã€‚ 3ã€æŠ›å¼‚å¸¸(AbortPolicy) 4ã€å°†ä»»åŠ¡åˆ†ç»™è°ƒç”¨çº¿ç¨‹æ¥æ‰§è¡Œ(CallerRunsPolicy)ã€‚ Runnable, Callable, Futureå’Œ FutureTask ç›´æ¥ç»§æ‰¿Thread, å’ŒRunnableéƒ½ä¸èƒ½è¿”å›æ‰§è¡Œç»“æœ, å°±å¿…é¡»é€šè¿‡å…±äº«å˜é‡æˆ–è€…ä½¿ç”¨çº¿ç¨‹é€šä¿¡çš„æ–¹å¼æ¥è¾¾åˆ°æ•ˆæœï¼Œè¿™æ ·ä½¿ç”¨èµ·æ¥å°±æ¯”è¾ƒéº»çƒ¦ã€‚ Callableä¸RunnableCallableä½äºjava.util.concurrentåŒ…ä¸‹ï¼Œå®ƒä¹Ÿæ˜¯ä¸€ä¸ªæ¥å£ï¼Œåœ¨å®ƒé‡Œé¢ä¹Ÿåªå£°æ˜äº†ä¸€ä¸ªæ–¹æ³•ï¼Œåªä¸è¿‡è¿™ä¸ªæ–¹æ³•å«åšcall()ï¼šä¸€èˆ¬æƒ…å†µä¸‹æ˜¯é…åˆExecutorServiceæ¥ä½¿ç”¨çš„ï¼Œåœ¨ExecutorServiceæ¥å£ä¸­å£°æ˜äº†è‹¥å¹²ä¸ªsubmitæ–¹æ³•çš„é‡è½½ç‰ˆæœ¬ 123&lt;T&gt; Future&lt;T&gt; submit(Callable&lt;T&gt; task);&lt;T&gt; Future&lt;T&gt; submit(Runnable task, T result);Future&lt;?&gt; submit(Runnable task); Future Futureå°±æ˜¯å¯¹äºå…·ä½“çš„Runnableæˆ–è€…Callableä»»åŠ¡çš„æ‰§è¡Œç»“æœè¿›è¡Œå–æ¶ˆã€æŸ¥è¯¢æ˜¯å¦å®Œæˆã€è·å–ç»“æœã€‚å¿…è¦æ—¶å¯ä»¥é€šè¿‡getæ–¹æ³•è·å–æ‰§è¡Œç»“æœï¼Œè¯¥æ–¹æ³•ä¼šé˜»å¡ç›´åˆ°ä»»åŠ¡è¿”å›ç»“æœã€‚Futureç±»ä½äºjava.util.concurrentåŒ…ä¸‹ï¼Œå®ƒæ˜¯ä¸€ä¸ªæ¥å£ Futureæä¾›äº†ä¸‰ç§åŠŸèƒ½ï¼š 1ï¼‰åˆ¤æ–­ä»»åŠ¡æ˜¯å¦å®Œæˆï¼› 2ï¼‰èƒ½å¤Ÿä¸­æ–­ä»»åŠ¡ï¼› 3ï¼‰èƒ½å¤Ÿè·å–ä»»åŠ¡æ‰§è¡Œç»“æœã€‚ å› ä¸ºFutureåªæ˜¯ä¸€ä¸ªæ¥å£ï¼Œæ‰€ä»¥æ˜¯æ— æ³•ç›´æ¥ç”¨æ¥åˆ›å»ºå¯¹è±¡ä½¿ç”¨çš„ï¼Œå› æ­¤å°±æœ‰äº†ä¸‹é¢çš„FutureTaskã€‚ FutureTask å¯ä»¥çœ‹å‡ºRunnableFutureç»§æ‰¿äº†Runnableæ¥å£å’ŒFutureæ¥å£ï¼Œè€ŒFutureTaskå®ç°äº†RunnableFutureæ¥å£ã€‚æ‰€ä»¥å®ƒæ—¢å¯ä»¥ä½œä¸ºRunnableè¢«çº¿ç¨‹æ‰§è¡Œï¼Œåˆå¯ä»¥ä½œä¸ºFutureå¾—åˆ°Callableçš„è¿”å›å€¼ã€‚ 1234public class FutureTask&lt;V&gt; implements RunnableFuture&lt;V&gt;public interface RunnableFuture&lt;V&gt; extends Runnable, Future&lt;V&gt; &#123; void run();&#125; é” å¸¸è§çš„é”æœ‰synchronizedã€volatileã€åå‘é”ã€è½»é‡çº§é”ã€é‡é‡çº§é” æ­»é”çš„åŸå›  äº’æ–¥æ€§: æŸä¸€æ®µæ—¶é—´å†…, æŸä¸€èµ„æºåªèƒ½ä¸€ä¸ªçº¿ç¨‹ä½¿ç”¨ è¯·æ±‚ä¿æŒ: Aç”³è¯·äº†ä¸€éƒ¨åˆ†èµ„æºä¸è¶³ä»¥è¿è¡Œ,éœ€è¦é¢å¤–çš„å…¶ä»–èµ„æº,ä½†åˆç”³è¯·ä¸åˆ°, è€Œå…¶ä»–çº¿ç¨‹åˆæ‹¿ä¸åˆ°Aä¿æŒçš„é‚£ä»½èµ„æº ä¸å¯å‰¥å¤º: è¿›ç¨‹æœªä½¿ç”¨å®Œä¹‹å‰,èµ„æºä¸å¯å‰¥å¤º å¾ªç¯ç­‰å¾…: è¿›ç¨‹èµ„æºå½¢æˆç¯å‹é“¾, å¯¼è‡´ä»»ä½•ä¸€ä¸ªçº¿ç¨‹éƒ½æ‹¿ä¸åˆ°è¿è¡Œæ‰€éœ€çš„å…¨éƒ¨èµ„æº CAS CAS(Compare and Swap): å®ƒçš„ä½œç”¨æ˜¯å°†æŒ‡å®šå†…å­˜åœ°å€çš„å†…å®¹ä¸æ‰€ç»™çš„æŸä¸ªå€¼ç›¸æ¯”ï¼Œå¦‚æœç›¸ç­‰ï¼Œåˆ™å°†å…¶å†…å®¹æ›¿æ¢ä¸ºæŒ‡ä»¤ä¸­æä¾›çš„æ–°å€¼ï¼Œå¦‚æœä¸ç›¸ç­‰ï¼Œåˆ™æ›´æ–°å¤±è´¥ã€‚è¿™ä¸€æ¯”è¾ƒå¹¶äº¤æ¢çš„æ“ä½œæ˜¯åŸå­çš„ï¼Œä¸å¯ä»¥è¢«ä¸­æ–­** ==CASæ˜¯é€šè¿‡ç¡¬ä»¶å‘½ä»¤ä¿è¯äº†åŸå­æ€§== ï¼ˆ1ï¼‰åœ¨å¤šçº¿ç¨‹ç«äº‰ä¸‹ï¼ŒåŠ é”ã€é‡Šæ”¾é”ä¼šå¯¼è‡´æ¯”è¾ƒå¤šçš„ä¸Šä¸‹æ–‡åˆ‡æ¢å’Œè°ƒåº¦å»¶æ—¶ï¼Œå¼•èµ·æ€§èƒ½é—®é¢˜ã€‚ ï¼ˆ2ï¼‰ä¸€ä¸ªçº¿ç¨‹æŒæœ‰é”ä¼šå¯¼è‡´å…¶å®ƒæ‰€æœ‰éœ€è¦æ­¤é”çš„çº¿ç¨‹æŒ‚èµ·ã€‚ ï¼ˆ3ï¼‰å¦‚æœä¸€ä¸ªä¼˜å…ˆçº§é«˜çš„çº¿ç¨‹ç­‰å¾…ä¸€ä¸ªä¼˜å…ˆçº§ä½çš„çº¿ç¨‹é‡Šæ”¾é”ä¼šå¯¼è‡´ä¼˜å…ˆçº§å€’ç½®ï¼Œå¼•èµ·æ€§èƒ½é£é™©ã€‚ volatileæ˜¯ä¸é”™çš„æœºåˆ¶ï¼Œä½†æ˜¯volatileä¸èƒ½ä¿è¯åŸå­æ€§ã€‚å› æ­¤å¯¹äºåŒæ­¥æœ€ç»ˆè¿˜æ˜¯è¦å›åˆ°é”æœºåˆ¶ä¸Šæ¥ã€‚ç‹¬å é”æ˜¯ä¸€ç§æ‚²è§‚é”ï¼Œsynchronizedå°±æ˜¯ä¸€ç§ç‹¬å é”ï¼Œä¼šå¯¼è‡´å…¶å®ƒæ‰€æœ‰éœ€è¦é”çš„çº¿ç¨‹æŒ‚èµ·ï¼Œç­‰å¾…æŒæœ‰é”çš„çº¿ç¨‹é‡Šæ”¾é”ã€‚è€Œå¦ä¸€ä¸ªæ›´åŠ æœ‰æ•ˆçš„é”å°±æ˜¯ä¹è§‚é”ã€‚æ‰€è°“ä¹è§‚é”å°±æ˜¯ï¼Œæ¯æ¬¡ä¸åŠ é”è€Œæ˜¯å‡è®¾æ²¡æœ‰å†²çªè€Œå»å®ŒæˆæŸé¡¹æ“ä½œï¼Œå¦‚æœå› ä¸ºå†²çªå¤±è´¥å°±é‡è¯•ï¼Œç›´åˆ°æˆåŠŸä¸ºæ­¢ã€‚ä¹è§‚é”ç”¨åˆ°çš„æœºåˆ¶å°±æ˜¯CASï¼ŒCompare and Swapã€‚ CASå¯¼è‡´çš„é—®é¢˜ ABAé—®é¢˜ å¤§å¤šæ•°æƒ…å†µä¸‹ä¹è§‚é”çš„å®ç°éƒ½ä¼šé€šè¿‡å¼•å…¥ä¸€ä¸ªç‰ˆæœ¬å·æ ‡è®°è¿™ä¸ªå¯¹è±¡ï¼Œæ¯æ¬¡ä¿®æ”¹ç‰ˆæœ¬å·éƒ½ä¼šå˜è¯ï¼Œæ¯”å¦‚ä½¿ç”¨æ—¶é—´æˆ³ä½œä¸ºç‰ˆæœ¬å·ï¼Œè¿™æ ·å°±å¯ä»¥å¾ˆå¥½çš„è§£å†³ABAé—®é¢˜ åœ¨JDKä¸­æä¾›äº†AtomicStampedReferenceç±»æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæ€è·¯æ˜¯ä¸€æ ·çš„ã€‚è¿™ä¸ªç±»ä¹Ÿç»´æŠ¤äº†ä¸€ä¸ªintç±»å‹çš„æ ‡è®°stampï¼Œæ¯æ¬¡æ›´æ–°æ•°æ®çš„æ—¶å€™é¡ºå¸¦æ›´æ–°ä¸€ä¸‹stampã€‚ 1234 // å¸¦æœ‰æ—¶é—´æˆ³çš„åŸå­ç±»ï¼Œä¸å­˜åœ¨ABAé—®é¢˜ï¼Œç¬¬äºŒä¸ªå‚æ•°å°±æ˜¯é»˜è®¤æ—¶é—´æˆ³ï¼Œè¿™é‡ŒæŒ‡å®šä¸º0AtomicStampedReference&lt;Integer&gt; a2 = new AtomicStampedReference&lt;Integer&gt;(10, 0);//å¯ä»¥çœ‹åˆ°ä½¿ç”¨AtomicStampedReferenceè¿›è¡ŒcompareAndSetçš„æ—¶å€™ï¼Œé™¤äº†è¦éªŒè¯æ•°æ®ï¼Œè¿˜è¦éªŒè¯æ—¶é—´æˆ³ã€‚ a2.compareAndSet(10, 11, stamp, stamp + 1); AtomicIntegerçš„CASåŸç† â€‹ é€šè¿‡æŸ¥çœ‹AtomicIntegerçš„æºç å¯çŸ¥ï¼Œ é€šè¿‡ç”³æ˜ä¸€ä¸ªvolatile ï¼ˆå†…å­˜é”å®šï¼ŒåŒä¸€æ—¶åˆ»åªæœ‰ä¸€ä¸ªçº¿ç¨‹å¯ä»¥ä¿®æ”¹å†…å­˜å€¼ï¼‰ç±»å‹çš„å˜é‡ï¼Œå†åŠ ä¸Šunsafe.compareAndSwapIntçš„æ–¹æ³•ï¼Œæ¥ä¿è¯å®ç°çº¿ç¨‹åŒæ­¥çš„ã€‚ 1234private volatile int value;public final boolean compareAndSet(int expect, int update) &#123; return unsafe.compareAndSwapInt(this, valueOffset, expect, update); &#125; å¾ªç¯æ—¶é—´é•¿å¼€é”€å¤§ è‡ªæ—‹CASå¦‚æœé•¿æ—¶é—´ä¸æˆåŠŸï¼Œä¼šç»™CPUå¸¦æ¥éå¸¸å¤§çš„æ‰§è¡Œå¼€é”€ã€‚å¦‚æœJVMèƒ½æ”¯æŒå¤„ç†å™¨æä¾›çš„pauseæŒ‡ä»¤é‚£ä¹ˆæ•ˆç‡ä¼šæœ‰ä¸€å®šçš„æå‡ï¼ŒpauseæŒ‡ä»¤æœ‰ä¸¤ä¸ªä½œç”¨ï¼Œç¬¬ä¸€å®ƒå¯ä»¥å»¶è¿Ÿæµæ°´çº¿æ‰§è¡ŒæŒ‡ä»¤ï¼ˆde-pipelineï¼‰,ä½¿CPUä¸ä¼šæ¶ˆè€—è¿‡å¤šçš„æ‰§è¡Œèµ„æºï¼Œå»¶è¿Ÿçš„æ—¶é—´å–å†³äºå…·ä½“å®ç°çš„ç‰ˆæœ¬ï¼Œåœ¨ä¸€äº›å¤„ç†å™¨ä¸Šå»¶è¿Ÿæ—¶é—´æ˜¯é›¶ã€‚ç¬¬äºŒå®ƒå¯ä»¥é¿å…åœ¨é€€å‡ºå¾ªç¯çš„æ—¶å€™å› å†…å­˜é¡ºåºå†²çªï¼ˆmemory order violationï¼‰è€Œå¼•èµ·CPUæµæ°´çº¿è¢«æ¸…ç©ºï¼ˆCPU pipeline flushï¼‰ï¼Œä»è€Œæé«˜CPUçš„æ‰§è¡Œæ•ˆç‡ã€‚ åªèƒ½ä¿è¯ä¸€ä¸ªå…±äº«å˜é‡çš„åŸå­æ“ä½œ å½“å¯¹ä¸€ä¸ªå…±äº«å˜é‡æ‰§è¡Œæ“ä½œæ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å¾ªç¯CASçš„æ–¹å¼æ¥ä¿è¯åŸå­æ“ä½œï¼Œä½†æ˜¯å¯¹å¤šä¸ªå…±äº«å˜é‡æ“ä½œæ—¶ï¼Œå¾ªç¯CASå°±æ— æ³•ä¿è¯æ“ä½œçš„åŸå­æ€§ï¼Œè¿™ä¸ªæ—¶å€™å°±å¯ä»¥ç”¨é”ï¼Œæˆ–è€…æœ‰ä¸€ä¸ªå–å·§çš„åŠæ³•ï¼Œå°±æ˜¯æŠŠå¤šä¸ªå…±äº«å˜é‡åˆå¹¶æˆä¸€ä¸ªå…±äº«å˜é‡æ¥æ“ä½œã€‚æ¯”å¦‚æœ‰ä¸¤ä¸ªå…±äº«å˜é‡iï¼2,j=aï¼Œåˆå¹¶ä¸€ä¸‹ij=2aï¼Œç„¶åç”¨CASæ¥æ“ä½œijã€‚ä»Java1.5å¼€å§‹JDKæä¾›äº†AtomicReferenceç±»æ¥ä¿è¯å¼•ç”¨å¯¹è±¡ä¹‹é—´çš„åŸå­æ€§ï¼Œä½ å¯ä»¥æŠŠå¤šä¸ªå˜é‡æ”¾åœ¨ä¸€ä¸ªå¯¹è±¡é‡Œæ¥è¿›è¡ŒCASæ“ä½œã€‚ synchronizedã€volatileçš„åŒºåˆ« ç›¸åŒç‚¹ï¼šéƒ½ä¿è¯äº†å¯è§æ€§ ä¸åŒç‚¹ ï¼š ==volatileä¸èƒ½ä¿è¯åŸå­æ€§==ï¼Œä½†æ˜¯==synchronizedèƒ½ä¿è¯åŸå­æ€§ä¸”ä¼šå‘ç”Ÿé˜»å¡==ï¼ˆåœ¨çº¿ç¨‹çŠ¶æ€è½¬æ¢ä¸­è¯¦è¯´ï¼‰ï¼Œå¼€é”€æ›´å¤§ã€‚ Volatile volatileå¯ä»¥çœ‹åšæ˜¯ä¸€ç§synchronizedçš„è½»é‡çº§é”ï¼Œä»–èƒ½å¤Ÿä¿è¯å¹¶å‘æ—¶ï¼Œè¢«å®ƒä¿®é¥°çš„å…±äº«å˜é‡çš„å¯è§æ€§ï¼Œå½“ä¸€ä¸ªå…±äº«å˜é‡è¢«volatileä¿®é¥°æ—¶ï¼Œå®ƒä¼šä¿è¯ä¿®æ”¹çš„å€¼ä¼šç«‹å³è¢«æ›´æ–°åˆ°ä¸»å­˜ï¼Œå½“æœ‰å…¶ä»–çº¿ç¨‹éœ€è¦è¯»å–æ—¶ï¼Œå®ƒä¼šå»å†…å­˜ä¸­è¯»å–æ–°å€¼ã€‚ volatileå¯ä»¥è§£å†³æŒ‡ä»¤é‡æ’ï¼Œå®ƒä½¿ç”¨çš„æ˜¯å†…å­˜å±éšœè¿›è¡Œè§£å†³çš„ï¼Œæ‰€è°“çš„å†…å­˜å±éšœæ˜¯ä¸€ä¸ªcpuå‘½ä»¤ï¼Œå®ƒæœ‰ä¸¤ä¸ªä½œç”¨ä¿è¯ç‰¹å®šçš„æ‰§è¡Œé¡ºåºï¼Œä¿è¯å¯è§æ€§ï¼Œé€šè¿‡åœ¨volatile æŒ‡ä»¤å‰åå¢åŠ å†…å­˜å±éšœä»è€Œè§£å†³æŒ‡ä»¤é‡æ’é—®é¢˜ã€‚ å®ç°åŸç†: è¢«volatileä¿®é¥°çš„å…±äº«å˜é‡åœ¨è¿›è¡Œå†™æ“ä½œçš„æ—¶å€™ 1ã€å°†å½“å‰å¤„ç†å™¨ç¼“å­˜è¡Œçš„æ•°æ®å†™å›åˆ°ç³»ç»Ÿå†…å­˜ã€‚ 2ã€è¿™ä¸ªå†™å›å†…å­˜çš„æ“ä½œä¼šä½¿åœ¨å…¶ä»–CPUé‡Œç¼“å­˜äº†è¯¥å†…å­˜åœ°å€çš„æ•°æ®æ— æ•ˆã€‚ ä½¿ç”¨åœºæ™¯: 1.è®¿é—®å˜é‡ä¸éœ€è¦åŠ é”ï¼ˆåŠ é”çš„è¯ä½¿ç”¨volatileå°±æ²¡å¿…è¦äº†ï¼‰ 2ã€å¯¹å˜é‡çš„å†™æ“ä½œä¸ä¾èµ–äºå½“å‰å€¼(å› ä¸ºä»–ä¸èƒ½ä¿è¯åŸå­æ€§) 3.è¯¥å˜é‡æ²¡æœ‰åŒ…å«åœ¨å…·æœ‰å…¶ä»–å˜é‡çš„ä¸å˜å¼ä¸­ã€‚ ä¸€èˆ¬æˆ‘ä»¬ä¼šç”¨æ¥ä¿®é¥°çŠ¶æ€æ ‡å¿—ï¼›è¯»å†™é”ï¼ˆè¯»&gt;&gt;å†™ï¼Œå¯¹å†™åŠ é”ï¼Œè¯»ä¸åŠ é”ï¼‰ï¼›DCLçš„å•ä¾‹æ¨¡å¼ä¸­ï¼›volatile beanï¼ˆä¾‹å¦‚æ”¾å…¥HTTPSessionä¸­çš„å¯¹è±¡ï¼‰ synchronized synchronizedæ˜¯å¹¶å‘ç¼–ç¨‹ä¸­æ¥è§¦çš„æœ€åŸºæœ¬çš„åŒæ­¥å·¥å…·ï¼Œæ˜¯ä¸€ç§é‡é‡çº§é”,ä¹Ÿæ˜¯ æ‚²è§‚é”ï¼Œä¹Ÿæ˜¯javaå†…ç½®çš„åŒæ­¥æœºåˆ¶ï¼Œé¦–å…ˆæˆ‘ä»¬çŸ¥é“synchronizedæä¾›äº†äº’æ–¥æ€§çš„è¯­ä¹‰å’Œå¯è§æ€§ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥é€šè¿‡ä½¿ç”¨å®ƒæ¥ä¿è¯å¹¶å‘çš„å®‰å…¨ã€‚ synchronizedä¸‰ç§ç”¨æ³• ç”¨äºç±»ä¸Š: å½“ä½¿ç”¨synchronizedä¿®é¥°ç±»é™æ€æ–¹æ³•æ—¶ï¼Œé‚£ä¹ˆå½“å‰åŠ é”çš„çº§åˆ«å°±æ˜¯ç±»ï¼Œå½“å¤šä¸ªçº¿ç¨‹å¹¶å‘è®¿é—®è¯¥ç±»ï¼ˆæ‰€æœ‰å®ä¾‹å¯¹è±¡ï¼‰çš„åŒæ­¥æ–¹æ³•ä»¥åŠåŒæ­¥ä»£ç å—æ—¶ï¼Œä¼šè¿›è¡ŒåŒæ­¥ ç”¨äºä»£ç å—: å½“ä½¿ç”¨synchronizedä¿®é¥°ä»£ç å—æ—¶ï¼Œé‚£ä¹ˆå½“å‰åŠ é”çš„çº§åˆ«å°±æ˜¯synchronizedï¼ˆXï¼‰ä¸­é…ç½®çš„xå¯¹è±¡å®ä¾‹ï¼Œå½“å¤šä¸ªçº¿ç¨‹å¹¶å‘è®¿é—®è¯¥å¯¹è±¡çš„åŒæ­¥æ–¹æ³•ã€åŒæ­¥ä»£ç å—ä»¥åŠå½“å‰çš„ä»£ç å—æ—¶ï¼Œä¼šè¿›è¡ŒåŒæ­¥ã€‚ ==ä½¿ç”¨åŒæ­¥ä»£ç å—æ—¶è¦æ³¨æ„çš„æ˜¯ä¸è¦ä½¿ç”¨Stringç±»å‹å¯¹è±¡ï¼Œå› ä¸ºStringå¸¸é‡æ± çš„å­˜åœ¨ï¼Œæ‰€ä»¥å¾ˆå®¹æ˜“å¯¼è‡´å‡ºé—®é¢˜ã€‚== Synchronizedå’ŒCASåŒºåˆ« CASæœ‰3ä¸ªæ“ä½œæ•°ï¼Œå†…å­˜å€¼Vï¼Œæ—§çš„é¢„æœŸå€¼Aï¼Œè¦ä¿®æ”¹çš„æ–°å€¼Bã€‚å½“ä¸”ä»…å½“é¢„æœŸå€¼Aå’Œå†…å­˜å€¼Vç›¸åŒæ—¶ï¼Œå°†å†…å­˜å€¼Vä¿®æ”¹ä¸ºBï¼Œå¦åˆ™è¿”å›Vã€‚è¿™æ˜¯ä¸€ç§ä¹è§‚é”çš„æ€è·¯ï¼Œå®ƒç›¸ä¿¡åœ¨å®ƒä¿®æ”¹ä¹‹å‰ï¼Œæ²¡æœ‰å…¶å®ƒçº¿ç¨‹å»ä¿®æ”¹å®ƒï¼› è€ŒSynchronizedæ˜¯ä¸€ç§æ‚²è§‚é”ï¼Œå®ƒè®¤ä¸ºåœ¨å®ƒä¿®æ”¹ä¹‹å‰ï¼Œä¸€å®šä¼šæœ‰å…¶å®ƒçº¿ç¨‹å»ä¿®æ”¹å®ƒï¼Œæ‚²è§‚é”æ•ˆç‡å¾ˆä½ã€‚ä¸‹é¢æ¥çœ‹ä¸€ä¸‹AtomicIntegeræ˜¯å¦‚ä½•åˆ©ç”¨CASå®ç°åŸå­æ€§æ“ä½œçš„ã€‚ ReentrantLock ReentrantLockå®ç°äº†Lockæ¥å£, æ”¯æŒä¸¤ç§è·å–é”çš„æ–¹å¼ï¼Œä¸€ç§æ˜¯å…¬å¹³æ¨¡å‹ï¼Œä¸€ç§æ˜¯éå…¬å¹³æ¨¡å‹ã€‚ å…¬å¹³é”æ¨¡å‹ï¼š åˆå§‹åŒ–æ—¶ï¼Œ state=0ï¼Œè¡¨ç¤ºæ— äººæŠ¢å äº†æ‰“æ°´æƒã€‚è¿™æ—¶å€™ï¼Œæ‘æ°‘Aæ¥æ‰“æ°´(Açº¿ç¨‹è¯·æ±‚é”)ï¼Œå äº†æ‰“æ°´æƒï¼ŒæŠŠstate+1ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š çº¿ç¨‹Aå–å¾—äº†é”ï¼ŒæŠŠ stateåŸå­æ€§+1,è¿™æ—¶å€™stateè¢«æ”¹ä¸º1ï¼ŒAçº¿ç¨‹ç»§ç»­æ‰§è¡Œå…¶ä»–ä»»åŠ¡ï¼Œç„¶åæ¥äº†æ‘æ°‘Bä¹Ÿæƒ³æ‰“æ°´ï¼ˆçº¿ç¨‹Bè¯·æ±‚é”ï¼‰ï¼Œçº¿ç¨‹Bæ— æ³•è·å–é”ï¼Œç”ŸæˆèŠ‚ç‚¹è¿›è¡Œæ’é˜Ÿï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š åˆå§‹åŒ–çš„æ—¶å€™ï¼Œä¼šç”Ÿæˆä¸€ä¸ªç©ºçš„å¤´èŠ‚ç‚¹ï¼Œç„¶åæ‰æ˜¯Bçº¿ç¨‹èŠ‚ç‚¹ï¼Œè¿™æ—¶å€™ï¼Œå¦‚æœçº¿ç¨‹Aåˆè¯·æ±‚é”ï¼Œæ˜¯å¦éœ€è¦æ’é˜Ÿï¼Ÿç­”æ¡ˆå½“ç„¶æ˜¯å¦å®šçš„ï¼Œå¦åˆ™å°±ç›´æ¥æ­»é”äº†ã€‚å½“Aå†æ¬¡è¯·æ±‚é”ï¼Œå°±ç›¸å½“äºæ˜¯æ‰“æ°´æœŸé—´ï¼ŒåŒä¸€å®¶äººä¹Ÿæ¥æ‰“æ°´äº†ï¼Œæ˜¯æœ‰ç‰¹æƒçš„ï¼Œè¿™æ—¶å€™çš„çŠ¶æ€å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š åˆ°äº†è¿™é‡Œï¼Œç›¸ä¿¡å¤§å®¶åº”è¯¥æ˜ç™½äº†ä»€ä¹ˆæ˜¯å¯é‡å…¥é”äº†å§ã€‚å°±æ˜¯ä¸€ä¸ªçº¿ç¨‹åœ¨è·å–äº†é”ä¹‹åï¼Œå†æ¬¡å»è·å–äº†åŒä¸€ä¸ªé”ï¼Œè¿™æ—¶å€™ä»…ä»…æ˜¯æŠŠçŠ¶æ€å€¼è¿›è¡Œç´¯åŠ ã€‚å¦‚æœçº¿ç¨‹Aé‡Šæ”¾äº†ä¸€æ¬¡é”ï¼Œå°±æˆè¿™æ ·äº†ï¼š ä»…ä»…æ˜¯æŠŠçŠ¶æ€å€¼å‡äº†ï¼Œåªæœ‰çº¿ç¨‹AæŠŠæ­¤é”å…¨éƒ¨é‡Šæ”¾äº†ï¼ŒçŠ¶æ€å€¼å‡åˆ°0äº†ï¼Œå…¶ä»–çº¿ç¨‹æ‰æœ‰æœºä¼šè·å–é”ã€‚å½“AæŠŠé”å®Œå…¨é‡Šæ”¾åï¼Œstateæ¢å¤ä¸º0ï¼Œç„¶åä¼šé€šçŸ¥é˜Ÿåˆ—å”¤é†’Bçº¿ç¨‹èŠ‚ç‚¹ï¼Œä½¿Bå¯ä»¥å†æ¬¡ç«äº‰é”ã€‚å½“ç„¶ï¼Œå¦‚æœBçº¿ç¨‹åé¢è¿˜æœ‰Cçº¿ç¨‹ï¼ŒCçº¿ç¨‹ç»§ç»­ä¼‘çœ ï¼Œé™¤éBæ‰§è¡Œå®Œäº†ï¼Œé€šçŸ¥äº†Cçº¿ç¨‹ã€‚æ³¨æ„ï¼Œå½“ä¸€ä¸ªçº¿ç¨‹èŠ‚ç‚¹è¢«å”¤é†’ç„¶åå–å¾—äº†é”ï¼Œå¯¹åº”èŠ‚ç‚¹ä¼šä»é˜Ÿåˆ—ä¸­åˆ é™¤ã€‚ éå…¬å¹³é”æ¨¡å‹ å¦‚æœä½ å·²ç»æ˜ç™½äº†å‰é¢è®²çš„å…¬å¹³é”æ¨¡å‹ï¼Œé‚£ä¹ˆéå…¬å¹³é”æ¨¡å‹ä¹Ÿå°±éå¸¸å®¹æ˜“ç†è§£äº†ã€‚å½“çº¿ç¨‹Aæ‰§è¡Œå®Œä¹‹åï¼Œè¦å”¤é†’çº¿ç¨‹Bæ˜¯éœ€è¦æ—¶é—´çš„ï¼Œè€Œä¸”çº¿ç¨‹Bé†’æ¥åè¿˜è¦å†æ¬¡ç«äº‰é”ï¼Œæ‰€ä»¥å¦‚æœåœ¨åˆ‡æ¢è¿‡ç¨‹å½“ä¸­ï¼Œæ¥äº†ä¸€ä¸ªçº¿ç¨‹Cï¼Œé‚£ä¹ˆçº¿ç¨‹Cæ˜¯æœ‰å¯èƒ½è·å–åˆ°é”çš„ï¼Œå¦‚æœCè·å–åˆ°äº†é”ï¼ŒBå°±åªèƒ½ç»§ç»­ä¹–ä¹–ä¼‘çœ äº†ã€‚ åå‘é”(jvmå†…éƒ¨) åå‘é”ï¼ˆé¡¾åæ€ä¹‰ï¼Œå®ƒä¼šåå‘äºç¬¬ä¸€ä¸ªè®¿é—®é”çš„çº¿ç¨‹ï¼Œå¦‚æœåœ¨è¿è¡Œè¿‡ç¨‹ä¸­ï¼ŒåŒæ­¥é”åªæœ‰ä¸€ä¸ªçº¿ç¨‹è®¿é—®ï¼Œä¸å­˜åœ¨å¤šçº¿ç¨‹äº‰ç”¨çš„æƒ…å†µï¼Œåˆ™çº¿ç¨‹æ˜¯ä¸éœ€è¦è§¦å‘åŒæ­¥çš„ï¼Œè¿™ç§æƒ…å†µä¸‹ï¼Œå°±ä¼šç»™çº¿ç¨‹åŠ ä¸€ä¸ªåå‘é”ï¼‰ å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œé”ä¸ä»…ä¸å­˜åœ¨å¤šçº¿ç¨‹ç«äº‰ï¼Œè€Œä¸”æ€»æ˜¯ç”±åŒä¸€çº¿ç¨‹å¤šæ¬¡è·å¾—ï¼Œä¸ºäº†è®©çº¿ç¨‹è·å¾—é”çš„ä»£ä»·æ›´ä½è€Œå¼•å…¥äº†åå‘é”ã€‚ è½»é‡çº§é”(jvm) è½»é‡çº§é”æ˜¯ç”±åå‘æ‰€å‡çº§æ¥çš„ï¼Œåå‘é”è¿è¡Œåœ¨ä¸€ä¸ªçº¿ç¨‹è¿›å…¥åŒæ­¥å—çš„æƒ…å†µä¸‹ï¼Œå½“ç¬¬äºŒä¸ªçº¿ç¨‹åŠ å…¥é”äº‰ç”¨çš„æ—¶å€™ï¼Œåå‘é”å°±ä¼šå‡çº§ä¸ºè½»é‡çº§é”ï¼› å¦‚æœè¯´è½»é‡çº§é”æ˜¯åœ¨æ— ç«äº‰çš„æƒ…å†µä¸‹ä½¿ç”¨CASæ“ä½œå»æ¶ˆé™¤åŒæ­¥ä½¿ç”¨çš„äº’æ–¥é‡ï¼Œ é‚£åå‘é”å°±æ˜¯åœ¨æ— ç«äº‰çš„æƒ…å†µä¸‹æŠŠæ•´ä¸ªåŒæ­¥éƒ½æ¶ˆé™¤æ‰ï¼Œ è¿CASæ“ä½œéƒ½ä¸åšäº†ã€‚ è‡ªæ—‹é”(jvm)è‡ªæ—‹é”åŸç†éå¸¸ç®€å•ï¼Œå¦‚æœæŒæœ‰é”çš„çº¿ç¨‹èƒ½åœ¨å¾ˆçŸ­æ—¶é—´å†…é‡Šæ”¾é”èµ„æºï¼Œé‚£ä¹ˆé‚£äº›ç­‰å¾…ç«äº‰é”çš„çº¿ç¨‹å°±ä¸éœ€è¦åšå†…æ ¸æ€å’Œç”¨æˆ·æ€ä¹‹é—´çš„åˆ‡æ¢è¿›å…¥é˜»å¡æŒ‚èµ·çŠ¶æ€ï¼Œå®ƒä»¬åªéœ€è¦ç­‰ä¸€ç­‰ï¼ˆè‡ªæ—‹ï¼‰ï¼Œç­‰æŒæœ‰é”çš„çº¿ç¨‹é‡Šæ”¾é”åå³å¯ç«‹å³è·å–é”ï¼Œè¿™æ ·å°±é¿å…ç”¨æˆ·çº¿ç¨‹å’Œå†…æ ¸çš„åˆ‡æ¢çš„æ¶ˆè€— jvmå†…éƒ¨å¯¹é”çš„æ“ä½œå¦‚æœå·²ç»å­˜åœ¨åå‘é”äº†ï¼Œåˆ™ä¼šå°è¯•è·å–è½»é‡çº§é”ï¼Œå¦‚æœä»¥ä¸Šä¸¤ç§éƒ½å¤±è´¥ï¼Œåˆ™å¯ç”¨è‡ªæ—‹é”ï¼Œå¦‚æœè‡ªæ—‹ä¹Ÿæ²¡æœ‰è·å–åˆ°é”ï¼Œåˆ™ä½¿ç”¨é‡é‡çº§é”ï¼Œæ²¡æœ‰è·å–åˆ°é”çš„çº¿ç¨‹é˜»å¡æŒ‚èµ·ï¼Œç›´åˆ°æŒæœ‰é”çš„çº¿ç¨‹æ‰§è¡Œå®ŒåŒæ­¥å—å”¤é†’ä»–ä»¬ï¼› åå‘é”æ˜¯åœ¨æ— é”äº‰ç”¨çš„æƒ…å†µä¸‹ä½¿ç”¨çš„ï¼Œä¹Ÿå°±æ˜¯åŒæ­¥å¼€åœ¨å½“å‰çº¿ç¨‹æ²¡æœ‰æ‰§è¡Œå®Œä¹‹å‰ï¼Œæ²¡æœ‰å…¶å®ƒçº¿ç¨‹ä¼šæ‰§è¡Œè¯¥åŒæ­¥å¿«ï¼Œä¸€æ—¦æœ‰äº†ç¬¬äºŒä¸ªçº¿ç¨‹çš„äº‰ç”¨ï¼Œåå‘é”å°±ä¼šå‡çº§ä¸ºè½»é‡çº§é”ï¼Œä¸€ç‚¹æœ‰ä¸¤ä¸ªä»¥ä¸Šçº¿ç¨‹äº‰ç”¨ï¼Œå°±ä¼šå‡çº§ä¸ºé‡é‡çº§é”ï¼›å¦‚æœçº¿ç¨‹äº‰ç”¨æ¿€çƒˆï¼Œé‚£ä¹ˆåº”è¯¥ç¦ç”¨åå‘é”ã€‚ synchronizedå®ç°ï¼Œlockå®ç°ï¼Œæœ‰ä½•åŒºåˆ« JUC Unsafeç±»æ˜¯åœ¨sun.miscåŒ…ä¸‹ï¼Œä¸å±äºJavaæ ‡å‡†ã€‚ä½†æ˜¯å¾ˆå¤šJavaçš„åŸºç¡€ç±»åº“ï¼ŒåŒ…æ‹¬ä¸€äº›è¢«å¹¿æ³›ä½¿ç”¨çš„é«˜æ€§èƒ½å¼€å‘åº“éƒ½æ˜¯åŸºäºUnsafeç±»å¼€å‘çš„ï¼Œæ¯”å¦‚Nettyã€Cassandraã€Hadoopã€Kafkaç­‰ã€‚Unsafeç±»åœ¨æå‡Javaè¿è¡Œæ•ˆç‡ï¼Œå¢å¼ºJavaè¯­è¨€åº•å±‚æ“ä½œèƒ½åŠ›æ–¹é¢èµ·äº†å¾ˆå¤§çš„ä½œç”¨ã€‚ Unsafeç±»ä½¿Javaæ‹¥æœ‰äº†åƒCè¯­è¨€çš„æŒ‡é’ˆä¸€æ ·æ“ä½œå†…å­˜ç©ºé—´çš„èƒ½åŠ›ï¼ŒåŒæ—¶ä¹Ÿå¸¦æ¥äº†æŒ‡é’ˆçš„é—®é¢˜ã€‚è¿‡åº¦çš„ä½¿ç”¨Unsafeç±»ä¼šä½¿å¾—å‡ºé”™çš„å‡ ç‡å˜å¤§ï¼Œå› æ­¤Javaå®˜æ–¹å¹¶ä¸å»ºè®®ä½¿ç”¨çš„ï¼Œå®˜æ–¹æ–‡æ¡£ä¹Ÿå‡ ä¹æ²¡æœ‰ã€‚é€šå¸¸æˆ‘ä»¬æœ€å¥½ä¹Ÿä¸è¦ä½¿ç”¨Unsafeç±»ï¼Œé™¤éæœ‰æ˜ç¡®çš„ç›®çš„ï¼Œå¹¶ä¸”ä¹Ÿè¦å¯¹å®ƒæœ‰æ·±å…¥çš„äº†è§£æ‰è¡Œã€‚ J.U.C - AQSjava.util.concurrentï¼ˆJ.U.Cï¼‰å¤§å¤§æé«˜äº†å¹¶å‘æ€§èƒ½ï¼ŒAQS è¢«è®¤ä¸ºæ˜¯ J.U.C çš„æ ¸å¿ƒã€‚ CountDownLatch ç”¨æ¥æ§åˆ¶ä¸€ä¸ªæˆ–è€…å¤šä¸ªçº¿ç¨‹ç­‰å¾…å¤šä¸ªçº¿ç¨‹ã€‚ ç»´æŠ¤äº†ä¸€ä¸ªè®¡æ•°å™¨ cntï¼Œæ¯æ¬¡è°ƒç”¨ countDown() æ–¹æ³•ä¼šè®©è®¡æ•°å™¨çš„å€¼å‡ 1ï¼Œå‡åˆ° 0 çš„æ—¶å€™ï¼Œé‚£äº›å› ä¸ºè°ƒç”¨ await() æ–¹æ³•è€Œåœ¨ç­‰å¾…çš„çº¿ç¨‹å°±ä¼šè¢«å”¤é†’ã€‚ 1234567891011121314151617public class CountdownLatchExample &#123; public static void main(String[] args) throws InterruptedException &#123; final int totalThread = 10; CountDownLatch countDownLatch = new CountDownLatch(totalThread); ExecutorService executorService = Executors.newCachedThreadPool(); for (int i = 0; i &lt; totalThread; i++) &#123; executorService.execute(() -&gt; &#123; System.out.print(\"run..\"); countDownLatch.countDown(); &#125;); &#125; countDownLatch.await();//å½“å‰çº¿ç¨‹éœ€è¦ç­‰å¾…Countdownlatchå€¼ä¸º0æ‰ä¼šè‹é†’ç»§ç»­æ‰§è¡Œ System.out.println(\"end\"); executorService.shutdown(); &#125;&#125; CyclicBarrier ç”¨æ¥æ§åˆ¶å¤šä¸ªçº¿ç¨‹äº’ç›¸ç­‰å¾…ï¼Œåªæœ‰å½“å¤šä¸ªçº¿ç¨‹éƒ½åˆ°è¾¾æ—¶ï¼Œè¿™äº›çº¿ç¨‹æ‰ä¼šç»§ç»­æ‰§è¡Œã€‚ å’Œ CountdownLatch ç›¸ä¼¼ï¼Œéƒ½æ˜¯é€šè¿‡ç»´æŠ¤è®¡æ•°å™¨æ¥å®ç°çš„ã€‚çº¿ç¨‹æ‰§è¡Œ await() æ–¹æ³•ä¹‹åè®¡æ•°å™¨ä¼šå‡ 1ï¼Œå¹¶è¿›è¡Œç­‰å¾…ï¼Œç›´åˆ°è®¡æ•°å™¨ä¸º 0ï¼Œæ‰€æœ‰è°ƒç”¨ await() æ–¹æ³•è€Œåœ¨ç­‰å¾…çš„çº¿ç¨‹æ‰èƒ½ç»§ç»­æ‰§è¡Œã€‚ CyclicBarrier å’Œ CountdownLatch çš„ä¸€ä¸ªåŒºåˆ«æ˜¯ï¼ŒCyclicBarrier çš„è®¡æ•°å™¨é€šè¿‡è°ƒç”¨ reset() æ–¹æ³•å¯ä»¥å¾ªç¯ä½¿ç”¨ï¼Œæ‰€ä»¥å®ƒæ‰å«åšå¾ªç¯å±éšœã€‚ CyclicBarrier æœ‰ä¸¤ä¸ªæ„é€ å‡½æ•°ï¼Œå…¶ä¸­ parties æŒ‡ç¤ºè®¡æ•°å™¨çš„åˆå§‹å€¼ï¼ŒbarrierAction åœ¨æ‰€æœ‰çº¿ç¨‹éƒ½åˆ°è¾¾å±éšœçš„æ—¶å€™ä¼šæ‰§è¡Œä¸€æ¬¡ã€‚ 12345678910public CyclicBarrier(int parties, Runnable barrierAction) &#123; if (parties &lt;= 0) throw new IllegalArgumentException(); this.parties = parties; this.count = parties; this.barrierCommand = barrierAction;&#125;public CyclicBarrier(int parties) &#123; this(parties, null);&#125; 1234567891011121314151617181920public class CyclicBarrierExample &#123; public static void main(String[] args) &#123; final int totalThread = 10; CyclicBarrier cyclicBarrier = new CyclicBarrier(totalThread); ExecutorService executorService = Executors.newCachedThreadPool(); for (int i = 0; i &lt; totalThread; i++) &#123; executorService.execute(() -&gt; &#123; System.out.print(\"before..\"); try &#123; cyclicBarrier.await(); &#125; catch (InterruptedException | BrokenBarrierException e) &#123; e.printStackTrace(); &#125; System.out.print(\"after..\"); &#125;); &#125; executorService.shutdown(); &#125;&#125; Semaphore Semaphore ç±»ä¼¼äºæ“ä½œç³»ç»Ÿä¸­çš„ä¿¡å·é‡ï¼Œå¯ä»¥æ§åˆ¶å¯¹äº’æ–¥èµ„æºçš„è®¿é—®çº¿ç¨‹æ•°ã€‚ ä»¥ä¸‹ä»£ç æ¨¡æ‹Ÿäº†å¯¹æŸä¸ªæœåŠ¡çš„å¹¶å‘è¯·æ±‚ï¼Œæ¯æ¬¡åªèƒ½æœ‰ 3 ä¸ªå®¢æˆ·ç«¯åŒæ—¶è®¿é—®ï¼Œè¯·æ±‚æ€»æ•°ä¸º 10ã€‚ 1234567891011121314151617181920212223public class SemaphoreExample &#123; public static void main(String[] args) &#123; final int clientCount = 3; final int totalRequestCount = 10; Semaphore semaphore = new Semaphore(clientCount); ExecutorService executorService = Executors.newCachedThreadPool(); for (int i = 0; i &lt; totalRequestCount; i++) &#123; executorService.execute(()-&gt;&#123; try &#123; semaphore.acquire(); System.out.print(semaphore.availablePermits() + \" \"); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; finally &#123; semaphore.release(); &#125; &#125;); &#125; executorService.shutdown(); &#125;&#125;//2 1 2 2 2 2 2 1 2 2 åŸºæœ¬ç±»å‹åŸå­ç±»concurrent åŒ…ä¸­æä¾›äº†JavaåŸºæœ¬ç±»å‹çš„åŸå­æ“ä½œå°è£…ç±»â€”â€“åªè¦ç±»ååŒ…å«äº†Atomicå…³é”®å­—éƒ½æ˜¯ç”¨äºè¿¸å‘çš„ç±»å‹çš„å°è£… å¦‚: AtomicInteger, AtomicLong, AtomicIntegerArray, AtomicBoolean, AtomicReference, â€¦ ç­‰ç­‰ ä»¥AtomicIntegerä¸ºä¾‹ 1234567891011121314/* * å…¶ä¸­getIntVolatileå’ŒcompareAndSwapIntéƒ½æ˜¯nativeæ–¹æ³• * getIntVolatileæ˜¯è·å–å½“å‰çš„æœŸæœ›å€¼ * compareAndSwapIntå°±æ˜¯æˆ‘ä»¬å¹³æ—¶è¯´çš„CAS(compare and swap)ï¼Œé€šè¿‡æ¯”è¾ƒå¦‚æœå†…å­˜åŒºçš„å€¼æ²¡æœ‰æ”¹å˜ï¼Œé‚£ä¹ˆå°±ç”¨æ–°å€¼ç›´æ¥ç»™è¯¥å†…å­˜åŒºèµ‹å€¼ */public final int getAndAddInt(Object paramObject, long paramLong, int paramInt)&#123; int i; do &#123; i = getIntVolatile(paramObject, paramLong); &#125; while (!compareAndSwapInt(paramObject, paramLong, i, i + paramInt)); return i;&#125; incrementAndGetæ˜¯å°†è‡ªå¢åçš„å€¼è¿”å›ï¼Œè¿˜æœ‰ä¸€ä¸ªæ–¹æ³•getAndIncrementæ˜¯å°†è‡ªå¢å‰çš„å€¼è¿”å›ï¼Œåˆ†åˆ«å¯¹åº”++iå’Œi++æ“ä½œã€‚åŒæ ·çš„decrementAndGetå’ŒgetAndDecrementåˆ™å¯¹--iå’Œi--æ“ä½œã€‚ å¹¶å‘å®¹å™¨ å“ˆå¸Œè¡¨éå¸¸é«˜æ•ˆï¼Œå¤æ‚åº¦ä¸ºO(1)çš„æ•°æ®ç»“æ„ï¼Œåœ¨Javaå¼€å‘ä¸­ï¼Œæˆ‘ä»¬æœ€å¸¸è§åˆ°æœ€é¢‘ç¹ä½¿ç”¨çš„å°±æ˜¯HashMapå’ŒHashTableï¼Œä½†æ˜¯åœ¨çº¿ç¨‹ç«äº‰æ¿€çƒˆçš„å¹¶å‘åœºæ™¯ä¸­ä½¿ç”¨éƒ½ä¸å¤Ÿåˆç†,ä¼šå¯¼è‡´çº¿ç¨‹å®‰å…¨é—®é¢˜ HashMap å…³äºä½è¿ç®— å…³äºä½è¿ç®—,å·¦ç§»ä¸€ä½å°±æ˜¯Ã—2å€çš„å€¼, ä½è¿ç®—ä¹‹é«˜æ•ˆï¼Œå¦‚ä¸‹æ–‡åœ¨æœ¬æ¥å¯ä»¥æ±‚æ¨¡è¿ç®—çš„æ—¶å€™ï¼Œä¹Ÿæ¢ç”¨ä½è¿ç®—æé«˜è¿ç®—é€Ÿåº¦ ä¸ºä½•è¦ç”¨2çš„å¹‚æ¬¡ä½œä¸ºå…¶å®¹é‡ ä¸ºäº†è¿½æ±‚é€Ÿåº¦ä¸æ•ˆç‡ï¼Œè®¡ç®—keyçš„bucketè¿›è¡Œhashè®¡ç®—çš„æ—¶å€™æŠŠå–æ¨¡è¿ç®—è½¬æ¢ä¸ºä½è¿ç®—ï¼Œè€Œå½“å®¹é‡ä¸€å®šæ˜¯2^næ—¶ï¼š h &amp; (length - 1) ç­‰ä»·ä¸ h % lengthï¼Œä½†ä»–ä»¬æ˜¯ç­‰ä»·ï¼ˆæ•ˆæœï¼‰ä¸ç­‰æ•ˆï¼ˆæ•ˆç‡ï¼‰çš„ï¼Œå…¶æ•ˆæœæ˜¯è®¡ç®—hä¸lengthçš„æ¨¡ è´Ÿè½½å› å­é»˜è®¤å¸¸é‡ï¼š static final floatDEFAULT_LOAD_FACTOR=0.75f; hashè¿ç®— (ä¸ºä»€ä¹ˆé•¿åº¦è¦æ˜¯2çš„åŸå› ) å·¦è¾¹ä¸¤ç»„æ˜¯æ•°ç»„é•¿åº¦ä¸º16ï¼ˆ2çš„4æ¬¡æ–¹ï¼‰ï¼Œå³è¾¹ä¸¤ç»„æ˜¯æ•°ç»„é•¿åº¦ä¸º15ã€‚ä¸¤ç»„çš„hashcodeå‡ä¸º8å’Œ9ï¼Œä½†æ˜¯å¾ˆæ˜æ˜¾ï¼Œå½“å®ƒä»¬å’Œ1110â€œä¸â€çš„æ—¶å€™ï¼Œäº§ç”Ÿäº†ç›¸åŒçš„ç»“æœï¼Œä¹Ÿå°±æ˜¯è¯´å®ƒä»¬ä¼šå®šä½åˆ°æ•°ç»„ä¸­çš„åŒä¸€ä¸ªä½ç½®ä¸Šå»ï¼Œè¿™å°±äº§ç”Ÿäº†ç¢°æ’ï¼Œ8å’Œ9ä¼šè¢«æ”¾åˆ°åŒä¸€ä¸ªé“¾è¡¨ä¸Šï¼Œé‚£ä¹ˆæŸ¥è¯¢çš„æ—¶å€™å°±éœ€è¦éå†è¿™ä¸ªé“¾è¡¨ï¼Œå¾—åˆ°8æˆ–è€…9ï¼Œè¿™æ ·å°±é™ä½äº†æŸ¥è¯¢çš„æ•ˆç‡ã€‚åŒæ—¶ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥å‘ç°ï¼Œå½“æ•°ç»„é•¿åº¦ä¸º15çš„æ—¶å€™ï¼Œhashcodeçš„å€¼ä¼šä¸14ï¼ˆ1110ï¼‰è¿›è¡Œâ€œä¸â€ï¼Œé‚£ä¹ˆæœ€åä¸€ä½æ°¸è¿œæ˜¯0ï¼Œè€Œ0001ï¼Œ0011ï¼Œ0101ï¼Œ1001ï¼Œ1011ï¼Œ0111ï¼Œ1101è¿™å‡ ä¸ªä½ç½®æ°¸è¿œéƒ½ä¸èƒ½å­˜æ”¾å…ƒç´ äº†ï¼Œç©ºé—´æµªè´¹ç›¸å½“å¤§ï¼Œæ›´ç³Ÿçš„æ˜¯è¿™ç§æƒ…å†µä¸­ï¼Œæ•°ç»„å¯ä»¥ä½¿ç”¨çš„ä½ç½®æ¯”æ•°ç»„é•¿åº¦å°äº†å¾ˆå¤šï¼Œè¿™æ„å‘³ç€è¿›ä¸€æ­¥å¢åŠ äº†ç¢°æ’çš„å‡ ç‡ï¼Œå‡æ…¢äº†æŸ¥è¯¢çš„æ•ˆç‡ï¼ hashmapä»€ä¹ˆæ—¶å€™è¿›è¡Œæ‰©å®¹å‘¢ï¼Ÿ å½“hashmapä¸­çš„å…ƒç´ ä¸ªæ•°è¶…è¿‡æ•°ç»„å¤§å°loadFactoræ—¶ï¼Œå°±ä¼šè¿›è¡Œæ•°ç»„æ‰©å®¹ï¼ŒloadFactorçš„é»˜è®¤å€¼ä¸º0.75ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œæ•°ç»„å¤§å°ä¸º16ï¼Œé‚£ä¹ˆå½“hashmapä¸­å…ƒç´ ä¸ªæ•°è¶…è¿‡160.75=12çš„æ—¶å€™ï¼Œå°±æŠŠæ•°ç»„çš„å¤§å°æ‰©å±•ä¸º2*16=32ï¼Œå³æ‰©å¤§ä¸€å€ï¼Œç„¶åé‡æ–°è®¡ç®—æ¯ä¸ªå…ƒç´ åœ¨æ•°ç»„ä¸­çš„ä½ç½®ï¼Œè€Œè¿™æ˜¯ä¸€ä¸ªéå¸¸æ¶ˆè€—æ€§èƒ½çš„æ“ä½œï¼Œæ‰€ä»¥å¦‚æœæˆ‘ä»¬å·²ç»é¢„çŸ¥hashmapä¸­å…ƒç´ çš„ä¸ªæ•°ï¼Œé‚£ä¹ˆé¢„è®¾å…ƒç´ çš„ä¸ªæ•°èƒ½å¤Ÿæœ‰æ•ˆçš„æé«˜hashmapçš„æ€§èƒ½. HashMapæ˜¯çº¿ç¨‹ä¸å®‰å…¨ æ‰©å®¹æ—¶å¯èƒ½é€ æˆ(å› ä¸ºé‡‡ç”¨äº†å€’æ’æ³•å¯¼è‡´äº†æ­»å¾ªç¯é“¾è¡¨,æ‰€ä»¥çº¿ç¨‹ä¸å®‰å…¨-&gt; 1.8é‡‡ç”¨äº†é¡ºæ’æ³•è§£å†³äº†è¿™ä¸ªé—®é¢˜) ç»“æœè¦†ç›–é—®é¢˜(å¤šçº¿ç¨‹ç¯å¢ƒä¸‹,åœ¨åŒä¸€ä¸ªæ¡¶å†…æ’å…¥æ•°æ®,ä¼šæ‹¿åˆ°å¤´èŠ‚ç‚¹,è‹¥Aå¯¹å¤´èŠ‚ç‚¹ä¿®æ”¹å€¼å,bä¸çŸ¥é“åˆä¿®æ”¹åˆ™è¦†ç›–äº†åŸå€¼) HashTableHashTableå’ŒHashMapçš„å®ç°åŸç†å‡ ä¹ä¸€æ ·ï¼Œå·®åˆ«æ— éæ˜¯1.HashTableä¸å…è®¸keyå’Œvalueä¸ºnullï¼›2.HashTableæ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚ä½†æ˜¯HashTableçº¿ç¨‹å®‰å…¨çš„ç­–ç•¥å®ç°ä»£ä»·å´å¤ªå¤§äº†ï¼Œç®€å•ç²—æš´ï¼Œget/putæ‰€æœ‰ç›¸å…³æ“ä½œéƒ½æ˜¯synchronizedçš„ï¼Œè¿™ç›¸å½“äºç»™æ•´ä¸ªå“ˆå¸Œè¡¨åŠ äº†ä¸€æŠŠå¤§é”ï¼Œå¤šçº¿ç¨‹è®¿é—®æ—¶å€™ï¼Œåªè¦æœ‰ä¸€ä¸ªçº¿ç¨‹è®¿é—®æˆ–æ“ä½œè¯¥å¯¹è±¡ï¼Œé‚£å…¶ä»–çº¿ç¨‹åªèƒ½é˜»å¡ï¼Œç›¸å½“äºå°†æ‰€æœ‰çš„æ“ä½œä¸²è¡ŒåŒ–ï¼Œåœ¨==ç«äº‰æ¿€çƒˆçš„å¹¶å‘åœºæ™¯ä¸­æ€§èƒ½å°±ä¼šéå¸¸å·®==ã€‚ HashTableæ€§èƒ½å·®ä¸»è¦æ˜¯ç”±äºæ‰€æœ‰æ“ä½œéœ€è¦ç«äº‰åŒä¸€æŠŠé”ï¼Œè€Œå¦‚æœå®¹å™¨ä¸­æœ‰å¤šæŠŠé”ï¼Œæ¯ä¸€æŠŠé”é”ä¸€æ®µæ•°æ®ï¼Œè¿™æ ·åœ¨å¤šçº¿ç¨‹è®¿é—®æ—¶ä¸åŒæ®µçš„æ•°æ®æ—¶ï¼Œå°±ä¸ä¼šå­˜åœ¨é”ç«äº‰äº†ï¼Œè¿™æ ·ä¾¿å¯ä»¥æœ‰æ•ˆåœ°æé«˜å¹¶å‘æ•ˆç‡ã€‚è¿™å°±æ˜¯ConcurrentHashMapæ‰€é‡‡ç”¨çš„â€åˆ†æ®µé”â€œæ€æƒ³ã€‚ putçš„ä¸»è¦é€»è¾‘ä¹Ÿå°±ä¸¤æ­¥ï¼š putæ–¹æ³•æ˜¯è¦åŠ é”çš„, è‹¥cè¶…å‡ºé˜ˆå€¼thresholdï¼Œéœ€è¦æ‰©å®¹å¹¶rehashã€‚æ‰©å®¹åçš„å®¹é‡æ˜¯å½“å‰å®¹é‡çš„2å€ã€‚è¿™æ ·å¯ä»¥æœ€å¤§ç¨‹åº¦é¿å…ä¹‹å‰æ•£åˆ—å¥½çš„entryé‡æ–°æ•£åˆ—ï¼Œå…·ä½“åœ¨å¦ä¸€ç¯‡æ–‡ç« ä¸­æœ‰è¯¦ç»†åˆ†æï¼Œä¸èµ˜è¿°ã€‚æ‰©å®¹å¹¶rehashçš„è¿™ä¸ªè¿‡ç¨‹æ˜¯æ¯”è¾ƒæ¶ˆè€—èµ„æºçš„ã€‚ *1.å®šä½segmentå¹¶ç¡®ä¿å®šä½çš„Segmentå·²åˆå§‹åŒ– * 2.è°ƒç”¨Segmentçš„putæ–¹æ³•ã€‚ getæ–¹æ³• å…ˆå®šä½Segmentï¼Œå†å®šä½HashEntry æ— éœ€åŠ é”ï¼Œç”±äºå…¶ä¸­æ¶‰åŠåˆ°çš„å…±äº«å˜é‡éƒ½ä½¿ç”¨volatileä¿®é¥°ï¼Œvolatileå¯ä»¥ä¿è¯å†…å­˜å¯è§æ€§ï¼Œæ‰€ä»¥ä¸ä¼šè¯»å–åˆ°è¿‡æœŸæ•°æ®ã€‚ Vector[1. åŒæ­¥](https://cyc2018.github.io/CS-Notes/#/notes/Java å®¹å™¨?id=_1-åŒæ­¥)å®ƒçš„å®ç°ä¸ ArrayList ç±»ä¼¼ï¼Œä½†æ˜¯ä½¿ç”¨äº† synchronized è¿›è¡ŒåŒæ­¥ã€‚ 12345678910111213public synchronized boolean add(E e) &#123; modCount++; ensureCapacityHelper(elementCount + 1); elementData[elementCount++] = e; return true;&#125;public synchronized E get(int index) &#123; if (index &gt;= elementCount) throw new ArrayIndexOutOfBoundsException(index); return elementData(index);&#125;Copy to clipboardErrorCopied [2. æ‰©å®¹](https://cyc2018.github.io/CS-Notes/#/notes/Java å®¹å™¨?id=_2-æ‰©å®¹-1)Vector çš„æ„é€ å‡½æ•°å¯ä»¥ä¼ å…¥ capacityIncrement å‚æ•°ï¼Œå®ƒçš„ä½œç”¨æ˜¯åœ¨æ‰©å®¹æ—¶ä½¿å®¹é‡ capacity å¢é•¿ capacityIncrementã€‚å¦‚æœè¿™ä¸ªå‚æ•°çš„å€¼å°äºç­‰äº 0ï¼Œæ‰©å®¹æ—¶æ¯æ¬¡éƒ½ä»¤ capacity ä¸ºåŸæ¥çš„ä¸¤å€ã€‚ 12345678910111213141516171819public Vector(int initialCapacity, int capacityIncrement) &#123; super(); if (initialCapacity &lt; 0) throw new IllegalArgumentException(\"Illegal Capacity: \"+ initialCapacity); this.elementData = new Object[initialCapacity]; this.capacityIncrement = capacityIncrement;&#125;Copy to clipboardErrorCopiedprivate void grow(int minCapacity) &#123; // overflow-conscious code int oldCapacity = elementData.length; int newCapacity = oldCapacity + ((capacityIncrement &gt; 0) ? capacityIncrement : oldCapacity); if (newCapacity - minCapacity &lt; 0) newCapacity = minCapacity; if (newCapacity - MAX_ARRAY_SIZE &gt; 0) newCapacity = hugeCapacity(minCapacity); elementData = Arrays.copyOf(elementData, newCapacity);&#125;Copy to clipboardErrorCopied è°ƒç”¨æ²¡æœ‰ capacityIncrement çš„æ„é€ å‡½æ•°æ—¶ï¼ŒcapacityIncrement å€¼è¢«è®¾ç½®ä¸º 0ï¼Œä¹Ÿå°±æ˜¯è¯´é»˜è®¤æƒ…å†µä¸‹ Vector æ¯æ¬¡æ‰©å®¹æ—¶å®¹é‡éƒ½ä¼šç¿»å€ã€‚ 1234567public Vector(int initialCapacity) &#123; this(initialCapacity, 0);&#125;public Vector() &#123; this(10);&#125;Copy to clipboardErrorCopied [3. ä¸ ArrayList çš„æ¯”è¾ƒ](https://cyc2018.github.io/CS-Notes/#/notes/Java å®¹å™¨?id=_3-ä¸-arraylist-çš„æ¯”è¾ƒ) Vector æ˜¯åŒæ­¥çš„ï¼Œå› æ­¤å¼€é”€å°±æ¯” ArrayList è¦å¤§ï¼Œè®¿é—®é€Ÿåº¦æ›´æ…¢ã€‚æœ€å¥½ä½¿ç”¨ ArrayList è€Œä¸æ˜¯ Vectorï¼Œå› ä¸ºåŒæ­¥æ“ä½œå®Œå…¨å¯ä»¥ç”±ç¨‹åºå‘˜è‡ªå·±æ¥æ§åˆ¶ï¼› Vector æ¯æ¬¡æ‰©å®¹è¯·æ±‚å…¶å¤§å°çš„ 2 å€ï¼ˆä¹Ÿå¯ä»¥é€šè¿‡æ„é€ å‡½æ•°è®¾ç½®å¢é•¿çš„å®¹é‡ï¼‰ï¼Œè€Œ ArrayList æ˜¯ 1.5 å€ã€‚ [4. æ›¿ä»£æ–¹æ¡ˆ](https://cyc2018.github.io/CS-Notes/#/notes/Java å®¹å™¨?id=_4-æ›¿ä»£æ–¹æ¡ˆ)å¯ä»¥ä½¿ç”¨ Collections.synchronizedList(); å¾—åˆ°ä¸€ä¸ªçº¿ç¨‹å®‰å…¨çš„ ArrayListã€‚ 12List&lt;String&gt; list = new ArrayList&lt;&gt;();List&lt;String&gt; synList = Collections.synchronizedList(list);Copy to clipboardErrorCopied ä¹Ÿå¯ä»¥ä½¿ç”¨ concurrent å¹¶å‘åŒ…ä¸‹çš„ CopyOnWriteArrayList ç±»ã€‚ 1List&lt;String&gt; list = new CopyOnWriteArrayList&lt;&gt;(); CopyOnWriteListè¯»å†™åˆ†ç¦»å†™æ“ä½œåœ¨ä¸€ä¸ªå¤åˆ¶çš„æ•°ç»„ä¸Šè¿›è¡Œï¼Œè¯»æ“ä½œè¿˜æ˜¯åœ¨åŸå§‹æ•°ç»„ä¸­è¿›è¡Œï¼Œè¯»å†™åˆ†ç¦»ï¼Œäº’ä¸å½±å“ã€‚ å†™æ“ä½œéœ€è¦åŠ é”ï¼Œé˜²æ­¢å¹¶å‘å†™å…¥æ—¶å¯¼è‡´å†™å…¥æ•°æ®ä¸¢å¤±ã€‚ å†™æ“ä½œç»“æŸä¹‹åéœ€è¦æŠŠåŸå§‹æ•°ç»„æŒ‡å‘æ–°çš„å¤åˆ¶æ•°ç»„ã€‚ 123456789101112131415161718192021public boolean add(E e) &#123; final ReentrantLock lock = this.lock; lock.lock(); try &#123; Object[] elements = getArray(); int len = elements.length; Object[] newElements = Arrays.copyOf(elements, len + 1); newElements[len] = e; setArray(newElements); return true; &#125; finally &#123; lock.unlock(); &#125;&#125;final void setArray(Object[] a) &#123; array = a;&#125;@SuppressWarnings(\"unchecked\")private E get(Object[] a, int index) &#123; return (E) a[index];&#125; [é€‚ç”¨åœºæ™¯](https://cyc2018.github.io/CS-Notes/#/notes/Java å®¹å™¨?id=é€‚ç”¨åœºæ™¯)CopyOnWriteArrayList åœ¨å†™æ“ä½œçš„åŒæ—¶å…è®¸è¯»æ“ä½œï¼Œå¤§å¤§æé«˜äº†è¯»æ“ä½œçš„æ€§èƒ½ï¼Œå› æ­¤å¾ˆé€‚åˆè¯»å¤šå†™å°‘çš„åº”ç”¨åœºæ™¯ã€‚ ä½†æ˜¯ CopyOnWriteArrayList æœ‰å…¶ç¼ºé™·ï¼š å†…å­˜å ç”¨ï¼šåœ¨å†™æ“ä½œæ—¶éœ€è¦å¤åˆ¶ä¸€ä¸ªæ–°çš„æ•°ç»„ï¼Œä½¿å¾—å†…å­˜å ç”¨ä¸ºåŸæ¥çš„ä¸¤å€å·¦å³ï¼› æ•°æ®ä¸ä¸€è‡´ï¼šè¯»æ“ä½œä¸èƒ½è¯»å–å®æ—¶æ€§çš„æ•°æ®ï¼Œå› ä¸ºéƒ¨åˆ†å†™æ“ä½œçš„æ•°æ®è¿˜æœªåŒæ­¥åˆ°è¯»æ•°ç»„ä¸­ã€‚ æ‰€ä»¥ CopyOnWriteArrayList ä¸é€‚åˆå†…å­˜æ•æ„Ÿä»¥åŠå¯¹å®æ—¶æ€§è¦æ±‚å¾ˆé«˜çš„åœºæ™¯ã€‚ JVMJavaå†…å­˜æ¨¡å‹ Java å†…å­˜æ¨¡å‹è¯•å›¾å±è”½å„ç§ç¡¬ä»¶å’Œæ“ä½œç³»ç»Ÿçš„å†…å­˜è®¿é—®å·®å¼‚ï¼Œä»¥å®ç°è®© Java ç¨‹åºåœ¨å„ç§å¹³å°ä¸‹éƒ½èƒ½è¾¾åˆ°ä¸€è‡´çš„å†…å­˜è®¿é—®æ•ˆæœã€‚ ä¸»å†…å­˜ä¸å·¥ä½œå†…å­˜ å¤„ç†å™¨ä¸Šçš„å¯„å­˜å™¨çš„è¯»å†™çš„é€Ÿåº¦æ¯”å†…å­˜å¿«å‡ ä¸ªæ•°é‡çº§ï¼Œä¸ºäº†è§£å†³è¿™ç§é€Ÿåº¦çŸ›ç›¾ï¼Œåœ¨å®ƒä»¬ä¹‹é—´åŠ å…¥äº†é«˜é€Ÿç¼“å­˜ã€‚ åŠ å…¥é«˜é€Ÿç¼“å­˜å¸¦æ¥äº†ä¸€ä¸ªæ–°çš„é—®é¢˜ï¼šç¼“å­˜ä¸€è‡´æ€§ã€‚å¦‚æœå¤šä¸ªç¼“å­˜å…±äº«åŒä¸€å—ä¸»å†…å­˜åŒºåŸŸï¼Œé‚£ä¹ˆå¤šä¸ªç¼“å­˜çš„æ•°æ®å¯èƒ½ä¼šä¸ä¸€è‡´ï¼Œéœ€è¦ä¸€äº›åè®®æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚ æ‰€æœ‰çš„å˜é‡éƒ½å­˜å‚¨åœ¨ä¸»å†…å­˜ä¸­ï¼Œæ¯ä¸ªçº¿ç¨‹è¿˜æœ‰è‡ªå·±çš„å·¥ä½œå†…å­˜ï¼Œå·¥ä½œå†…å­˜å­˜å‚¨åœ¨é«˜é€Ÿç¼“å­˜æˆ–è€…å¯„å­˜å™¨ä¸­ï¼Œä¿å­˜äº†è¯¥çº¿ç¨‹ä½¿ç”¨çš„å˜é‡çš„ä¸»å†…å­˜å‰¯æœ¬æ‹·è´ã€‚ çº¿ç¨‹åªèƒ½ç›´æ¥æ“ä½œå·¥ä½œå†…å­˜ä¸­çš„å˜é‡ï¼Œä¸åŒçº¿ç¨‹ä¹‹é—´çš„å˜é‡å€¼ä¼ é€’éœ€è¦é€šè¿‡ä¸»å†…å­˜æ¥å®Œæˆ (å…±äº«å†…å­˜) å†…å­˜é—´äº¤äº’æ“ä½œJava å†…å­˜æ¨¡å‹å®šä¹‰äº† 8 ä¸ªæ“ä½œæ¥å®Œæˆä¸»å†…å­˜å’Œå·¥ä½œå†…å­˜çš„äº¤äº’æ“ä½œã€‚ readï¼šæŠŠä¸€ä¸ªå˜é‡çš„å€¼ä»ä¸»å†…å­˜ä¼ è¾“åˆ°å·¥ä½œå†…å­˜ä¸­ loadï¼šåœ¨ read ä¹‹åæ‰§è¡Œï¼ŒæŠŠ read å¾—åˆ°çš„å€¼æ”¾å…¥å·¥ä½œå†…å­˜çš„å˜é‡å‰¯æœ¬ä¸­ useï¼šæŠŠå·¥ä½œå†…å­˜ä¸­ä¸€ä¸ªå˜é‡çš„å€¼ä¼ é€’ç»™æ‰§è¡Œå¼•æ“ assignï¼šæŠŠä¸€ä¸ªä»æ‰§è¡Œå¼•æ“æ¥æ”¶åˆ°çš„å€¼èµ‹ç»™å·¥ä½œå†…å­˜çš„å˜é‡ storeï¼šæŠŠå·¥ä½œå†…å­˜çš„ä¸€ä¸ªå˜é‡çš„å€¼ä¼ é€åˆ°ä¸»å†…å­˜ä¸­ writeï¼šåœ¨ store ä¹‹åæ‰§è¡Œï¼ŒæŠŠ store å¾—åˆ°çš„å€¼æ”¾å…¥ä¸»å†…å­˜çš„å˜é‡ä¸­ lockï¼šä½œç”¨äºä¸»å†…å­˜çš„å˜é‡ unlock: ä½œç”¨äºä¸»å†…å­˜çš„å˜é‡ å†…å­˜æ¨¡å‹ä¸‰å¤§ç‰¹æ€§1. åŸå­æ€§Java å†…å­˜æ¨¡å‹ä¿è¯äº† readã€loadã€useã€assignã€storeã€writeã€lock å’Œ unlock æ“ä½œå…·æœ‰åŸå­æ€§ï¼Œä¾‹å¦‚å¯¹ä¸€ä¸ª int ç±»å‹çš„å˜é‡æ‰§è¡Œ assign èµ‹å€¼æ“ä½œï¼Œè¿™ä¸ªæ“ä½œå°±æ˜¯åŸå­æ€§çš„ã€‚ä½†æ˜¯ Java å†…å­˜æ¨¡å‹å…è®¸è™šæ‹Ÿæœºå°†æ²¡æœ‰è¢« volatile(å¯è§æ€§,ç«‹å³åŒæ­¥) ä¿®é¥°çš„ 64 ä½æ•°æ®ï¼ˆlongï¼Œdoubleï¼‰çš„è¯»å†™æ“ä½œåˆ’åˆ†ä¸ºä¸¤æ¬¡ 32 ä½çš„æ“ä½œæ¥è¿›è¡Œï¼Œå³ loadã€storeã€read å’Œ write æ“ä½œå¯ä»¥ä¸å…·å¤‡åŸå­æ€§ã€‚ æœ‰ä¸€ä¸ªé”™è¯¯è®¤è¯†å°±æ˜¯ï¼Œint ç­‰åŸå­æ€§çš„ç±»å‹åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸­ä¸ä¼šå‡ºç°çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚å‰é¢çš„çº¿ç¨‹ä¸å®‰å…¨ç¤ºä¾‹ä»£ç ä¸­ï¼Œcnt å±äº int ç±»å‹å˜é‡ï¼Œ1000 ä¸ªçº¿ç¨‹å¯¹å®ƒè¿›è¡Œè‡ªå¢æ“ä½œä¹‹åï¼Œå¾—åˆ°çš„å€¼ä¸º 997 è€Œä¸æ˜¯ 1000ã€‚ ä¸ºäº†æ–¹ä¾¿è®¨è®ºï¼Œå°†å†…å­˜é—´çš„äº¤äº’æ“ä½œç®€åŒ–ä¸º 3 ä¸ªï¼šloadã€assignã€storeã€‚ ä¸‹å›¾æ¼”ç¤ºäº†ä¸¤ä¸ªçº¿ç¨‹åŒæ—¶å¯¹ cnt è¿›è¡Œæ“ä½œï¼Œloadã€assignã€store è¿™ä¸€ç³»åˆ—æ“ä½œæ•´ä½“ä¸Šçœ‹ä¸å…·å¤‡åŸå­æ€§ï¼Œé‚£ä¹ˆåœ¨ T1 ä¿®æ”¹ cnt å¹¶ä¸”è¿˜æ²¡æœ‰å°†ä¿®æ”¹åçš„å€¼å†™å…¥ä¸»å†…å­˜ï¼ŒT2 ä¾ç„¶å¯ä»¥è¯»å…¥æ—§å€¼ã€‚å¯ä»¥çœ‹å‡ºï¼Œè¿™ä¸¤ä¸ªçº¿ç¨‹è™½ç„¶æ‰§è¡Œäº†ä¸¤æ¬¡è‡ªå¢è¿ç®—ï¼Œä½†æ˜¯ä¸»å†…å­˜ä¸­ cnt çš„å€¼æœ€åä¸º 1 è€Œä¸æ˜¯ 2ã€‚å› æ­¤å¯¹ int ç±»å‹è¯»å†™æ“ä½œæ»¡è¶³åŸå­æ€§åªæ˜¯è¯´æ˜ loadã€assignã€store è¿™äº›å•ä¸ªæ“ä½œå…·å¤‡åŸå­æ€§ã€‚ AtomicInteger èƒ½ä¿è¯å¤šä¸ªçº¿ç¨‹ä¿®æ”¹çš„åŸå­æ€§ã€‚ ä½¿ç”¨ AtomicInteger é‡å†™ä¹‹å‰çº¿ç¨‹ä¸å®‰å…¨çš„ä»£ç ä¹‹åå¾—åˆ°ä»¥ä¸‹çº¿ç¨‹å®‰å…¨å®ç°ï¼š 1234567891011public class AtomicExample &#123; private AtomicInteger cnt = new AtomicInteger(); public void add() &#123; cnt.incrementAndGet(); &#125; public int get() &#123; return cnt.get(); &#125;&#125; é™¤äº†ä½¿ç”¨åŸå­ç±»ä¹‹å¤–ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ synchronized äº’æ–¥é”æ¥ä¿è¯æ“ä½œçš„åŸå­æ€§ã€‚å®ƒå¯¹åº”çš„å†…å­˜é—´äº¤äº’æ“ä½œä¸ºï¼šlock å’Œ unlockï¼Œåœ¨è™šæ‹Ÿæœºå®ç°ä¸Šå¯¹åº”çš„å­—èŠ‚ç æŒ‡ä»¤ä¸º monitorenter å’Œ monitorexitã€‚ 12345678910public class AtomicSynchronizedExample &#123; private int cnt = 0; public synchronized void add() &#123; cnt++; &#125; public synchronized int get() &#123; return cnt; &#125;&#125; 2. å¯è§æ€§å¯è§æ€§æŒ‡å½“ä¸€ä¸ªçº¿ç¨‹ä¿®æ”¹äº†å…±äº«å˜é‡çš„å€¼ï¼Œå…¶å®ƒçº¿ç¨‹èƒ½å¤Ÿç«‹å³å¾—çŸ¥è¿™ä¸ªä¿®æ”¹ã€‚Java å†…å­˜æ¨¡å‹æ˜¯é€šè¿‡åœ¨å˜é‡ä¿®æ”¹åå°†æ–°å€¼åŒæ­¥å›ä¸»å†…å­˜ï¼Œåœ¨å˜é‡è¯»å–å‰ä»ä¸»å†…å­˜åˆ·æ–°å˜é‡å€¼æ¥å®ç°å¯è§æ€§çš„ã€‚ ä¸»è¦æœ‰ä¸‰ç§å®ç°å¯è§æ€§çš„æ–¹å¼ï¼š volatile synchronizedï¼Œå¯¹ä¸€ä¸ªå˜é‡æ‰§è¡Œ unlock æ“ä½œä¹‹å‰ï¼Œå¿…é¡»æŠŠå˜é‡å€¼åŒæ­¥å›ä¸»å†…å­˜ã€‚ finalï¼Œè¢« final å…³é”®å­—ä¿®é¥°çš„å­—æ®µåœ¨æ„é€ å™¨ä¸­ä¸€æ—¦åˆå§‹åŒ–å®Œæˆï¼Œå¹¶ä¸”æ²¡æœ‰å‘ç”Ÿ this é€ƒé€¸ï¼ˆå…¶å®ƒçº¿ç¨‹é€šè¿‡ this å¼•ç”¨è®¿é—®åˆ°åˆå§‹åŒ–äº†ä¸€åŠçš„å¯¹è±¡ï¼‰ï¼Œé‚£ä¹ˆå…¶å®ƒçº¿ç¨‹å°±èƒ½çœ‹è§ final å­—æ®µçš„å€¼ã€‚ å¯¹å‰é¢çš„çº¿ç¨‹ä¸å®‰å…¨ç¤ºä¾‹ä¸­çš„ cnt å˜é‡ä½¿ç”¨ volatile ä¿®é¥°ï¼Œä¸èƒ½è§£å†³çº¿ç¨‹ä¸å®‰å…¨é—®é¢˜ï¼Œå› ä¸º volatile å¹¶ä¸èƒ½ä¿è¯æ“ä½œçš„åŸå­æ€§ã€‚ 3. æœ‰åºæ€§æœ‰åºæ€§æ˜¯æŒ‡ï¼šåœ¨æœ¬çº¿ç¨‹å†…è§‚å¯Ÿï¼Œæ‰€æœ‰æ“ä½œéƒ½æ˜¯æœ‰åºçš„ã€‚åœ¨ä¸€ä¸ªçº¿ç¨‹è§‚å¯Ÿå¦ä¸€ä¸ªçº¿ç¨‹ï¼Œæ‰€æœ‰æ“ä½œéƒ½æ˜¯æ— åºçš„ï¼Œæ— åºæ˜¯å› ä¸ºå‘ç”Ÿäº†æŒ‡ä»¤é‡æ’åºã€‚åœ¨ Java å†…å­˜æ¨¡å‹ä¸­ï¼Œå…è®¸ç¼–è¯‘å™¨å’Œå¤„ç†å™¨å¯¹æŒ‡ä»¤è¿›è¡Œé‡æ’åºï¼Œé‡æ’åºè¿‡ç¨‹ä¸ä¼šå½±å“åˆ°å•çº¿ç¨‹ç¨‹åºçš„æ‰§è¡Œï¼Œå´ä¼šå½±å“åˆ°å¤šçº¿ç¨‹å¹¶å‘æ‰§è¡Œçš„æ­£ç¡®æ€§ã€‚ volatile å…³é”®å­—é€šè¿‡æ·»åŠ å†…å­˜å±éšœçš„æ–¹å¼æ¥ç¦æ­¢æŒ‡ä»¤é‡æ’ï¼Œå³é‡æ’åºæ—¶ä¸èƒ½æŠŠåé¢çš„æŒ‡ä»¤æ”¾åˆ°å†…å­˜å±éšœä¹‹å‰ã€‚ ä¹Ÿå¯ä»¥é€šè¿‡ synchronized æ¥ä¿è¯æœ‰åºæ€§ï¼Œå®ƒä¿è¯æ¯ä¸ªæ—¶åˆ»åªæœ‰ä¸€ä¸ªçº¿ç¨‹æ‰§è¡ŒåŒæ­¥ä»£ç ï¼Œç›¸å½“äºæ˜¯è®©çº¿ç¨‹é¡ºåºæ‰§è¡ŒåŒæ­¥ä»£ç ã€‚ å…ˆè¡Œå‘ç”ŸåŸåˆ™ä¸Šé¢æåˆ°äº†å¯ä»¥ç”¨ volatile å’Œ synchronized æ¥ä¿è¯æœ‰åºæ€§ã€‚é™¤æ­¤ä¹‹å¤–ï¼ŒJVM è¿˜è§„å®šäº†å…ˆè¡Œå‘ç”ŸåŸåˆ™ï¼Œè®©ä¸€ä¸ªæ“ä½œæ— éœ€æ§åˆ¶å°±èƒ½å…ˆäºå¦ä¸€ä¸ªæ“ä½œå®Œæˆã€‚ 1. å•ä¸€çº¿ç¨‹åŸåˆ™ Single Thread rule åœ¨ä¸€ä¸ªçº¿ç¨‹å†…ï¼Œåœ¨ç¨‹åºå‰é¢çš„æ“ä½œå…ˆè¡Œå‘ç”Ÿäºåé¢çš„æ“ä½œã€‚ ç®¡ç¨‹é”å®šè§„åˆ™ Monitor Lock Rule ä¸€ä¸ª unlock æ“ä½œå…ˆè¡Œå‘ç”Ÿäºåé¢å¯¹åŒä¸€ä¸ªé”çš„ lock æ“ä½œã€‚ 3. volatile å˜é‡è§„åˆ™ Volatile Variable Rule å¯¹ä¸€ä¸ª volatile å˜é‡çš„å†™æ“ä½œå…ˆè¡Œå‘ç”Ÿäºåé¢å¯¹è¿™ä¸ªå˜é‡çš„è¯»æ“ä½œã€‚ 4. çº¿ç¨‹å¯åŠ¨è§„åˆ™ Thread Start Rule Thread å¯¹è±¡çš„ start() æ–¹æ³•è°ƒç”¨å…ˆè¡Œå‘ç”Ÿäºæ­¤çº¿ç¨‹çš„æ¯ä¸€ä¸ªåŠ¨ä½œã€‚ 5. çº¿ç¨‹åŠ å…¥è§„åˆ™ Thread Join Rule Thread å¯¹è±¡çš„ç»“æŸå…ˆè¡Œå‘ç”Ÿäº join() æ–¹æ³•è¿”å›ã€‚ 6. çº¿ç¨‹ä¸­æ–­è§„åˆ™ Thread Interruption Rule å¯¹çº¿ç¨‹ interrupt() æ–¹æ³•çš„è°ƒç”¨å…ˆè¡Œå‘ç”Ÿäºè¢«ä¸­æ–­çº¿ç¨‹çš„ä»£ç æ£€æµ‹åˆ°ä¸­æ–­äº‹ä»¶çš„å‘ç”Ÿï¼Œå¯ä»¥é€šè¿‡ interrupted() æ–¹æ³•æ£€æµ‹åˆ°æ˜¯å¦æœ‰ä¸­æ–­å‘ç”Ÿã€‚ [7. å¯¹è±¡ç»ˆç»“è§„åˆ™ Finalizer Rule ä¸€ä¸ªå¯¹è±¡çš„åˆå§‹åŒ–å®Œæˆï¼ˆæ„é€ å‡½æ•°æ‰§è¡Œç»“æŸï¼‰å…ˆè¡Œå‘ç”Ÿäºå®ƒçš„ finalize() æ–¹æ³•çš„å¼€å§‹ã€‚ 8. ä¼ é€’æ€§ Transitivity å¦‚æœæ“ä½œ A å…ˆè¡Œå‘ç”Ÿäºæ“ä½œ Bï¼Œæ“ä½œ B å…ˆè¡Œå‘ç”Ÿäºæ“ä½œ Cï¼Œé‚£ä¹ˆæ“ä½œ A å…ˆè¡Œå‘ç”Ÿäºæ“ä½œ Cã€‚ å†…å­˜åˆ†åŒºå†…å­˜åˆ†åŒº: (æ€»å…±åˆ†ä¸º: ç¨‹åºè®¡æ•°å™¨, å †, æ ˆ, æ–¹æ³•åŒº, æœ¬åœ°æ–¹æ³•åŒº) çº¿ç¨‹ç§æœ‰åŒºåŸŸ:ç¨‹åºè®¡æ•°å™¨ã€Javaè™šæ‹Ÿæœºæ ˆã€æœ¬åœ°æ–¹æ³•æ ˆ å¦‚æœå½“å‰çº¿ç¨‹æ­£åœ¨æ‰§è¡Œçš„æ˜¯ä¸€ä¸ªJavaæ–¹æ³•ï¼Œè¿™ä¸ªè®¡æ•°å™¨è®°å½•çš„æ˜¯æ­£åœ¨æ‰§è¡Œçš„è™šæ‹Ÿæœºå­—èŠ‚ç æŒ‡ä»¤çš„åœ°å€ï¼›å¦‚æœæ­£åœ¨æ‰§è¡Œ çš„æ˜¯ä¸€ä¸ªNativeæ–¹æ³•ï¼Œè¿™ä¸ªè®¡æ•°å™¨å€¼ä¸ºç©ºã€‚ çº¿ç¨‹å…±äº«åŒºåŸŸ:Javaå †(å­˜å‚¨é™æ€æ–‡ä»¶, å˜é‡) , æ–¹æ³•åŒºã€è¿è¡Œæ—¶å¸¸é‡æ±  å½“çº¿ç¨‹ç»ˆæ­¢æ—¶ï¼Œä¸‰è€…ï¼ˆè™šæ‹Ÿæœºæ ˆï¼Œæœ¬åœ°æ–¹æ³•æ ˆå’Œç¨‹åºè®¡æ•°å™¨ï¼‰æ‰€å ç”¨çš„å†…å­˜ç©ºé—´ä¹Ÿä¼šè¢«é‡Šæ”¾æ‰, å› ä¸ºå®ƒä»¬æ˜¯éå…±äº«åŒº å†…å­˜æº¢å‡ºåŸå› :ç³»ç»Ÿä¸èƒ½å†åˆ†é…ä½ æ‰€éœ€çš„å†…å­˜ç©ºé—´ ä¸€æ¬¡æ€§åŠ è½½äº†è¿‡å¤šçš„æ•°æ® å¯¹è±¡ä¸èƒ½è¢«å›æ”¶ ä»£ç bugå¯¼è‡´æ­»å¾ªç¯ è§£å†³æ–¹æ¡ˆ: ä½¿ç”¨å†…å­˜åˆ†æå·¥å…·jstatåˆ†æåŸå›  è°ƒå¼æ˜¯å¦æ˜¯ä¸‰æ–¹è½¯ä»¶çš„æ¼æ´ è®¾ç½®å¯åŠ¨å†…å­˜çš„å¤§å° å†…å­˜æ³„æ¼åŸå› :å†…å­˜ä¸­æœ‰ä¸€å—ç©ºé—´æ— æ³•åœ¨è¢«ä½¿ç”¨,åˆä¸èƒ½è¢«æ¸…ç†æ‰,ç´¯ç§¯é‡å¤§äº†ä¹‹åå°±ä¼šå¯¼è‡´å†…å­˜æ³„æ¼ ä»£ç æ¼æ´å¯¼è‡´å¸¸å‘æ€§æˆ–è€…å¶å‘æ€§æ³„æ¼ å¯¹è±¡ä¸èƒ½è¢«å›æ”¶æ˜¯æ ¹æœ¬åŸå›  å†…å­˜æº¢å‡ºå’Œå†…å­˜æ³„éœ²çš„è”ç³»å†…å­˜æ³„éœ²ä¼šæœ€ç»ˆä¼šå¯¼è‡´å†…å­˜æº¢å‡ºã€‚ç›¸åŒç‚¹ï¼šéƒ½ä¼šå¯¼è‡´åº”ç”¨ç¨‹åºè¿è¡Œå‡ºç°é—®é¢˜ï¼Œæ€§èƒ½ä¸‹é™æˆ–æŒ‚èµ·ã€‚ä¸åŒç‚¹ï¼š 1) å†…å­˜æ³„éœ²æ˜¯å¯¼è‡´å†…å­˜æº¢å‡ºçš„åŸå› ä¹‹ä¸€ï¼Œå†…å­˜æ³„éœ²ç§¯ç´¯èµ·æ¥å°†å¯¼è‡´å†…å­˜æº¢å‡ºã€‚ 2) å†…å­˜æ³„éœ²å¯ä»¥é€šè¿‡å®Œå–„ä»£ç æ¥é¿å…ï¼Œå†… GCGCç®—æ³•å’Œæœºåˆ¶ æœºåˆ¶: æ ‡è®°æ¸…é™¤, å¼•ç”¨è®¡æ•°, åœæ­¢-å¤åˆ¶(ç¨‹åºæš‚åœæ‰§è¡Œ) ç®—æ³•: å¼•ç”¨è®¡æ•°æ³•, æ ¹æœç´¢ç®—æ³•, æ ‡è®°-æ¸…é™¤ç®—æ³•, å¤åˆ¶ç®—æ³• Copying, æ ‡è®°æ•´ç†ç®—æ³• GCç®—æ³•javaè¯­è¨€è§„èŒƒæ²¡æœ‰æ˜ç¡®çš„è¯´æ˜JVM ä½¿ç”¨å“ªç§åƒåœ¾å›æ”¶ç®—æ³•ï¼Œä½†æ˜¯ä»»ä½•ä¸€ç§åƒåœ¾å›æ”¶ç®—æ³•ä¸€èˆ¬è¦åšä¸¤ä»¶åŸºæœ¬äº‹æƒ…ï¼š ï¼ˆ1ï¼‰å‘ç°æ— ç”¨çš„ä¿¡æ¯å¯¹è±¡ï¼› ï¼ˆ2ï¼‰å›æ”¶å°†æ— ç”¨å¯¹è±¡å ç”¨çš„å†…å­˜ç©ºé—´ã€‚ä½¿è¯¥ç©ºé—´å¯è¢«ç¨‹åºå†æ¬¡ä½¿ç”¨ã€‚ 1. å¼•ç”¨è®¡æ•°æ³•å †ä¸­æ¯ä¸ªå¯¹è±¡å®ä¾‹éƒ½æœ‰ä¸€ä¸ªå¼•ç”¨è®¡æ•°ã€‚ä»»ä½•å¼•ç”¨è®¡æ•°å™¨ä¸º0çš„å¯¹è±¡å®ä¾‹å¯ä»¥è¢«å½“ä½œåƒåœ¾æ”¶é›†ã€‚å½“ä¸€ä¸ªå¯¹è±¡å®ä¾‹è¢«åƒåœ¾æ”¶é›†æ—¶ï¼Œå®ƒå¼•ç”¨çš„ä»»ä½•å¯¹è±¡å®ä¾‹çš„å¼•ç”¨è®¡æ•°å™¨å‡1ã€‚ ä¼˜ç‚¹:å¼•ç”¨è®¡æ•°å™¨å¯ä»¥å¾ˆå¿«çš„é¢æ‰§è¡Œ, äº¤ç»‡åœ¨ç¨‹åºè¿è¡Œä¸­,å¯¹ç¨‹åºéœ€è¦ä¸è¢«é•¿æ—¶é—´æ‰“æ–­çš„å®æ—¶ç¯å¢ƒæ¯”è¾ƒæœ‰åˆ© ç¼ºç‚¹:æ— æ³•æ£€æµ‹å‡ºå¾ªç¯å¼•ç”¨ã€‚å¦‚çˆ¶å¯¹è±¡æœ‰ä¸€ä¸ªå¯¹å­å¯¹è±¡çš„å¼•ç”¨ï¼Œå­å¯¹è±¡åè¿‡æ¥å¼•ç”¨çˆ¶å¯¹è±¡ã€‚è¿™æ ·ï¼Œä»–ä»¬çš„å¼•ç”¨è®¡æ•°æ°¸è¿œä¸å¯èƒ½ä¸º0. 123456789101112public class Main &#123; public static void main(String[] args) &#123; MyObject object1 = new MyObject(); MyObject object2 = new MyObject(); object1.object = object2; object2.object = object1; object1 = null; object2 = null; &#125;&#125; 2. tracingç®—æ³•(Tracing Collector) æˆ– æ ‡è®°-æ¸…é™¤ç®—æ³•(mark and sweep) ä»ä¸€ä¸ªèŠ‚ç‚¹GC ROOTå¼€å§‹ï¼Œå¯»æ‰¾å¯¹åº”çš„å¼•ç”¨èŠ‚ç‚¹ï¼Œæ‰¾åˆ°è¿™ä¸ªèŠ‚ç‚¹ä»¥åï¼Œç»§ç»­å¯»æ‰¾è¿™ä¸ªèŠ‚ç‚¹çš„å¼•ç”¨èŠ‚ç‚¹ï¼Œå½“æ‰€æœ‰çš„å¼•ç”¨èŠ‚ç‚¹å¯»æ‰¾å®Œæ¯•ä¹‹åï¼Œå‰©ä½™çš„èŠ‚ç‚¹åˆ™è¢«è®¤ä¸ºæ˜¯æ²¡æœ‰è¢«å¼•ç”¨åˆ°çš„èŠ‚ç‚¹ï¼Œå³æ— ç”¨çš„èŠ‚ç‚¹ã€‚ javaä¸­å¯ä½œä¸ºGC Rootçš„å¯¹è±¡æœ‰ 1.è™šæ‹Ÿæœºæ ˆä¸­å¼•ç”¨çš„å¯¹è±¡ï¼ˆæœ¬åœ°å˜é‡è¡¨ï¼‰ 2.æ–¹æ³•åŒºä¸­é™æ€å±æ€§å¼•ç”¨çš„å¯¹è±¡ 3.æ–¹æ³•åŒºä¸­å¸¸é‡å¼•ç”¨çš„å¯¹è±¡ 4.æœ¬åœ°æ–¹æ³•æ ˆä¸­å¼•ç”¨çš„å¯¹è±¡ï¼ˆNativeå¯¹è±¡) 2.2.1 æ ‡è®°-æ¸…é™¤ç®—æ³•æ ‡è®°-æ¸…é™¤ç®—æ³•é‡‡ç”¨ä»æ ¹é›†åˆè¿›è¡Œæ‰«æï¼Œå¯¹å­˜æ´»çš„å¯¹è±¡å¯¹è±¡æ ‡è®°ï¼Œæ ‡è®°å®Œæ¯•åï¼Œå†æ‰«ææ•´ä¸ªç©ºé—´ä¸­æœªè¢«æ ‡è®°çš„å¯¹è±¡ï¼Œè¿›è¡Œå›æ”¶ï¼Œå¦‚å›¾æ‰€ç¤º 2.2.2 compactingç®—æ³• æˆ– æ ‡è®°-æ•´ç†ç®—æ³•æ ‡è®°-æ•´ç†ç®—æ³•é‡‡ç”¨æ ‡è®°-æ¸…é™¤ç®—æ³•ä¸€æ ·çš„æ–¹å¼è¿›è¡Œå¯¹è±¡çš„æ ‡è®°ï¼Œä½†åœ¨æ¸…é™¤æ—¶ä¸åŒï¼Œåœ¨å›æ”¶ä¸å­˜æ´»çš„å¯¹è±¡å ç”¨çš„ç©ºé—´åï¼Œä¼šå°†æ‰€æœ‰çš„å­˜æ´»å¯¹è±¡å¾€å·¦ç«¯ç©ºé—²ç©ºé—´ç§»åŠ¨ï¼Œå¹¶æ›´æ–°å¯¹åº”çš„æŒ‡é’ˆ,è§£å†³äº†å†…å­˜ç¢ç‰‡çš„é—®é¢˜. 2.2.3copyingç®—æ³•(Compacting Collector)åŸºäºcopyingç®—æ³•çš„åƒåœ¾ æ”¶é›†å°±ä»æ ¹é›†ä¸­æ‰«ææ´»åŠ¨å¯¹è±¡ï¼Œå¹¶å°†æ¯ä¸ª æ´»åŠ¨å¯¹è±¡å¤åˆ¶åˆ°ç©ºé—²é¢(ä½¿å¾—æ´»åŠ¨å¯¹è±¡æ‰€å çš„å†…å­˜ä¹‹é—´æ²¡æœ‰ç©ºé—²æ´)ï¼Œè¿™æ ·ç©ºé—²é¢å˜æˆäº†å¯¹è±¡é¢ï¼ŒåŸæ¥çš„å¯¹è±¡é¢å˜æˆäº†ç©ºé—²é¢ï¼Œç¨‹åºä¼šåœ¨æ–°çš„å¯¹è±¡é¢ä¸­åˆ†é…å†…å­˜ã€‚ä¸€ç§å…¸å‹çš„åŸºäºcopingç®—æ³•çš„åƒåœ¾å›æ”¶æ˜¯stop-and-copyç®—æ³•ï¼Œå®ƒå°†å †åˆ†æˆå¯¹è±¡é¢å’Œç©ºé—²åŒºåŸŸé¢ï¼Œåœ¨å¯¹è±¡é¢ä¸ç©ºé—²åŒºåŸŸé¢çš„åˆ‡æ¢è¿‡ç¨‹ä¸­ï¼Œ==ç¨‹åºæš‚åœæ‰§è¡Œ==ã€‚ 2.3.4 generationç®—æ³•(Generational Collector)åˆ†ä»£å›æ”¶åˆ†ä»£çš„åƒåœ¾å›æ”¶ç­–ç•¥ï¼Œæ˜¯åŸºäºè¿™æ ·ä¸€ä¸ªäº‹å®ï¼šä¸åŒçš„å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸæ˜¯ä¸ä¸€æ ·çš„ã€‚å› æ­¤ï¼Œä¸åŒç”Ÿå‘½å‘¨æœŸçš„å¯¹è±¡å¯ä»¥é‡‡å–ä¸åŒçš„å›æ”¶ç®—æ³•ï¼Œä»¥ä¾¿æé«˜å›æ”¶æ•ˆç‡ã€‚ Javaä¸­çš„å¯¹æ˜¯jvmæ‰€ç®¡ç†çš„æœ€å¤§çš„ä¸€å—å†…å­˜ç©ºé—´, ä¸»è¦ç”¨äºç²—æ”¾å„ç§ç±»çš„å®ä¾‹å¯¹è±¡. åœ¨Javaä¸­å †è¢«åˆ†æˆä¸¤ä¸ªä¸åŒçš„åŒºåŸŸ: 1. æ–°ç”Ÿä»£(young) æ‰€æœ‰æ–°ç”Ÿæˆçš„å¯¹è±¡é¦–å…ˆéƒ½æ˜¯æ”¾åœ¨å¹´è½»ä»£çš„ã€‚å¹´è½»ä»£çš„ç›®æ ‡å°±æ˜¯å°½å¯èƒ½å¿«é€Ÿçš„æ”¶é›†æ‰é‚£äº›ç”Ÿå‘½å‘¨æœŸçŸ­çš„å¯¹è±¡ã€‚ å­˜åœ¨åŒºåŸŸ:Eden, From Survivor, To Survivor å›æ”¶æ—¶å…ˆå°†edenåŒºå­˜æ´»å¯¹è±¡å¤åˆ¶åˆ°ä¸€ä¸ªsurvivor0åŒºï¼Œç„¶åæ¸…ç©ºedenåŒºï¼Œå½“è¿™ä¸ªsurvivor0åŒºä¹Ÿå­˜æ”¾æ»¡äº†æ—¶ï¼Œåˆ™å°†edenåŒºå’Œsurvivor0åŒºå­˜æ´»å¯¹è±¡å¤åˆ¶åˆ°å¦ä¸€ä¸ªsurvivor1åŒºï¼Œç„¶åæ¸…ç©ºedenå’Œè¿™ä¸ªsurvivor0åŒºï¼Œæ­¤æ—¶survivor0åŒºæ˜¯ç©ºçš„ï¼Œç„¶åå°†survivor0åŒºå’Œsurvivor1åŒºäº¤æ¢ï¼Œå³ä¿æŒsurvivor1åŒºä¸ºç©ºï¼Œ å¦‚æ­¤å¾€å¤ã€‚ å½“survivor1åŒºä¸è¶³ä»¥å­˜æ”¾ edenå’Œsurvivor0çš„å­˜æ´»å¯¹è±¡æ—¶ï¼Œå°±å°†å­˜æ´»å¯¹è±¡ç›´æ¥å­˜æ”¾åˆ°è€å¹´ä»£ã€‚è‹¥æ˜¯è€å¹´ä»£ä¹Ÿæ»¡äº†å°±ä¼šè§¦å‘ä¸€æ¬¡Full GCï¼Œä¹Ÿå°±æ˜¯==æ–°ç”Ÿä»£ã€è€å¹´ä»£éƒ½è¿›è¡Œå›æ”¶== 2. è€å¹´ä»£(old) åœ¨å¹´è½»ä»£ä¸­ç»å†äº†Næ¬¡åƒåœ¾å›æ”¶åä»ç„¶å­˜æ´»çš„å¯¹è±¡ï¼Œå°±ä¼šè¢«æ”¾åˆ°å¹´è€ä»£ä¸­ã€‚å› æ­¤ï¼Œå¯ä»¥è®¤ä¸ºå¹´è€ä»£ä¸­å­˜æ”¾çš„éƒ½æ˜¯ä¸€äº›ç”Ÿå‘½å‘¨æœŸè¾ƒé•¿çš„å¯¹è±¡ã€‚ å½“è€å¹´ä»£å†…å­˜æ»¡æ—¶è§¦å‘Major GCå³Full GCï¼ŒFull GCå‘ç”Ÿé¢‘ç‡æ¯”è¾ƒä½ï¼Œè€å¹´ä»£å¯¹è±¡å­˜æ´»æ—¶é—´æ¯”è¾ƒé•¿ï¼Œå­˜æ´»ç‡æ ‡è®°é«˜ã€‚ å †å¤§å°=æ–°ç”Ÿä»£+è€å¹´ä»£, å †çš„å¤§å°å¯ä»¥é€šè¿‡å‚æ•° â€“Xmsã€-Xmx æ¥æŒ‡å®šã€‚ JVM æ¯æ¬¡åªä¼šä½¿ç”¨ Eden å’Œå…¶ä¸­çš„ä¸€å— Survivor åŒºåŸŸæ¥ä¸ºå¯¹è±¡æœåŠ¡ï¼Œæ‰€ä»¥æ— è®ºä»€ä¹ˆæ—¶å€™ï¼Œæ€»æ˜¯æœ‰ä¸€å— Survivor åŒºåŸŸæ˜¯ç©ºé—²ç€çš„ã€‚å› æ­¤ï¼Œæ–°ç”Ÿä»£å®é™…å¯ç”¨çš„å†…å­˜ç©ºé—´ä¸º 9/10 ( å³90% )çš„æ–°ç”Ÿä»£ç©ºé—´ã€‚ æŒä¹…ä»£ï¼ˆPermanent Generationï¼‰ ç”¨äºå­˜æ”¾é™æ€æ–‡ä»¶ï¼Œå¦‚Javaç±»ã€æ–¹æ³•ç­‰ã€‚æŒä¹…ä»£å¯¹åƒåœ¾å›æ”¶æ²¡æœ‰æ˜¾è‘—å½±å“ï¼Œä½†æ˜¯æœ‰äº›åº”ç”¨å¯èƒ½åŠ¨æ€ç”Ÿæˆæˆ–è€…è°ƒç”¨ä¸€äº›classï¼Œä¾‹å¦‚Hibernate ç­‰ï¼Œåœ¨è¿™ç§æ—¶å€™éœ€è¦è®¾ç½®ä¸€ä¸ªæ¯”è¾ƒå¤§çš„æŒä¹…ä»£ç©ºé—´æ¥å­˜æ”¾è¿™äº›è¿è¡Œè¿‡ç¨‹ä¸­æ–°å¢çš„ç±»ã€‚ GCï¼ˆåƒåœ¾æ”¶é›†å™¨ï¼‰ Serialæ”¶é›†å™¨ï¼ˆå¤åˆ¶ç®—æ³•) æ–°ç”Ÿä»£å•çº¿ç¨‹æ”¶é›†å™¨ï¼Œæ ‡è®°å’Œæ¸…ç†éƒ½æ˜¯å•çº¿ç¨‹ï¼Œä¼˜ç‚¹æ˜¯ç®€å•é«˜æ•ˆã€‚ Serial Oldæ”¶é›†å™¨(æ ‡è®°-æ•´ç†ç®—æ³•) è€å¹´ä»£å•çº¿ç¨‹æ”¶é›†å™¨ï¼ŒSerialæ”¶é›†å™¨çš„è€å¹´ä»£ç‰ˆæœ¬ã€‚ ParNewæ”¶é›†å™¨(åœæ­¢-å¤åˆ¶ç®—æ³•) æ–°ç”Ÿä»£æ”¶é›†å™¨ï¼Œå¯ä»¥è®¤ä¸ºæ˜¯Serialæ”¶é›†å™¨çš„å¤šçº¿ç¨‹ç‰ˆæœ¬,åœ¨å¤šæ ¸CPUç¯å¢ƒä¸‹æœ‰ç€æ¯”Serialæ›´å¥½çš„è¡¨ç°ã€‚ Parallel Scavengeæ”¶é›†å™¨(åœæ­¢-å¤åˆ¶ç®—æ³•) å¹¶è¡Œæ”¶é›†å™¨ï¼Œè¿½æ±‚é«˜ååé‡ï¼Œé«˜æ•ˆåˆ©ç”¨CPUã€‚ååé‡ä¸€èˆ¬ä¸º99%ï¼Œ ååé‡= ç”¨æˆ·çº¿ç¨‹æ—¶é—´/(ç”¨æˆ·çº¿ç¨‹æ—¶é—´+GCçº¿ç¨‹æ—¶é—´)ã€‚é€‚åˆåå°åº”ç”¨ç­‰å¯¹äº¤äº’ç›¸åº”è¦æ±‚ä¸é«˜çš„åœºæ™¯ã€‚ Parallel Oldæ”¶é›†å™¨(åœæ­¢-å¤åˆ¶ç®—æ³•) Parallel Scavengeæ”¶é›†å™¨çš„è€å¹´ä»£ç‰ˆæœ¬ï¼Œå¹¶è¡Œæ”¶é›†å™¨ï¼Œååé‡ä¼˜å…ˆ CMS(Concurrent Mark Sweep)æ”¶é›†å™¨ï¼ˆæ ‡è®°-æ¸…ç†ç®—æ³•ï¼‰ é«˜å¹¶å‘ã€ä½åœé¡¿ï¼Œè¿½æ±‚æœ€çŸ­GCå›æ”¶åœé¡¿æ—¶é—´ï¼Œcpuå ç”¨æ¯”è¾ƒé«˜ï¼Œå“åº”æ—¶é—´å¿«ï¼Œåœé¡¿æ—¶é—´çŸ­ï¼Œå¤šæ ¸cpu è¿½æ±‚é«˜å“åº”æ—¶é—´çš„é€‰æ‹© GCçš„æ‰§è¡Œæœºåˆ¶ç”±äºå¯¹è±¡è¿›è¡Œäº†åˆ†ä»£å¤„ç†ï¼Œå› æ­¤åƒåœ¾å›æ”¶åŒºåŸŸã€æ—¶é—´ä¹Ÿä¸ä¸€æ ·ã€‚GCæœ‰ä¸¤ç§ç±»å‹ï¼šScavenge GCå’ŒFull GCã€‚ Scavenge GCä¸€èˆ¬æƒ…å†µä¸‹ï¼Œå½“æ–°å¯¹è±¡ç”Ÿæˆï¼Œå¹¶ä¸”åœ¨Edenç”³è¯·ç©ºé—´å¤±è´¥æ—¶ï¼Œå°±ä¼šè§¦å‘Scavenge GCï¼Œå¯¹EdenåŒºåŸŸè¿›è¡ŒGCï¼Œæ¸…é™¤éå­˜æ´»å¯¹è±¡ï¼Œå¹¶ä¸”æŠŠå°šä¸”å­˜æ´»çš„å¯¹è±¡ç§»åŠ¨åˆ°SurvivoråŒºã€‚ç„¶åæ•´ç†Survivorçš„ä¸¤ä¸ªåŒºã€‚è¿™ç§æ–¹å¼çš„GCæ˜¯å¯¹å¹´è½»ä»£çš„EdenåŒºè¿›è¡Œï¼Œä¸ä¼šå½±å“åˆ°å¹´è€ä»£ã€‚å› ä¸ºå¤§éƒ¨åˆ†å¯¹è±¡éƒ½æ˜¯ä»EdenåŒºå¼€å§‹çš„ï¼ŒåŒæ—¶EdenåŒºä¸ä¼šåˆ†é…çš„å¾ˆå¤§ï¼Œæ‰€ä»¥EdenåŒºçš„GCä¼šé¢‘ç¹è¿›è¡Œã€‚å› è€Œï¼Œä¸€èˆ¬åœ¨è¿™é‡Œéœ€è¦ä½¿ç”¨é€Ÿåº¦å¿«ã€æ•ˆç‡é«˜çš„ç®—æ³•ï¼Œä½¿Edenå»èƒ½å°½å¿«ç©ºé—²å‡ºæ¥ã€‚ Full GCå¯¹æ•´ä¸ªå †è¿›è¡Œæ•´ç†ï¼ŒåŒ…æ‹¬Youngã€Tenuredå’ŒPermã€‚Full GCå› ä¸ºéœ€è¦å¯¹æ•´ä¸ªå †è¿›è¡Œå›æ”¶ï¼Œæ‰€ä»¥æ¯”Scavenge GCè¦æ…¢ï¼Œå› æ­¤åº”è¯¥å°½å¯èƒ½å‡å°‘Full GCçš„æ¬¡æ•°ã€‚åœ¨å¯¹JVMè°ƒä¼˜çš„è¿‡ç¨‹ä¸­ï¼Œå¾ˆå¤§ä¸€éƒ¨åˆ†å·¥ä½œå°±æ˜¯å¯¹äºFullGCçš„è°ƒèŠ‚ã€‚æœ‰å¦‚ä¸‹åŸå› å¯èƒ½å¯¼è‡´Full GCï¼š 1.å¹´è€ä»£ï¼ˆTenuredï¼‰è¢«å†™æ»¡ 2.æŒä¹…ä»£ï¼ˆPermï¼‰è¢«å†™æ»¡ 3.System.gc()è¢«æ˜¾ç¤ºè°ƒç”¨ 4.ä¸Šä¸€æ¬¡GCä¹‹åHeapçš„å„åŸŸåˆ†é…ç­–ç•¥åŠ¨æ€å˜åŒ– Javaæœ‰äº†GCåŒæ ·ä¼šå‡ºç°å†…å­˜æ³„éœ²é—®é¢˜ 1.é™æ€é›†åˆç±»åƒHashMapã€Vectorç­‰çš„ä½¿ç”¨æœ€å®¹æ˜“å‡ºç°å†…å­˜æ³„éœ²ï¼Œè¿™äº›é™æ€å˜é‡çš„ç”Ÿå‘½å‘¨æœŸå’Œåº”ç”¨ç¨‹åºä¸€è‡´ï¼Œæ‰€æœ‰çš„å¯¹è±¡Objectä¹Ÿä¸èƒ½è¢«é‡Šæ”¾ï¼Œå› ä¸ºä»–ä»¬ä¹Ÿå°†ä¸€ç›´è¢«Vectorç­‰åº”ç”¨ç€ã€‚ 2.å„ç§è¿æ¥ï¼Œæ•°æ®åº“è¿æ¥ï¼Œç½‘ç»œè¿æ¥ï¼ŒIOè¿æ¥ç­‰æ²¡æœ‰æ˜¾ç¤ºè°ƒç”¨closeå…³é—­ï¼Œä¸è¢«GCå›æ”¶å¯¼è‡´å†…å­˜æ³„éœ²ã€‚ 3.ç›‘å¬å™¨çš„ä½¿ç”¨ï¼Œåœ¨é‡Šæ”¾å¯¹è±¡çš„åŒæ—¶æ²¡æœ‰ç›¸åº”åˆ é™¤ç›‘å¬å™¨çš„æ—¶å€™ä¹Ÿå¯èƒ½å¯¼è‡´å†…å­˜æ³„éœ²ã€‚ JVMä¸­çš„å®‰å…¨ç‚¹ åœ¨ JVM ä¸­å¦‚ä½•åˆ¤æ–­å¯¹è±¡å¯ä»¥è¢«å›æ”¶ ä¸€æ–‡ä¸­ï¼Œæˆ‘ä»¬çŸ¥é“ HotSpot è™šæ‹Ÿæœºé‡‡å–çš„æ˜¯å¯è¾¾æ€§åˆ†æç®—æ³•ã€‚å³é€šè¿‡ GC Roots æšä¸¾åˆ¤å®šå¾…å›æ”¶çš„å¯¹è±¡ã€‚ é‚£ä¹ˆï¼Œé¦–å…ˆè¦æ‰¾åˆ°å“ªäº›æ˜¯ GC Rootsã€‚ æœ‰ä¸¤ç§æŸ¥æ‰¾ GC Roots çš„æ–¹æ³•ï¼š ä¸€ç§æ˜¯éå†æ–¹æ³•åŒºå’Œæ ˆåŒºæŸ¥æ‰¾ï¼ˆä¿å®ˆå¼ GCï¼‰ã€‚ ä¸€ç§æ˜¯é€šè¿‡ OopMap æ•°æ®ç»“æ„æ¥è®°å½• GC Roots çš„ä½ç½®ï¼ˆå‡†ç¡®å¼ GCï¼‰ã€‚ å¾ˆæ˜æ˜¾ï¼Œä¿å®ˆå¼ GC çš„æˆæœ¬å¤ªé«˜ã€‚å‡†ç¡®å¼ GC çš„ä¼˜ç‚¹å°±æ˜¯èƒ½å¤Ÿè®©è™šæ‹Ÿæœºå¿«é€Ÿå®šä½åˆ° GC Rootsã€‚ å¯¹åº” OopMap çš„ä½ç½®å³å¯ä½œä¸ºä¸€ä¸ªå®‰å…¨ç‚¹ï¼ˆSafe Pointï¼‰ã€‚ åœ¨æ‰§è¡Œ GC æ“ä½œæ—¶ï¼Œæ‰€æœ‰çš„å·¥ä½œçº¿ç¨‹å¿…é¡»åœé¡¿ï¼Œè¿™å°±æ˜¯æ‰€è°“çš„â€Stop-The-Worldâ€ã€‚ ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ å› ä¸ºå¯è¾¾æ€§åˆ†æç®—æ³•å¿…é¡»æ˜¯åœ¨ä¸€ä¸ªç¡®ä¿ä¸€è‡´æ€§çš„å†…å­˜å¿«ç…§ä¸­è¿›è¡Œã€‚å¦‚æœåœ¨åˆ†æçš„è¿‡ç¨‹ä¸­å¯¹è±¡å¼•ç”¨å…³ç³»è¿˜åœ¨ä¸æ–­å˜åŒ–ï¼Œåˆ†æç»“æœçš„å‡†ç¡®æ€§å°±ä¸èƒ½ä¿è¯ã€‚ å®‰å…¨ç‚¹æ„å‘³ç€åœ¨è¿™ä¸ªç‚¹æ—¶ï¼Œæ‰€æœ‰å·¥ä½œçº¿ç¨‹çš„çŠ¶æ€æ˜¯ç¡®å®šçš„ï¼ŒJVM å°±å¯ä»¥å®‰å…¨åœ°æ‰§è¡Œ GC ã€‚ å¦‚ä½•é€‰å®šå®‰å…¨ç‚¹å®‰å…¨ç‚¹å¤ªå¤šï¼ŒGC è¿‡äºé¢‘ç¹ï¼Œå¢å¤§è¿è¡Œæ—¶è´Ÿè·ï¼›å®‰å…¨ç‚¹å¤ªå°‘ï¼ŒGC ç­‰å¾…æ—¶é—´å¤ªé•¿ã€‚ ä¸€èˆ¬ä¼šåœ¨å¦‚ä¸‹å‡ ä¸ªä½ç½®é€‰æ‹©å®‰å…¨ç‚¹ï¼š å¾ªç¯çš„æœ«å°¾ æ–¹æ³•ä¸´è¿”å›å‰ è°ƒç”¨æ–¹æ³•ä¹‹å æŠ›å¼‚å¸¸çš„ä½ç½® ä¸ºä»€ä¹ˆé€‰å®šè¿™äº›ä½ç½®ä½œä¸ºå®‰å…¨ç‚¹ï¼š ä¸»è¦çš„ç›®çš„å°±æ˜¯é¿å…ç¨‹åºé•¿æ—¶é—´æ— æ³•è¿›å…¥ Safe Pointã€‚æ¯”å¦‚ JVM åœ¨åš GC ä¹‹å‰è¦ç­‰æ‰€æœ‰çš„åº”ç”¨çº¿ç¨‹è¿›å…¥å®‰å…¨ç‚¹ï¼Œå¦‚æœæœ‰ä¸€ä¸ªçº¿ç¨‹ä¸€ç›´æ²¡æœ‰è¿›å…¥å®‰å…¨ç‚¹ï¼Œå°±ä¼šå¯¼è‡´ GC æ—¶ JVM åœé¡¿æ—¶é—´å»¶é•¿ã€‚æ¯”å¦‚è¿™é‡Œï¼Œè¶…å¤§çš„å¾ªç¯å¯¼è‡´æ‰§è¡Œ GC ç­‰å¾…æ—¶é—´è¿‡é•¿ã€‚ å¦‚ä½•åœ¨ GC å‘ç”Ÿæ—¶ï¼Œæ‰€æœ‰çº¿ç¨‹éƒ½è·‘åˆ°æœ€è¿‘çš„ Safe Point ä¸Šå†åœä¸‹æ¥ï¼Ÿä¸»è¦æœ‰ä¸¤ç§æ–¹å¼ï¼š æŠ¢æ–­å¼ä¸­æ–­ï¼šåœ¨ GC å‘ç”Ÿæ—¶ï¼Œé¦–å…ˆä¸­æ–­æ‰€æœ‰çº¿ç¨‹ï¼Œå¦‚æœå‘ç°çº¿ç¨‹æœªæ‰§è¡Œåˆ° Safe Pointï¼Œå°±æ¢å¤çº¿ç¨‹è®©å…¶è¿è¡Œåˆ° Safe Point ä¸Šã€‚ ä¸»åŠ¨å¼ä¸­æ–­ï¼šåœ¨ GC å‘ç”Ÿæ—¶ï¼Œä¸ç›´æ¥æ“ä½œçº¿ç¨‹ä¸­æ–­ï¼Œè€Œæ˜¯ç®€å•åœ°è®¾ç½®ä¸€ä¸ªæ ‡å¿—ï¼Œè®©å„ä¸ªçº¿ç¨‹æ‰§è¡Œæ—¶ä¸»åŠ¨è½®è¯¢è¿™ä¸ªæ ‡å¿—ï¼Œå‘ç°ä¸­æ–­æ ‡å¿—ä¸ºçœŸæ—¶å°±è‡ªå·±ä¸­æ–­æŒ‚èµ·ã€‚ JVM é‡‡å–çš„å°±æ˜¯ä¸»åŠ¨å¼ä¸­æ–­ã€‚è½®è¯¢æ ‡å¿—çš„åœ°æ–¹å’Œå®‰å…¨ç‚¹æ˜¯é‡åˆçš„ã€‚ å®‰å…¨åŒºåŸŸåˆæ˜¯ä»€ä¹ˆï¼ŸSafe Point æ˜¯å¯¹æ­£åœ¨æ‰§è¡Œçš„çº¿ç¨‹è®¾å®šçš„, å¦‚æœä¸€ä¸ªçº¿ç¨‹å¤„äº Sleep æˆ–ä¸­æ–­çŠ¶æ€ï¼Œå®ƒå°±ä¸èƒ½å“åº” JVM çš„ä¸­æ–­è¯·æ±‚ï¼Œå†è¿è¡Œåˆ° Safe Point ä¸Šã€‚å› æ­¤ JVM å¼•å…¥äº† Safe Regionã€‚ Safe Region æ˜¯æŒ‡åœ¨ä¸€æ®µä»£ç ç‰‡æ®µä¸­ï¼Œå¼•ç”¨å…³ç³»ä¸ä¼šå‘ç”Ÿå˜åŒ–ã€‚åœ¨è¿™ä¸ªåŒºåŸŸå†…çš„ä»»æ„åœ°æ–¹å¼€å§‹ GC éƒ½æ˜¯å®‰å…¨çš„ã€‚çº¿ç¨‹åœ¨è¿›å…¥ Safe Region çš„æ—¶å€™å…ˆæ ‡è®°è‡ªå·±å·²è¿›å…¥äº† Safe Regionï¼Œç­‰åˆ°è¢«å”¤é†’æ—¶å‡†å¤‡ç¦»å¼€ Safe Region æ—¶ï¼Œå…ˆæ£€æŸ¥èƒ½å¦ç¦»å¼€ï¼Œå¦‚æœ GC å®Œæˆäº†ï¼Œé‚£ä¹ˆçº¿ç¨‹å¯ä»¥ç¦»å¼€ï¼Œå¦åˆ™å®ƒå¿…é¡»ç­‰å¾…ç›´åˆ°æ”¶åˆ°å®‰å…¨ç¦»å¼€çš„ä¿¡å·ä¸ºæ­¢ã€‚","categories":[{"name":"Java","slug":"Java","permalink":"/categories/Java/"}],"tags":[{"name":"Java","slug":"Java","permalink":"/tags/Java/"},{"name":"IT","slug":"IT","permalink":"/tags/IT/"},{"name":"æŠ€æœ¯ç¬”è®°","slug":"æŠ€æœ¯ç¬”è®°","permalink":"/tags/%E6%8A%80%E6%9C%AF%E7%AC%94%E8%AE%B0/"},{"name":"Job","slug":"Job","permalink":"/tags/Job/"}]},{"title":"ZooKeeperé¢è¯•","slug":"ZooKeeperé¢è¯•","date":"2019-10-20T11:51:12.000Z","updated":"2019-10-20T06:06:22.160Z","comments":true,"path":"2019/10/20/ZooKeeperé¢è¯•/","link":"","permalink":"/2019/10/20/ZooKeeper%E9%9D%A2%E8%AF%95/","excerpt":"","text":"ZooKeeperé¢è¯•1. ä»€ä¹ˆæ˜¯dubbo?Dubboæ˜¯é˜¿é‡Œå·´å·´SOAæœåŠ¡åŒ–æ²»ç†æ–¹æ¡ˆçš„æ ¸å¿ƒæ¡†æ¶ï¼Œæ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼æœåŠ¡æ¡†æ¶ï¼Œè‡´åŠ›äºæä¾›é«˜æ€§èƒ½å’Œé€æ˜åŒ–çš„RPCè¿œç¨‹æœåŠ¡è°ƒç”¨æ–¹æ¡ˆï¼Œä»¥åŠSOAæœåŠ¡æ²»ç†æ–¹æ¡ˆã€‚ Dubboæä¾›ä¸‰ä¸ªå…³é”®åŠŸèƒ½ åŒ…æ‹¬åŸºäºæ¥å£çš„è¿œç¨‹è°ƒç”¨ å®¹é”™å’Œè´Ÿè½½å¹³è¡¡ è‡ªåŠ¨æœåŠ¡æ³¨å†Œå’Œå‘ç°ã€‚ 2. æµ‹è¯•å’Œç”Ÿäº§å…¬ç”¨ä¸€å¥—zookeeperï¼Œæ€ä¹ˆä¿è¯æ¶ˆè´¹ä¸å†²çª? dubboç™½åå•(Filterè¿‡æ»¤å™¨) æœåŠ¡åˆ†ç»„ 1234567&lt;!--æœåŠ¡--&gt;&lt;dubbo:service group=\"feedback\" interface=\"com.xxx.IndexService\" /&gt;&lt;dubbo:service group=\"member\" interface=\"com.xxx.IndexService\" /&gt;&lt;!--å¼•ç”¨--&gt;&lt;dubbo:reference id=\"feedbackIndexService\" group=\"feedback\" interface=\"com.xxx.IndexService\" /&gt;&lt;dubbo:reference id=\"memberIndexService\" group=\"member\" interface=\"com.xxx.IndexService\" /&gt; å¤šç‰ˆæœ¬ 1&lt;dubbo:service interface=\"com.foo.BarService\" version=\"1.0.0\" /&gt; ç¬¬ä¸€ç§æ–¹æ¡ˆï¼šå®ç°com.alibaba.dubbo.rpc.Filteræ¥å£ï¼š public class AuthorityFilter implements Filter { private static final Logger LOGGER = LoggerFactory.getLogger(AuthorityFilter.class); private IpWhiteList ipWhiteList; //dubboé€šè¿‡setteræ–¹å¼è‡ªåŠ¨æ³¨å…¥ public void setIpWhiteList(IpWhiteList ipWhiteList) { this.ipWhiteList = ipWhiteList; } @Override public Result invoke(Invoker&lt;?&gt; invoker, Invocation invocation) throws RpcException { if (!ipWhiteList.isEnabled()) { LOGGER.debug(&quot;ç™½åå•ç¦ç”¨&quot;); return invoker.invoke(invocation); } String clientIp = RpcContext.getContext().getRemoteHost(); LOGGER.debug(&quot;è®¿é—®ipä¸º{}&quot;, clientIp); List&lt;String&gt; allowedIps = ipWhiteList.getAllowedIps(); if (allowedIps.contains(clientIp)) { return invoker.invoke(invocation); } else { return new RpcResult(); } } æ³¨æ„ï¼šåªèƒ½é€šè¿‡setteræ–¹å¼æ¥æ³¨å…¥å…¶ä»–çš„beanï¼Œä¸”ä¸è¦æ ‡æ³¨æ³¨è§£ï¼dubboè‡ªå·±ä¼šå¯¹è¿™äº›beanè¿›è¡Œæ³¨å…¥ï¼Œä¸éœ€è¦å†æ ‡æ³¨@Resourceè®©Springæ³¨å…¥åœ¨resourcesç›®å½•ä¸‹æ·»åŠ çº¯æ–‡æœ¬æ–‡ä»¶META-INF/dubbo/com.alibaba.dubbo.rpc.Filterï¼Œå†…å®¹å¦‚ä¸‹ï¼š xxxFilter=com.xxx.AuthorityFilterä¿®æ”¹dubboçš„provideré…ç½®æ–‡ä»¶ï¼Œåœ¨dubbo:providerä¸­æ·»åŠ é…ç½®çš„filterï¼Œ å†…å®¹å¦‚ä¸‹ï¼š &lt;dubbo:provider filter=&quot;xxxFilter&quot; /&gt; è¿™æ ·å°±å¯ä»¥å®ç°dubboæ¥å£çš„IPç™½åå•åŠŸèƒ½äº†ã€‚ å‡ºè‡ªhttps://www.cnblogs.com/wangzhongqiu/archive/2017/09/22/7575759.html 3. ZooKeeperæ˜¯ä»€ä¹ˆï¼Ÿ Zookeeperæ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼çš„ï¼Œå¼€æ”¾æºç çš„åˆ†å¸ƒå¼åº”ç”¨ç¨‹åºåè°ƒæœåŠ¡ï¼Œæ˜¯Googleçš„Chubbyä¸€ä¸ªå¼€æºçš„å®ç°ï¼Œå®ƒæ˜¯é›†ç¾¤çš„ç®¡ç†è€…ï¼Œç›‘è§†ç€é›†ç¾¤ä¸­å„ä¸ªèŠ‚ç‚¹çš„çŠ¶æ€æ ¹æ®èŠ‚ç‚¹æäº¤çš„åé¦ˆè¿›è¡Œä¸‹ä¸€æ­¥åˆç†æ“ä½œã€‚æœ€ç»ˆï¼Œå°†ç®€å•æ˜“ç”¨çš„æ¥å£å’Œæ€§èƒ½é«˜æ•ˆã€åŠŸèƒ½ç¨³å®šçš„ç³»ç»Ÿæä¾›ç»™ç”¨æˆ·ã€‚ å®¢æˆ·ç«¯çš„è¯»è¯·æ±‚å¯ä»¥è¢«é›†ç¾¤ä¸­çš„ä»»æ„ä¸€å°æœºå™¨å¤„ç†ï¼Œå¦‚æœè¯»è¯·æ±‚åœ¨èŠ‚ç‚¹ä¸Šæ³¨å†Œäº†ç›‘å¬å™¨ï¼Œè¿™ä¸ªç›‘å¬å™¨ä¹Ÿæ˜¯ç”±æ‰€è¿æ¥çš„zookeeperæœºå™¨æ¥å¤„ç†ã€‚å¯¹äºå†™è¯·æ±‚ï¼Œè¿™äº›è¯·æ±‚ä¼šåŒæ—¶å‘ç»™å…¶ä»–zookeeperæœºå™¨å¹¶ä¸”è¾¾æˆä¸€è‡´åï¼Œè¯·æ±‚æ‰ä¼šè¿”å›æˆåŠŸã€‚å› æ­¤ï¼Œéšç€zookeeperçš„é›†ç¾¤æœºå™¨å¢å¤šï¼Œè¯»è¯·æ±‚çš„ååä¼šæé«˜ä½†æ˜¯å†™è¯·æ±‚çš„ååä¼šä¸‹é™ã€‚æœ‰åºæ€§æ˜¯zookeeperä¸­éå¸¸é‡è¦çš„ä¸€ä¸ªç‰¹æ€§ï¼Œæ‰€æœ‰çš„æ›´æ–°éƒ½æ˜¯å…¨å±€æœ‰åºçš„ï¼Œæ¯ä¸ªæ›´æ–°éƒ½æœ‰ä¸€ä¸ªå”¯ä¸€çš„æ—¶é—´æˆ³ï¼Œè¿™ä¸ªæ—¶é—´æˆ³ç§°ä¸ºzxidï¼ˆ==Zookeeper Transaction Id==ï¼‰ã€‚è€Œè¯»è¯·æ±‚åªä¼šç›¸å¯¹äºæ›´æ–°æœ‰åºï¼Œä¹Ÿå°±æ˜¯è¯»è¯·æ±‚çš„è¿”å›ç»“æœä¸­ä¼šå¸¦æœ‰è¿™ä¸ªzookeeperæœ€æ–°çš„zxidã€‚ åº”ç”¨åœºæ™¯Zookeeperçš„åŠŸèƒ½å¾ˆå¼ºå¤§ï¼Œåº”ç”¨åœºæ™¯å¾ˆå¤šï¼Œç»“åˆæˆ‘å®é™…å·¥ä½œä¸­ä½¿ç”¨Dubboæ¡†æ¶çš„æƒ…å†µï¼ŒZookeeperä¸»è¦æ˜¯åšæ³¨å†Œä¸­å¿ƒç”¨ã€‚åŸºäºDubboæ¡†æ¶å¼€å‘çš„æä¾›è€…ã€æ¶ˆè´¹è€…éƒ½å‘Zookeeperæ³¨å†Œè‡ªå·±çš„URLï¼Œæ¶ˆè´¹è€…è¿˜èƒ½æ‹¿åˆ°å¹¶è®¢é˜…æä¾›è€…çš„æ³¨å†ŒURLï¼Œä»¥ä¾¿åœ¨åç»­ç¨‹åºçš„æ‰§è¡Œä¸­å»è°ƒç”¨æä¾›è€…ã€‚è€Œæä¾›è€…å‘ç”Ÿäº†å˜åŠ¨ï¼Œä¹Ÿä¼šé€šè¿‡Zookeeperå‘è®¢é˜…çš„æ¶ˆè´¹è€…å‘é€é€šçŸ¥ã€‚ 5. zookeeperæ˜¯å¦‚ä½•ä¿è¯äº‹åŠ¡çš„é¡ºåºä¸€è‡´æ€§çš„zookeeperé‡‡ç”¨äº†é€’å¢çš„äº‹åŠ¡Id(zxid)æ¥æ ‡è¯†ï¼Œæ‰€æœ‰çš„proposaléƒ½åœ¨è¢«æå‡ºçš„æ—¶å€™åŠ ä¸Šäº†zxidï¼Œzxidå®é™…ä¸Šæ˜¯ä¸€ä¸ª64ä½çš„æ•°å­—ï¼Œé«˜32ä½æ˜¯epochç”¨æ¥æ ‡è¯†leaderæ˜¯å¦å‘ç”Ÿæ”¹å˜ï¼Œå¦‚æœæœ‰æ–°çš„leaderäº§ç”Ÿå‡ºæ¥ï¼Œepochä¼šè‡ªå¢ï¼Œä½32ä½ç”¨æ¥é€’å¢è®¡æ•°ã€‚å½“æ–°äº§ç”Ÿproposalçš„æ—¶å€™ï¼Œä¼šä¾æ®æ•°æ®åº“çš„ä¸¤é˜¶æ®µè¿‡ç¨‹ï¼Œé¦–å…ˆä¼šå‘å…¶ä»–çš„serverå‘å‡ºäº‹åŠ¡æ‰§è¡Œè¯·æ±‚ï¼Œå¦‚æœè¶…è¿‡åŠæ•°çš„æœºå™¨éƒ½èƒ½æ‰§è¡Œå¹¶ä¸”èƒ½å¤ŸæˆåŠŸï¼Œé‚£ä¹ˆå°±ä¼šå¼€å§‹æ‰§è¡Œ 5. ZooKeeperæä¾›äº†ä»€ä¹ˆï¼Ÿ 5.1 æ–‡ä»¶ç³»ç»ŸZookeeperæä¾›ä¸€ä¸ªå¤šå±‚çº§çš„èŠ‚ç‚¹å‘½åç©ºé—´ï¼ˆåƒæ ‘ä¸€æ ·, èŠ‚ç‚¹ç§°ä¸ºznodeï¼‰ã€‚ä¸æ–‡ä»¶ç³»ç»Ÿä¸åŒçš„æ˜¯ï¼Œè¿™äº›èŠ‚ç‚¹éƒ½å¯ä»¥è®¾ç½®å…³è”çš„æ•°æ®ï¼Œè€Œæ–‡ä»¶ç³»ç»Ÿä¸­åªæœ‰æ–‡ä»¶èŠ‚ç‚¹å¯ä»¥å­˜æ”¾æ•°æ®è€Œç›®å½•èŠ‚ç‚¹ä¸è¡Œã€‚Zookeeperä¸ºäº†ä¿è¯é«˜ååå’Œä½å»¶è¿Ÿï¼Œåœ¨å†…å­˜ä¸­ç»´æŠ¤äº†è¿™ä¸ªæ ‘çŠ¶çš„ç›®å½•ç»“æ„ï¼Œè¿™ç§ç‰¹æ€§ä½¿å¾—Zookeeperä¸èƒ½ç”¨äºå­˜æ”¾å¤§é‡çš„æ•°æ®ï¼Œæ¯ä¸ªèŠ‚ç‚¹çš„å­˜æ”¾æ•°æ®ä¸Šé™ä¸º1Mã€‚ å››ç§ç±»å‹çš„znode1ã€PERSISTENT-æŒä¹…åŒ–ç›®å½•èŠ‚ç‚¹åˆ›å»ºä¹‹åä¸€ç›´å­˜åœ¨ï¼Œé™¤éæœ‰åˆ é™¤æ“ä½œï¼Œåˆ›å»ºèŠ‚ç‚¹çš„å®¢æˆ·ç«¯ä¼šè¯å¤±æ•ˆä¹Ÿä¸å½±å“æ­¤èŠ‚ç‚¹ã€‚2ã€PERSISTENT_SEQUENTIAL-æŒä¹…åŒ–é¡ºåºç¼–å·ç›®å½•èŠ‚ç‚¹è·ŸæŒä¹…ä¸€æ ·ï¼Œå°±æ˜¯çˆ¶èŠ‚ç‚¹åœ¨åˆ›å»ºä¸‹ä¸€çº§å­èŠ‚ç‚¹çš„æ—¶å€™ï¼Œè®°å½•æ¯ä¸ªå­èŠ‚ç‚¹åˆ›å»ºçš„å…ˆåé¡ºåºï¼Œä¼šç»™æ¯ä¸ªå­èŠ‚ç‚¹ååŠ ä¸Šä¸€ä¸ªæ•°å­—åç¼€ã€‚3ã€EPHEMERAL-ä¸´æ—¶ç›®å½•èŠ‚ç‚¹ ephemeralçŸ­æš‚çš„,ä¸´æ—¶çš„åˆ›å»ºå®¢æˆ·ç«¯ä¼šè¯å¤±æ•ˆï¼ˆæ³¨æ„æ˜¯ä¼šè¯å¤±æ•ˆï¼Œä¸æ˜¯è¿æ¥æ–­äº†ï¼‰ï¼ŒèŠ‚ç‚¹ä¹Ÿå°±æ²¡äº†ã€‚ä¸èƒ½å»ºå­èŠ‚ç‚¹ã€‚4ã€EPHEMERAL_SEQUENTIAL-ä¸´æ—¶é¡ºåºç¼–å·ç›®å½•èŠ‚ç‚¹å®¢æˆ·ç«¯ä¸zookeeperæ–­å¼€è¿æ¥åï¼Œè¯¥èŠ‚ç‚¹è¢«åˆ é™¤ï¼Œåªæ˜¯Zookeeperç»™è¯¥èŠ‚ç‚¹åç§°è¿›è¡Œé¡ºåºç¼–å· åˆ›å»ºçš„ä¸´æ—¶èŠ‚ç‚¹ä»€ä¹ˆæ—¶å€™ä¼šè¢«åˆ é™¤ï¼Œæ˜¯è¿æ¥ä¸€æ–­å°±åˆ é™¤å—ï¼Ÿå»¶æ—¶æ˜¯å¤šå°‘ï¼Ÿè¿æ¥æ–­äº†ä¹‹åï¼ŒZKä¸ä¼šé©¬ä¸Šç§»é™¤ä¸´æ—¶æ•°æ®ï¼Œåªæœ‰å½“SESSIONEXPIREDä¹‹åï¼Œæ‰ä¼šæŠŠè¿™ä¸ªä¼šè¯å»ºç«‹çš„ä¸´æ—¶æ•°æ®ç§»é™¤ã€‚å› æ­¤ï¼Œç”¨æˆ·éœ€è¦è°¨æ…è®¾ç½®Session_TimeOut æ˜¯å¦å¯ä»¥æ‹’ç»å•ä¸ªIPå¯¹ZKçš„è®¿é—®æ“ä½œ ?ZKæœ¬èº«ä¸æä¾›è¿™æ ·çš„åŠŸèƒ½ï¼Œå®ƒä»…ä»…æä¾›äº†å¯¹å•ä¸ªIPçš„è¿æ¥æ•°çš„é™åˆ¶ã€‚ä½ å¯ä»¥é€šè¿‡ä¿®æ”¹iptablesæ¥å®ç°å¯¹å•ä¸ªipçš„é™åˆ¶ï¼›å½“ç„¶ï¼Œä½ ä¹Ÿå¯ä»¥é€šè¿‡è¿™æ ·çš„æ–¹å¼æ¥è§£å†³ã€‚ 5.2 é€šçŸ¥æœºåˆ¶clientç«¯ä¼šå¯¹æŸä¸ªznodeå»ºç«‹ä¸€ä¸ªwatcheräº‹ä»¶ï¼Œå½“è¯¥znodeå‘ç”Ÿå˜åŒ–æ—¶ï¼Œè¿™äº›clientä¼šæ”¶åˆ°zookeeperçš„é€šçŸ¥ï¼Œç„¶åclientå¯ä»¥æ ¹æ®znodeå˜åŒ–æ¥åšå‡ºä¸šåŠ¡ä¸Šçš„æ”¹å˜ç­‰ã€‚ 6. Zookeeperåšäº†ä»€ä¹ˆï¼Ÿ å‘½åæœåŠ¡ï¼ˆæ–‡ä»¶ç³»ç»Ÿï¼‰å‘½åæœåŠ¡æ˜¯æŒ‡é€šè¿‡æŒ‡å®šçš„åå­—æ¥è·å–èµ„æºæˆ–è€…æœåŠ¡çš„åœ°å€ï¼Œåˆ©ç”¨zkåˆ›å»ºä¸€ä¸ªå…¨å±€çš„è·¯å¾„ï¼Œå³æ˜¯å”¯ä¸€çš„è·¯å¾„ï¼Œè¿™ä¸ªè·¯å¾„å°±å¯ä»¥ä½œä¸ºä¸€ä¸ªåå­—ï¼ŒæŒ‡å‘é›†ç¾¤ä¸­çš„é›†ç¾¤ï¼Œæä¾›çš„æœåŠ¡çš„åœ°å€ï¼Œæˆ–è€…ä¸€ä¸ªè¿œç¨‹çš„å¯¹è±¡ç­‰ç­‰ã€‚ zkçš„é…ç½®ç®¡ç†ï¼ˆæ–‡ä»¶ç³»ç»Ÿã€é€šçŸ¥æœºåˆ¶ï¼‰ç¨‹åºåˆ†å¸ƒå¼çš„éƒ¨ç½²åœ¨ä¸åŒçš„æœºå™¨ä¸Šï¼Œå°†ç¨‹åºçš„é…ç½®ä¿¡æ¯æ”¾åœ¨zkçš„znodeä¸‹ï¼Œå½“æœ‰é…ç½®å‘ç”Ÿæ”¹å˜æ—¶ï¼Œä¹Ÿå°±æ˜¯znodeå‘ç”Ÿå˜åŒ–æ—¶ï¼Œå¯ä»¥é€šè¿‡æ”¹å˜zkä¸­æŸä¸ªç›®å½•èŠ‚ç‚¹çš„å†…å®¹ï¼Œåˆ©ç”¨watcheré€šçŸ¥ç»™å„ä¸ªå®¢æˆ·ç«¯ï¼Œä»è€Œæ›´æ”¹é…ç½®ã€‚ Zookeeperé›†ç¾¤ç®¡ç†ï¼ˆæ–‡ä»¶ç³»ç»Ÿã€é€šçŸ¥æœºåˆ¶ï¼‰æ‰€è°“é›†ç¾¤ç®¡ç†æ— åœ¨ä¹ä¸¤ç‚¹ï¼š 1. æ˜¯å¦æœ‰æœºå™¨é€€å‡ºå’ŒåŠ å…¥ 2. é€‰ä¸¾leaderã€‚ å¯¹äºç¬¬ä¸€ç‚¹ï¼Œæ‰€æœ‰æœºå™¨çº¦å®šåœ¨çˆ¶ç›®å½•ä¸‹åˆ›å»ºä¸´æ—¶ç›®å½•èŠ‚ç‚¹ï¼Œç„¶åç›‘å¬çˆ¶ç›®å½•èŠ‚ç‚¹çš„å­èŠ‚ç‚¹å˜åŒ–æ¶ˆæ¯ã€‚ä¸€æ—¦æœ‰æœºå™¨æŒ‚æ‰ï¼Œè¯¥æœºå™¨ä¸ zookeeperçš„è¿æ¥æ–­å¼€ï¼Œå…¶æ‰€åˆ›å»ºçš„ä¸´æ—¶ç›®å½•èŠ‚ç‚¹è¢«åˆ é™¤ï¼Œæ‰€æœ‰å…¶ä»–æœºå™¨éƒ½æ”¶åˆ°é€šçŸ¥ï¼šæŸä¸ªå…„å¼Ÿç›®å½•è¢«åˆ é™¤ï¼Œäºæ˜¯ï¼Œæ‰€æœ‰äººéƒ½çŸ¥é“ï¼šå®ƒä¸Šèˆ¹äº†ã€‚æ–°æœºå™¨åŠ å…¥ä¹Ÿæ˜¯ç±»ä¼¼ï¼Œæ‰€æœ‰æœºå™¨æ”¶åˆ°é€šçŸ¥ï¼šæ–°å…„å¼Ÿç›®å½•åŠ å…¥ï¼Œhighcountåˆæœ‰äº†. å¯¹äºç¬¬äºŒç‚¹ï¼Œæˆ‘ä»¬ç¨å¾®æ”¹å˜ä¸€ä¸‹ï¼Œæ‰€æœ‰æœºå™¨åˆ›å»ºä¸´æ—¶é¡ºåºç¼–å·ç›®å½•èŠ‚ç‚¹ï¼Œæ¯æ¬¡é€‰å–ç¼–å·æœ€å°çš„æœºå™¨ä½œä¸ºmasterå°±å¥½ã€‚ Zookeeperåˆ†å¸ƒå¼é”ï¼ˆæ–‡ä»¶ç³»ç»Ÿã€é€šçŸ¥æœºåˆ¶ï¼‰æœ‰äº†zookeeperçš„ä¸€è‡´æ€§æ–‡ä»¶ç³»ç»Ÿï¼Œé”çš„é—®é¢˜å˜å¾—å®¹æ˜“ã€‚é”æœåŠ¡å¯ä»¥åˆ†ä¸ºä¸¤ç±»ï¼Œä¸€ä¸ªæ˜¯ä¿æŒç‹¬å ï¼Œå¦ä¸€ä¸ªæ˜¯æ§åˆ¶æ—¶åºã€‚ å¯¹äºç¬¬ä¸€ç±»ï¼Œæˆ‘ä»¬å°†zookeeperä¸Šçš„ä¸€ä¸ªznodeçœ‹ä½œæ˜¯ä¸€æŠŠé”ï¼Œé€šè¿‡create znodeçš„æ–¹å¼æ¥å®ç°ã€‚æ‰€æœ‰å®¢æˆ·ç«¯éƒ½å»åˆ›å»º /distribute_lock èŠ‚ç‚¹ï¼Œæœ€ç»ˆæˆåŠŸåˆ›å»ºçš„é‚£ä¸ªå®¢æˆ·ç«¯ä¹Ÿå³æ‹¥æœ‰äº†è¿™æŠŠé”ã€‚ç”¨å®Œåˆ é™¤æ‰è‡ªå·±åˆ›å»ºçš„distribute_lock èŠ‚ç‚¹å°±é‡Šæ”¾å‡ºé”ã€‚ (æ€æƒ³å°±æ˜¯: å»åˆ›å»ºä¸€ä¸ªlockèŠ‚ç‚¹, è°åˆ›å»ºæˆåŠŸè°å°±èƒ½æ‹¿åˆ°è¿™æŠŠé”, ç”¨å®Œå,åˆ é™¤æ‰è‡ªå·±åˆ›å»ºçš„è¿™ä¸ªèŠ‚ç‚¹) å¯¹äºç¬¬äºŒç±»ï¼Œ /distribute_lock å·²ç»é¢„å…ˆå­˜åœ¨ï¼Œæ‰€æœ‰å®¢æˆ·ç«¯åœ¨å®ƒä¸‹é¢åˆ›å»ºä¸´æ—¶é¡ºåºç¼–å·ç›®å½•èŠ‚ç‚¹ï¼Œå’Œé€‰masterä¸€æ ·ï¼Œç¼–å·æœ€å°çš„è·å¾—é”ï¼Œç”¨å®Œåˆ é™¤ï¼Œä¾æ¬¡æ–¹ä¾¿ã€‚ è·å–åˆ†å¸ƒå¼é”çš„æµç¨‹:åœ¨è·å–åˆ†å¸ƒå¼é”çš„æ—¶å€™åœ¨lockerèŠ‚ç‚¹ä¸‹åˆ›å»ºä¸´æ—¶é¡ºåºèŠ‚ç‚¹ï¼Œé‡Šæ”¾é”çš„æ—¶å€™åˆ é™¤è¯¥ä¸´æ—¶èŠ‚ç‚¹ã€‚å®¢æˆ·ç«¯è°ƒç”¨createNodeæ–¹æ³•åœ¨lockerä¸‹åˆ›å»ºä¸´æ—¶é¡ºåºèŠ‚ç‚¹ï¼Œç„¶åè°ƒç”¨getChildren(â€œlockerâ€)æ¥è·å–lockerä¸‹é¢çš„æ‰€æœ‰å­èŠ‚ç‚¹ï¼Œæ³¨æ„æ­¤æ—¶ä¸ç”¨è®¾ç½®ä»»ä½•Watcherã€‚å®¢æˆ·ç«¯è·å–åˆ°æ‰€æœ‰çš„å­èŠ‚ç‚¹pathä¹‹åï¼Œå¦‚æœå‘ç°è‡ªå·±åˆ›å»ºçš„èŠ‚ç‚¹åœ¨æ‰€æœ‰åˆ›å»ºçš„å­èŠ‚ç‚¹åºå·æœ€å°ï¼Œé‚£ä¹ˆå°±è®¤ä¸ºè¯¥å®¢æˆ·ç«¯è·å–åˆ°äº†é”ã€‚å¦‚æœå‘ç°è‡ªå·±åˆ›å»ºçš„èŠ‚ç‚¹å¹¶élockeræ‰€æœ‰å­èŠ‚ç‚¹ä¸­æœ€å°çš„ï¼Œè¯´æ˜è‡ªå·±è¿˜æ²¡æœ‰è·å–åˆ°é”ï¼Œ==æ­¤æ—¶å®¢æˆ·ç«¯éœ€è¦æ‰¾åˆ°æ¯”è‡ªå·±å°çš„é‚£ä¸ªèŠ‚ç‚¹ï¼Œç„¶åå¯¹å…¶è°ƒç”¨exist()æ–¹æ³•ï¼ŒåŒæ—¶å¯¹å…¶æ³¨å†Œäº‹ä»¶ç›‘å¬å™¨==ã€‚ä¹‹åï¼Œè®©è¿™ä¸ªè¢«å…³æ³¨çš„èŠ‚ç‚¹åˆ é™¤ï¼Œåˆ™å®¢æˆ·ç«¯çš„Watcherä¼šæ”¶åˆ°ç›¸åº”é€šçŸ¥ï¼Œæ­¤æ—¶å†æ¬¡åˆ¤æ–­è‡ªå·±åˆ›å»ºçš„èŠ‚ç‚¹æ˜¯å¦æ˜¯lockerå­èŠ‚ç‚¹ä¸­åºå·æœ€å°çš„ï¼Œå¦‚æœæ˜¯åˆ™è·å–åˆ°äº†é”ï¼Œå¦‚æœä¸æ˜¯åˆ™é‡å¤ä»¥ä¸Šæ­¥éª¤ç»§ç»­è·å–åˆ°æ¯”è‡ªå·±å°çš„ä¸€ä¸ªèŠ‚ç‚¹å¹¶æ³¨å†Œç›‘å¬ã€‚å½“å‰è¿™ä¸ªè¿‡ç¨‹ä¸­è¿˜éœ€è¦è®¸å¤šçš„é€»è¾‘åˆ¤æ–­ã€‚ ä»£ç çš„å®ç°ä¸»è¦æ˜¯åŸºäºäº’æ–¥é”ï¼Œè·å–åˆ†å¸ƒå¼é”çš„é‡ç‚¹é€»è¾‘åœ¨äºBaseDistributedLockï¼Œå®ç°äº†åŸºäºZookeeperå®ç°åˆ†å¸ƒå¼é”çš„ç»†èŠ‚ã€‚ Zookeeperé˜Ÿåˆ—ç®¡ç†ï¼ˆæ–‡ä»¶ç³»ç»Ÿã€é€šçŸ¥æœºåˆ¶ï¼‰ä¸¤ç§ç±»å‹çš„é˜Ÿåˆ—ï¼š åŒæ­¥é˜Ÿåˆ—ï¼Œå½“ä¸€ä¸ªé˜Ÿåˆ—çš„æˆå‘˜éƒ½èšé½æ—¶ï¼Œè¿™ä¸ªé˜Ÿåˆ—æ‰å¯ç”¨ï¼Œå¦åˆ™ä¸€ç›´ç­‰å¾…æ‰€æœ‰æˆå‘˜åˆ°è¾¾ã€‚ åœ¨çº¦å®šç›®å½•ä¸‹åˆ›å»ºä¸´æ—¶ç›®å½•èŠ‚ç‚¹ï¼Œç›‘å¬èŠ‚ç‚¹æ•°ç›®æ˜¯å¦æ˜¯æˆ‘ä»¬è¦æ±‚çš„æ•°ç›®ã€‚ é˜Ÿåˆ—æŒ‰ç…§ FIFO æ–¹å¼è¿›è¡Œå…¥é˜Ÿå’Œå‡ºé˜Ÿæ“ä½œã€‚ å’Œåˆ†å¸ƒå¼é”æœåŠ¡ä¸­çš„æ§åˆ¶æ—¶åºåœºæ™¯åŸºæœ¬åŸç†ä¸€è‡´ï¼Œå…¥åˆ—æœ‰ç¼–å·ï¼Œå‡ºåˆ—æŒ‰ç¼–å·ã€‚åœ¨ç‰¹å®šçš„ç›®å½•ä¸‹åˆ›å»ºPERSISTENT_SEQUENTIALèŠ‚ç‚¹ï¼Œåˆ›å»ºæˆåŠŸæ—¶Watcheré€šçŸ¥ç­‰å¾…çš„é˜Ÿåˆ—ï¼Œé˜Ÿåˆ—åˆ é™¤åºåˆ—å·æœ€å°çš„èŠ‚ç‚¹ç”¨ä»¥æ¶ˆè´¹ã€‚æ­¤åœºæ™¯ä¸‹Zookeeperçš„znodeç”¨äºæ¶ˆæ¯å­˜å‚¨ï¼Œznodeå­˜å‚¨çš„æ•°æ®å°±æ˜¯æ¶ˆæ¯é˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯å†…å®¹ï¼ŒSEQUENTIALåºåˆ—å·å°±æ˜¯æ¶ˆæ¯çš„ç¼–å·ï¼ŒæŒ‰åºå–å‡ºå³å¯ã€‚ç”±äºåˆ›å»ºçš„èŠ‚ç‚¹æ˜¯æŒä¹…åŒ–çš„ï¼Œæ‰€ä»¥ä¸å¿…æ‹…å¿ƒé˜Ÿåˆ—æ¶ˆæ¯çš„ä¸¢å¤±é—®é¢˜ã€‚ Zookeeperæ•°æ®å¤åˆ¶Zookeeperä½œä¸ºä¸€ä¸ªé›†ç¾¤æä¾›ä¸€è‡´çš„æ•°æ®æœåŠ¡ï¼Œè‡ªç„¶ï¼Œå®ƒè¦åœ¨æ‰€æœ‰æœºå™¨é—´åšæ•°æ®å¤åˆ¶ã€‚æ•°æ®å¤åˆ¶çš„å¥½å¤„ï¼š å®¹é”™ï¼šä¸€ä¸ªèŠ‚ç‚¹å‡ºé”™ï¼Œä¸è‡´äºè®©æ•´ä¸ªç³»ç»Ÿåœæ­¢å·¥ä½œï¼Œåˆ«çš„èŠ‚ç‚¹å¯ä»¥æ¥ç®¡å®ƒçš„å·¥ä½œï¼› æé«˜ç³»ç»Ÿçš„æ‰©å±•èƒ½åŠ› ï¼šæŠŠè´Ÿè½½åˆ†å¸ƒåˆ°å¤šä¸ªèŠ‚ç‚¹ä¸Šï¼Œæˆ–è€…å¢åŠ èŠ‚ç‚¹æ¥æé«˜ç³»ç»Ÿçš„è´Ÿè½½èƒ½åŠ›ï¼› æé«˜æ€§èƒ½ï¼šè®©å®¢æˆ·ç«¯æœ¬åœ°è®¿é—®å°±è¿‘çš„èŠ‚ç‚¹ï¼Œæé«˜ç”¨æˆ·è®¿é—®é€Ÿåº¦ã€‚ ä»å®¢æˆ·ç«¯è¯»å†™è®¿é—®çš„é€æ˜åº¦æ¥çœ‹ï¼Œæ•°æ®å¤åˆ¶é›†ç¾¤ç³»ç»Ÿåˆ†ä¸‹é¢ä¸¤ç§ï¼š å†™ä¸»(WriteMaster) ï¼šå¯¹æ•°æ®çš„ä¿®æ”¹æäº¤ç»™æŒ‡å®šçš„èŠ‚ç‚¹ã€‚è¯»æ— æ­¤é™åˆ¶ï¼Œå¯ä»¥è¯»å–ä»»ä½•ä¸€ä¸ªèŠ‚ç‚¹ã€‚è¿™ç§æƒ…å†µä¸‹å®¢æˆ·ç«¯éœ€è¦å¯¹è¯»ä¸å†™è¿›è¡ŒåŒºåˆ«ï¼Œä¿—ç§°è¯»å†™åˆ†ç¦»ï¼› å†™ä»»æ„(Write Any)ï¼šå¯¹æ•°æ®çš„ä¿®æ”¹å¯æäº¤ç»™ä»»æ„çš„èŠ‚ç‚¹ï¼Œè·Ÿè¯»ä¸€æ ·ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œå®¢æˆ·ç«¯å¯¹é›†ç¾¤èŠ‚ç‚¹çš„è§’è‰²ä¸å˜åŒ–é€æ˜ã€‚ å¯¹zookeeperæ¥è¯´ï¼Œå®ƒé‡‡ç”¨çš„æ–¹å¼æ˜¯å†™ä»»æ„ã€‚é€šè¿‡å¢åŠ æœºå™¨ï¼Œå®ƒçš„==è¯»ååèƒ½åŠ›å’Œå“åº”èƒ½åŠ›æ‰©å±•æ€§éå¸¸å¥½==ï¼Œè€Œ==å†™ï¼Œéšç€æœºå™¨çš„å¢å¤šååèƒ½åŠ›è‚¯å®šä¸‹é™==ï¼ˆè¿™ä¹Ÿæ˜¯å®ƒå»ºç«‹observerçš„åŸå› ï¼‰ï¼Œè€Œå“åº”èƒ½åŠ›åˆ™å–å†³äºå…·ä½“å®ç°æ–¹å¼ï¼Œæ˜¯å»¶è¿Ÿå¤åˆ¶ä¿æŒæœ€ç»ˆä¸€è‡´æ€§ï¼Œè¿˜æ˜¯ç«‹å³å¤åˆ¶å¿«é€Ÿå“åº”ã€‚ 7. Zookeeperå·¥ä½œåŸç†Zookeeper çš„æ ¸å¿ƒæ˜¯åŸå­å¹¿æ’­ï¼Œè¿™ä¸ªæœºåˆ¶ä¿è¯äº†å„ä¸ªServerä¹‹é—´çš„åŒæ­¥ã€‚å®ç°è¿™ä¸ªæœºåˆ¶çš„åè®®å«åšZabåè®®(ZookeeperåŸå­å¹¿æ’­)ã€‚ Zabåè®®æœ‰ä¸¤ç§æ¨¡å¼: å®ƒä»¬åˆ†åˆ«æ˜¯æ¢å¤æ¨¡å¼ï¼ˆé€‰ä¸»ï¼‰å’Œå¹¿æ’­æ¨¡å¼ï¼ˆåŒæ­¥ï¼‰ å½“æœåŠ¡å¯åŠ¨æˆ–è€…åœ¨é¢†å¯¼è€…å´©æºƒåï¼ŒZabå°±è¿›å…¥äº†æ¢å¤æ¨¡å¼ï¼Œå½“é¢†å¯¼è€…è¢«é€‰ä¸¾å‡ºæ¥ï¼Œä¸”å¤§å¤šæ•°Serverå®Œæˆäº†å’Œ leaderçš„çŠ¶æ€åŒæ­¥ä»¥åï¼Œæ¢å¤æ¨¡å¼å°±ç»“æŸäº†ã€‚çŠ¶æ€åŒæ­¥ä¿è¯äº†leaderå’ŒServerå…·æœ‰ç›¸åŒçš„ç³»ç»ŸçŠ¶æ€ã€‚ 8. Zookeeper ä¸‹ Serverå·¥ä½œçŠ¶æ€æ¯ä¸ªServeråœ¨å·¥ä½œè¿‡ç¨‹ä¸­æœ‰ä¸‰ç§çŠ¶æ€ï¼šLOOKINGï¼šå½“å‰Serverä¸çŸ¥é“leaderæ˜¯è°ï¼Œæ­£åœ¨æœå¯»LEADINGï¼šå½“å‰Serverå³ä¸ºé€‰ä¸¾å‡ºæ¥çš„leaderFOLLOWING: leaderå·²ç»é€‰ä¸¾å‡ºæ¥ï¼Œå½“å‰Serverä¸ä¹‹åŒæ­¥ 9. zookeeperæ˜¯å¦‚ä½•é€‰å–ä¸»leaderçš„ï¼Ÿå½“leaderå´©æºƒæˆ–è€…leaderå¤±å»å¤§å¤šæ•°çš„followerï¼Œè¿™æ—¶zkè¿›å…¥æ¢å¤æ¨¡å¼ï¼Œæ¢å¤æ¨¡å¼éœ€è¦é‡æ–°é€‰ä¸¾å‡ºä¸€ä¸ªæ–°çš„leaderï¼Œè®©æ‰€æœ‰çš„Serveréƒ½æ¢å¤åˆ°ä¸€ä¸ªæ­£ç¡®çš„çŠ¶æ€ã€‚Zkçš„é€‰ä¸¾ç®—æ³•æœ‰ä¸¤ç§ï¼šä¸€ç§æ˜¯åŸºäºbasic paxoså®ç°çš„ï¼Œå¦å¤–ä¸€ç§æ˜¯åŸºäºfast paxosç®—æ³•å®ç°çš„ã€‚ç³»ç»Ÿé»˜è®¤çš„é€‰ä¸¾ç®—æ³•ä¸ºfast paxosã€‚ Zookeeperé€‰ä¸»æµç¨‹(basic paxos)(æ¯ä¸ªèŠ‚ç‚¹éƒ½å‘é€ä¸€zxid, é€‰ä¸¾çº¿ç¨‹æ¨èzxidæœ€å¤§çš„é‚£ä¸ªserverä½œä¸ºleader)ï¼ˆ1ï¼‰é€‰ä¸¾çº¿ç¨‹ç”±å½“å‰Serverå‘èµ·é€‰ä¸¾çš„çº¿ç¨‹æ‹…ä»»ï¼Œå…¶ä¸»è¦åŠŸèƒ½æ˜¯å¯¹æŠ•ç¥¨ç»“æœè¿›è¡Œç»Ÿè®¡ï¼Œå¹¶é€‰å‡ºæ¨èçš„Serverï¼›ï¼ˆ2ï¼‰é€‰ä¸¾çº¿ç¨‹é¦–å…ˆå‘æ‰€æœ‰Serverå‘èµ·ä¸€æ¬¡è¯¢é—®(åŒ…æ‹¬è‡ªå·±)ï¼›ï¼ˆ3ï¼‰é€‰ä¸¾çº¿ç¨‹æ”¶åˆ°å›å¤åï¼ŒéªŒè¯æ˜¯å¦æ˜¯è‡ªå·±å‘èµ·çš„è¯¢é—®(éªŒè¯zxidæ˜¯å¦ä¸€è‡´)ï¼Œç„¶åè·å–å¯¹æ–¹çš„id(myid)ï¼Œå¹¶å­˜å‚¨åˆ°å½“å‰è¯¢é—®å¯¹è±¡åˆ—è¡¨ä¸­ï¼Œæœ€åè·å–å¯¹æ–¹æè®®çš„leaderç›¸å…³ä¿¡æ¯(id,zxid)ï¼Œå¹¶å°†è¿™äº›ä¿¡æ¯å­˜å‚¨åˆ°å½“æ¬¡é€‰ä¸¾çš„æŠ•ç¥¨è®°å½•è¡¨ä¸­ï¼›ï¼ˆ4ï¼‰é€‰ä¸¾çº¿ç¨‹æ”¶åˆ°æ‰€æœ‰Serverå›å¤ä»¥åï¼Œå°±è®¡ç®—å‡ºzxidæœ€å¤§çš„é‚£ä¸ªServerï¼Œå¹¶å°†è¿™ä¸ªServerç›¸å…³ä¿¡æ¯è®¾ç½®æˆä¸‹ä¸€æ¬¡è¦æŠ•ç¥¨çš„Serverï¼›ï¼ˆ5ï¼‰çº¿ç¨‹å°†å½“å‰zxidæœ€å¤§çš„Serverè®¾ç½®ä¸ºå½“å‰Serverè¦æ¨èçš„Leaderï¼Œå¦‚æœæ­¤æ—¶è·èƒœçš„Serverè·å¾—n/2 + 1(å¤§äºä¸€èˆ¬çš„æŠ•ç¥¨æ•°)çš„Serverç¥¨æ•°ï¼Œè®¾ç½®å½“å‰æ¨èçš„leaderä¸ºè·èƒœçš„Serverï¼Œå°†æ ¹æ®è·èƒœçš„Serverç›¸å…³ä¿¡æ¯è®¾ç½®è‡ªå·±çš„çŠ¶æ€ï¼Œå¦åˆ™ï¼Œç»§ç»­è¿™ä¸ªè¿‡ç¨‹ï¼Œç›´åˆ°leaderè¢«é€‰ä¸¾å‡ºæ¥ã€‚ é€šè¿‡æµç¨‹åˆ†ææˆ‘ä»¬å¯ä»¥å¾—å‡ºï¼šè¦ä½¿Leaderè·å¾—å¤šæ•°Serverçš„æ”¯æŒï¼Œåˆ™Serveræ€»æ•°å¿…é¡»æ˜¯å¥‡æ•°2n+1ï¼Œä¸”å­˜æ´»çš„Serverçš„æ•°ç›®ä¸å¾—å°‘äºn+1. æ¯ä¸ªServerå¯åŠ¨åéƒ½ä¼šé‡å¤ä»¥ä¸Šæµç¨‹ã€‚åœ¨æ¢å¤æ¨¡å¼ä¸‹ï¼Œå¦‚æœæ˜¯åˆšä»å´©æºƒçŠ¶æ€æ¢å¤çš„æˆ–è€…åˆšå¯åŠ¨çš„serverè¿˜ä¼šä»ç£ç›˜å¿«ç…§ä¸­æ¢å¤æ•°æ®å’Œä¼šè¯ä¿¡æ¯ï¼Œzkä¼šè®°å½•äº‹åŠ¡æ—¥å¿—å¹¶å®šæœŸè¿›è¡Œå¿«ç…§ï¼Œæ–¹ä¾¿åœ¨æ¢å¤æ—¶è¿›è¡ŒçŠ¶æ€æ¢å¤ã€‚ Zookeeperé€‰ä¸»æµç¨‹(fast paxos)(æœ‰ä¸€ä¸ªèŠ‚ç‚¹ä¸»åŠ¨æå‡ºè¦æˆä¸ºleader,å»é—®å¤§å®¶æ˜¯å¦åŒæ„)fast paxosæµç¨‹æ˜¯åœ¨é€‰ä¸¾è¿‡ç¨‹ä¸­ï¼ŒæŸServeré¦–å…ˆå‘æ‰€æœ‰Serveræè®®è‡ªå·±è¦æˆä¸ºleaderï¼Œå½“å…¶å®ƒServeræ”¶åˆ°æè®®ä»¥åï¼Œè§£å†³epochå’Œ zxidçš„å†²çªï¼Œå¹¶æ¥å—å¯¹æ–¹çš„æè®®ï¼Œç„¶åå‘å¯¹æ–¹å‘é€æ¥å—æè®®å®Œæˆçš„æ¶ˆæ¯ï¼Œé‡å¤è¿™ä¸ªæµç¨‹ï¼Œæœ€åä¸€å®šèƒ½é€‰ä¸¾å‡ºLeaderã€‚ 10. ZookeeperåŒæ­¥æµç¨‹é€‰å®ŒLeaderä»¥åï¼Œzkå°±è¿›å…¥çŠ¶æ€åŒæ­¥è¿‡ç¨‹ã€‚ Leaderç­‰å¾…serverè¿æ¥ï¼› Followerè¿æ¥leaderï¼Œå°†æœ€å¤§çš„zxidå‘é€ç»™leaderï¼› Leaderæ ¹æ®followerçš„zxidç¡®å®šåŒæ­¥ç‚¹ï¼› å®ŒæˆåŒæ­¥åé€šçŸ¥follower å·²ç»æˆä¸ºuptodateçŠ¶æ€ï¼› Followeræ”¶åˆ°uptodateæ¶ˆæ¯åï¼Œåˆå¯ä»¥é‡æ–°æ¥å—clientçš„è¯·æ±‚è¿›è¡ŒæœåŠ¡äº†ã€‚ 11. åˆ†å¸ƒå¼é€šçŸ¥å’Œåè°ƒå¯¹äºç³»ç»Ÿè°ƒåº¦æ¥è¯´ï¼šæ“ä½œäººå‘˜å‘é€é€šçŸ¥å®é™…æ˜¯é€šè¿‡æ§åˆ¶å°æ”¹å˜æŸä¸ªèŠ‚ç‚¹çš„çŠ¶æ€ï¼Œç„¶åzkå°†è¿™äº›å˜åŒ–å‘é€ç»™æ³¨å†Œäº†è¿™ä¸ªèŠ‚ç‚¹çš„watcherçš„æ‰€æœ‰å®¢æˆ·ç«¯ã€‚å¯¹äºæ‰§è¡Œæƒ…å†µæ±‡æŠ¥ï¼šæ¯ä¸ªå·¥ä½œè¿›ç¨‹éƒ½åœ¨æŸä¸ªç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªä¸´æ—¶èŠ‚ç‚¹ã€‚å¹¶æºå¸¦å·¥ä½œçš„è¿›åº¦æ•°æ®ï¼Œè¿™æ ·æ±‡æ€»çš„è¿›ç¨‹å¯ä»¥ç›‘æ§ç›®å½•å­èŠ‚ç‚¹çš„å˜åŒ–è·å¾—å·¥ä½œè¿›åº¦çš„å®æ—¶çš„å…¨å±€æƒ…å†µã€‚ 12. æœºå™¨ä¸­ä¸ºä»€ä¹ˆä¼šæœ‰leaderï¼Ÿåœ¨åˆ†å¸ƒå¼ç¯å¢ƒä¸­ï¼Œæœ‰äº›ä¸šåŠ¡é€»è¾‘åªéœ€è¦é›†ç¾¤ä¸­çš„æŸä¸€å°æœºå™¨è¿›è¡Œæ‰§è¡Œï¼Œå…¶ä»–çš„æœºå™¨å¯ä»¥å…±äº«è¿™ä¸ªç»“æœï¼Œè¿™æ ·å¯ä»¥å¤§å¤§å‡å°‘é‡å¤è®¡ç®—ï¼Œæé«˜æ€§èƒ½ï¼Œäºæ˜¯å°±éœ€è¦è¿›è¡Œleaderé€‰ä¸¾ã€‚ 13. zkèŠ‚ç‚¹å®•æœºå¦‚ä½•å¤„ç†ï¼ŸZookeeperæœ¬èº«ä¹Ÿæ˜¯é›†ç¾¤ï¼Œæ¨èé…ç½®ä¸å°‘äº3ä¸ªæœåŠ¡å™¨ã€‚Zookeeperè‡ªèº«ä¹Ÿè¦ä¿è¯å½“ä¸€ä¸ªèŠ‚ç‚¹å®•æœºæ—¶ï¼Œå…¶ä»–èŠ‚ç‚¹ä¼šç»§ç»­æä¾›æœåŠ¡ã€‚å¦‚æœæ˜¯ä¸€ä¸ªFollowerå®•æœºï¼Œè¿˜æœ‰2å°æœåŠ¡å™¨æä¾›è®¿é—®ï¼Œå› ä¸ºZookeeperä¸Šçš„æ•°æ®æ˜¯æœ‰å¤šä¸ªå‰¯æœ¬çš„ï¼Œæ•°æ®å¹¶ä¸ä¼šä¸¢å¤±ï¼›å¦‚æœæ˜¯ä¸€ä¸ªLeaderå®•æœºï¼ŒZookeeperä¼šé€‰ä¸¾å‡ºæ–°çš„Leaderã€‚ZKé›†ç¾¤çš„æœºåˆ¶æ˜¯åªè¦è¶…è¿‡åŠæ•°çš„èŠ‚ç‚¹æ­£å¸¸ï¼Œé›†ç¾¤å°±èƒ½æ­£å¸¸æä¾›æœåŠ¡ã€‚åªæœ‰åœ¨ZKèŠ‚ç‚¹æŒ‚å¾—å¤ªå¤šï¼Œåªå‰©ä¸€åŠæˆ–ä¸åˆ°ä¸€åŠèŠ‚ç‚¹èƒ½å·¥ä½œï¼Œé›†ç¾¤æ‰å¤±æ•ˆã€‚æ‰€ä»¥3ä¸ªèŠ‚ç‚¹çš„clusterå¯ä»¥æŒ‚æ‰1ä¸ªèŠ‚ç‚¹(leaderå¯ä»¥å¾—åˆ°2ç¥¨&gt;1.5)2ä¸ªèŠ‚ç‚¹çš„clusterå°±ä¸èƒ½æŒ‚æ‰ä»»ä½•1ä¸ªèŠ‚ç‚¹äº†(leaderå¯ä»¥å¾—åˆ°1ç¥¨&lt;=1) 14. zookeeperè´Ÿè½½å‡è¡¡å’Œnginxè´Ÿè½½å‡è¡¡åŒºåˆ«zkçš„è´Ÿè½½å‡è¡¡æ˜¯å¯ä»¥è°ƒæ§ï¼Œnginxåªæ˜¯èƒ½è°ƒæƒé‡ï¼Œå…¶ä»–éœ€è¦å¯æ§çš„éƒ½éœ€è¦è‡ªå·±å†™æ’ä»¶ï¼›ä½†æ˜¯nginxçš„ååé‡æ¯”zkå¤§å¾ˆå¤šï¼Œåº”è¯¥è¯´æŒ‰ä¸šåŠ¡é€‰æ‹©ç”¨å“ªç§æ–¹å¼ã€‚ 15. zookeeper watchæœºåˆ¶Watchæœºåˆ¶å®˜æ–¹å£°æ˜ï¼šä¸€ä¸ªWatchäº‹ä»¶æ˜¯ä¸€ä¸ªä¸€æ¬¡æ€§çš„è§¦å‘å™¨ï¼Œå½“è¢«è®¾ç½®äº†Watchçš„æ•°æ®å‘ç”Ÿäº†æ”¹å˜çš„æ—¶å€™ï¼Œåˆ™æœåŠ¡å™¨å°†è¿™ä¸ªæ”¹å˜å‘é€ç»™è®¾ç½®äº†Watchçš„å®¢æˆ·ç«¯ï¼Œä»¥ä¾¿é€šçŸ¥å®ƒä»¬ã€‚ ä¸ºä»€ä¹ˆä¸æ˜¯æ°¸ä¹…çš„ï¼Œä¸¾ä¸ªä¾‹å­ï¼Œå¦‚æœæœåŠ¡ç«¯å˜åŠ¨é¢‘ç¹ï¼Œè€Œç›‘å¬çš„å®¢æˆ·ç«¯å¾ˆå¤šæƒ…å†µä¸‹ï¼Œæ¯æ¬¡å˜åŠ¨éƒ½è¦é€šçŸ¥åˆ°æ‰€æœ‰çš„å®¢æˆ·ç«¯ï¼Œè¿™å¤ªæ¶ˆè€—æ€§èƒ½äº†ã€‚åœ¨å®é™…åº”ç”¨ä¸­ï¼Œå¾ˆå¤šæƒ…å†µä¸‹ï¼Œæˆ‘ä»¬çš„å®¢æˆ·ç«¯ä¸éœ€è¦çŸ¥é“æœåŠ¡ç«¯çš„æ¯ä¸€æ¬¡å˜åŠ¨ï¼Œæˆ‘åªè¦æœ€æ–°çš„æ•°æ®å³å¯ã€‚ Zookeeperæœºåˆ¶çš„ç‰¹ç‚¹ï¼š ä¸€æ¬¡æ€§è§¦å‘æ•°æ®å‘ç”Ÿæ”¹å˜æ—¶ï¼Œä¸€ä¸ªwatcher eventä¼šè¢«å‘é€åˆ°clientï¼Œä½†æ˜¯clientåªä¼šæ”¶åˆ°ä¸€æ¬¡è¿™æ ·çš„ä¿¡æ¯ã€‚ watcher eventå¼‚æ­¥å‘é€: watcherçš„é€šçŸ¥äº‹ä»¶ä»serverå‘é€åˆ°clientæ˜¯å¼‚æ­¥çš„ï¼Œè¿™å°±å­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼Œä¸åŒçš„å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´é€šè¿‡socketè¿›è¡Œé€šä¿¡ï¼Œç”±äºç½‘ç»œå»¶è¿Ÿæˆ–å…¶ä»–å› ç´ å¯¼è‡´å®¢æˆ·ç«¯åœ¨ä¸åŒçš„æ—¶åˆ»ç›‘å¬åˆ°äº‹ä»¶ï¼Œç”±äºZookeeperæœ¬èº«æä¾›äº†ordering guaranteeï¼Œå³å®¢æˆ·ç«¯ç›‘å¬äº‹ä»¶åï¼Œæ‰ä¼šæ„ŸçŸ¥å®ƒæ‰€ç›‘è§†znodeå‘ç”Ÿäº†å˜åŒ–ã€‚æ‰€ä»¥æˆ‘ä»¬ä½¿ç”¨Zookeeperä¸èƒ½æœŸæœ›èƒ½å¤Ÿç›‘æ§åˆ°èŠ‚ç‚¹æ¯æ¬¡çš„å˜åŒ–ã€‚Zookeeperåªèƒ½ä¿è¯æœ€ç»ˆçš„ä¸€è‡´æ€§ï¼Œè€Œæ— æ³•ä¿è¯å¼ºä¸€è‡´æ€§ã€‚ æ•°æ®ç›‘è§†Zookeeperæœ‰æ•°æ®ç›‘è§†å’Œå­æ•°æ®ç›‘è§†getdata() and exists()è®¾ç½®æ•°æ®ç›‘è§†ï¼Œgetchildren()è®¾ç½®äº†å­èŠ‚ç‚¹ç›‘è§†ã€‚ æ³¨å†Œwatcher getDataã€existsã€getChildren è§¦å‘watcher createã€deleteã€setData( ä¿®æ”¹æ“ä½œé€šè¿‡åˆ é™¤,åˆ›å»º å®ç°) setData()ä¼šè§¦å‘znodeä¸Šè®¾ç½®çš„data watchï¼ˆå¦‚æœsetæˆåŠŸçš„è¯ï¼‰ã€‚ä¸€ä¸ªæˆåŠŸçš„create() æ“ä½œä¼šè§¦å‘è¢«åˆ›å»ºçš„znodeä¸Šçš„æ•°æ®watchï¼Œä»¥åŠå…¶çˆ¶èŠ‚ç‚¹ä¸Šçš„child watchã€‚è€Œä¸€ä¸ªæˆåŠŸçš„delete()æ“ä½œå°†ä¼šåŒæ—¶è§¦å‘ä¸€ä¸ªznodeçš„data watchå’Œchild watchï¼ˆå› ä¸ºè¿™æ ·å°±æ²¡æœ‰å­èŠ‚ç‚¹äº†ï¼‰ï¼ŒåŒæ—¶ä¹Ÿä¼šè§¦å‘å…¶çˆ¶èŠ‚ç‚¹çš„child watchã€‚ å½“ä¸€ä¸ªå®¢æˆ·ç«¯è¿æ¥åˆ°ä¸€ä¸ªæ–°çš„æœåŠ¡å™¨ä¸Šæ—¶ï¼Œwatchå°†ä¼šè¢«ä»¥ä»»æ„ä¼šè¯äº‹ä»¶è§¦å‘ã€‚å½“ä¸ä¸€ä¸ªæœåŠ¡å™¨å¤±å»è¿æ¥çš„æ—¶å€™ï¼Œæ˜¯æ— æ³•æ¥æ”¶åˆ°watchçš„ã€‚è€Œå½“clienté‡æ–°è¿æ¥æ—¶ï¼Œå¦‚æœéœ€è¦çš„è¯ï¼Œæ‰€æœ‰å…ˆå‰æ³¨å†Œè¿‡çš„watchï¼Œéƒ½ä¼šè¢«é‡æ–°æ³¨å†Œã€‚é€šå¸¸è¿™æ˜¯å®Œå…¨é€æ˜çš„ã€‚åªæœ‰åœ¨ä¸€ä¸ªç‰¹æ®Šæƒ…å†µä¸‹ï¼Œwatchå¯èƒ½ä¼šä¸¢å¤±ï¼šå¯¹äºä¸€ä¸ªæœªåˆ›å»ºçš„znodeçš„exist watchï¼Œå¦‚æœåœ¨å®¢æˆ·ç«¯æ–­å¼€è¿æ¥æœŸé—´è¢«åˆ›å»ºäº†ï¼Œå¹¶ä¸”éšååœ¨å®¢æˆ·ç«¯è¿æ¥ä¸Šä¹‹å‰åˆåˆ é™¤äº†ï¼Œè¿™ç§æƒ…å†µä¸‹ï¼Œè¿™ä¸ªwatchäº‹ä»¶å¯èƒ½ä¼šè¢«ä¸¢å¤±ã€‚ Watchæ˜¯è½»é‡çº§çš„ï¼Œå…¶å®å°±æ˜¯æœ¬åœ°JVMçš„Callbackï¼ŒæœåŠ¡å™¨ç«¯åªæ˜¯å­˜äº†æ˜¯å¦æœ‰è®¾ç½®äº†Watcherçš„å¸ƒå°”ç±»å‹ é›†ç¾¤æ”¯æŒåŠ¨æ€æ·»åŠ æœºå™¨å—ï¼Ÿå…¶å®å°±æ˜¯æ°´å¹³æ‰©å®¹äº†ï¼ŒZookeeperåœ¨è¿™æ–¹é¢ä¸å¤ªå¥½ã€‚ä¸¤ç§æ–¹å¼ï¼šå…¨éƒ¨é‡å¯ï¼šå…³é—­æ‰€æœ‰ZookeeperæœåŠ¡ï¼Œä¿®æ”¹é…ç½®ä¹‹åå¯åŠ¨ã€‚ä¸å½±å“ä¹‹å‰å®¢æˆ·ç«¯çš„ä¼šè¯ã€‚é€ä¸ªé‡å¯ï¼šé¡¾åæ€ä¹‰ã€‚è¿™æ˜¯æ¯”è¾ƒå¸¸ç”¨çš„æ–¹å¼ã€‚","categories":[],"tags":[{"name":"IT - æŠ€æœ¯ç¬”è®° - Job - zookeeper","slug":"IT-æŠ€æœ¯ç¬”è®°-Job-zookeeper","permalink":"/tags/IT-%E6%8A%80%E6%9C%AF%E7%AC%94%E8%AE%B0-Job-zookeeper/"}]},{"title":"Redisé¢è¯•","slug":"Redisé¢è¯•","date":"2019-10-20T11:51:12.000Z","updated":"2019-10-20T06:04:02.571Z","comments":true,"path":"2019/10/20/Redisé¢è¯•/","link":"","permalink":"/2019/10/20/Redis%E9%9D%A2%E8%AF%95/","excerpt":"","text":"ä»€ä¹ˆæ˜¯Redisï¼Ÿç®€è¿°å®ƒçš„ä¼˜ç¼ºç‚¹ï¼Ÿ Redisæœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªKey-Valueç±»å‹çš„å†…å­˜æ•°æ®åº“ï¼Œå¾ˆåƒmemcachedï¼Œæ•´ä¸ªæ•°æ®åº“ç»Ÿç»ŸåŠ è½½åœ¨å†…å­˜å½“ä¸­è¿›è¡Œæ“ä½œï¼Œå®šæœŸé€šè¿‡å¼‚æ­¥æ“ä½œæŠŠæ•°æ®åº“æ•°æ®flushåˆ°ç¡¬ç›˜ä¸Šè¿›è¡Œä¿å­˜ã€‚ å› ä¸ºæ˜¯çº¯å†…å­˜æ“ä½œï¼ŒRedisçš„æ€§èƒ½éå¸¸å‡ºè‰²ï¼Œæ¯ç§’å¯ä»¥å¤„ç†è¶…è¿‡ 10ä¸‡æ¬¡è¯»å†™æ“ä½œï¼Œæ˜¯å·²çŸ¥æ€§èƒ½æœ€å¿«çš„Key-Value DBã€‚ Redisçš„å‡ºè‰²ä¹‹å¤„ä¸ä»…ä»…æ˜¯æ€§èƒ½ï¼ŒRedisæœ€å¤§çš„é­…åŠ›æ˜¯æ”¯æŒä¿å­˜å¤šç§æ•°æ®ç»“æ„ï¼Œæ­¤å¤–å•ä¸ªvalueçš„æœ€å¤§é™åˆ¶æ˜¯1GBï¼Œä¸åƒ memcachedåªèƒ½ä¿å­˜1MBçš„æ•°æ®ï¼Œå› æ­¤Rediså¯ä»¥ç”¨æ¥å®ç°å¾ˆå¤šæœ‰ç”¨çš„åŠŸèƒ½ã€‚ æ¯”æ–¹è¯´ç”¨ä»–çš„Listæ¥åšFIFOåŒå‘é“¾è¡¨ï¼Œå®ç°ä¸€ä¸ªè½»é‡çº§çš„é«˜æ€§ èƒ½æ¶ˆæ¯é˜Ÿåˆ—æœåŠ¡ï¼Œç”¨ä»–çš„Setå¯ä»¥åšé«˜æ€§èƒ½çš„tagç³»ç»Ÿç­‰ç­‰ã€‚ å¦å¤–Redisä¹Ÿå¯ä»¥å¯¹å­˜å…¥çš„Key-Valueè®¾ç½®expireæ—¶é—´ï¼Œå› æ­¤ä¹Ÿå¯ä»¥è¢«å½“ä½œä¸€ ä¸ªåŠŸèƒ½åŠ å¼ºç‰ˆçš„memcachedæ¥ç”¨ã€‚ Redisçš„ä¸»è¦ç¼ºç‚¹æ˜¯æ•°æ®åº“å®¹é‡å—åˆ°ç‰©ç†å†…å­˜çš„é™åˆ¶ï¼Œä¸èƒ½ç”¨ä½œæµ·é‡æ•°æ®çš„é«˜æ€§èƒ½è¯»å†™ï¼Œå› æ­¤Redisé€‚åˆçš„åœºæ™¯ä¸»è¦å±€é™åœ¨è¾ƒå°æ•°æ®é‡çš„é«˜æ€§èƒ½æ“ä½œå’Œè¿ç®—ä¸Šã€‚ 1ã€ ä½¿ç”¨Redisæœ‰å“ªäº›å¥½å¤„ï¼Ÿ é€Ÿåº¦å¿«ï¼Œå› ä¸ºæ•°æ®å­˜åœ¨å†…å­˜ä¸­ï¼Œç±»ä¼¼äºHashMapï¼ŒHashMapçš„ä¼˜åŠ¿å°±æ˜¯æŸ¥æ‰¾å’Œæ“ä½œçš„æ—¶é—´å¤æ‚åº¦éƒ½æ˜¯O(1) æ”¯æŒä¸°å¯Œæ•°æ®ç±»å‹ï¼Œæ”¯æŒ==stringï¼Œlistï¼Œsetï¼Œsorted setï¼Œhash== æ”¯æŒäº‹åŠ¡ï¼Œæ“ä½œéƒ½æ˜¯åŸå­æ€§ï¼Œæ‰€è°“çš„åŸå­æ€§å°±æ˜¯å¯¹æ•°æ®çš„æ›´æ”¹è¦ä¹ˆå…¨éƒ¨æ‰§è¡Œï¼Œè¦ä¹ˆå…¨éƒ¨ä¸æ‰§è¡Œ ä¸°å¯Œçš„ç‰¹æ€§ï¼šå¯ç”¨äºç¼“å­˜ï¼Œæ¶ˆæ¯ï¼ŒæŒ‰keyè®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œè¿‡æœŸåå°†ä¼šè‡ªåŠ¨åˆ é™¤ 2ã€ redisç›¸æ¯”memcachedæœ‰å“ªäº›ä¼˜åŠ¿ memcachedæ‰€æœ‰çš„å€¼å‡æ˜¯ç®€å•çš„å­—ç¬¦ä¸²ï¼Œredisä½œä¸ºå…¶æ›¿ä»£è€…ï¼Œæ”¯æŒæ›´ä¸ºä¸°å¯Œçš„æ•°æ®ç±»å‹ redisçš„é€Ÿåº¦æ¯”memcachedå¿«å¾ˆå¤š rediså¯ä»¥æŒä¹…åŒ–å…¶æ•°æ® â€“ é™„åŠ çš„æ•°æ®æŒä¹…åŒ–ï¼Œ æº¢å†™åˆ°ç£ç›˜å½“ä¸­ 3ã€rediså¸¸è§æ€§èƒ½é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆï¼š Masteræœ€å¥½ä¸è¦åšä»»ä½•æŒä¹…åŒ–å·¥ä½œï¼Œå¦‚RDBå†…å­˜å¿«ç…§å’ŒAOFæ—¥å¿—æ–‡ä»¶ å¦‚æœæ•°æ®æ¯”è¾ƒé‡è¦ï¼ŒæŸä¸ªSlaveå¼€å¯AOFå¤‡ä»½æ•°æ®ï¼Œç­–ç•¥è®¾ç½®ä¸ºæ¯ç§’åŒæ­¥ä¸€æ¬¡ ä¸ºäº†ä¸»ä»å¤åˆ¶çš„é€Ÿåº¦å’Œè¿æ¥çš„ç¨³å®šæ€§ï¼ŒMasterå’ŒSlaveæœ€å¥½åœ¨åŒä¸€ä¸ªå±€åŸŸç½‘å†… å°½é‡é¿å…åœ¨å‹åŠ›å¾ˆå¤§çš„ä¸»åº“ä¸Šå¢åŠ ä»åº“ ä¸»ä»å¤åˆ¶ä¸è¦ç”¨å›¾çŠ¶ç»“æ„ï¼Œç”¨å•å‘é“¾è¡¨ç»“æ„æ›´ä¸ºç¨³å®šï¼Œå³ï¼šMaster &lt;- Slave1 &lt;- Slave2 &lt;- Slave3â€¦ è¿™æ ·çš„ç»“æ„æ–¹ä¾¿è§£å†³å•ç‚¹æ•…éšœé—®é¢˜ï¼Œå®ç°Slaveå¯¹Masterçš„æ›¿æ¢ã€‚å¦‚æœMasteræŒ‚äº†ï¼Œå¯ä»¥ç«‹åˆ»å¯ç”¨Slave1åšMasterï¼Œå…¶ä»–ä¸å˜ã€‚ 4ã€redisçš„æ·˜æ±°ç­–ç•¥, ä¿è¯æ•°æ®çš„çƒ­ç‚¹æ€§==rediså†…å­˜æ•°æ®é›†å¤§å°ä¸Šå‡åˆ°ä¸€å®šå¤§å°çš„æ—¶å€™ï¼Œå°±ä¼šæ–½è¡Œæ•°æ®æ·˜æ±°ç­–ç•¥ã€‚== enviction é©±é€ï¼Œæµæµª voltile-lruï¼šä»å·²è®¾ç½®è¿‡æœŸæ—¶é—´çš„æ•°æ®é›†ï¼ˆserver.db[i].expiresï¼‰ä¸­æŒ‘é€‰æœ€è¿‘æœ€å°‘ä½¿ç”¨çš„æ•°æ®æ·˜æ±° volatile-ttlï¼šä»å·²è®¾ç½®è¿‡æœŸæ—¶é—´çš„æ•°æ®é›†ï¼ˆserver.db[i].expiresï¼‰ä¸­æŒ‘é€‰å°†è¦è¿‡æœŸçš„æ•°æ®æ·˜æ±° volatile-randomï¼šä»å·²è®¾ç½®è¿‡æœŸæ—¶é—´çš„æ•°æ®é›†ï¼ˆserver.db[i].expiresï¼‰ä¸­ä»»æ„é€‰æ‹©æ•°æ®æ·˜æ±° allkeys-lruï¼šä»æ•°æ®é›†ï¼ˆserver.db[i].dictï¼‰ä¸­æŒ‘é€‰æœ€è¿‘æœ€å°‘ä½¿ç”¨çš„æ•°æ®æ·˜æ±° allkeys-randomï¼šä»æ•°æ®é›†ï¼ˆserver.db[i].dictï¼‰ä¸­ä»»æ„é€‰æ‹©æ•°æ®æ·˜æ±° no-envictionï¼ˆé©±é€ï¼‰ï¼šç¦æ­¢é©±é€æ•°æ® 5ã€Memcacheä¸Redisçš„åŒºåˆ«éƒ½æœ‰å“ªäº› å­˜å‚¨æ–¹å¼ MemecacheæŠŠæ•°æ®å…¨éƒ¨å­˜åœ¨å†…å­˜ä¹‹ä¸­ï¼Œæ–­ç”µåä¼šæŒ‚æ‰ï¼Œæ•°æ®ä¸èƒ½è¶…è¿‡å†…å­˜å¤§å°ã€‚ Redisæœ‰éƒ¨ä»½å­˜åœ¨ç¡¬ç›˜ä¸Šï¼Œè¿™æ ·èƒ½ä¿è¯æ•°æ®çš„æŒä¹…æ€§ã€‚ æ•°æ®æ”¯æŒç±»å‹ Memcacheå¯¹æ•°æ®ç±»å‹æ”¯æŒç›¸å¯¹ç®€å•ã€‚ Redisæœ‰å¤æ‚çš„æ•°æ®ç±»å‹ ä½¿ç”¨åº•å±‚æ¨¡å‹ä¸åŒ å®ƒä»¬ä¹‹é—´åº•å±‚å®ç°æ–¹å¼ ä»¥åŠä¸å®¢æˆ·ç«¯ä¹‹é—´é€šä¿¡çš„åº”ç”¨åè®®ä¸ä¸€æ ·ã€‚ Redisç›´æ¥è‡ªå·±æ„å»ºäº†VM æœºåˆ¶ ï¼Œå› ä¸ºä¸€èˆ¬çš„ç³»ç»Ÿè°ƒç”¨ç³»ç»Ÿå‡½æ•°çš„è¯ï¼Œä¼šæµªè´¹ä¸€å®šçš„æ—¶é—´å»ç§»åŠ¨å’Œè¯·æ±‚ã€‚ valueå¤§å°redisæœ€å¤§å¯ä»¥è¾¾åˆ°1GBï¼Œè€Œmemcacheåªæœ‰1MB 6ã€ä¸ªäººæ€»ç»“äº†ä»¥ä¸‹å¤šç§Webåº”ç”¨åœºæ™¯ï¼Œåœ¨è¿™äº›åœºæ™¯ä¸‹å¯ä»¥å……åˆ†çš„åˆ©ç”¨Redisçš„ç‰¹æ€§ï¼Œå¤§å¤§æé«˜æ•ˆç‡ã€‚ åœ¨ä¸»é¡µä¸­æ˜¾ç¤ºæœ€æ–°çš„é¡¹ç›®åˆ—è¡¨ï¼šRedisä½¿ç”¨çš„æ˜¯å¸¸é©»å†…å­˜çš„ç¼“å­˜ï¼Œé€Ÿåº¦éå¸¸å¿«ã€‚LPUSHç”¨æ¥æ’å…¥ä¸€ä¸ªå†…å®¹IDï¼Œä½œä¸ºå…³é”®å­—å­˜å‚¨åœ¨åˆ—è¡¨å¤´éƒ¨ã€‚LTRIMç”¨æ¥é™åˆ¶åˆ—è¡¨ä¸­çš„é¡¹ç›®æ•°æœ€å¤šä¸º5000ã€‚å¦‚æœç”¨æˆ·éœ€è¦çš„æ£€ç´¢çš„æ•°æ®é‡è¶…è¶Šè¿™ä¸ªç¼“å­˜å®¹é‡ï¼Œè¿™æ—¶æ‰éœ€è¦æŠŠè¯·æ±‚å‘é€åˆ°æ•°æ®åº“ã€‚ åˆ é™¤å’Œè¿‡æ»¤ï¼šå¦‚æœä¸€ç¯‡æ–‡ç« è¢«åˆ é™¤ï¼Œå¯ä»¥ä½¿ç”¨LREMä»ç¼“å­˜ä¸­å½»åº•æ¸…é™¤æ‰ã€‚ æ’è¡Œæ¦œåŠç›¸å…³é—®é¢˜ï¼šæ’è¡Œæ¦œï¼ˆleader boardï¼‰æŒ‰ç…§å¾—åˆ†è¿›è¡Œæ’åºã€‚ZADDå‘½ä»¤å¯ä»¥ç›´æ¥å®ç°è¿™ä¸ªåŠŸèƒ½ï¼Œè€ŒZREVRANGEå‘½ä»¤å¯ä»¥ç”¨æ¥æŒ‰ç…§å¾—åˆ†æ¥è·å–å‰100åçš„ç”¨æˆ·ï¼ŒZRANKå¯ä»¥ç”¨æ¥è·å–ç”¨æˆ·æ’åï¼Œéå¸¸ç›´æ¥è€Œä¸”æ“ä½œå®¹æ˜“ã€‚ æŒ‰ç…§ç”¨æˆ·æŠ•ç¥¨å’Œæ—¶é—´æ’åºï¼šæ’è¡Œæ¦œï¼Œå¾—åˆ†ä¼šéšç€æ—¶é—´å˜åŒ–ã€‚LPUSHå’ŒLTRIMå‘½ä»¤ç»“åˆè¿ç”¨ï¼ŒæŠŠæ–‡ç« æ·»åŠ åˆ°ä¸€ä¸ªåˆ—è¡¨ä¸­ã€‚ä¸€é¡¹åå°ä»»åŠ¡ç”¨æ¥è·å–åˆ—è¡¨ï¼Œå¹¶é‡æ–°è®¡ç®—åˆ—è¡¨çš„æ’åºï¼ŒZADDå‘½ä»¤ç”¨æ¥æŒ‰ç…§æ–°çš„é¡ºåºå¡«å……ç”Ÿæˆåˆ—è¡¨ã€‚åˆ—è¡¨å¯ä»¥å®ç°éå¸¸å¿«é€Ÿçš„æ£€ç´¢ï¼Œå³ä½¿æ˜¯è´Ÿè½½å¾ˆé‡çš„ç«™ç‚¹ã€‚ è¿‡æœŸé¡¹ç›®å¤„ç†ï¼šä½¿ç”¨Unixæ—¶é—´ä½œä¸ºå…³é”®å­—ï¼Œç”¨æ¥ä¿æŒåˆ—è¡¨èƒ½å¤ŸæŒ‰æ—¶é—´æ’åºã€‚å¯¹current_timeå’Œtime_to_liveè¿›è¡Œæ£€ç´¢ï¼Œå®ŒæˆæŸ¥æ‰¾è¿‡æœŸé¡¹ç›®çš„è‰°å·¨ä»»åŠ¡ã€‚å¦ä¸€é¡¹åå°ä»»åŠ¡ä½¿ç”¨ZRANGEâ€¦WITHSCORESè¿›è¡ŒæŸ¥è¯¢ï¼Œåˆ é™¤è¿‡æœŸçš„æ¡ç›®ã€‚ è®¡æ•°ï¼šè¿›è¡Œå„ç§æ•°æ®ç»Ÿè®¡çš„ç”¨é€”æ˜¯éå¸¸å¹¿æ³›çš„ï¼Œæ¯”å¦‚æƒ³çŸ¥é“ä»€ä¹ˆæ—¶å€™å°é”ä¸€ä¸ªIPåœ°å€ã€‚INCRBYå‘½ä»¤è®©è¿™äº›å˜å¾—å¾ˆå®¹æ˜“ï¼Œé€šè¿‡åŸå­é€’å¢ä¿æŒè®¡æ•°ï¼›GETSETç”¨æ¥é‡ç½®è®¡æ•°å™¨ï¼›è¿‡æœŸå±æ€§ç”¨æ¥ç¡®è®¤ä¸€ä¸ªå…³é”®å­—ä»€ä¹ˆæ—¶å€™åº”è¯¥åˆ é™¤ã€‚ ç‰¹å®šæ—¶é—´å†…çš„ç‰¹å®šé¡¹ç›®ï¼šè¿™æ˜¯ç‰¹å®šè®¿é—®è€…çš„é—®é¢˜ï¼Œå¯ä»¥é€šè¿‡ç»™æ¯æ¬¡é¡µé¢æµè§ˆä½¿ç”¨SADDå‘½ä»¤æ¥è§£å†³ã€‚SADDä¸ä¼šå°†å·²ç»å­˜åœ¨çš„æˆå‘˜æ·»åŠ åˆ°ä¸€ä¸ªé›†åˆã€‚ Pub/Subï¼šåœ¨æ›´æ–°ä¸­ä¿æŒç”¨æˆ·å¯¹æ•°æ®çš„æ˜ å°„æ˜¯ç³»ç»Ÿä¸­çš„ä¸€ä¸ªæ™®éä»»åŠ¡ã€‚Redisçš„pub/subåŠŸèƒ½ä½¿ç”¨äº†SUBSCRIBEã€UNSUBSCRIBEå’ŒPUBLISHå‘½ä»¤ï¼Œè®©è¿™ä¸ªå˜å¾—æ›´åŠ å®¹æ˜“ã€‚ é˜Ÿåˆ—ï¼šåœ¨å½“å‰çš„ç¼–ç¨‹ä¸­é˜Ÿåˆ—éšå¤„å¯è§ã€‚é™¤äº†pushå’Œpopç±»å‹çš„å‘½ä»¤ä¹‹å¤–ï¼ŒRedisè¿˜æœ‰é˜»å¡é˜Ÿåˆ—çš„å‘½ä»¤ï¼Œèƒ½å¤Ÿè®©ä¸€ä¸ªç¨‹åºåœ¨æ‰§è¡Œæ—¶è¢«å¦ä¸€ä¸ªç¨‹åºæ·»åŠ åˆ°é˜Ÿåˆ— 7ã€Redisçš„å…¨ç§°æ˜¯ä»€ä¹ˆï¼ŸRemote Dictionary Serverã€‚ 8ã€ä¸€ä¸ªå­—ç¬¦ä¸²ç±»å‹çš„å€¼èƒ½å­˜å‚¨æœ€å¤§å®¹é‡æ˜¯å¤šå°‘ï¼Ÿ512M 9ã€ä¸ºä»€ä¹ˆRediséœ€è¦æŠŠæ‰€æœ‰æ•°æ®æ”¾åˆ°å†…å­˜ä¸­ï¼ŸRedisä¸ºäº†è¾¾åˆ°æœ€å¿«çš„è¯»å†™é€Ÿåº¦å°†æ•°æ®éƒ½è¯»åˆ°å†…å­˜ä¸­ï¼Œå¹¶é€šè¿‡å¼‚æ­¥çš„æ–¹å¼å°†æ•°æ®å†™å…¥ç£ç›˜ã€‚æ‰€ä»¥rediså…·æœ‰å¿«é€Ÿå’Œæ•°æ®æŒä¹…åŒ–çš„ç‰¹å¾ã€‚å¦‚æœä¸å°†æ•°æ®æ”¾åœ¨å†…å­˜ä¸­ï¼Œç£ç›˜I/Oé€Ÿåº¦ä¸ºä¸¥é‡å½±å“redisçš„æ€§èƒ½ã€‚åœ¨å†…å­˜è¶Šæ¥è¶Šä¾¿å®œçš„ä»Šå¤©ï¼Œrediså°†ä¼šè¶Šæ¥è¶Šå—æ¬¢è¿ã€‚ å¦‚æœè®¾ç½®äº†æœ€å¤§ä½¿ç”¨çš„å†…å­˜ï¼Œåˆ™æ•°æ®å·²æœ‰è®°å½•æ•°è¾¾åˆ°å†…å­˜é™å€¼åä¸èƒ½ç»§ç»­æ’å…¥æ–°å€¼ã€‚ 10ã€Redisé›†ç¾¤æ–¹æ¡ˆåº”è¯¥æ€ä¹ˆåšï¼Ÿéƒ½æœ‰å“ªäº›æ–¹æ¡ˆï¼Ÿ 1.codisã€‚ ç›®å‰ç”¨çš„æœ€å¤šçš„é›†ç¾¤æ–¹æ¡ˆï¼ŒåŸºæœ¬å’Œtwemproxyä¸€è‡´çš„æ•ˆæœï¼Œä½†å®ƒæ”¯æŒåœ¨ èŠ‚ç‚¹æ•°é‡æ”¹å˜æƒ…å†µä¸‹ï¼Œæ—§èŠ‚ç‚¹æ•°æ®å¯æ¢å¤åˆ°æ–°hashèŠ‚ç‚¹ã€‚ 2.redis cluster3.0è‡ªå¸¦çš„é›†ç¾¤ï¼Œç‰¹ç‚¹åœ¨äºä»–çš„åˆ†å¸ƒå¼ç®—æ³•ä¸æ˜¯ä¸€è‡´æ€§hashï¼Œè€Œæ˜¯hashæ§½çš„æ¦‚å¿µï¼Œä»¥åŠè‡ªèº«æ”¯æŒèŠ‚ç‚¹è®¾ç½®ä»èŠ‚ç‚¹ã€‚å…·ä½“çœ‹å®˜æ–¹æ–‡æ¡£ä»‹ç»ã€‚ 3.åœ¨ä¸šåŠ¡ä»£ç å±‚å®ç°ï¼Œèµ·å‡ ä¸ªæ¯«æ— å…³è”çš„rediså®ä¾‹ï¼Œåœ¨ä»£ç å±‚ï¼Œå¯¹key è¿›è¡Œhashè®¡ç®—ï¼Œç„¶åå»å¯¹åº”çš„rediså®ä¾‹æ“ä½œæ•°æ®ã€‚ è¿™ç§æ–¹å¼å¯¹hashå±‚ä»£ç è¦æ±‚æ¯”è¾ƒé«˜ï¼Œè€ƒè™‘éƒ¨åˆ†åŒ…æ‹¬ï¼ŒèŠ‚ç‚¹å¤±æ•ˆåçš„æ›¿ä»£ç®—æ³•æ–¹æ¡ˆï¼Œæ•°æ®éœ‡è¡åçš„è‡ªåŠ¨è„šæœ¬æ¢å¤ï¼Œå®ä¾‹çš„ç›‘æ§ï¼Œç­‰ç­‰ã€‚ 11ã€Redisé›†ç¾¤æ–¹æ¡ˆä»€ä¹ˆæƒ…å†µä¸‹ä¼šå¯¼è‡´æ•´ä¸ªé›†ç¾¤ä¸å¯ç”¨ï¼Ÿæœ‰Aï¼ŒBï¼ŒCä¸‰ä¸ªèŠ‚ç‚¹çš„é›†ç¾¤,åœ¨æ²¡æœ‰å¤åˆ¶æ¨¡å‹çš„æƒ…å†µä¸‹,å¦‚æœèŠ‚ç‚¹Bå¤±è´¥äº†ï¼Œé‚£ä¹ˆæ•´ä¸ªé›†ç¾¤å°±ä¼šä»¥ä¸ºç¼ºå°‘5501-11000è¿™ä¸ªèŒƒå›´çš„æ§½è€Œä¸å¯ç”¨ã€‚ 12ã€Redisæœ‰å“ªäº›é€‚åˆçš„åœºæ™¯ï¼Ÿ ï¼ˆ1ï¼‰ä¼šè¯ç¼“å­˜ï¼ˆSession Cacheï¼‰ æœ€å¸¸ç”¨çš„ä¸€ç§ä½¿ç”¨Redisçš„æƒ…æ™¯æ˜¯ä¼šè¯ç¼“å­˜ï¼ˆsession cacheï¼‰ã€‚ç”¨Redisç¼“å­˜ä¼šè¯æ¯”å…¶ä»–å­˜å‚¨ï¼ˆå¦‚Memcachedï¼‰çš„ä¼˜åŠ¿åœ¨äºï¼šRedisæä¾›æŒä¹…åŒ–ã€‚å½“ç»´æŠ¤ä¸€ä¸ªä¸æ˜¯ä¸¥æ ¼è¦æ±‚ä¸€è‡´æ€§çš„ç¼“å­˜æ—¶ï¼Œå¦‚æœç”¨æˆ·çš„è´­ç‰©è½¦ä¿¡æ¯å…¨éƒ¨ä¸¢å¤±ï¼Œå¤§éƒ¨åˆ†äººéƒ½ä¼šä¸é«˜å…´çš„ï¼Œç°åœ¨ï¼Œä»–ä»¬è¿˜ä¼šè¿™æ ·å—ï¼Ÿ å¹¸è¿çš„æ˜¯ï¼Œéšç€ Redis è¿™äº›å¹´çš„æ”¹è¿›ï¼Œå¾ˆå®¹æ˜“æ‰¾åˆ°æ€ä¹ˆæ°å½“çš„ä½¿ç”¨Redisæ¥ç¼“å­˜ä¼šè¯çš„æ–‡æ¡£ã€‚ç”šè‡³å¹¿ä¸ºäººçŸ¥çš„å•†ä¸šå¹³å°Magentoä¹Ÿæä¾›Redisçš„æ’ä»¶ã€‚ ï¼ˆ2ï¼‰å…¨é¡µç¼“å­˜ï¼ˆFPCï¼‰ é™¤åŸºæœ¬çš„ä¼šè¯tokenä¹‹å¤–ï¼ŒRedisè¿˜æä¾›å¾ˆç®€ä¾¿çš„FPCå¹³å°ã€‚å›åˆ°ä¸€è‡´æ€§é—®é¢˜ï¼Œå³ä½¿é‡å¯äº†Rediså®ä¾‹ï¼Œå› ä¸ºæœ‰ç£ç›˜çš„æŒä¹…åŒ–ï¼Œç”¨æˆ·ä¹Ÿä¸ä¼šçœ‹åˆ°é¡µé¢åŠ è½½é€Ÿåº¦çš„ä¸‹é™ï¼Œè¿™æ˜¯ä¸€ä¸ªæå¤§æ”¹è¿›ï¼Œç±»ä¼¼PHPæœ¬åœ°FPCã€‚ å†æ¬¡ä»¥Magentoä¸ºä¾‹ï¼ŒMagentoæä¾›ä¸€ä¸ªæ’ä»¶æ¥ä½¿ç”¨Redisä½œä¸ºå…¨é¡µç¼“å­˜åç«¯ã€‚ æ­¤å¤–ï¼Œå¯¹WordPressçš„ç”¨æˆ·æ¥è¯´ï¼ŒPantheonæœ‰ä¸€ä¸ªéå¸¸å¥½çš„æ’ä»¶ wp-redisï¼Œè¿™ä¸ªæ’ä»¶èƒ½å¸®åŠ©ä½ ä»¥æœ€å¿«é€Ÿåº¦åŠ è½½ä½ æ›¾æµè§ˆè¿‡çš„é¡µé¢ã€‚ ï¼ˆ3ï¼‰é˜Ÿåˆ— Reidsåœ¨å†…å­˜å­˜å‚¨å¼•æ“é¢†åŸŸçš„ä¸€å¤§ä¼˜ç‚¹æ˜¯æä¾› list å’Œ set æ“ä½œï¼Œè¿™ä½¿å¾—Redisèƒ½ä½œä¸ºä¸€ä¸ªå¾ˆå¥½çš„æ¶ˆæ¯é˜Ÿåˆ—å¹³å°æ¥ä½¿ç”¨ã€‚Redisä½œä¸ºé˜Ÿåˆ—ä½¿ç”¨çš„æ“ä½œï¼Œå°±ç±»ä¼¼äºæœ¬åœ°ç¨‹åºè¯­è¨€ï¼ˆå¦‚Pythonï¼‰å¯¹ list çš„ push/pop æ“ä½œã€‚ å¦‚æœä½ å¿«é€Ÿçš„åœ¨Googleä¸­æœç´¢â€œRedis queuesâ€ï¼Œä½ é©¬ä¸Šå°±èƒ½æ‰¾åˆ°å¤§é‡çš„å¼€æºé¡¹ç›®ï¼Œè¿™äº›é¡¹ç›®çš„ç›®çš„å°±æ˜¯åˆ©ç”¨Redisåˆ›å»ºéå¸¸å¥½çš„åç«¯å·¥å…·ï¼Œä»¥æ»¡è¶³å„ç§é˜Ÿåˆ—éœ€æ±‚ã€‚ä¾‹å¦‚ï¼ŒCeleryæœ‰ä¸€ä¸ªåå°å°±æ˜¯ä½¿ç”¨Redisä½œä¸ºbrokerï¼Œä½ å¯ä»¥ä»è¿™é‡Œå»æŸ¥çœ‹ã€‚ ï¼ˆ4ï¼‰æ’è¡Œæ¦œ/è®¡æ•°å™¨ Redisåœ¨å†…å­˜ä¸­å¯¹æ•°å­—è¿›è¡Œé€’å¢æˆ–é€’å‡çš„æ“ä½œå®ç°çš„éå¸¸å¥½ã€‚é›†åˆï¼ˆSetï¼‰å’Œæœ‰åºé›†åˆï¼ˆSorted Setï¼‰ä¹Ÿä½¿å¾—æˆ‘ä»¬åœ¨æ‰§è¡Œè¿™äº›æ“ä½œçš„æ—¶å€™å˜çš„éå¸¸ç®€å•ï¼ŒRedisåªæ˜¯æ­£å¥½æä¾›äº†è¿™ä¸¤ç§æ•°æ®ç»“æ„ã€‚ æ‰€ä»¥ï¼Œæˆ‘ä»¬è¦ä»æ’åºé›†åˆä¸­è·å–åˆ°æ’åæœ€é å‰çš„10ä¸ªç”¨æˆ·â€“æˆ‘ä»¬ç§°ä¹‹ä¸ºâ€œuser_scoresâ€ï¼Œæˆ‘ä»¬åªéœ€è¦åƒä¸‹é¢ä¸€æ ·æ‰§è¡Œå³å¯ï¼š å½“ç„¶ï¼Œè¿™æ˜¯å‡å®šä½ æ˜¯æ ¹æ®ä½ ç”¨æˆ·çš„åˆ†æ•°åšé€’å¢çš„æ’åºã€‚å¦‚æœä½ æƒ³è¿”å›ç”¨æˆ·åŠç”¨æˆ·çš„åˆ†æ•°ï¼Œä½ éœ€è¦è¿™æ ·æ‰§è¡Œï¼š ZRANGE user_scores 0 10 WITHSCORES Agora Gameså°±æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„ä¾‹å­ï¼Œç”¨Rubyå®ç°çš„ï¼Œå®ƒçš„æ’è¡Œæ¦œå°±æ˜¯ä½¿ç”¨Redisæ¥å­˜å‚¨æ•°æ®çš„ï¼Œä½ å¯ä»¥åœ¨è¿™é‡Œçœ‹åˆ°ã€‚ ï¼ˆ5ï¼‰å‘å¸ƒ/è®¢é˜… æœ€åï¼ˆä½†è‚¯å®šä¸æ˜¯æœ€ä¸é‡è¦çš„ï¼‰æ˜¯Redisçš„å‘å¸ƒ/è®¢é˜…åŠŸèƒ½ã€‚å‘å¸ƒ/è®¢é˜…çš„ä½¿ç”¨åœºæ™¯ç¡®å®éå¸¸å¤šã€‚æˆ‘å·²çœ‹è§äººä»¬åœ¨ç¤¾äº¤ç½‘ç»œè¿æ¥ä¸­ä½¿ç”¨ï¼Œè¿˜å¯ä½œä¸ºåŸºäºå‘å¸ƒ/è®¢é˜…çš„è„šæœ¬è§¦å‘å™¨ï¼Œç”šè‡³ç”¨Redisçš„å‘å¸ƒ/è®¢é˜…åŠŸèƒ½æ¥å»ºç«‹èŠå¤©ç³»ç»Ÿï¼ 13ã€Redisæ”¯æŒçš„Javaå®¢æˆ·ç«¯éƒ½æœ‰å“ªäº›ï¼Ÿå®˜æ–¹æ¨èç”¨å“ªä¸ªï¼ŸRedissonã€Jedisã€lettuceç­‰ç­‰ï¼Œå®˜æ–¹æ¨èä½¿ç”¨Redissonã€‚ 14ã€Jedisä¸Redissonå¯¹æ¯”æœ‰ä»€ä¹ˆä¼˜ç¼ºç‚¹ï¼ŸJedisæ˜¯Redisçš„Javaå®ç°çš„å®¢æˆ·ç«¯ï¼Œå…¶APIæä¾›äº†æ¯”è¾ƒå…¨é¢çš„Rediså‘½ä»¤çš„æ”¯æŒï¼› Redissonå®ç°äº†åˆ†å¸ƒå¼å’Œå¯æ‰©å±•çš„Javaæ•°æ®ç»“æ„ï¼Œå’ŒJedisç›¸æ¯”ï¼ŒåŠŸèƒ½è¾ƒä¸ºç®€å•ï¼Œä¸æ”¯æŒå­—ç¬¦ä¸²æ“ä½œï¼Œä¸æ”¯æŒæ’åºã€äº‹åŠ¡ã€ç®¡é“ã€åˆ†åŒºç­‰Redisç‰¹æ€§ã€‚Redissonçš„å®—æ—¨æ˜¯ä¿ƒè¿›ä½¿ç”¨è€…å¯¹Redisçš„å…³æ³¨åˆ†ç¦»ï¼Œä»è€Œè®©ä½¿ç”¨è€…èƒ½å¤Ÿå°†ç²¾åŠ›æ›´é›†ä¸­åœ°æ”¾åœ¨å¤„ç†ä¸šåŠ¡é€»è¾‘ä¸Šã€‚ 15ã€Rediså’ŒRedissonæœ‰ä»€ä¹ˆå…³ç³»ï¼Ÿ==Redissonæ˜¯ä¸€ä¸ªé«˜çº§çš„åˆ†å¸ƒå¼åè°ƒRediså®¢æœç«¯==ï¼Œèƒ½å¸®åŠ©ç”¨æˆ·åœ¨åˆ†å¸ƒå¼ç¯å¢ƒä¸­è½»æ¾å®ç°ä¸€äº›Javaçš„å¯¹è±¡ (Bloom filter, BitSet, Set, SetMultimap, ScoredSortedSet, SortedSet, Map, ConcurrentMap, List, ListMultimap, Queue, BlockingQueue, Deque, BlockingDeque, Semaphore, Lock, ReadWriteLock, AtomicLong, CountDownLatch, Publish / Subscribe, HyperLogLog)ã€‚ 17ã€Rediså¦‚ä½•è®¾ç½®å¯†ç åŠéªŒè¯å¯†ç ï¼Ÿè®¾ç½®å¯†ç ï¼šconfig set requirepass 123456 æˆæƒå¯†ç ï¼šauth 123456 18ã€è¯´è¯´Rediså“ˆå¸Œæ§½çš„æ¦‚å¿µï¼ŸRedisé›†ç¾¤æ²¡æœ‰ä½¿ç”¨ä¸€è‡´æ€§hash,è€Œæ˜¯å¼•å…¥äº†å“ˆå¸Œæ§½çš„æ¦‚å¿µï¼ŒRedisé›†ç¾¤æœ‰16384ä¸ªå“ˆå¸Œæ§½ï¼Œæ¯ä¸ªkeyé€šè¿‡CRC16æ ¡éªŒåå¯¹16384å–æ¨¡æ¥å†³å®šæ”¾ç½®å“ªä¸ªæ§½ï¼Œé›†ç¾¤çš„æ¯ä¸ªèŠ‚ç‚¹è´Ÿè´£ä¸€éƒ¨åˆ†hashæ§½ã€‚ 19ã€Redisé›†ç¾¤çš„ä¸»ä»å¤åˆ¶æ¨¡å‹æ˜¯æ€æ ·çš„ï¼Ÿä¸ºäº†ä½¿åœ¨éƒ¨åˆ†èŠ‚ç‚¹å¤±è´¥æˆ–è€…å¤§éƒ¨åˆ†èŠ‚ç‚¹æ— æ³•é€šä¿¡çš„æƒ…å†µä¸‹é›†ç¾¤ä»ç„¶å¯ç”¨ï¼Œæ‰€ä»¥é›†ç¾¤ä½¿ç”¨äº†ä¸»ä»å¤åˆ¶æ¨¡å‹,æ¯ä¸ªèŠ‚ç‚¹éƒ½ä¼šæœ‰N-1ä¸ªå¤åˆ¶å“. 20ã€Redisé›†ç¾¤ä¼šæœ‰å†™æ“ä½œä¸¢å¤±å—ï¼Ÿä¸ºä»€ä¹ˆï¼ŸRediså¹¶ä¸èƒ½ä¿è¯æ•°æ®çš„å¼ºä¸€è‡´æ€§ï¼Œè¿™æ„å‘³è¿™åœ¨å®é™…ä¸­é›†ç¾¤åœ¨ç‰¹å®šçš„æ¡ä»¶ä¸‹å¯èƒ½ä¼šä¸¢å¤±å†™æ“ä½œã€‚ 21ã€Redisé›†ç¾¤ä¹‹é—´æ˜¯å¦‚ä½•å¤åˆ¶çš„ï¼Ÿå¼‚æ­¥å¤åˆ¶ 22ã€Redisé›†ç¾¤æœ€å¤§èŠ‚ç‚¹ä¸ªæ•°æ˜¯å¤šå°‘ï¼Ÿ16384ä¸ªã€‚ 23ã€Redisé›†ç¾¤å¦‚ä½•é€‰æ‹©æ•°æ®åº“ï¼ŸRedisé›†ç¾¤ç›®å‰æ— æ³•åšæ•°æ®åº“é€‰æ‹©ï¼Œé»˜è®¤åœ¨0æ•°æ®åº“ã€‚ 24ã€æ€ä¹ˆæµ‹è¯•Redisçš„è¿é€šæ€§ï¼Ÿping 25ã€Redisä¸­çš„ç®¡é“æœ‰ä»€ä¹ˆç”¨ï¼Ÿä¸€æ¬¡è¯·æ±‚/å“åº”æœåŠ¡å™¨èƒ½å®ç°å¤„ç†æ–°çš„è¯·æ±‚å³ä½¿æ—§çš„è¯·æ±‚è¿˜æœªè¢«å“åº”ã€‚è¿™æ ·å°±å¯ä»¥å°†å¤šä¸ªå‘½ä»¤å‘é€åˆ°æœåŠ¡å™¨ï¼Œè€Œä¸ç”¨ç­‰å¾…å›å¤ï¼Œæœ€ååœ¨ä¸€ä¸ªæ­¥éª¤ä¸­è¯»å–è¯¥ç­”å¤ã€‚ è¿™å°±æ˜¯ç®¡é“ï¼ˆpipeliningï¼‰ï¼Œæ˜¯ä¸€ç§å‡ åå¹´æ¥å¹¿æ³›ä½¿ç”¨çš„æŠ€æœ¯ã€‚ä¾‹å¦‚è®¸å¤šPOP3åè®®å·²ç»å®ç°æ”¯æŒè¿™ä¸ªåŠŸèƒ½ï¼Œå¤§å¤§åŠ å¿«äº†ä»æœåŠ¡å™¨ä¸‹è½½æ–°é‚®ä»¶çš„è¿‡ç¨‹ã€‚ 26ã€æ€ä¹ˆç†è§£Redisäº‹åŠ¡ï¼Ÿäº‹åŠ¡æ˜¯ä¸€ä¸ªå•ç‹¬çš„éš”ç¦»æ“ä½œï¼šäº‹åŠ¡ä¸­çš„æ‰€æœ‰å‘½ä»¤éƒ½ä¼šåºåˆ—åŒ–ã€æŒ‰é¡ºåºåœ°æ‰§è¡Œã€‚äº‹åŠ¡åœ¨æ‰§è¡Œçš„è¿‡ç¨‹ä¸­ï¼Œä¸ä¼šè¢«å…¶ä»–å®¢æˆ·ç«¯å‘é€æ¥çš„å‘½ä»¤è¯·æ±‚æ‰€æ‰“æ–­ã€‚ äº‹åŠ¡æ˜¯ä¸€ä¸ªåŸå­æ“ä½œï¼šäº‹åŠ¡ä¸­çš„å‘½ä»¤è¦ä¹ˆå…¨éƒ¨è¢«æ‰§è¡Œï¼Œè¦ä¹ˆå…¨éƒ¨éƒ½ä¸æ‰§è¡Œã€‚ 27ã€Redisäº‹åŠ¡ç›¸å…³çš„å‘½ä»¤æœ‰å“ªå‡ ä¸ªï¼Ÿ****MULTIã€EXECã€DISCARDã€WATCH 28ã€Redis keyçš„è¿‡æœŸæ—¶é—´å’Œæ°¸ä¹…æœ‰æ•ˆåˆ†åˆ«æ€ä¹ˆè®¾ç½®ï¼ŸEXPIREå’ŒPERSISTå‘½ä»¤ã€‚ 29ã€Rediså¦‚ä½•åšå†…å­˜ä¼˜åŒ–ï¼Ÿå°½å¯èƒ½ä½¿ç”¨æ•£åˆ—è¡¨ï¼ˆhashesï¼‰ï¼Œæ•£åˆ—è¡¨ï¼ˆæ˜¯è¯´æ•£åˆ—è¡¨é‡Œé¢å­˜å‚¨çš„æ•°å°‘ï¼‰ä½¿ç”¨çš„å†…å­˜éå¸¸å°ï¼Œæ‰€ä»¥ä½ åº”è¯¥å°½å¯èƒ½çš„å°†ä½ çš„æ•°æ®æ¨¡å‹æŠ½è±¡åˆ°ä¸€ä¸ªæ•£åˆ—è¡¨é‡Œé¢ã€‚ æ¯”å¦‚ä½ çš„webç³»ç»Ÿä¸­æœ‰ä¸€ä¸ªç”¨æˆ·å¯¹è±¡ï¼Œä¸è¦ä¸ºè¿™ä¸ªç”¨æˆ·çš„åç§°ï¼Œå§“æ°ï¼Œé‚®ç®±ï¼Œå¯†ç è®¾ç½®å•ç‹¬çš„key,è€Œæ˜¯åº”è¯¥æŠŠè¿™ä¸ªç”¨æˆ·çš„æ‰€æœ‰ä¿¡æ¯å­˜å‚¨åˆ°ä¸€å¼ æ•£åˆ—è¡¨é‡Œé¢ã€‚ 30ã€Rediså›æ”¶è¿›ç¨‹å¦‚ä½•å·¥ä½œçš„ï¼Ÿä¸€ä¸ªå®¢æˆ·ç«¯è¿è¡Œäº†æ–°çš„å‘½ä»¤ï¼Œæ·»åŠ äº†æ–°çš„æ•°æ®ã€‚Rediæ£€æŸ¥å†…å­˜ä½¿ç”¨æƒ…å†µï¼Œå¦‚æœå¤§äºmaxmemoryçš„é™åˆ¶, åˆ™æ ¹æ®è®¾å®šå¥½çš„ç­–ç•¥è¿›è¡Œå›æ”¶ã€‚","categories":[],"tags":[{"name":"IT","slug":"IT","permalink":"/tags/IT/"},{"name":"æŠ€æœ¯ç¬”è®°","slug":"æŠ€æœ¯ç¬”è®°","permalink":"/tags/%E6%8A%80%E6%9C%AF%E7%AC%94%E8%AE%B0/"},{"name":"æ•°æ®åº“","slug":"æ•°æ®åº“","permalink":"/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/"},{"name":"Job","slug":"Job","permalink":"/tags/Job/"},{"name":"Redis","slug":"Redis","permalink":"/tags/Redis/"}]},{"title":"ç®—æ³•ç¬”è®°","slug":"ç®—æ³•ç¬”è®°","date":"2019-10-20T11:51:12.000Z","updated":"2019-10-20T11:37:22.747Z","comments":true,"path":"2019/10/20/ç®—æ³•ç¬”è®°/","link":"","permalink":"/2019/10/20/%E7%AE%97%E6%B3%95%E7%AC%94%E8%AE%B0/","excerpt":"","text":"åå¤§ç®—æ³•é€’å½’ç®—æ³•èƒ½å¤Ÿç”¨é€’å½’è§£å†³çš„é—®é¢˜éœ€è¦æ»¡è¶³ä¸‰ä¸ªæ¡ä»¶ï¼š åŸé—®é¢˜å¯ä»¥è½¬æ¢ä¸ºä¸€ä¸ªæˆ–å¤šä¸ªå­é—®é¢˜æ¥æ±‚è§£ï¼Œè€Œè¿™äº›å­é—®é¢˜çš„æ±‚è§£æ–¹æ³•å’ŒåŸé—®é¢˜å®Œå…¨ç›¸åŒï¼Œåªæ˜¯è§„æ¨¡ä¸åŒï¼› é€’å½’è°ƒç”¨æ¬¡æ•°å¿…é¡»æ˜¯æœ‰é™çš„ï¼› å¿…é¡»æœ‰ç»“æŸé€’å½’çš„æ¡ä»¶ï¼ˆé€’å½’å‡ºå£ï¼‰æ¥ç»ˆæ­¢é€’å½’ã€‚ è®¾è®¡é€’å½’ç®—æ³•æ¨¡å¼ å…ˆæ±‚è§£é—®é¢˜çš„é€’å½’æ¨¡å‹ã€‚ åœ¨è®¾è®¡é€’å½’ç®—æ³•çš„æ—¶å€™ï¼Œå¦‚æœçº ç»“é€’å½’æ ‘çš„æ¯ä¸€ä¸ªé˜¶æ®µçš„è¯ï¼Œå°±ä¼šæä¸ºå¤æ‚ã€‚å› æ­¤ï¼Œåªè€ƒè™‘é€’å½’æ ‘ä¸­çš„ç¬¬ä¸€å±‚å’Œç¬¬äºŒå±‚ä¹‹é—´çš„å…³ç³»å³å¯ï¼Œå³â€œå¤§é—®é¢˜â€ å’Œ â€œå°é—®é¢˜â€ çš„å…³ç³»ï¼Œå…¶ä»–å…³ç³»ç±»ä¼¼ã€‚ æ±‚è§£é—®é¢˜çš„é€’å½’æ¨¡å‹ï¼š å¯¹åŸé—®é¢˜ f(n) è¿›è¡Œåˆ†æï¼Œå‡è®¾å‡ºåˆç†çš„å°é—®é¢˜ f(n-1)ï¼› å‡è®¾å°é—®é¢˜ f(n-1) æ˜¯å¯è§£çš„ï¼Œåœ¨æ­¤åŸºç¡€ä¸Šç¡®å®šå¤§é—®é¢˜ f(n) çš„è§£ï¼Œå³ç»™å‡º f(n) ä¸ f(n-1) ä¹‹é—´çš„å…³ç³»ï¼Œä¹Ÿå°±æ˜¯ç¡®å®šäº†é€’å½’ä½“ã€‚ï¼ˆä¸æ•°å­¦å½’çº³æ³•ä¸­ç¡®å®š i=n-1 æ—¶æˆç«‹ï¼Œå†æ±‚è¯ i=n æ—¶ç­‰å¼æˆç«‹çš„è¿‡ç¨‹ç›¸ä¼¼ï¼‰ã€‚è¿˜è¦æ˜ç¡®éœ€è¦è¿”å›ä»€ä¹ˆä¿¡æ¯ç»™ä¸Šä¸€å±‚é€’å½’è°ƒç”¨ã€‚ ç¡®å®šä¸€ä¸ªç‰¹å®šæƒ…å†µï¼ˆå¦‚ f(0) æˆ– f(1)ï¼‰çš„è§£ï¼Œç”±æ­¤ä½œä¸ºé€’å½’å‡ºå£ã€‚ï¼ˆä¸æ•°å­¦å½’çº³æ³•ä¸­æ±‚è¯ i=0 æˆ– i=1æ—¶ç­‰å¼æˆç«‹ç›¸ä¼¼ï¼‰ ä¾‹å­:æ±‚æ•°ç»„ä¸­æœ€å°å€¼ï¼š123456789101112131415161718/** * é€’å½’æ±‚æ•°ç»„æœ€å¤§å€¼ * * @param arr ç›®æ ‡æ•°ç»„ * @param i èµ·å§‹ä¸‹æ ‡ * @return */private static int getMax(int[] arr, int i) &#123; if (i == arr.length - 1) &#123; return arr[i];//åªæœ‰ä¸€ä¸ªå…ƒç´ çš„æ—¶å€™,å®ƒå°±æ˜¯æœ€å¤§å€¼ï¼ˆç‰¹å®šé—®é¢˜çš„è§£ï¼‰ &#125; else &#123; //å‡è®¾è§£å‡ºäº†å­é—®é¢˜i+1çš„æœ€å¤§å€¼, //å°†i+1çš„æœ€å¤§å€¼å’Œå½“å‰iè¿›è¡Œæ¯”è¾ƒ, è¿”å›æœ€å¤§çš„ //å°†æœ€åä¸€ä¸ªå…ƒç´ ä¸â€œå‡è®¾å­˜åœ¨çš„â€æœ€å¤§å€¼æ¯”è¾ƒ int max = Math.max(arr[i], getMax(arr, i + 1)); return max; &#125;&#125; åˆ†æ²»ç®—æ³• åˆ†æ²»æ³•æ˜¯ä¸€ç§å¾ˆé‡è¦çš„ç®—æ³•ã€‚å­—é¢ä¸Šçš„è§£é‡Šæ˜¯â€œåˆ†è€Œæ²»ä¹‹â€ï¼Œå°±æ˜¯æŠŠä¸€ä¸ªå¤æ‚çš„é—®é¢˜åˆ†æˆä¸¤ä¸ªæˆ–æ›´å¤šçš„ç›¸åŒæˆ–ç›¸ä¼¼çš„å­é—®é¢˜ï¼Œå†æŠŠå­é—®é¢˜åˆ†æˆæ›´å°çš„å­é—®é¢˜â€¦â€¦ç›´åˆ°æœ€åå­é—®é¢˜å¯ä»¥ç®€å•çš„ç›´æ¥æ±‚è§£ï¼ŒåŸé—®é¢˜çš„è§£å³å­é—®é¢˜çš„è§£çš„åˆå¹¶ã€‚ åˆ†æ²»æ³•é€‚ç”¨çš„æƒ…å†µåˆ†æ²»ç®—æ³•æ‰€èƒ½è§£å†³çš„é—®é¢˜ä¸€èˆ¬å…·æœ‰ä»¥ä¸‹å‡ ä¸ªç‰¹å¾: 1) è¯¥é—®é¢˜çš„è§„æ¨¡ç¼©å°åˆ°ä¸€å®šçš„ç¨‹åº¦å°±å¯ä»¥å®¹æ˜“åœ°è§£å†³ 2) è¯¥é—®é¢˜å¯ä»¥åˆ†è§£ä¸ºè‹¥å¹²ä¸ªè§„æ¨¡è¾ƒå°çš„ç›¸åŒé—®é¢˜ï¼Œå³è¯¥é—®é¢˜å…·æœ‰æœ€ä¼˜å­ç»“æ„æ€§è´¨ã€‚ 3) åˆ©ç”¨è¯¥é—®é¢˜åˆ†è§£å‡ºçš„å­é—®é¢˜çš„è§£å¯ä»¥åˆå¹¶ä¸ºè¯¥é—®é¢˜çš„è§£ï¼› å¦‚æœä¸å…·å¤‡è¿™ä¸€æ¡ç‰¹å¾, é‚£ä¹ˆå¯ä»¥è€ƒè™‘ä½¿ç”¨è´ªå¿ƒç®—æ³•æˆ–è€…åŠ¨æ€è§„åˆ’ç®—æ³• 4) è¯¥é—®é¢˜æ‰€åˆ†è§£å‡ºçš„å„ä¸ªå­é—®é¢˜æ˜¯ç›¸äº’ç‹¬ç«‹çš„ï¼Œå³å­é—®é¢˜ä¹‹é—´ä¸åŒ…å«å…¬å…±çš„å­å­é—®é¢˜ã€‚ å¦‚æœå„å­é—®é¢˜æ˜¯ä¸ç‹¬ç«‹çš„åˆ™åˆ†æ²»æ³•è¦åšè®¸å¤šä¸å¿…è¦çš„å·¥ä½œï¼Œé‡å¤åœ°è§£å…¬å…±çš„å­é—®é¢˜ï¼Œæ­¤æ—¶è™½ç„¶å¯ç”¨åˆ†æ²»æ³•ï¼Œä½†ä¸€èˆ¬ç”¨åŠ¨æ€è§„åˆ’æ³•è¾ƒå¥½ã€‚ åˆ†æ²»æ³•çš„åŸºæœ¬æ­¥éª¤åˆ†æ²»æ³•åœ¨æ¯ä¸€å±‚é€’å½’ä¸Šéƒ½æœ‰ä¸‰ä¸ªæ­¥éª¤ï¼š ï¼ˆ1ï¼‰åˆ†è§£ï¼Œå°†è¦è§£å†³çš„é—®é¢˜åˆ’åˆ†æˆè‹¥å¹²è§„æ¨¡è¾ƒå°çš„åŒç±»é—®é¢˜ï¼› ï¼ˆ2ï¼‰æ±‚è§£ï¼Œå½“å­é—®é¢˜åˆ’åˆ†å¾—è¶³å¤Ÿå°æ—¶ï¼Œç”¨è¾ƒç®€å•çš„æ–¹æ³•è§£å†³ï¼› ï¼ˆ3ï¼‰åˆå¹¶ï¼ŒæŒ‰åŸé—®é¢˜çš„è¦æ±‚ï¼Œå°†å­é—®é¢˜çš„è§£é€å±‚åˆå¹¶æ„æˆåŸé—®é¢˜çš„è§£ã€‚ åˆ†æ²»ç®—æ³•çš„è®¾è®¡æ¨¡å¼:1234567891011Divide_and_Conquer(P)&#123; if(xxx) //é€’å½’å‡ºå£ï¼šå¦‚æœè§„æ¨¡è¶³å¤Ÿå°ï¼Œå…‹åˆ¶ç›´æ¥æ±‚è§£ï¼Œåˆ™å¼€å§‹â€œæ²»â€ return ADHOC(P); //ADHOCæ˜¯æ²»ç†å¯ç›´æ¥æ±‚è§£å­é—®é¢˜çš„å­è¿‡ç¨‹ &lt;divide P into smaller subinstances P1,P2,...Pk&gt;; //å°†Pâ€œåˆ†â€è§£ä¸ºkä¸ªå­é—®é¢˜ for(int i = 0; i &lt; k; ++i) yi = Divide_and_Conquer(Pi); //é€’å½’æ±‚è§£å„ä¸ªå­é—®é¢˜ return merge(y1, y2, ..., yk); //å°†å„ä¸ªå­é—®é¢˜çš„è§£â€œåˆâ€å¹¶ä¸ºåŸé—®é¢˜çš„è§£&#125; æ¡ˆä¾‹: æ±‚æ•°ç»„çš„å’Œ123456private static int getSum(int[] arr, int low, int high) &#123; if (low &gt;= high) return arr[high];// â€œæ²»â€ ç›´æ¥æ±‚è§£ int mid = (low + high) / 2;// â€œåˆ†â€ åˆ†è§£æˆä¸¤ä¸ªå­é—®é¢˜ // â€œåˆâ€ è‡ªåº•å‘ä¸Šæ±‚å­æ•°ç»„lå’Œrçš„å’Œ return getSum(arr, low, mid) + getSum(arr, mid + 1, high); &#125; åˆ†æ²» - æ±‚é€†åºå¯¹æ•°ç›®å¦‚ï¼Œ{3, 1, 2, 4} ä¸­é€†åºå¯¹æœ‰ &lt;3,1&gt; &lt;3,2&gt; 12345678910111213141516171819202122232425262728293031323334353637383940static int getReverseCount(int[] arr, int low, int high) &#123; //æ²» if (low &gt;= high) return 0; //åˆ† æˆå­é—®é¢˜,å­é—®é¢˜è§£æœ‰ä¸‰ä¸ª //1. å·¦è¾¹éƒ¨åˆ†çš„è§£ //2. å³è¾¹éƒ¨åˆ†çš„è§£ //3. å·¦å³ä¸¤éƒ¨åˆ†åˆèµ·æ¥çš„è§£ int mid = (low + high) / 2; int lC = getReverseCount(arr, low, mid); int rC = getReverseCount(arr, mid + 1, high); int mergeC = merge(arr, low, mid, high); //åˆå¹¶å­é—®é¢˜çš„è§£(3ä¸ª) return lC + rC + mergeC; &#125; private static int merge(int[] arr, int low, int mid, int high) &#123; //å°†å·¦å³ä¸¤éƒ¨åˆ†çš„é™å®šåŒºé—´å†…çš„å€¼æ‹¿å‡ºæ¥(è¿™æ ·ä¸ä¼šå½±å“æ•´ä½“)æ±‚å·¦å³ä¸¤éƒ¨åˆ†åˆèµ·æ¥çš„è§£-&gt; æŠŠä¸­é—´éƒ¨åˆ†æ‹¿å‡ºæ¥æ’å¥½åºåœ¨æ”¾å›å» int[] tmp = Arrays.copyOfRange(arr, low, high + 1); int nMid = mid - low; int nHigh = tmp.length - 1; int num = 0;//é€†åºæ•° //å¼€å§‹æ±‚ä¸¤éƒ¨åˆ†åˆèµ·æ¥çš„è§£(ä»…ä»…!! æŠŠä¸­é—´é‚£éƒ¨åˆ†æ‹¿å‡ºæ¥è¿›è¡Œæ’åºå,æ”¾å›åˆ°åŸæ•°ç»„arrä¸­) int index = low; int p1 = 0; int p2 = nMid + 1; while (p1 &lt;= nMid &amp;&amp; p2 &lt;= nHigh) &#123; // æ¯”è¾ƒå·¦å³ä¸¤éƒ¨åˆ†çš„å…ƒç´ ï¼Œå“ªä¸ªå°ï¼ŒæŠŠé‚£ä¸ªå…ƒç´ å¡«å…¥åŸæ•°ç»„indexä½ç½®ä¸­ if (tmp[p1] &gt; tmp[p2]) &#123; num++; System.out.println(tmp[p1] + \" \" + tmp[p2]); arr[index++] = tmp[p2++]; &#125; else &#123; arr[index++] = tmp[p1++]; &#125; &#125; //æŠŠå‰©ä½™çš„å…ƒç´ å¡«å…¥arrç›¸åº”ä½ç½® while (p1 &lt;= nMid) arr[index++] = tmp[p1++]; while (p2 &lt;= nHigh) arr[index++] = tmp[p2++]; return num; &#125; å¤§æ•´æ•°ä¹˜æ³• åŠ¨æ€è§„åˆ’ åŠ¨æ€è§„åˆ’è¿‡ç¨‹æ˜¯ï¼šæ¯æ¬¡å†³ç­–ä¾èµ–äºå½“å‰çŠ¶æ€ï¼Œåˆéšå³å¼•èµ·çŠ¶æ€çš„è½¬ç§»ã€‚æ˜¯ä¸€ç§åˆ†é˜¶æ®µæ±‚è§£å†³ç­–é—®é¢˜çš„æ•°å­¦æ€æƒ³ã€‚æ€»ç»“èµ·æ¥å°±æ˜¯ä¸€å¥è¯ï¼Œå¤§äº‹åŒ–å°ï¼Œå°äº‹åŒ–äº†ã€‚ åŸºæœ¬æ€æƒ³ä¸åˆ†æ²»æ³•ç±»ä¼¼ï¼Œä¹Ÿæ˜¯å°†å¾…æ±‚è§£çš„é—®é¢˜åˆ†è§£ä¸ºè‹¥å¹²ä¸ªå­é—®é¢˜ï¼ˆé˜¶æ®µï¼‰ï¼ŒæŒ‰é¡ºåºæ±‚è§£å­é˜¶æ®µï¼Œå‰ä¸€å­é—®é¢˜çš„è§£ï¼Œä¸ºåä¸€å­é—®é¢˜çš„æ±‚è§£æä¾›äº†æœ‰ç”¨çš„ä¿¡æ¯ã€‚åœ¨æ±‚è§£ä»»ä¸€å­é—®é¢˜æ—¶ï¼Œåˆ—å‡ºå„ç§å¯èƒ½çš„å±€éƒ¨è§£ï¼Œé€šè¿‡å†³ç­–ä¿ç•™é‚£äº›æœ‰å¯èƒ½è¾¾åˆ°æœ€ä¼˜çš„å±€éƒ¨è§£ï¼Œä¸¢å¼ƒå…¶ä»–å±€éƒ¨è§£ã€‚ä¾æ¬¡è§£å†³å„å­é—®é¢˜ï¼Œæœ€åä¸€ä¸ªå­é—®é¢˜å°±æ˜¯åˆå§‹é—®é¢˜çš„è§£ã€‚ é€šç”¨é€’æ¨å¼:$$ f(n,m)=max{f(n-1,m), f(n-1,m-w[n])+P(n,m)}$$ ä¼˜åŒ–: ç”±äºåŠ¨æ€è§„åˆ’è§£å†³çš„é—®é¢˜å¤šæ•°æœ‰é‡å å­é—®é¢˜è¿™ä¸ªç‰¹ç‚¹ï¼Œä¸ºå‡å°‘é‡å¤è®¡ç®—ï¼Œå¯¹æ¯ä¸€ä¸ªå­é—®é¢˜åªè§£ä¸€æ¬¡ï¼Œå°†å…¶ä¸åŒé˜¶æ®µçš„ä¸åŒçŠ¶æ€ä¿å­˜åœ¨ä¸€ä¸ªäºŒç»´æ•°ç»„ä¸­ã€‚ åˆ†æ²»æ³•æœ€å¤§çš„å·®åˆ«:é€‚åˆäºç”¨åŠ¨æ€è§„åˆ’æ³•æ±‚è§£çš„é—®é¢˜ï¼Œç»åˆ†è§£åå¾—åˆ°çš„å­é—®é¢˜å¾€å¾€ä¸æ˜¯äº’ç›¸ç‹¬ç«‹çš„ï¼ˆå³ä¸‹ä¸€ä¸ªå­é˜¶æ®µçš„æ±‚è§£æ˜¯å»ºç«‹åœ¨ä¸Šä¸€ä¸ªå­é˜¶æ®µçš„è§£çš„åŸºç¡€ä¸Šï¼Œè¿›è¡Œè¿›ä¸€æ­¥çš„æ±‚è§£ï¼‰ã€‚ é€‚ç”¨çš„æƒ…å†µèƒ½é‡‡ç”¨åŠ¨æ€è§„åˆ’æ±‚è§£çš„é—®é¢˜çš„ä¸€èˆ¬è¦å…·æœ‰3ä¸ªæ€§è´¨ï¼š æœ€ä¼˜åŒ–åŸç†ï¼šå¦‚æœé—®é¢˜çš„æœ€ä¼˜è§£æ‰€åŒ…å«çš„å­é—®é¢˜çš„è§£ä¹Ÿæ˜¯æœ€ä¼˜çš„ï¼Œå°±ç§°è¯¥é—®é¢˜å…·æœ‰æœ€ä¼˜å­ç»“æ„ï¼Œå³æ»¡è¶³æœ€ä¼˜åŒ–åŸç†ã€‚ æ— åæ•ˆæ€§ï¼šå³æŸé˜¶æ®µçŠ¶æ€ä¸€æ—¦ç¡®å®šï¼Œå°±ä¸å—è¿™ä¸ªçŠ¶æ€ä»¥åå†³ç­–çš„å½±å“ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼ŒæŸçŠ¶æ€ä»¥åçš„è¿‡ç¨‹ä¸ä¼šå½±å“ä»¥å‰çš„çŠ¶æ€ï¼Œåªä¸å½“å‰çŠ¶æ€æœ‰å…³ã€‚ æœ‰é‡å å­é—®é¢˜ï¼šå³å­é—®é¢˜ä¹‹é—´æ˜¯ä¸ç‹¬ç«‹çš„ï¼Œä¸€ä¸ªå­é—®é¢˜åœ¨ä¸‹ä¸€é˜¶æ®µå†³ç­–ä¸­å¯èƒ½è¢«å¤šæ¬¡ä½¿ç”¨åˆ°ã€‚ï¼ˆè¯¥æ€§è´¨å¹¶ä¸æ˜¯åŠ¨æ€è§„åˆ’é€‚ç”¨çš„å¿…è¦æ¡ä»¶ï¼Œä½†æ˜¯å¦‚æœæ²¡æœ‰è¿™æ¡æ€§è´¨ï¼ŒåŠ¨æ€è§„åˆ’ç®—æ³•åŒå…¶ä»–ç®—æ³•ç›¸æ¯”å°±ä¸å…·å¤‡ä¼˜åŠ¿ï¼‰ æ±‚è§£çš„åŸºæœ¬æ­¥éª¤â€‹ åˆå§‹çŠ¶æ€â†’â”‚å†³ç­–ï¼‘â”‚â†’â”‚å†³ç­–ï¼’â”‚â†’â€¦â†’â”‚å†³ç­–ï½â”‚â†’ç»“æŸçŠ¶æ€ åˆ’åˆ†é˜¶æ®µï¼šæŒ‰ç…§é—®é¢˜çš„æ—¶é—´æˆ–ç©ºé—´ç‰¹å¾ï¼ŒæŠŠé—®é¢˜åˆ†ä¸ºè‹¥å¹²ä¸ªé˜¶æ®µã€‚åœ¨åˆ’åˆ†é˜¶æ®µæ—¶ï¼Œæ³¨æ„åˆ’åˆ†åçš„é˜¶æ®µä¸€å®šè¦æ˜¯æœ‰åºçš„æˆ–è€…æ˜¯å¯æ’åºçš„ï¼Œå¦åˆ™é—®é¢˜å°±æ— æ³•æ±‚è§£ã€‚ ç¡®å®šçŠ¶æ€å’ŒçŠ¶æ€å˜é‡-&gt;(é€’å½’çš„å®šä¹‰æœ€ä¼˜è§£ã€‚)ï¼šå°†é—®é¢˜å‘å±•åˆ°å„ä¸ªé˜¶æ®µæ—¶æ‰€å¤„äºçš„å„ç§å®¢è§‚æƒ…å†µç”¨ä¸åŒçš„çŠ¶æ€è¡¨ç¤ºå‡ºæ¥ã€‚å½“ç„¶ï¼ŒçŠ¶æ€çš„é€‰æ‹©è¦æ»¡è¶³æ— åæ•ˆæ€§ã€‚ ç¡®å®šå†³ç­–å¹¶å†™å‡ºçŠ¶æ€è½¬ç§»æ–¹ç¨‹ï¼šå› ä¸ºå†³ç­–å’ŒçŠ¶æ€è½¬ç§»æœ‰ç€å¤©ç„¶çš„è”ç³»ï¼ŒçŠ¶æ€è½¬ç§»å°±æ˜¯æ ¹æ®ä¸Šä¸€é˜¶æ®µçš„çŠ¶æ€å’Œå†³ç­–æ¥å¯¼å‡ºæœ¬é˜¶æ®µçš„çŠ¶æ€ã€‚æ‰€ä»¥å¦‚æœç¡®å®šäº†å†³ç­–ï¼ŒçŠ¶æ€è½¬ç§»æ–¹ç¨‹ä¹Ÿå°±å¯å†™å‡ºã€‚ä½†äº‹å®ä¸Šå¸¸å¸¸æ˜¯åè¿‡æ¥åšï¼Œæ ¹æ®ç›¸é‚»ä¸¤ä¸ªé˜¶æ®µçš„çŠ¶æ€ä¹‹é—´çš„å…³ç³»æ¥ç¡®å®šå†³ç­–æ–¹æ³•å’ŒçŠ¶æ€è½¬ç§»æ–¹ç¨‹ã€‚ å¯»æ‰¾è¾¹ç•Œæ¡ä»¶ï¼šç»™å‡ºçš„çŠ¶æ€è½¬ç§»æ–¹ç¨‹æ˜¯ä¸€ä¸ªé€’æ¨å¼ï¼Œéœ€è¦ä¸€ä¸ªé€’æ¨çš„ç»ˆæ­¢æ¡ä»¶æˆ–è¾¹ç•Œæ¡ä»¶ã€‚ åŠ¨æ€è§„åˆ’æ¡ˆä¾‹0, 1èƒŒåŒ…é—®é¢˜ ä¸¤ç§æƒ…å†µæ¥åˆ†æ, è¦æ‹¿çš„ä¸œè¥¿èƒ½ä¸èƒ½è£…è¿›èƒŒåŒ…,èƒ½è£…è¿›å»çš„è¯,è¦ä¸è¦é‚£å®ƒ(çœ‹ä»·å€¼) å¦‚æœç¬¬kä»¶ç‰©å“çš„é‡é‡w[k]æ¯”æ­¤æ—¶çš„èƒŒåŒ…çš„å‰©ä½™é‡é‡cå¤§äº†ï¼Œé‚£æˆ‘è‚¯å®šæ˜¯æ‹¿ä¸åŠ¨äº†ï¼Œå³w[k]&gt;cã€‚æ‰€ä»¥æ­¤æ—¶åŒ…ä¸­ç‰©å“çš„ä»·å€¼å°±æ˜¯æˆ‘æ‹¿çš„å‰ä¸€ä¸ªç‰©å“ä¹‹ååŒ…ä¸­çš„ä»·å€¼ï¼Œå³ b(k,c)=b(k-1,c).åŒ…ä¸­å‰©ä½™ç©ºé—´ä¸å˜ï¼Œè¿˜æ˜¯cã€‚ é‚£ä¹ˆç¬¬äºŒç§æƒ…å†µï¼Œå¦‚æœæˆ‘æ‹¿å¾—åŠ¨ç¬¬kä»¶ç‰©å“ï¼Œå³ç¬¬kä»¶ç‰©å“çš„é‡é‡w[k]&lt;cï¼Œé¢å¯¹kå·ç‰©å“ï¼Œæ— å¤–ä¹ä¸¤ç§é€‰æ‹©ï¼Œæ‹¿æˆ–è€…ä¸æ‹¿ï¼Œè¿™æ—¶æˆ‘å°±è¦æ ¹æ®æ‹¿èµ°ä¹‹åäº§ç”Ÿçš„æ•ˆç›Šè¿›è¡Œå†³ç­–äº†ï¼š ä¸æ‹¿kå·ç‰©å“ï¼Œé‚£ä¹ˆæ­¤æ—¶åŒ…ä¸­ç‰©å“çš„æ€»ä»·å€¼b(k,c)=b(k-1,c)ï¼Œå’Œç¬¬ä¸€ç§æ‹¿ä¸åŠ¨kå·ç‰©å“çš„ä¸€æ ·ã€‚ æ‹¿èµ°kå·ç‰©å“ï¼Œé‚£ä¹ˆæ­¤æ—¶åŒ…ä¸­ç‰©å“çš„æ€»ä»·å€¼b(k,c)=b(k-1,c-w[k])+v[k]æ‹¿äº†ç¬¬kä»¶ç‰©å“åï¼Œé‚£æˆ‘çš„åŒ…ä¸­çš„ä»·å€¼è‚¯å®šå°±æ˜¯åŸå…ˆçš„ä»·å€¼å†åŠ ä¸Šç¬¬kä»¶ç‰©å“çš„ä»·å€¼ï¼Œè€Œä¸”æ‹¿äº†ä¹‹ååŒ…ä¸­çš„å‰©ä½™å®¹é‡å°±ä¸ºc-w[k]äº†ã€‚ æ€»ç»“ä¸€ä¸‹ï¼Œå°±æ˜¯å¦‚ä¸‹çš„å…¬å¼äº†ï¼šb(k,c)=max{b(k-1,c),b(k-1,c-w[k])+v[k]} 1234567891011121314151617181920class Main &#123; public static void main(String[] args) &#123; int[] w = &#123; 0, 2, 3, 4, 5, 9 &#125;; int[] v = &#123; 0, 3, 4, 5, 8, 10 &#125;; int N = 6, W = 21; int[][] b = new int[N][W]; for (int k = 1; k &lt; N; k++) &#123; for (int c = 1; c &lt; W; c++) &#123; if (w[k] &gt; c) &#123; b[k][c] = b[k - 1][c]; &#125; else &#123; int value1 = b[k - 1][c - w[k]] + v[k]; // æ‹¿ç¬¬kä»¶ç‰©å“ int value2 = b[k - 1][c]; // ä¸æ‹¿ç¬¬kä»¶ç‰©å“ b[k][c] = Math.max(value1, value2); &#125; &#125; &#125; System.out.println(b[5][20]); &#125;&#125; 1234567891011121314151617181920212223242526//é€’å½’æ–¹å¼ /** * @param w é‡é‡æ•°ç»„ * @param v ç‰©å“ä»·å€¼æ•°ç»„ * @param capacity èƒŒåŒ…å®¹é‡ * @param i ç‰©å“iå¼€å§‹ * @return */ private static int getValue(int[] w, int[] v, int capacity, int i) &#123; if (i == w.length - 1) &#123; //æœ€åä¸€ä»¶ç‰©å“ return w[i] &lt;= capacity ? v[i] : 0; &#125; else &#123; if (capacity &lt; w[i]) &#123; //èƒŒåŒ…è£…ä¸äº†ä¸äº†çš„æƒ…å†µ return getValue(w, v, capacity, i + 1); &#125; //èƒ½è£…ä¸‹, ä½†æ˜¯è€ƒè™‘æ‹¿ä¸æ‹¿ //æ‹¿ int v1 = getValue(w, v, capacity - w[i], i + 1) + v[i]; //ä¸æ‹¿ int v2 = getValue(w, v, capacity, i + 1); return Math.max(v1, v2); &#125; &#125; è´ªå¿ƒç®—æ³• æ‰€è°“è´ªå¿ƒç®—æ³•æ˜¯æŒ‡ï¼Œåœ¨å¯¹é—®é¢˜æ±‚è§£æ—¶ï¼Œæ€»æ˜¯åšå‡ºåœ¨å½“å‰çœ‹æ¥æ˜¯æœ€å¥½çš„é€‰æ‹©ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸ä»æ•´ä½“æœ€ä¼˜ä¸ŠåŠ ä»¥è€ƒè™‘ï¼Œä»–æ‰€åšå‡ºçš„ä»…æ˜¯åœ¨æŸç§æ„ä¹‰ä¸Šçš„å±€éƒ¨æœ€ä¼˜è§£ã€‚ å¿…é¡»æ³¨æ„çš„æ˜¯ï¼Œè´ªå¿ƒç®—æ³•ä¸æ˜¯å¯¹æ‰€æœ‰é—®é¢˜éƒ½èƒ½å¾—åˆ°æ•´ä½“æœ€ä¼˜è§£ï¼Œé‡‡ç”¨çš„è´ªå¿ƒç­–ç•¥ä¸€å®šè¦ä»”ç»†åˆ†æå…¶æ˜¯å¦æ»¡è¶³æ— åæ•ˆæ€§ã€‚å³æŸä¸ªçŠ¶æ€ä»¥åçš„è¿‡ç¨‹ä¸ä¼šå½±å“ä»¥å‰çš„çŠ¶æ€ è´ªå¿ƒç®—æ³•çš„åŸºæœ¬æ€è·¯ï¼šâ€‹ 1.å»ºç«‹æ•°å­¦æ¨¡å‹æ¥æè¿°é—®é¢˜ã€‚ â€‹ 2.æŠŠæ±‚è§£çš„é—®é¢˜åˆ†æˆè‹¥å¹²ä¸ªå­é—®é¢˜ã€‚ â€‹ 3.å¯¹æ¯ä¸€å­é—®é¢˜æ±‚è§£ï¼Œå¾—åˆ°å­é—®é¢˜çš„å±€éƒ¨æœ€ä¼˜è§£ã€‚ â€‹ 4.æŠŠå­é—®é¢˜çš„è§£å±€éƒ¨æœ€ä¼˜è§£åˆæˆåŸæ¥è§£é—®é¢˜çš„ä¸€ä¸ªè§£ã€‚ è´ªå¿ƒç®—æ³•é€‚ç”¨çš„é—®é¢˜è´ªå¿ƒç­–ç•¥é€‚ç”¨çš„å‰ææ˜¯ï¼šå±€éƒ¨æœ€ä¼˜ç­–ç•¥èƒ½å¯¼è‡´äº§ç”Ÿå…¨å±€æœ€ä¼˜è§£ã€‚ å®é™…ä¸Šï¼Œè´ªå¿ƒç®—æ³•é€‚ç”¨çš„æƒ…å†µå¾ˆå°‘ã€‚ä¸€èˆ¬ï¼Œå¯¹ä¸€ä¸ªé—®é¢˜åˆ†ææ˜¯å¦é€‚ç”¨äºè´ªå¿ƒç®—æ³•ï¼Œå¯ä»¥å…ˆé€‰æ‹©è¯¥é—®é¢˜ä¸‹çš„å‡ ä¸ªå®é™…æ•°æ®è¿›è¡Œåˆ†æï¼Œå°±å¯åšå‡ºåˆ¤æ–­ã€‚ è´ªå¿ƒç®—æ³•çš„å®ç°æ¡†æ¶ ä»é—®é¢˜çš„æŸä¸€åˆå§‹è§£å‡ºå‘ï¼› â€‹ while ï¼ˆèƒ½æœç»™å®šæ€»ç›®æ ‡å‰è¿›ä¸€æ­¥ï¼‰ â€‹ { â€‹ åˆ©ç”¨å¯è¡Œçš„å†³ç­–ï¼Œæ±‚å‡ºå¯è¡Œè§£çš„ä¸€ä¸ªè§£å…ƒç´ ï¼› â€‹ } â€‹ ç”±æ‰€æœ‰è§£å…ƒç´ ç»„åˆæˆé—®é¢˜çš„ä¸€ä¸ªå¯è¡Œè§£ï¼› æ¡ˆä¾‹ç‰©å“è£…è½½é—®é¢˜:æœ€ä¼˜è£…è½½é—®é¢˜ï¼Œç»™å‡ºnä¸ªç‰©ä½“ï¼Œç¬¬iä¸ªç‰©ä½“é‡é‡ä¸ºwiã€‚é€‰æ‹©å°½é‡å¤šçš„ç‰©ä½“ï¼Œä½¿å¾—æ€»é‡é‡ä¸è¶…è¿‡Cã€‚ç»è¿‡å‰é¢çš„å­¦ä¹ å¾ˆå®¹æ˜“æƒ³åˆ°è´ªå¿ƒç­–ç•¥ï¼Œé‚£å°±æ˜¯æ¯æ¬¡é€‰é‡é‡æœ€è½»çš„ç‰©ä½“ï¼Œé‚£ä¹ˆç‰©ä½“æ•°å°±æœ€å¤šã€‚ 1234567891011121314151617181920/** * @param n ç‰©å“æ•° * @param w ç‰©å“å¯¹è±¡çš„é‡é‡æ•°ç»„ * @param c é™é‡å€¼ * @return */ private static int f(int n, int[] w, int c) &#123; int sum = 0; int cnt = 0; for (int i = 0; i &lt; n; i++) &#123; sum += w[i]; //ä¼˜å…ˆé€‰æ‹©é‡é‡æœ€è½»çš„ç‰©ä½“, åˆ™æœ€ç»ˆçš„ç‰©ä½“æ•°å°±ä¼šæœ€å¤š,ä¸”ä¸è¶…è¿‡é™é‡ if (sum &lt;= c) &#123; cnt++; &#125; else &#123; break; &#125; &#125; return cnt; &#125; å›æº¯ç®—æ³• å›æº¯æ³•æ˜¯ä¸€ç§é€‰ä¼˜æœç´¢æ³•ï¼ŒæŒ‰é€‰ä¼˜æ¡ä»¶å‘å‰æœç´¢ï¼Œä»¥è¾¾åˆ°ç›®æ ‡ã€‚ä½†å½“æ¢ç´¢åˆ°æŸä¸€æ­¥æ—¶ï¼Œå‘ç°åŸå…ˆé€‰æ‹©å¹¶ä¸ä¼˜æˆ–è¾¾ä¸åˆ°ç›®æ ‡ï¼Œå°±é€€å›ä¸€æ­¥é‡æ–°é€‰æ‹©ï¼Œè¿™ç§èµ°ä¸é€šå°±é€€å›å†èµ°çš„æŠ€æœ¯ä¸ºå›æº¯æ³•ï¼Œè€Œæ»¡è¶³å›æº¯æ¡ä»¶çš„æŸä¸ªçŠ¶æ€çš„ç‚¹ç§°ä¸ºâ€œå›æº¯ç‚¹â€ã€‚ è®¸å¤šå¤æ‚çš„ï¼Œè§„æ¨¡è¾ƒå¤§çš„é—®é¢˜éƒ½å¯ä»¥ä½¿ç”¨å›æº¯æ³•ï¼Œæœ‰â€œé€šç”¨è§£é¢˜æ–¹æ³•â€çš„ç¾ç§°ã€‚ å›æº¯ç®—æ³•è®¾è®¡æ¨¡å¼: ï¼ˆ1ï¼‰é’ˆå¯¹æ‰€ç»™é—®é¢˜ï¼Œç¡®å®šé—®é¢˜çš„è§£ç©ºé—´ï¼š é¦–å…ˆåº”æ˜ç¡®å®šä¹‰é—®é¢˜çš„è§£ç©ºé—´ï¼Œé—®é¢˜çš„è§£ç©ºé—´åº”è‡³å°‘åŒ…å«é—®é¢˜çš„ä¸€ä¸ªï¼ˆæœ€ä¼˜ï¼‰è§£ã€‚ â€‹ ï¼ˆ2ï¼‰ç¡®å®šç»“ç‚¹çš„æ‰©å±•æœç´¢è§„åˆ™ â€‹ ï¼ˆ3ï¼‰ä»¥æ·±åº¦ä¼˜å…ˆæ–¹å¼æœç´¢è§£ç©ºé—´ï¼Œå¹¶åœ¨æœç´¢è¿‡ç¨‹ä¸­ç”¨å‰ªæå‡½æ•°é¿å…æ— æ•ˆæœç´¢ã€‚ æ¡ˆä¾‹ å…«çš‡åé—®é¢˜ 1234567891011121314151617181920void back_tracking(int row=0) //ç®—æ³•å‡½æ•°ï¼Œä»ç¬¬0è¡Œå¼€å§‹éå†&#123; if (row==n) t ++; //åˆ¤æ–­è‹¥éå†å®Œæˆï¼Œå°±è¿›è¡Œè®¡æ•° for (int col=0;col&lt;n;col++) //éå†æ£‹ç›˜æ¯ä¸€åˆ— &#123; queen[row] = col; //å°†çš‡åçš„ä½ç½®è®°å½•åœ¨æ•°ç»„ if (is_ok(row)) //åˆ¤æ–­çš‡åçš„ä½ç½®æ˜¯å¦æœ‰å†²çª back_tracking(row+1); //é€’å½’ï¼Œè®¡ç®—ä¸‹ä¸€ä¸ªçš‡åçš„ä½ç½® &#125;&#125;bool is_ok(int row)&#123; //åˆ¤æ–­è®¾ç½®çš„çš‡åæ˜¯å¦åœ¨åŒä¸€è¡Œï¼ŒåŒä¸€åˆ—ï¼Œæˆ–è€…åŒä¸€æ–œçº¿ä¸Š for (int j=0;j&lt;row;j++) &#123; if (queen[row]==queen[j]||row-queen[row]==j-queen[j]||row+queen[row]==j+queen[j]) return false; &#125; return true;&#125; 01èƒŒåŒ…é—®é¢˜ ç”¨å›æº¯æ³•è§£é—®é¢˜æ—¶ï¼Œåº”æ˜ç¡®å®šä¹‰é—®é¢˜çš„è§£ç©ºé—´ã€‚é—®é¢˜çš„è§£ç©ºé—´è‡³å°‘åŒ…å«é—®é¢˜çš„ä¸€ä¸ª(æœ€ä¼˜)è§£ã€‚å¯¹äº n=3 æ—¶çš„ 0/1 èƒŒåŒ…é—®é¢˜ï¼Œå¯ç”¨ä¸€æ£µå®Œå…¨äºŒå‰æ ‘è¡¨ç¤ºè§£ç©ºé—´ æ±‚è§£æ­¥éª¤1)é’ˆå¯¹æ‰€ç»™é—®é¢˜ï¼Œå®šä¹‰é—®é¢˜çš„è§£ç©ºé—´ï¼› 2)ç¡®å®šæ˜“äºæœç´¢çš„è§£ç©ºé—´ç»“æ„ï¼› 3)ä»¥æ·±åº¦ä¼˜å…ˆæ–¹å¼æœç´¢è§£ç©ºé—´ï¼Œå¹¶åœ¨æœç´¢è¿‡ç¨‹ä¸­ç”¨å‰ªæå‡½æ•°é¿å…æ— æ•ˆæœç´¢ã€‚ å¸¸ç”¨çš„å‰ªæå‡½æ•°ï¼šç”¨çº¦æŸå‡½æ•°åœ¨æ‰©å±•ç»“ç‚¹å¤„å‰ªå»ä¸æ»¡è¶³çº¦æŸçš„å­æ ‘ï¼›ç”¨é™ç•Œå‡½æ•°å‰ªå»å¾—ä¸åˆ°æœ€ä¼˜è§£çš„å­æ ‘ã€‚ å›æº¯æ³•å¯¹è§£ç©ºé—´åšæ·±åº¦ä¼˜å…ˆæœç´¢æ—¶ï¼Œæœ‰é€’å½’å›æº¯å’Œè¿­ä»£å›æº¯ï¼ˆéé€’å½’ï¼‰ä¸¤ç§æ–¹æ³•ï¼Œä½†ä¸€èˆ¬æƒ…å†µä¸‹ç”¨é€’å½’æ–¹æ³•å®ç°å›æº¯æ³•ã€‚ ç®—æ³•æè¿°è§£ 0/1 èƒŒåŒ…é—®é¢˜çš„å›æº¯æ³•åœ¨æœç´¢è§£ç©ºé—´æ ‘æ—¶ï¼Œåªè¦å…¶å·¦å„¿å­ç»“ç‚¹æ˜¯ä¸€ä¸ªå¯è¡Œç»“ç‚¹ï¼Œæœç´¢å°±è¿›å…¥å…¶å·¦å­æ ‘ã€‚å½“å³å­æ ‘ä¸­æœ‰å¯èƒ½åŒ…å«æœ€ä¼˜è§£æ—¶æ‰è¿›å…¥å³å­æ ‘æœç´¢ã€‚å¦åˆ™å°†å³å­æ ‘å‰ªå»ã€‚ 12345678910111213141516171819202122232425void dfs(int i,int cv,int cw)&#123; //cwå½“å‰åŒ…å†…ç‰©å“é‡é‡ï¼Œcvå½“å‰åŒ…å†…ç‰©å“ä»·å€¼ if(i&gt;n) &#123; if(cv&gt;bestval) //æ˜¯å¦è¶…è¿‡äº†æœ€å¤§ä»·å€¼ &#123; bestval=cv; //å¾—åˆ°æœ€å¤§ä»·å€¼ for(i=1;i&lt;=n;i++) bestx[i]=x[i]; //å¾—åˆ°é€‰ä¸­çš„ç‰©å“ &#125; &#125; else for(int j=0;j&lt;=1;j++) //æšä¸¾ç‰©ä½“iæ‰€æœ‰å¯èƒ½çš„è·¯å¾„ï¼Œ &#123; x[i]=j; if(cw+x[i]*w[i]&lt;=TotCap) //æ»¡è¶³çº¦æŸ,ç»§ç»­å‘å­èŠ‚ç‚¹æ¢ç´¢ &#123; cw+=w[i]*x[i]; cv+=val[i]*x[i]; dfs(i+1,cv,cw); cw-=w[i]*x[i]; //å›æº¯ä¸Šä¸€å±‚ç‰©ä½“çš„é€‰æ‹©æƒ…å†µ cv-=val[i]*x[i]; &#125; &#125;&#125; ä¸»å‡½æ•°éƒ¨åˆ† 123456789101112131415161718192021222324252627int main()&#123; int i; bestval=0; cout&lt;&lt;\"è¯·è¾“å…¥èƒŒåŒ…æœ€å¤§å®¹é‡:\"&lt;&lt;endl;; cin&gt;&gt;TotCap; cout&lt;&lt;\"è¯·è¾“å…¥ç‰©å“ä¸ªæ•°:\"&lt;&lt;endl; cin&gt;&gt;n; cout&lt;&lt;\"è¯·ä¾æ¬¡è¾“å…¥ç‰©å“çš„é‡é‡:\"&lt;&lt;endl; for(i=1;i&lt;=n;i++) cin&gt;&gt;w[i]; cout&lt;&lt;\"è¯·ä¾æ¬¡è¾“å…¥ç‰©å“çš„ä»·å€¼:\"&lt;&lt;endl; for(i=1;i&lt;=n;i++) cin&gt;&gt;val[i]; dfs(1,0,0); cout&lt;&lt;\"æœ€å¤§ä»·å€¼ä¸º:\"&lt;&lt;endl; cout&lt;&lt;bestval&lt;&lt;endl; cout&lt;&lt;\"è¢«é€‰ä¸­çš„ç‰©å“çš„æ ‡å·ä¾æ¬¡æ˜¯:\"&lt;&lt;endl; for(i=1;i&lt;=n;i++) if(bestx[i]==1) cout&lt;&lt;i&lt;&lt;\" \"; cout&lt;&lt;endl; return 0;&#125; åˆ†æ”¯é™ç•Œæ³• ç±»ä¼¼äºå›æº¯æ³•ï¼Œä¹Ÿæ˜¯ä¸€ç§åœ¨é—®é¢˜çš„è§£ç©ºé—´æ ‘Tä¸Šæœç´¢é—®é¢˜è§£çš„ç®—æ³•ã€‚ä½†åœ¨ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œåˆ†æ”¯é™ç•Œæ³•ä¸å›æº¯æ³•çš„æ±‚è§£ç›®æ ‡ä¸åŒã€‚å›æº¯æ³•çš„æ±‚è§£ç›®æ ‡æ˜¯æ‰¾å‡ºTä¸­æ»¡è¶³çº¦æŸæ¡ä»¶çš„æ‰€æœ‰è§£ï¼Œè€Œåˆ†æ”¯é™ç•Œæ³•çš„æ±‚è§£ç›®æ ‡åˆ™æ˜¯æ‰¾å‡ºæ»¡è¶³çº¦æŸæ¡ä»¶çš„ä¸€ä¸ªè§£ï¼Œæˆ–æ˜¯åœ¨æ»¡è¶³çº¦æŸæ¡ä»¶çš„è§£ä¸­æ‰¾å‡ºä½¿æŸä¸€ç›®æ ‡å‡½æ•°å€¼è¾¾åˆ°æå¤§æˆ–æå°çš„è§£ï¼Œå³åœ¨æŸç§æ„ä¹‰ä¸‹çš„æœ€ä¼˜è§£ã€‚ æ‰€è°“â€œåˆ†æ”¯â€å°±æ˜¯é‡‡ç”¨å¹¿åº¦ä¼˜å…ˆçš„ç­–ç•¥ï¼Œä¾æ¬¡æœç´¢E-ç»“ç‚¹çš„æ‰€æœ‰åˆ†æ”¯ï¼Œä¹Ÿå°±æ˜¯æ‰€æœ‰ç›¸é‚»ç»“ç‚¹ï¼ŒæŠ›å¼ƒä¸æ»¡è¶³çº¦æŸæ¡ä»¶çš„ç»“ç‚¹ï¼Œå…¶ä½™ç»“ç‚¹åŠ å…¥æ´»ç»“ç‚¹è¡¨ã€‚ç„¶åä»è¡¨ä¸­é€‰æ‹©ä¸€ä¸ªç»“ç‚¹ä½œä¸ºä¸‹ä¸€ä¸ªE-ç»“ç‚¹ï¼Œç»§ç»­æœç´¢ã€‚ â€‹ é€‰æ‹©ä¸‹ä¸€ä¸ªE-ç»“ç‚¹çš„æ–¹å¼ä¸åŒï¼Œåˆ™ä¼šæœ‰å‡ ç§ä¸åŒçš„åˆ†æ”¯æœç´¢æ–¹å¼ã€‚ 1ï¼‰FIFOæœç´¢ 2ï¼‰LIFOæœç´¢ 3ï¼‰ä¼˜å…ˆé˜Ÿåˆ—å¼æœç´¢ å›æº¯æ³•å’Œåˆ†æ”¯é™ç•Œæ³•çš„ä¸€äº›åŒºåˆ« æ–¹æ³•å¯¹è§£ç©ºé—´æ ‘çš„æœç´¢æ–¹å¼ å­˜å‚¨ç»“ç‚¹çš„å¸¸ç”¨æ•°æ®ç»“æ„ ç»“ç‚¹å­˜å‚¨ç‰¹æ€§å¸¸ç”¨åº”ç”¨ å›æº¯æ³•æ·±åº¦ä¼˜å…ˆæœç´¢å †æ ˆæ´»ç»“ç‚¹çš„æ‰€æœ‰å¯è¡Œå­ç»“ç‚¹è¢«éå†åæ‰è¢«ä»æ ˆä¸­å¼¹å‡ºæ‰¾å‡ºæ»¡è¶³çº¦æŸæ¡ä»¶çš„æ‰€æœ‰è§£ åˆ†æ”¯é™ç•Œæ³•å¹¿åº¦ä¼˜å…ˆæˆ–æœ€å°æ¶ˆè€—ä¼˜å…ˆæœç´¢é˜Ÿåˆ—ã€ä¼˜å…ˆé˜Ÿåˆ—æ¯ä¸ªç»“ç‚¹åªæœ‰ä¸€æ¬¡æˆä¸ºæ´»ç»“ç‚¹çš„æœºä¼šæ‰¾å‡ºæ»¡è¶³çº¦æŸæ¡ä»¶çš„ä¸€ä¸ªè§£æˆ–ç‰¹å®šæ„ä¹‰ä¸‹çš„æœ€ä¼˜è§£","categories":[],"tags":[{"name":"IT","slug":"IT","permalink":"/tags/IT/"},{"name":"æŠ€æœ¯ç¬”è®°","slug":"æŠ€æœ¯ç¬”è®°","permalink":"/tags/%E6%8A%80%E6%9C%AF%E7%AC%94%E8%AE%B0/"},{"name":"Job","slug":"Job","permalink":"/tags/Job/"},{"name":"æ•°æ®ç»“æ„","slug":"æ•°æ®ç»“æ„","permalink":"/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"/tags/%E7%AE%97%E6%B3%95/"},{"name":"æ’åº","slug":"æ’åº","permalink":"/tags/%E6%8E%92%E5%BA%8F/"}]},{"title":"JavaåŸºç¡€æ ¸å¿ƒ","slug":"JavaåŸºç¡€","date":"2019-10-20T11:51:12.000Z","updated":"2019-10-20T14:00:53.540Z","comments":true,"path":"2019/10/20/JavaåŸºç¡€/","link":"","permalink":"/2019/10/20/Java%E5%9F%BA%E7%A1%80/","excerpt":"","text":"æ•°æ®ç±»å‹åŸºæœ¬ç±»å‹ byte/8 char/16 short/16 int/32 float/32 long/64 double/64 boolean/~ åŒ…è£…ç±»å‹ åŸºæœ¬ç±»å‹éƒ½æœ‰å¯¹åº”çš„åŒ…è£…ç±»å‹ï¼ŒåŸºæœ¬ç±»å‹ä¸å…¶å¯¹åº”çš„åŒ…è£…ç±»å‹ä¹‹é—´çš„èµ‹å€¼ä½¿ç”¨è‡ªåŠ¨è£…ç®±ä¸æ‹†ç®±å®Œæˆã€‚ 12Integer x = 2; // è£…ç®± è°ƒç”¨äº† Integer.valueOf(2)int y = x; // æ‹†ç®± è°ƒç”¨äº† X.intValue() ç¼“å­˜æ± (!!!é‡è¦)new Integer(123) ä¸ Integer.valueOf(123) çš„åŒºåˆ«åœ¨äºï¼š new Integer(123) æ¯æ¬¡éƒ½ä¼šæ–°å»ºä¸€ä¸ªå¯¹è±¡ï¼› Integer.valueOf(123) ä¼šä½¿ç”¨ç¼“å­˜æ± ä¸­çš„å¯¹è±¡ï¼Œå¤šæ¬¡è°ƒç”¨ä¼šå–å¾—åŒä¸€ä¸ªå¯¹è±¡çš„å¼•ç”¨ã€‚ 123456Integer x = new Integer(123);Integer y = new Integer(123);System.out.println(x == y); // falseInteger z = Integer.valueOf(123);Integer k = Integer.valueOf(123);System.out.println(z == k); // trueCopy to clipboardErrorCopied valueOf() æ–¹æ³•çš„å®ç°æ¯”è¾ƒç®€å•ï¼Œå°±æ˜¯å…ˆåˆ¤æ–­å€¼æ˜¯å¦åœ¨ç¼“å­˜æ± ä¸­ï¼Œå¦‚æœåœ¨çš„è¯å°±ç›´æ¥è¿”å›ç¼“å­˜æ± çš„å†…å®¹ã€‚ åœ¨ Java 8 ä¸­ï¼ŒInteger ç¼“å­˜æ± çš„å¤§å°é»˜è®¤ä¸º -128~127ã€‚ ç¼–è¯‘å™¨ä¼šåœ¨è‡ªåŠ¨è£…ç®±è¿‡ç¨‹è°ƒç”¨ valueOf() æ–¹æ³•ï¼Œå› æ­¤å¤šä¸ªå€¼ç›¸åŒä¸”å€¼åœ¨ç¼“å­˜æ± èŒƒå›´å†…çš„ Integer å®ä¾‹ä½¿ç”¨è‡ªåŠ¨è£…ç®±æ¥åˆ›å»ºï¼Œé‚£ä¹ˆå°±ä¼šå¼•ç”¨ç›¸åŒçš„å¯¹è±¡ã€‚ åŸºæœ¬ç±»å‹å¯¹åº”çš„ç¼“å†²æ± å¦‚ä¸‹: boolean values true and false all byte values (byteå–å€¼èŒƒå›´å†…çš„å…¨éƒ¨å€¼ -128~127) short values between -128 and 127 int values between -128 and 127 char in the range \\u0000 to \\u007F åœ¨ä½¿ç”¨è¿™äº›åŸºæœ¬ç±»å‹å¯¹åº”çš„åŒ…è£…ç±»å‹æ—¶ï¼Œå¦‚æœè¯¥æ•°å€¼èŒƒå›´åœ¨ç¼“å†²æ± èŒƒå›´å†…ï¼Œå°±å¯ä»¥ç›´æ¥ä½¿ç”¨ç¼“å†²æ± ä¸­çš„å¯¹è±¡ã€‚ åœ¨ jdk 1.8 æ‰€æœ‰çš„æ•°å€¼ç±»ç¼“å†²æ± ä¸­ï¼ŒInteger çš„ç¼“å†²æ±  IntegerCache å¾ˆç‰¹æ®Šï¼Œè¿™ä¸ªç¼“å†²æ± çš„ä¸‹ç•Œæ˜¯ - 128ï¼Œä¸Šç•Œé»˜è®¤æ˜¯ 127ï¼Œä½†æ˜¯è¿™ä¸ªä¸Šç•Œæ˜¯å¯è°ƒçš„ï¼Œåœ¨å¯åŠ¨ jvm çš„æ—¶å€™ï¼Œé€šè¿‡ -XX:AutoBoxCacheMax= æ¥æŒ‡å®šè¿™ä¸ªç¼“å†²æ± çš„å¤§å°ï¼Œè¯¥é€‰é¡¹åœ¨ JVM åˆå§‹åŒ–çš„æ—¶å€™ä¼šè®¾å®šä¸€ä¸ªåä¸º java.lang.IntegerCache.high ç³»ç»Ÿå±æ€§ï¼Œç„¶å IntegerCache åˆå§‹åŒ–çš„æ—¶å€™å°±ä¼šè¯»å–è¯¥ç³»ç»Ÿå±æ€§æ¥å†³å®šä¸Šç•Œã€‚ [String](https://cyc2018.github.io/CS-Notes/#/notes/Java åŸºç¡€?id=äºŒã€string) String è¢«å£°æ˜ä¸º finalï¼Œå› æ­¤å®ƒä¸å¯è¢«ç»§æ‰¿ã€‚(Integer ç­‰åŒ…è£…ç±»ä¹Ÿä¸èƒ½è¢«ç»§æ‰¿ï¼‰ åœ¨ Java 8 ä¸­ï¼ŒString å†…éƒ¨ä½¿ç”¨ ** final byte[] æ•°ç»„å­˜å‚¨æ•°æ®**ã€‚ å†…éƒ¨å®ç°: 12345678public final class String implements java.io.Serializable, Comparable&lt;String&gt;, CharSequence &#123; /** The value is used for character storage. */ private final byte[] value;// /** The identifier of the encoding used to encode the bytes in &#123;@code value&#125;. */ private final byte coder;&#125; valueæ•°ç»„è¢«å£°æ˜ä¸ºfinal,è¿™æ„å‘³ç€valueæ•°ç»„åˆå§‹åŒ–ä¹‹åå°±ä¸èƒ½åœ¨å¼•ç”¨å…¶ä»–æ•°ç»„,å¹¶ä¸”Stringå†…éƒ¨æ²¡æœ‰æ”¹å˜valueæ•°ç»„çš„æ–¹æ³•,å› æ­¤å¯ä»¥ä¿è¯Stringä¸å¯å˜ String Pool å­—ç¬¦ä¸²å¸¸é‡æ± ï¼ˆString Poolï¼‰ä¿å­˜ç€æ‰€æœ‰å­—ç¬¦ä¸²å­—é¢é‡ï¼ˆliteral stringsï¼‰ï¼Œè¿™äº›å­—é¢é‡åœ¨ç¼–è¯‘æ—¶æœŸå°±ç¡®å®šã€‚ä¸ä»…å¦‚æ­¤ï¼Œè¿˜å¯ä»¥ä½¿ç”¨ String çš„ intern() æ–¹æ³•åœ¨è¿è¡Œè¿‡ç¨‹ä¸­å°†å­—ç¬¦ä¸²æ·»åŠ åˆ° String Pool ä¸­ã€‚ 123456String s1 = new String(\"aaa\");String s2 = new String(\"aaa\");System.out.println(s1 == s2); // falseString s3 = s1.intern();String s4 = s1.intern();System.out.println(s3 == s4); // true ä¸å¯å˜çš„å¥½å¤„ 1. å¯ä»¥ç¼“å­˜ hash å€¼ å› ä¸º String çš„ hash å€¼ç»å¸¸è¢«ä½¿ç”¨ï¼Œä¾‹å¦‚ String ç”¨åš HashMap çš„ keyã€‚ä¸å¯å˜çš„ç‰¹æ€§å¯ä»¥ä½¿å¾— hash å€¼ä¹Ÿä¸å¯å˜ï¼Œå› æ­¤åªéœ€è¦è¿›è¡Œä¸€æ¬¡è®¡ç®—ã€‚ 2. String Pool çš„éœ€è¦ å¦‚æœä¸€ä¸ª String å¯¹è±¡å·²ç»è¢«åˆ›å»ºè¿‡äº†ï¼Œé‚£ä¹ˆå°±ä¼šä» String Pool ä¸­å–å¾—å¼•ç”¨ã€‚åªæœ‰ String æ˜¯ä¸å¯å˜çš„ï¼Œæ‰å¯èƒ½ä½¿ç”¨ String Pool(å¦åˆ™å¯å˜çš„è¯,æŸä¸ªä¿®æ”¹æ“ä½œå°†å¯¼è‡´æ‰€æœ‰å¼•ç”¨è¯¥å¯¹è±¡çš„å€¼éƒ½å‘ç”Ÿæ”¹å˜)ã€‚ String, StringBuffer and StringBuilder1. å¯å˜æ€§ String ä¸å¯å˜ StringBuffer å’Œ StringBuilder å¯å˜ 2. çº¿ç¨‹å®‰å…¨ String ä¸å¯å˜ï¼Œå› æ­¤æ˜¯çº¿ç¨‹å®‰å…¨çš„ StringBuilder ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ StringBuffer æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå†…éƒ¨ä½¿ç”¨ synchronized è¿›è¡ŒåŒæ­¥ (å‡ ä¹æ‰€æœ‰æ–¹æ³•éƒ½ç”¨äº†synchronizedå…³é”®å­—è¿›è¡ŒåŠ é”) è¿ç®—å‚æ•°ä¼ é€’!!!! Java çš„å‚æ•°æ˜¯ä»¥å€¼ä¼ é€’çš„å½¢å¼ä¼ å…¥æ–¹æ³•ä¸­ï¼Œè€Œä¸æ˜¯å¼•ç”¨ä¼ é€’ã€‚ ä»¥ä¸‹ä»£ç ä¸­ Dog dog çš„ dog æ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼Œå­˜å‚¨çš„æ˜¯å¯¹è±¡çš„åœ°å€ã€‚åœ¨å°†ä¸€ä¸ªå‚æ•°ä¼ å…¥ä¸€ä¸ªæ–¹æ³•æ—¶ï¼Œæœ¬è´¨ä¸Šæ˜¯å°†å¯¹è±¡çš„åœ°å€ä»¥å€¼çš„æ–¹å¼ä¼ é€’åˆ°å½¢å‚ä¸­ã€‚å› æ­¤åœ¨æ–¹æ³•ä¸­ä½¿æŒ‡é’ˆå¼•ç”¨å…¶å®ƒå¯¹è±¡ï¼Œé‚£ä¹ˆè¿™ä¸¤ä¸ªæŒ‡é’ˆæ­¤æ—¶æŒ‡å‘çš„æ˜¯å®Œå…¨ä¸åŒçš„å¯¹è±¡ï¼Œåœ¨ä¸€æ–¹æ”¹å˜å…¶æ‰€æŒ‡å‘å¯¹è±¡çš„å†…å®¹æ—¶å¯¹å¦ä¸€æ–¹æ²¡æœ‰å½±å“ã€‚ 123456789101112131415public class PassByValueExample &#123; public static void main(String[] args) &#123; Dog dog = new Dog(\"A\"); System.out.println(dog.getObjectAddress()); // Dog@4554617c func(dog); System.out.println(dog.getObjectAddress()); // Dog@4554617c System.out.println(dog.getName()); // A &#125; private static void func(Dog dog) &#123; System.out.println(dog.getObjectAddress()); // Dog@4554617c dog = new Dog(\"B\"); System.out.println(dog.getObjectAddress()); // Dog@74a14482 System.out.println(dog.getName()); // B &#125;&#125; å¦‚æœåœ¨æ–¹æ³•ä¸­æ”¹å˜å¯¹è±¡çš„å­—æ®µå€¼ä¼šæ”¹å˜åŸå¯¹è±¡è¯¥å­—æ®µå€¼ï¼Œå› ä¸ºæ”¹å˜çš„æ˜¯åŒä¸€ä¸ªåœ°å€æŒ‡å‘çš„å†…å®¹ !!! 12345678910class PassByValueExample &#123; public static void main(String[] args) &#123; Dog dog = new Dog(\"A\"); func(dog); System.out.println(dog.getName()); // B &#125; private static void func(Dog dog) &#123; dog.setName(\"B\");//æ”¹å˜åŸåœ°å€æŒ‡å‘çš„å¯¹è±¡çš„å€¼,æ‰€ä»¥åŸå¯¹è±¡ä¼šå—åˆ°å½±å“ &#125;&#125; floatä¸doubleJava ä¸èƒ½éšå¼æ‰§è¡Œå‘ä¸‹è½¬å‹ï¼Œå› ä¸ºè¿™ä¼šä½¿å¾—ç²¾åº¦é™ä½ã€‚ 1.1 å­—é¢é‡å±äº double ç±»å‹ï¼Œä¸èƒ½ç›´æ¥å°† 1.1 ç›´æ¥èµ‹å€¼ç»™ float å˜é‡ï¼Œå› ä¸ºè¿™æ˜¯å‘ä¸‹è½¬å‹ã€‚ 1234// float f = 1.1; double a=1.1; float b=2.3f; double v = 32.32d; 1.1f å­—é¢é‡æ‰æ˜¯ float ç±»å‹ã€‚ 1float f = 1.1f; éšå¼ç±»å‹è½¬æ¢å› ä¸ºå­—é¢é‡ 1 æ˜¯ int ç±»å‹ï¼Œå®ƒæ¯” short ç±»å‹ç²¾åº¦è¦é«˜ï¼Œå› æ­¤ä¸èƒ½éšå¼åœ°å°† int ç±»å‹ä¸‹è½¬å‹ä¸º short ç±»å‹ã€‚ 12short s1 = 1;// s1 = s1 + 1; ä½†æ˜¯ä½¿ç”¨ += æˆ–è€… ++ è¿ç®—ç¬¦å¯ä»¥æ‰§è¡Œéšå¼ç±»å‹è½¬æ¢ã€‚ 12s1 += 1;// s1++; ä¸Šé¢çš„è¯­å¥ç›¸å½“äºå°† s1 + 1 çš„è®¡ç®—ç»“æœè¿›è¡Œäº†å‘ä¸‹è½¬å‹ï¼š 1s1 = (short) (s1 + 1); switchä» Java 7 å¼€å§‹ï¼Œå¯ä»¥åœ¨ switch æ¡ä»¶åˆ¤æ–­è¯­å¥ä¸­ä½¿ç”¨ String å¯¹è±¡ã€‚ä½†æ˜¯ä¸æ”¯æŒLong !!!! ç»§æ‰¿æƒé™ä¿®é¥°ç¬¦ Java ä¸­æœ‰ä¸‰ä¸ªè®¿é—®æƒé™ä¿®é¥°ç¬¦ï¼šprivateã€protected ä»¥åŠ publicï¼Œå¦‚æœä¸åŠ è®¿é—®ä¿®é¥°ç¬¦ï¼Œè¡¨ç¤ºdefaultåŒ…çº§å¯è§ å¯ä»¥å¯¹ç±»æˆ–ç±»ä¸­çš„æˆå‘˜ï¼ˆå­—æ®µä»¥åŠæ–¹æ³•ï¼‰åŠ ä¸Šè®¿é—®ä¿®é¥°ç¬¦ã€‚ é‡å†™ä¸é‡è½½1. é‡å†™ï¼ˆOverrideï¼‰ å­˜åœ¨äºç»§æ‰¿ä½“ç³»ä¸­ï¼ŒæŒ‡å­ç±»å®ç°äº†ä¸€ä¸ªä¸çˆ¶ç±»åœ¨æ–¹æ³•å£°æ˜ä¸Šå®Œå…¨ç›¸åŒçš„ä¸€ä¸ªæ–¹æ³•ã€‚ ä¸ºäº†æ»¡è¶³é‡Œå¼æ›¿æ¢åŸåˆ™ï¼Œé‡å†™æœ‰ä»¥ä¸‹ä¸‰ä¸ªé™åˆ¶ï¼š å­ç±»æ–¹æ³•çš„è®¿é—®æƒé™å¿…é¡»å¤§äºç­‰äºçˆ¶ç±»æ–¹æ³•ï¼› ==( æƒé™&gt;= )== å­ç±»æ–¹æ³•çš„è¿”å›ç±»å‹å¿…é¡»æ˜¯çˆ¶ç±»æ–¹æ³•è¿”å›ç±»å‹æˆ–ä¸ºå…¶å­ç±»å‹ã€‚ ==( è¿”å›ç±»å‹ç›¸å®¹ )== å­ç±»æ–¹æ³•æŠ›å‡ºçš„å¼‚å¸¸ç±»å‹å¿…é¡»æ˜¯çˆ¶ç±»æŠ›å‡ºå¼‚å¸¸ç±»å‹æˆ–ä¸ºå…¶å­ç±»å‹ã€‚ (æŠ›å‡ºå¼‚å¸¸ç›¸å®¹) ä½¿ç”¨ @Override æ³¨è§£ï¼Œå¯ä»¥è®©ç¼–è¯‘å™¨å¸®å¿™æ£€æŸ¥æ˜¯å¦æ»¡è¶³ä¸Šé¢çš„ä¸‰ä¸ªé™åˆ¶æ¡ä»¶ã€‚ ä¸‹é¢çš„ç¤ºä¾‹ä¸­ï¼ŒSubClass ä¸º SuperClass çš„å­ç±»ï¼ŒSubClass é‡å†™äº† SuperClass çš„ func() æ–¹æ³•ã€‚å…¶ä¸­ï¼š å­ç±»æ–¹æ³•è®¿é—®æƒé™ä¸º publicï¼Œå¤§äºçˆ¶ç±»çš„ protectedã€‚ å­ç±»çš„è¿”å›ç±»å‹ä¸º ArrayListï¼Œæ˜¯çˆ¶ç±»è¿”å›ç±»å‹ List çš„å­ç±»ã€‚ å­ç±»æŠ›å‡ºçš„å¼‚å¸¸ç±»å‹ä¸º Exceptionï¼Œæ˜¯çˆ¶ç±»æŠ›å‡ºå¼‚å¸¸ Throwable çš„å­ç±»ã€‚ å­ç±»é‡å†™æ–¹æ³•ä½¿ç”¨ @Override æ³¨è§£ï¼Œä»è€Œè®©ç¼–è¯‘å™¨è‡ªåŠ¨æ£€æŸ¥æ˜¯å¦æ»¡è¶³é™åˆ¶æ¡ä»¶ã€‚ 123456789//çˆ¶ç±»protected List&lt;Integer&gt; func() throws Throwable &#123; return new ArrayList&lt;&gt;(); &#125;//å­ç±»é‡å†™çš„ @Override public ArrayList&lt;Integer&gt; func() throws Exception &#123; return new ArrayList&lt;&gt;(); &#125; 2. é‡è½½ï¼ˆOverloadï¼‰ é‡è½½åªå…³å¿ƒçš„æ˜¯å‚æ•°æ˜¯å¦ç›¸åŒ,è€Œä¸å…³å¿ƒè¿”å›å€¼ç±»å‹ !!!! å­˜åœ¨äºåŒä¸€ä¸ªç±»ä¸­ï¼ŒæŒ‡ä¸€ä¸ªæ–¹æ³•ä¸å·²ç»å­˜åœ¨çš„æ–¹æ³•åç§°ä¸Šç›¸åŒï¼Œä½†æ˜¯å‚æ•°ç±»å‹ã€ä¸ªæ•°ã€é¡ºåºè‡³å°‘æœ‰ä¸€ä¸ªä¸åŒã€‚ åº”è¯¥æ³¨æ„çš„æ˜¯ï¼Œè¿”å›å€¼ä¸åŒï¼Œå…¶å®ƒéƒ½ç›¸åŒä¸ç®—æ˜¯é‡è½½ã€‚ equals() Objectç±»ä¸­é»˜è®¤å®ç°æ˜¯æ¯”è¾ƒä¸¤ä¸ªå¯¹è±¡çš„åœ°å€å¼•ç”¨æ˜¯å¦ç›¸ç­‰ å¯¹äºåŸºæœ¬ç±»å‹ï¼Œ== åˆ¤æ–­ä¸¤ä¸ªå€¼æ˜¯å¦ç›¸ç­‰ï¼ŒåŸºæœ¬ç±»å‹æ²¡æœ‰ equals() æ–¹æ³•ã€‚ å¯¹äºå¼•ç”¨ç±»å‹ï¼Œ== åˆ¤æ–­ä¸¤ä¸ªå˜é‡æ˜¯å¦å¼•ç”¨åŒä¸€ä¸ªå¯¹è±¡ï¼Œè€Œ equals() åˆ¤æ–­å¼•ç”¨çš„å¯¹è±¡æ˜¯å¦ç­‰ä»·ã€‚ hashCode() hashCode() è¿”å›æ•£åˆ—å€¼ï¼Œè€Œ equals() æ˜¯ç”¨æ¥åˆ¤æ–­ä¸¤ä¸ªå¯¹è±¡æ˜¯å¦ç­‰ä»·ã€‚ç­‰ä»·çš„ä¸¤ä¸ªå¯¹è±¡æ•£åˆ—å€¼ä¸€å®šç›¸åŒï¼Œä½†æ˜¯æ•£åˆ—å€¼ç›¸åŒçš„ä¸¤ä¸ªå¯¹è±¡ä¸ä¸€å®šç­‰ä»·ã€‚ !!! æ‰€ä»¥hashCodeæ˜¯equals() æ–¹æ³•ä½¿ç”¨çš„å‰æ æ‰€ä»¥é‡å†™equalsæ–¹æ³•ä¸€å®šè¦é‡å†™hashCodeæ–¹æ³•, ä¸€èˆ¬å¤šç”¨äºhashç¯å¢ƒä¸‹ toString()Objectç±»åŸç”Ÿå®ç°: ç±»å+å¯¹è±¡çš„hashå€¼ clone() ä½¿ç”¨ clone() æ–¹æ³•æ¥æ‹·è´ä¸€ä¸ªå¯¹è±¡å³å¤æ‚åˆæœ‰é£é™©ï¼Œå®ƒä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œå¹¶ä¸”è¿˜éœ€è¦ç±»å‹è½¬æ¢ã€‚Effective Java ä¹¦ä¸Šè®²åˆ°ï¼Œæœ€å¥½ä¸è¦å»ä½¿ç”¨ clone()ï¼Œå¯ä»¥ä½¿ç”¨æ‹·è´æ„é€ å‡½æ•°æˆ–è€…æ‹·è´å·¥å‚æ¥æ‹·è´ä¸€ä¸ªå¯¹è±¡ã€‚ Objectç±»åŸç”Ÿå®ç°: è¿™ä¸ªæ˜¯ä¸€ä¸ªprotectedæ–¹æ³•, å¿…é¡»è¦é‡å†™æ‰èƒ½è°ƒç”¨, å¹¶ä¸”å…¶åŸç”Ÿå®ç°æ˜¯ç›´æ¥cloneçš„å¯¹è±¡çš„åœ°å€å±äºæµ…æ‹·è´ æµ…æ‹·è´ æ‹·è´å¯¹è±¡å’ŒåŸå§‹å¯¹è±¡çš„å¼•ç”¨ç±»å‹å¼•ç”¨åŒä¸€ä¸ªå¯¹è±¡ã€‚ æ·±æ‹·è´ æ‹·è´å¯¹è±¡å’ŒåŸå§‹å¯¹è±¡çš„å¼•ç”¨ç±»å‹å¼•ç”¨ä¸åŒå¯¹è±¡ã€‚ super è®¿é—®çˆ¶ç±»çš„æ„é€ å‡½æ•°ï¼šå¯ä»¥ä½¿ç”¨ super() å‡½æ•°è®¿é—®çˆ¶ç±»çš„æ„é€ å‡½æ•°ï¼Œä»è€Œå§”æ‰˜çˆ¶ç±»å®Œæˆä¸€äº›åˆå§‹åŒ–çš„å·¥ä½œã€‚åº”è¯¥æ³¨æ„åˆ°ï¼Œå­ç±»ä¸€å®šä¼šè°ƒç”¨çˆ¶ç±»çš„æ„é€ å‡½æ•°æ¥å®Œæˆåˆå§‹åŒ–å·¥ä½œï¼Œ(å­ç±»ä¸ç”¨super()æ˜¾å¼è°ƒç”¨çš„æƒ…å†µä¸‹) ä¸€èˆ¬æ˜¯è‡ªåŠ¨è°ƒç”¨çˆ¶ç±»çš„é»˜è®¤æ„é€ å‡½æ•°ï¼Œå¦‚æœå­ç±»éœ€è¦è°ƒç”¨çˆ¶ç±»å…¶å®ƒæ„é€ å‡½æ•°ï¼Œé‚£ä¹ˆå°±å¯ä»¥ä½¿ç”¨ super å‡½æ•°ã€‚ è®¿é—®çˆ¶ç±»çš„æˆå‘˜ï¼šå¦‚æœå­ç±»é‡å†™äº†çˆ¶ç±»çš„æŸä¸ªæ–¹æ³•ï¼Œå¯ä»¥é€šè¿‡ä½¿ç”¨ super å…³é”®å­—æ¥å¼•ç”¨çˆ¶ç±»çš„æ–¹æ³•å®ç°ã€‚ å…³é”®å­—static1. é™æ€å˜é‡ é™æ€å˜é‡ï¼šåˆç§°ä¸ºç±»å˜é‡ï¼Œä¹Ÿå°±æ˜¯è¯´è¿™ä¸ªå˜é‡å±äºç±»çš„ï¼Œç±»æ‰€æœ‰çš„å®ä¾‹éƒ½å…±äº«é™æ€å˜é‡ï¼Œå¯ä»¥ç›´æ¥é€šè¿‡ç±»åæ¥è®¿é—®å®ƒã€‚é™æ€å˜é‡åœ¨å†…å­˜ä¸­åªå­˜åœ¨ä¸€ä»½ã€‚ å®ä¾‹å˜é‡ï¼šæ¯åˆ›å»ºä¸€ä¸ªå®ä¾‹å°±ä¼šäº§ç”Ÿä¸€ä¸ªå®ä¾‹å˜é‡ï¼Œå®ƒä¸è¯¥å®ä¾‹åŒç”Ÿå…±æ­»ã€‚ 123456789101112public class A &#123; private int x; // å®ä¾‹å˜é‡ private static int y; // é™æ€å˜é‡ public static void main(String[] args) &#123; // int x = A.x; // Non-static field 'x' cannot be referenced from a static context A a = new A(); int x = a.x; int y = A.y; &#125;&#125; 2. é™æ€æ–¹æ³• åªèƒ½è®¿é—®æ‰€å±ç±»çš„é™æ€å­—æ®µå’Œé™æ€æ–¹æ³•( è¿™äº›å±äºç±»æ‰€æœ‰çš„, è€Œä¸æ˜¯å¯¹è±¡æ‰€æœ‰)ï¼Œæ–¹æ³•ä¸­ä¸èƒ½æœ‰ this å’Œ super å…³é”®å­—ã€‚ é™æ€æ–¹æ³•åœ¨ç±»åŠ è½½çš„æ—¶å€™å°±å­˜åœ¨äº†ï¼Œå®ƒä¸ä¾èµ–äºä»»ä½•å®ä¾‹ã€‚æ‰€ä»¥é™æ€æ–¹æ³•å¿…é¡»æœ‰å®ç°ï¼Œä¹Ÿå°±æ˜¯è¯´å®ƒä¸èƒ½æ˜¯æŠ½è±¡æ–¹æ³•ã€‚ 12345public abstract class A &#123; public static void func1()&#123; &#125; // public abstract static void func2(); // Illegal combination of modifiers: 'abstract' and 'static'&#125; 3. é™æ€è¯­å¥å— é™æ€è¯­å¥å—åœ¨ç±»åˆå§‹åŒ–æ—¶ä»…è¿è¡Œä¸€æ¬¡ã€‚ 123456789public class A &#123; static &#123; System.out.println(\"123\"); &#125; public static void main(String[] args) &#123; A a1 = new A(); A a2 = new A(); &#125;&#125; 4. é™æ€å†…éƒ¨ç±» éé™æ€å†…éƒ¨ç±»ä¾èµ–äºå¤–éƒ¨ç±»çš„å®ä¾‹ï¼Œè€Œé™æ€å†…éƒ¨ç±»ä¸éœ€è¦ã€‚ é™æ€å†…éƒ¨ç±»ä¸èƒ½è®¿é—®å¤–éƒ¨ç±»çš„éé™æ€çš„å˜é‡å’Œæ–¹æ³•ã€‚ 123456789101112131415public class OuterClass &#123; class InnerClass &#123; &#125; static class StaticInnerClass &#123; &#125; public static void main(String[] args) &#123; // InnerClass innerClass = new InnerClass(); // 'OuterClass.this' cannot be referenced from a static context OuterClass outerClass = new OuterClass(); InnerClass innerClass = outerClass.new InnerClass(); StaticInnerClass staticInnerClass = new StaticInnerClass(); &#125;&#125; 5. é™æ€å¯¼åŒ… åœ¨ä½¿ç”¨é™æ€å˜é‡å’Œæ–¹æ³•æ—¶ä¸ç”¨å†æŒ‡æ˜ ClassNameï¼Œä»è€Œç®€åŒ–ä»£ç ï¼Œä½†å¯è¯»æ€§å¤§å¤§é™ä½ã€‚ 1import static com.xxx.ClassName.* 6. åˆå§‹åŒ–é¡ºåº é™æ€å˜é‡å’Œé™æ€è¯­å¥å—ä¼˜å…ˆäºå®ä¾‹å˜é‡å’Œæ™®é€šè¯­å¥å—ï¼Œé™æ€å˜é‡å’Œé™æ€è¯­å¥å—çš„åˆå§‹åŒ–é¡ºåºå–å†³äºå®ƒä»¬åœ¨ä»£ç ä¸­çš„é¡ºåºã€‚ 12345678public static String staticField = \"é™æ€å˜é‡\";Copy to clipboardErrorCopiedstatic &#123; System.out.println(\"é™æ€è¯­å¥å—\");&#125;Copy to clipboardErrorCopiedpublic String field = \"å®ä¾‹å˜é‡\";Copy to clipboardErrorCopied&#123; System.out.println(\"æ™®é€šè¯­å¥å—\");&#125;Copy to clipboardErrorCopied æœ€åæ‰æ˜¯æ„é€ å‡½æ•°çš„åˆå§‹åŒ–ã€‚ 123public InitialOrderTest() &#123; System.out.println(\"æ„é€ å‡½æ•°\");&#125;Copy to clipboardErrorCopied å­˜åœ¨ç»§æ‰¿çš„æƒ…å†µä¸‹ï¼Œåˆå§‹åŒ–é¡ºåºä¸ºï¼š çˆ¶ç±»ï¼ˆé™æ€å˜é‡ã€é™æ€è¯­å¥å—ï¼‰ å­ç±»ï¼ˆé™æ€å˜é‡ã€é™æ€è¯­å¥å—ï¼‰ çˆ¶ç±»ï¼ˆå®ä¾‹å˜é‡ã€æ™®é€šè¯­å¥å—ï¼‰ çˆ¶ç±»ï¼ˆæ„é€ å‡½æ•°ï¼‰ å­ç±»ï¼ˆå®ä¾‹å˜é‡ã€æ™®é€šè¯­å¥å—ï¼‰ å­ç±»ï¼ˆæ„é€ å‡½æ•°ï¼‰ åå°„ ==æ¯ä¸ªç±»éƒ½æœ‰ä¸€ä¸ª Class å¯¹è±¡ï¼ŒåŒ…å«äº†ä¸ç±»æœ‰å…³çš„ä¿¡æ¯ã€‚å½“ç¼–è¯‘ä¸€ä¸ªæ–°ç±»æ—¶ï¼Œä¼šäº§ç”Ÿä¸€ä¸ªåŒåçš„ .class æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶å†…å®¹ä¿å­˜ç€ Class å¯¹è±¡ã€‚== ç±»åŠ è½½ç›¸å½“äº Class å¯¹è±¡çš„åŠ è½½ï¼Œç±»åœ¨ç¬¬ä¸€æ¬¡ä½¿ç”¨æ—¶æ‰åŠ¨æ€åŠ è½½åˆ° JVM ä¸­ã€‚ä¹Ÿå¯ä»¥ä½¿ç”¨ Class.forName(&quot;com.mysql.jdbc.Driver&quot;) è¿™ç§æ–¹å¼æ¥æ§åˆ¶ç±»çš„åŠ è½½ï¼Œè¯¥æ–¹æ³•ä¼šè¿”å›ä¸€ä¸ª Class å¯¹è±¡ã€‚ åå°„å¯ä»¥æä¾›è¿è¡Œæ—¶çš„ç±»ä¿¡æ¯ï¼Œå¹¶ä¸”è¿™ä¸ªç±»å¯ä»¥åœ¨è¿è¡Œæ—¶æ‰åŠ è½½è¿›æ¥ï¼Œç”šè‡³åœ¨ç¼–è¯‘æ—¶æœŸè¯¥ç±»çš„ .class ä¸å­˜åœ¨ä¹Ÿå¯ä»¥åŠ è½½è¿›æ¥ã€‚ Class å’Œ java.lang.reflect ä¸€èµ·å¯¹åå°„æä¾›äº†æ”¯æŒï¼Œjava.lang.reflect ç±»åº“ä¸»è¦åŒ…å«äº†ä»¥ä¸‹ä¸‰ä¸ªç±»ï¼š Field ï¼šå¯ä»¥ä½¿ç”¨ get() å’Œ set() æ–¹æ³•è¯»å–å’Œä¿®æ”¹ Field å¯¹è±¡å…³è”çš„å­—æ®µï¼› Method ï¼šå¯ä»¥ä½¿ç”¨ invoke() æ–¹æ³•è°ƒç”¨ä¸ Method å¯¹è±¡å…³è”çš„æ–¹æ³•ï¼› Constructor ï¼šå¯ä»¥ç”¨ Constructor çš„ newInstance() åˆ›å»ºæ–°çš„å¯¹è±¡ã€‚ åå°„çš„ä¼˜ç‚¹ï¼š å¯æ‰©å±•æ€§ ï¼šåº”ç”¨ç¨‹åºå¯ä»¥åˆ©ç”¨å…¨é™å®šååˆ›å»ºå¯æ‰©å±•å¯¹è±¡çš„å®ä¾‹ï¼Œæ¥ä½¿ç”¨æ¥è‡ªå¤–éƒ¨çš„ç”¨æˆ·è‡ªå®šä¹‰ç±»ã€‚ ç±»æµè§ˆå™¨å’Œå¯è§†åŒ–å¼€å‘ç¯å¢ƒ ï¼šä¸€ä¸ªç±»æµè§ˆå™¨éœ€è¦å¯ä»¥æšä¸¾ç±»çš„æˆå‘˜ã€‚å¯è§†åŒ–å¼€å‘ç¯å¢ƒï¼ˆå¦‚ IDEï¼‰å¯ä»¥ä»åˆ©ç”¨åå°„ä¸­å¯ç”¨çš„ç±»å‹ä¿¡æ¯ä¸­å—ç›Šï¼Œä»¥å¸®åŠ©ç¨‹åºå‘˜ç¼–å†™æ­£ç¡®çš„ä»£ç ã€‚ è°ƒè¯•å™¨å’Œæµ‹è¯•å·¥å…· ï¼š è°ƒè¯•å™¨éœ€è¦èƒ½å¤Ÿæ£€æŸ¥ä¸€ä¸ªç±»é‡Œçš„ç§æœ‰æˆå‘˜ã€‚æµ‹è¯•å·¥å…·å¯ä»¥åˆ©ç”¨åå°„æ¥è‡ªåŠ¨åœ°è°ƒç”¨ç±»é‡Œå®šä¹‰çš„å¯è¢«å‘ç°çš„ API å®šä¹‰ï¼Œä»¥ç¡®ä¿ä¸€ç»„æµ‹è¯•ä¸­æœ‰è¾ƒé«˜çš„ä»£ç è¦†ç›–ç‡ã€‚ åå°„çš„ç¼ºç‚¹ï¼š å°½ç®¡åå°„éå¸¸å¼ºå¤§ï¼Œä½†ä¹Ÿä¸èƒ½æ»¥ç”¨ã€‚å¦‚æœä¸€ä¸ªåŠŸèƒ½å¯ä»¥ä¸ç”¨åå°„å®Œæˆï¼Œé‚£ä¹ˆæœ€å¥½å°±ä¸ç”¨ã€‚åœ¨æˆ‘ä»¬ä½¿ç”¨åå°„æŠ€æœ¯æ—¶ï¼Œä¸‹é¢å‡ æ¡å†…å®¹åº”è¯¥ç‰¢è®°äºå¿ƒã€‚ æ€§èƒ½å¼€é”€ ï¼šåå°„æ¶‰åŠäº†åŠ¨æ€ç±»å‹çš„è§£æï¼Œæ‰€ä»¥ JVM æ— æ³•å¯¹è¿™äº›ä»£ç è¿›è¡Œä¼˜åŒ–ã€‚å› æ­¤ï¼Œåå°„æ“ä½œçš„æ•ˆç‡è¦æ¯”é‚£äº›éåå°„æ“ä½œä½å¾—å¤šã€‚æˆ‘ä»¬åº”è¯¥é¿å…åœ¨ç»å¸¸è¢«æ‰§è¡Œçš„ä»£ç æˆ–å¯¹æ€§èƒ½è¦æ±‚å¾ˆé«˜çš„ç¨‹åºä¸­ä½¿ç”¨åå°„ã€‚ å®‰å…¨é™åˆ¶ ï¼šä½¿ç”¨åå°„æŠ€æœ¯è¦æ±‚ç¨‹åºå¿…é¡»åœ¨ä¸€ä¸ªæ²¡æœ‰å®‰å…¨é™åˆ¶çš„ç¯å¢ƒä¸­è¿è¡Œã€‚å¦‚æœä¸€ä¸ªç¨‹åºå¿…é¡»åœ¨æœ‰å®‰å…¨é™åˆ¶çš„ç¯å¢ƒä¸­è¿è¡Œï¼Œå¦‚ Appletï¼Œé‚£ä¹ˆè¿™å°±æ˜¯ä¸ªé—®é¢˜äº†ã€‚ å†…éƒ¨æš´éœ² ï¼šç”±äºåå°„å…è®¸ä»£ç æ‰§è¡Œä¸€äº›åœ¨æ­£å¸¸æƒ…å†µä¸‹ä¸è¢«å…è®¸çš„æ“ä½œï¼ˆæš´éœ²äº†æºç æ–‡ä»¶: æ¯”å¦‚è®¿é—®ç§æœ‰çš„å±æ€§å’Œæ–¹æ³•ï¼‰ï¼Œæ‰€ä»¥ä½¿ç”¨åå°„å¯èƒ½ä¼šå¯¼è‡´æ„æ–™ä¹‹å¤–çš„å‰¯ä½œç”¨ï¼Œè¿™å¯èƒ½å¯¼è‡´ä»£ç åŠŸèƒ½å¤±è°ƒå¹¶ç ´åå¯ç§»æ¤æ€§ã€‚åå°„ä»£ç ç ´åäº†æŠ½è±¡æ€§ï¼Œå› æ­¤å½“å¹³å°å‘ç”Ÿæ”¹å˜çš„æ—¶å€™ï¼Œä»£ç çš„è¡Œä¸ºå°±æœ‰å¯èƒ½ä¹Ÿéšç€å˜åŒ–ã€‚ Trail: The Reflection API æ·±å…¥è§£æ Java åå°„ï¼ˆ1ï¼‰- åŸºç¡€ æŠ½è±¡ç±»ä¸æ¥å£1. æŠ½è±¡ç±» æŠ½è±¡ç±»å’ŒæŠ½è±¡æ–¹æ³•éƒ½ä½¿ç”¨ abstract å…³é”®å­—è¿›è¡Œå£°æ˜ã€‚å¦‚æœä¸€ä¸ªç±»ä¸­åŒ…å«æŠ½è±¡æ–¹æ³•ï¼Œé‚£ä¹ˆè¿™ä¸ªç±»å¿…é¡»å£°æ˜ä¸ºæŠ½è±¡ç±»ã€‚ æŠ½è±¡ç±»å’Œæ™®é€šç±»æœ€å¤§çš„åŒºåˆ«æ˜¯ï¼ŒæŠ½è±¡ç±»ä¸èƒ½è¢«å®ä¾‹åŒ–ï¼Œéœ€è¦ç»§æ‰¿æŠ½è±¡ç±»æ‰èƒ½å®ä¾‹åŒ–å…¶å­ç±»ã€‚ 2. æ¥å£ æ¥å£æ˜¯æŠ½è±¡ç±»çš„å»¶ä¼¸ï¼Œåœ¨ Java 8 ä¹‹å‰ï¼Œå®ƒå¯ä»¥çœ‹æˆæ˜¯ä¸€ä¸ªå®Œå…¨æŠ½è±¡çš„ç±»ï¼Œä¹Ÿå°±æ˜¯è¯´å®ƒä¸èƒ½æœ‰ä»»ä½•çš„æ–¹æ³•å®ç°ã€‚ä» Java 8 å¼€å§‹ï¼Œæ¥å£ä¹Ÿå¯ä»¥æ‹¥æœ‰é»˜è®¤çš„æ–¹æ³•å®ç°ï¼Œè¿™æ˜¯å› ä¸ºä¸æ”¯æŒé»˜è®¤æ–¹æ³•çš„æ¥å£çš„ç»´æŠ¤æˆæœ¬å¤ªé«˜äº†ã€‚åœ¨ Java 8 ä¹‹å‰ï¼Œå¦‚æœä¸€ä¸ªæ¥å£æƒ³è¦æ·»åŠ æ–°çš„æ–¹æ³•ï¼Œé‚£ä¹ˆè¦ä¿®æ”¹æ‰€æœ‰å®ç°äº†è¯¥æ¥å£çš„ç±»ã€‚ æ¥å£çš„æˆå‘˜ï¼ˆå­—æ®µ + æ–¹æ³•ï¼‰é»˜è®¤éƒ½æ˜¯ public çš„ï¼Œå¹¶ä¸”ä¸å…è®¸å®šä¹‰ä¸º private æˆ–è€… protected (å› ä¸ºæ¥å£å¿…é¡»è¢«å®ç°)ã€‚ æ¥å£çš„å­—æ®µé»˜è®¤éƒ½æ˜¯ static å’Œ final çš„ã€‚ 3. æ¯”è¾ƒ ä»è®¾è®¡å±‚é¢ä¸Šçœ‹ï¼ŒæŠ½è±¡ç±»æä¾›äº†ä¸€ç§ IS-A å…³ç³»ï¼Œé‚£ä¹ˆå°±å¿…é¡»æ»¡è¶³é‡Œå¼æ›¿æ¢åŸåˆ™ï¼Œå³å­ç±»å¯¹è±¡å¿…é¡»èƒ½å¤Ÿæ›¿æ¢æ‰æ‰€æœ‰çˆ¶ç±»å¯¹è±¡ã€‚è€Œæ¥å£æ›´åƒæ˜¯ä¸€ç§ LIKE-A å…³ç³»ï¼Œå®ƒåªæ˜¯æä¾›ä¸€ç§æ–¹æ³•å®ç°å¥‘çº¦ï¼Œå¹¶ä¸è¦æ±‚æ¥å£å’Œå®ç°æ¥å£çš„ç±»å…·æœ‰ IS-A å…³ç³»ã€‚ ä»ä½¿ç”¨ä¸Šæ¥çœ‹ï¼Œä¸€ä¸ªç±»å¯ä»¥å®ç°å¤šä¸ªæ¥å£ï¼Œä½†æ˜¯ä¸èƒ½ç»§æ‰¿å¤šä¸ªæŠ½è±¡ç±»ã€‚ æ¥å£çš„å­—æ®µåªèƒ½æ˜¯ static å’Œ final ç±»å‹çš„ï¼Œè€ŒæŠ½è±¡ç±»çš„å­—æ®µæ²¡æœ‰è¿™ç§é™åˆ¶ã€‚ æ¥å£çš„æˆå‘˜åªèƒ½æ˜¯ public çš„ï¼Œè€ŒæŠ½è±¡ç±»çš„æˆå‘˜å¯ä»¥æœ‰å¤šç§è®¿é—®æƒé™ã€‚ 4. ä½¿ç”¨é€‰æ‹© ä½¿ç”¨æ¥å£ï¼š éœ€è¦è®©ä¸ç›¸å…³çš„ç±»éƒ½å®ç°ä¸€ä¸ªæ–¹æ³•ï¼Œä¾‹å¦‚ä¸ç›¸å…³çš„ç±»éƒ½å¯ä»¥å®ç° Compareable æ¥å£ä¸­çš„ compareTo() æ–¹æ³•ï¼› éœ€è¦ä½¿ç”¨å¤šé‡ç»§æ‰¿ã€‚ ä½¿ç”¨æŠ½è±¡ç±»ï¼š éœ€è¦åœ¨å‡ ä¸ªç›¸å…³çš„ç±»ä¸­å…±äº«ä»£ç ã€‚ éœ€è¦èƒ½æ§åˆ¶ç»§æ‰¿æ¥çš„æˆå‘˜çš„è®¿é—®æƒé™ï¼Œè€Œä¸æ˜¯éƒ½ä¸º publicã€‚ éœ€è¦ç»§æ‰¿éé™æ€å’Œéå¸¸é‡å­—æ®µã€‚ åœ¨å¾ˆå¤šæƒ…å†µä¸‹ï¼Œæ¥å£ä¼˜å…ˆäºæŠ½è±¡ç±»ã€‚å› ä¸ºæ¥å£æ²¡æœ‰æŠ½è±¡ç±»ä¸¥æ ¼çš„ç±»å±‚æ¬¡ç»“æ„è¦æ±‚ï¼Œå¯ä»¥çµæ´»åœ°ä¸ºä¸€ä¸ªç±»æ·»åŠ è¡Œä¸ºã€‚å¹¶ä¸”ä» Java 8 å¼€å§‹ï¼Œæ¥å£ä¹Ÿå¯ä»¥æœ‰é»˜è®¤çš„æ–¹æ³•å®ç°ï¼Œä½¿å¾—ä¿®æ”¹æ¥å£çš„æˆæœ¬ä¹Ÿå˜çš„å¾ˆä½ã€‚ å¼‚å¸¸Throwable å¯ä»¥ç”¨æ¥è¡¨ç¤ºä»»ä½•å¯ä»¥ä½œä¸ºå¼‚å¸¸æŠ›å‡ºçš„ç±»,æ˜¯æ‰€æœ‰å¼‚å¸¸çš„åŸºç±»ï¼Œåˆ†ä¸ºä¸¤ç§ï¼š Error å’Œ Exceptionã€‚å…¶ä¸­ Error ç”¨æ¥è¡¨ç¤º JVM æ— æ³•å¤„ç†çš„é”™è¯¯ï¼ŒException åˆ†ä¸ºä¸¤ç§ï¼š å—æ£€å¼‚å¸¸ ï¼šéœ€è¦ç”¨ tryâ€¦catchâ€¦ è¯­å¥æ•è·å¹¶è¿›è¡Œå¤„ç†ï¼Œå¹¶ä¸”å¯ä»¥ä»å¼‚å¸¸ä¸­æ¢å¤ï¼› éå—æ£€å¼‚å¸¸ ï¼šæ˜¯ç¨‹åºè¿è¡Œæ—¶é”™è¯¯ï¼Œä¾‹å¦‚é™¤ 0 ä¼šå¼•å‘ Arithmetic Exceptionï¼Œæ­¤æ—¶ç¨‹åºå´©æºƒå¹¶ä¸”æ— æ³•æ¢å¤ã€‚ æ³›å‹ æ³›å‹çš„æœ¬è´¨æ˜¯ä¸ºäº†å‚æ•°åŒ–ç±»å‹ï¼ˆåœ¨ä¸åˆ›å»ºæ–°çš„ç±»å‹çš„æƒ…å†µä¸‹ï¼Œé€šè¿‡æ³›å‹æŒ‡å®šçš„ä¸åŒç±»å‹æ¥æ§åˆ¶å½¢å‚å…·ä½“é™åˆ¶çš„ç±»å‹ï¼‰ã€‚ä¹Ÿå°±æ˜¯è¯´åœ¨æ³›å‹ä½¿ç”¨è¿‡ç¨‹ä¸­ï¼Œæ“ä½œçš„æ•°æ®ç±»å‹è¢«æŒ‡å®šä¸ºä¸€ä¸ªå‚æ•°ï¼Œè¿™ç§å‚æ•°ç±»å‹å¯ä»¥ç”¨åœ¨ç±»ã€æ¥å£å’Œæ–¹æ³•ä¸­ï¼Œåˆ†åˆ«è¢«ç§°ä¸ºæ³›å‹ç±»ã€æ³›å‹æ¥å£ã€æ³›å‹æ–¹æ³•ã€‚ æ³›å‹ç±»:123456789/***åœ¨ä½¿ç”¨æ³›å‹çš„æ—¶å€™å¦‚æœä¼ å…¥æ³›å‹å®å‚ï¼Œåˆ™ä¼šæ ¹æ®ä¼ å…¥çš„æ³›å‹å®å‚åšç›¸åº”çš„é™åˆ¶ï¼Œæ­¤æ—¶æ³›å‹æ‰ä¼šèµ·åˆ°æœ¬åº”èµ·åˆ°çš„é™åˆ¶ä½œç”¨ã€‚å¦‚æœä¸ä¼ å…¥æ³›å‹ç±»å‹å®å‚çš„è¯ï¼Œåœ¨æ³›å‹ç±»ä¸­ä½¿ç”¨æ³›å‹çš„æ–¹æ³•æˆ–æˆå‘˜å˜é‡å®šä¹‰çš„ç±»å‹å¯ä»¥ä¸ºä»»ä½•çš„ç±»å‹ã€‚ */public class Box&lt;T&gt; &#123; // T stands for \"Type\" private T t; public void set(T t) &#123; this.t = t; &#125; public T get() &#123; return t; &#125;&#125; æ³›å‹æ¥å£:1234567891011/** * æœªä¼ å…¥æ³›å‹å®å‚æ—¶ï¼Œä¸æ³›å‹ç±»çš„å®šä¹‰ç›¸åŒï¼Œåœ¨å£°æ˜ç±»çš„æ—¶å€™ï¼Œéœ€å°†æ³›å‹çš„å£°æ˜ä¹Ÿä¸€èµ·åŠ åˆ°ç±»ä¸­ * å³ï¼šclass FruitGenerator&lt;T&gt; implements Generator&lt;T&gt;&#123; * å¦‚æœä¸å£°æ˜æ³›å‹ï¼Œå¦‚ï¼šclass FruitGenerator implements Generator&lt;T&gt;ï¼Œç¼–è¯‘å™¨ä¼šæŠ¥é”™ï¼š\"Unknown class\" */class FruitGenerator&lt;T&gt; implements Generator&lt;T&gt;&#123; @Override public T next() &#123; return null; &#125;&#125; æ³›å‹æ–¹æ³•:123456789101112131415/** * æ³›å‹æ–¹æ³•çš„åŸºæœ¬ä»‹ç» * @param tClass ä¼ å…¥çš„æ³›å‹å®å‚ * @return T è¿”å›å€¼ä¸ºTç±»å‹ * è¯´æ˜ï¼š * 1ï¼‰public ä¸ è¿”å›å€¼ä¸­é—´&lt;T&gt;éå¸¸é‡è¦ï¼Œå¯ä»¥ç†è§£ä¸ºå£°æ˜æ­¤æ–¹æ³•ä¸ºæ³›å‹æ–¹æ³•ã€‚ * 2ï¼‰åªæœ‰å£°æ˜äº†&lt;T&gt;çš„æ–¹æ³•æ‰æ˜¯æ³›å‹æ–¹æ³•ï¼Œæ³›å‹ç±»ä¸­çš„ä½¿ç”¨äº†æ³›å‹çš„æˆå‘˜æ–¹æ³•å¹¶ä¸æ˜¯æ³›å‹æ–¹æ³•ã€‚ * 3ï¼‰&lt;T&gt;è¡¨æ˜è¯¥æ–¹æ³•å°†ä½¿ç”¨æ³›å‹ç±»å‹Tï¼Œæ­¤æ—¶æ‰å¯ä»¥åœ¨æ–¹æ³•ä¸­ä½¿ç”¨æ³›å‹ç±»å‹Tã€‚ * 4ï¼‰ä¸æ³›å‹ç±»çš„å®šä¹‰ä¸€æ ·ï¼Œæ­¤å¤„Tå¯ä»¥éšä¾¿å†™ä¸ºä»»æ„æ ‡è¯†ï¼Œå¸¸è§çš„å¦‚Tã€Eã€Kã€Vç­‰å½¢å¼çš„å‚æ•°å¸¸ç”¨äºè¡¨ç¤ºæ³›å‹ã€‚ */public &lt;T&gt; T genericMethod(Class&lt;T&gt; tClass)throws InstantiationException , IllegalAccessException&#123; T instance = tClass.newInstance(); return instance;&#125; æ³›å‹é¢è¯•é¢˜: Javaä¸­çš„æ³›å‹æ˜¯ä»€ä¹ˆ ? ä½¿ç”¨æ³›å‹çš„å¥½å¤„æ˜¯ä»€ä¹ˆ? é‚£äº›æ‹¥æœ‰Java1.4æˆ–æ›´æ—©ç‰ˆæœ¬çš„å¼€å‘èƒŒæ™¯çš„äººéƒ½çŸ¥é“ï¼Œåœ¨é›†åˆä¸­å­˜å‚¨å¯¹è±¡å¹¶åœ¨ä½¿ç”¨å‰è¿›è¡Œç±»å‹è½¬æ¢æ˜¯å¤šä¹ˆçš„ä¸æ–¹ä¾¿ã€‚æ³›å‹é˜²æ­¢äº†é‚£ç§æƒ…å†µçš„å‘ç”Ÿã€‚å®ƒæä¾›äº†ç¼–è¯‘æœŸçš„ç±»å‹å®‰å…¨ï¼Œç¡®ä¿ä½ åªèƒ½æŠŠæ­£ç¡®ç±»å‹çš„å¯¹è±¡æ”¾å…¥é›†åˆä¸­ï¼Œé¿å…äº†åœ¨è¿è¡Œæ—¶å‡ºç°ClassCastExceptionã€‚ Javaçš„æ³›å‹æ˜¯å¦‚ä½•å·¥ä½œçš„ ? ä»€ä¹ˆæ˜¯ç±»å‹æ“¦é™¤ ? æ³›å‹æ˜¯é€šè¿‡ç±»å‹æ“¦é™¤æ¥å®ç°çš„ï¼Œç¼–è¯‘å™¨åœ¨ç¼–è¯‘æ—¶æ“¦é™¤äº†æ‰€æœ‰ç±»å‹ç›¸å…³çš„ä¿¡æ¯ï¼Œæ‰€ä»¥åœ¨è¿è¡Œæ—¶ä¸å­˜åœ¨ä»»ä½•ç±»å‹ç›¸å…³çš„ä¿¡æ¯ã€‚ä¾‹å¦‚Liståœ¨è¿è¡Œæ—¶ä»…ç”¨ä¸€ä¸ªListæ¥è¡¨ç¤ºã€‚è¿™æ ·åšçš„ç›®çš„ï¼Œæ˜¯ç¡®ä¿èƒ½å’ŒJava 5ä¹‹å‰çš„ç‰ˆæœ¬å¼€å‘äºŒè¿›åˆ¶ç±»åº“è¿›è¡Œå…¼å®¹ã€‚ä½ æ— æ³•åœ¨è¿è¡Œæ—¶è®¿é—®åˆ°ç±»å‹å‚æ•°ï¼Œå› ä¸ºç¼–è¯‘å™¨å·²ç»æŠŠæ³›å‹ç±»å‹è½¬æ¢æˆäº†åŸå§‹ç±»å‹ã€‚æ ¹æ®ä½ å¯¹è¿™ä¸ªæ³›å‹é—®é¢˜çš„å›ç­”æƒ…å†µï¼Œä½ ä¼šå¾—åˆ°ä¸€äº›åç»­æé—®ï¼Œæ¯”å¦‚ä¸ºä»€ä¹ˆæ³›å‹æ˜¯ç”±ç±»å‹æ“¦é™¤æ¥å®ç°çš„æˆ–è€…ç»™ä½ å±•ç¤ºä¸€äº›ä¼šå¯¼è‡´ç¼–è¯‘å™¨å‡ºé”™çš„é”™è¯¯æ³›å‹ä»£ç ã€‚è¯·é˜…è¯»æˆ‘çš„Javaä¸­æ³›å‹æ˜¯å¦‚ä½•å·¥ä½œçš„æ¥äº†è§£æ›´å¤šä¿¡æ¯ã€‚ Arrayä¸­å¯ä»¥ç”¨æ³›å‹å—? ä¸å¯ä»¥, Arrayäº‹å®ä¸Šå¹¶ä¸æ”¯æŒæ³›å‹, å»ºè®®ç”¨Listæ¥ä»£æ›¿Array,listå¯ä»¥æä¾›ç¼–è¯‘æœŸé—´çš„ç±»å‹å®‰å…¨ä¿è¯ å¯ä»¥æŠŠListä¼ é€’ç»™ä¸€ä¸ªæ¥å—Listå‚æ•°çš„æ–¹æ³•å—ï¼Ÿ ä¸å¯ä»¥, ä¼šå¯¼è‡´ç¼–è¯‘é”™è¯¯, å› ä¸ºList å¯ä»¥å­˜å‚¨ä»»ä½•ç±»å‹çš„å¯¹è±¡,è€ŒList åªèƒ½æ˜¯String ç¼–å†™ä¸€ä¸ªæ³›å‹æ–¹æ³•ï¼Œè®©å®ƒèƒ½æ¥å—æ³›å‹å‚æ•°å¹¶è¿”å›æ³›å‹ç±»å‹? 123public V put(K key, V value) &#123; return cache.put(key, value); &#125; æ³¨è§£ æ³¨è§£æœ¬è´¨æ˜¯ä¸€ä¸ªç»§æ‰¿äº†Annotation çš„ç‰¹æ®Šæ¥å£ï¼Œå…¶å…·ä½“å®ç°ç±»æ˜¯Java è¿è¡Œæ—¶ç”Ÿæˆçš„åŠ¨æ€ä»£ç†ç±»ã€‚è€Œæˆ‘ä»¬é€šè¿‡åå°„è·å–æ³¨è§£æ—¶ï¼Œè¿”å›çš„æ˜¯Java è¿è¡Œæ—¶ç”Ÿæˆçš„åŠ¨æ€ä»£ç†å¯¹è±¡$Proxy1ã€‚é€šè¿‡ä»£ç†å¯¹è±¡è°ƒç”¨è‡ªå®šä¹‰æ³¨è§£ï¼ˆæ¥å£ï¼‰çš„æ–¹æ³•ï¼Œä¼šæœ€ç»ˆè°ƒç”¨AnnotationInvocationHandler çš„invoke æ–¹æ³•ã€‚è¯¥æ–¹æ³•ä¼šä»memberValues è¿™ä¸ªMap ä¸­ç´¢å¼•å‡ºå¯¹åº”çš„å€¼ã€‚è€ŒmemberValues çš„æ¥æºæ˜¯Java å¸¸é‡æ± ã€‚ (å­˜äº†ç±»ç»“æ„æ–‡ä»¶çš„å€¼) è‡ªå®šä¹‰æ³¨è§£ç±»ç¼–å†™çš„ä¸€äº›è§„åˆ™: \\1. Annotation å‹å®šä¹‰ä¸º@interface, æ‰€æœ‰çš„Annotation ä¼šè‡ªåŠ¨ç»§æ‰¿java.lang.Annotationè¿™ä¸€æ¥å£,å¹¶ä¸”ä¸èƒ½å†å»ç»§æ‰¿åˆ«çš„ç±»æˆ–æ˜¯æ¥å£. \\2. å‚æ•°æˆå‘˜åªèƒ½ç”¨public æˆ–é»˜è®¤(default) è¿™ä¸¤ä¸ªè®¿é—®æƒä¿®é¥° \\3. å‚æ•°æˆå‘˜åªèƒ½ç”¨åŸºæœ¬ç±»å‹byteã€shortã€charã€intã€longã€floatã€doubleã€booleanå…«ç§åŸºæœ¬æ•°æ®ç±»å‹å’ŒStringã€Enumã€Classã€annotationsç­‰æ•°æ®ç±»å‹ï¼Œä»¥åŠè¿™ä¸€äº›ç±»å‹çš„æ•°ç»„. \\4. è¦è·å–ç±»æ–¹æ³•å’Œå­—æ®µçš„æ³¨è§£ä¿¡æ¯ï¼Œå¿…é¡»é€šè¿‡Javaçš„åå°„æŠ€æœ¯æ¥è·å– Annotation å¯¹è±¡ï¼Œå› ä¸ºä½ é™¤æ­¤ä¹‹å¤–æ²¡æœ‰åˆ«çš„è·å–æ³¨è§£å¯¹è±¡çš„æ–¹æ³• \\5. æ³¨è§£ä¹Ÿå¯ä»¥æ²¡æœ‰å®šä¹‰æˆå‘˜,ï¼Œä¸è¿‡è¿™æ ·æ³¨è§£å°±æ²¡å•¥ç”¨äº†PS:è‡ªå®šä¹‰æ³¨è§£éœ€è¦ä½¿ç”¨åˆ°å…ƒæ³¨è§£ åŸºæœ¬å®¹å™¨List, Set, Queue éƒ½ç»§æ‰¿è‡ªCollectionæ¥å£ List ä¼˜ç‚¹ ç¼ºç‚¹ ä¿å­˜å…ƒç´ çš„é¡ºåº åº”ç”¨ ArrayList éšæœºè®¿é—®é€Ÿåº¦å¿«ï¼Œå†…éƒ¨ä½¿ç”¨æ•°ç»„å®ç°ã€‚ è¿­ä»£ï¼Œæ’å…¥å’Œåˆ é™¤å…ƒç´ æ…¢ï¼Œå°¤å…¶æ˜¯å½“List]å°ºå¯¸æ¯”è¾ƒå¤§çš„æ—¶å€™ã€‚ æ’å…¥é¡ºåº å¯å˜é•¿æ•°ç»„ LinkedList è¿­ä»£(é¡ºåºè®¿é—®ç»è¿‡ä¼˜åŒ–)ï¼Œæ’å…¥ï¼Œåˆ é™¤éƒ½å¾ˆå¿«å†…éƒ¨ä½¿ç”¨åŒå‘é“¾è¡¨å®ç° éšæœºè®¿é—®é€Ÿåº¦æ…¢ æ’å…¥é¡ºåº é¡ºåºè®¿é—®, æ‰¹é‡æ’å…¥åˆ é™¤å…ƒç´ çš„åœºåˆ Set ä¼˜ç‚¹ ä¿å­˜å…ƒç´ çš„é¡ºåº è¦æ±‚ HashSet ä¸ºå¿«é€ŸæŸ¥æ‰¾è®¾è®¡ æ•£åˆ—å­˜å‚¨ å¿…é¡»å®šä¹‰hashCode()æ–¹æ³• LinkedHashSet å’ŒHashSetä¸€æ ·çš„æŸ¥è¯¢é€Ÿåº¦ï¼Œä½†æ˜¯æ’å…¥è¦æ¯”HashSetæ…¢ä¸€äº›ï¼Œå› ä¸ºå®ƒé€šè¿‡ç»´æŠ¤é“¾è¡¨å½¢å¼ç»´æŠ¤å…ƒç´ ã€‚ ä½¿ç”¨é“¾è¡¨ç»´æŠ¤å…ƒç´ é¡ºåº(æ’å…¥é¡ºåº) å¿…é¡»å®šä¹‰hashCode()æ–¹æ³• TreeSet ä¿å­˜æœ‰åºçš„Setï¼Œåº•å±‚é€šè¿‡TreeMapæ¥å®ç°çš„ æŒ‰ç…§æ’åºé¡ºåºç»´æŠ¤å…ƒç´  å¿…é¡»å®ç°Comparableæ¥å£(åŒ…å«compareToæ–¹æ³•) HashMap, HashTableéƒ½ç»§æ‰¿è‡ªMapæ¥å£ Queue ç‰¹ç‚¹ ä¿å­˜å…ƒç´ çš„é¡ºåº LinkedList LinkedListé™¤äº†æ™®é€šListä¹‹å¤–ï¼Œè¿˜æ·»åŠ äº†å¾ˆå¤šå®ç°&lt;é˜Ÿåˆ—ï¼Œæ ˆï¼ŒåŒå‘é˜Ÿåˆ—&gt;ä¸‰ç§æ•°æ®ç»“æ„çš„æ–¹æ³•ã€‚å°¤å…¶æ˜¯æ¨¡æ‹ŸQueueçš„æ—¶å€™åœ¨ä¸¤ç«¯æ’å…¥åˆ é™¤å…ƒç´ å¾ˆå¿«(ç»è¿‡äº†ä¼˜åŒ–)ã€‚ æ’å…¥çš„é¡ºåº PriorityQueue æŒ‰ç…§æ’åºé¡ºåºå–å‡ºå…ƒç´ ï¼Œæ‰€ä»¥è¦æ±‚å¿…é¡»å®ç°Comparableæ¥å£ã€‚ æ’åºé¡ºåº Map ç‰¹ç‚¹ ä¿å­˜å…ƒç´ çš„é¡ºåº è¦æ±‚ HashMap MapåŸºäºæ•£åˆ—å­˜å‚¨ï¼Œæ’å…¥å’ŒæŸ¥è¯¢â€œé”®å€¼å¯¹â€çš„å¼€é”€æ˜¯å›ºå®šçš„ã€‚ æ•£åˆ—å­˜å‚¨ å­˜å…¥çš„é”®éœ€è¦å…·å¤‡hashCode()æ–¹æ³•ï¼Œå½“ç„¶ï¼Œè¿”å›çš„æ ‡è¯†ä¸ä¸€å®šè¦å”¯ä¸€ LinkedHashMap ä¸ºäº†æé«˜é€Ÿåº¦æ•£åˆ—äº†æ‰€æœ‰å…ƒç´ ï¼Œæ’å…¥æŸ¥è¯¢åªæ¯”HashMapæ…¢ä¸€ç‚¹ç‚¹ï¼Œå› ä¸ºå®ƒåœ¨ç»´æŠ¤æ•£åˆ—æ•°æ®ç»“æ„çš„åŒæ—¶è¿˜è¦ç»´æŠ¤é“¾è¡¨(æ’å…¥é¡ºåº)ã€‚ ä½†æ˜¯è¿­ä»£è®¿é—®çš„æ—¶å€™æ›´å¿«ï¼Œå› ä¸ºå†…éƒ¨ä½¿ç”¨é“¾è¡¨ç»´æŠ¤æ¬¡åºã€‚ æ’å…¥é¡ºåº åŒæ ·éœ€è¦é”®å®ç°hashCode()æ–¹æ³• TreeMap MapåŸºäºçº¢é»‘æ ‘çš„å®ç°ã€‚æ‰€ä»¥æ‰€å¾—çš„ç»“æœæ˜¯ç»è¿‡æ’åºçš„ã€‚ çº¢é»‘æ ‘ ä¸ºäº†æ’åºï¼Œå¿…é¡»å®ç°Comparableæ¥å£ã€‚ ç‰¹æ€§Java å„ç‰ˆæœ¬çš„æ–°ç‰¹æ€§New highlights in Java SE 8 Lambda Expressions Pipelines and Streams Date and Time API Default Methods Type Annotations Nashhorn JavaScript Engine Concurrent Accumulators Parallel operations PermGen Error Removed New highlights in Java SE 7 Strings in Switch Statement Type Inference for Generic Instance Creation Multiple Exception Handling Support for Dynamic Languages Try with Resources Java nio Package Binary Literals, Underscore in literals Diamond Syntax Difference between Java 1.8 and Java 1.7? Java 8 ç‰¹æ€§ Java ä¸ C++ çš„åŒºåˆ« Java æ˜¯çº¯ç²¹çš„é¢å‘å¯¹è±¡è¯­è¨€ï¼Œæ‰€æœ‰çš„å¯¹è±¡éƒ½ç»§æ‰¿è‡ª java.lang.Objectï¼ŒC++ ä¸ºäº†å…¼å®¹ C å³æ”¯æŒé¢å‘å¯¹è±¡ä¹Ÿæ”¯æŒé¢å‘è¿‡ç¨‹ã€‚ Java é€šè¿‡è™šæ‹Ÿæœºä»è€Œå®ç°è·¨å¹³å°ç‰¹æ€§ï¼Œä½†æ˜¯ C++ ä¾èµ–äºç‰¹å®šçš„å¹³å°ã€‚ Java æ²¡æœ‰æŒ‡é’ˆï¼Œå®ƒçš„å¼•ç”¨å¯ä»¥ç†è§£ä¸ºå®‰å…¨æŒ‡é’ˆï¼Œè€Œ C++ å…·æœ‰å’Œ C ä¸€æ ·çš„æŒ‡é’ˆã€‚ Java æ”¯æŒè‡ªåŠ¨åƒåœ¾å›æ”¶ï¼Œè€Œ C++ éœ€è¦æ‰‹åŠ¨å›æ”¶ã€‚ Java ä¸æ”¯æŒå¤šé‡ç»§æ‰¿ï¼Œåªèƒ½é€šè¿‡å®ç°å¤šä¸ªæ¥å£æ¥è¾¾åˆ°ç›¸åŒç›®çš„ï¼Œè€Œ C++ æ”¯æŒå¤šé‡ç»§æ‰¿ã€‚ Java ä¸æ”¯æŒæ“ä½œç¬¦é‡è½½ï¼Œè™½ç„¶å¯ä»¥å¯¹ä¸¤ä¸ª String å¯¹è±¡æ‰§è¡ŒåŠ æ³•è¿ç®—ï¼Œä½†æ˜¯è¿™æ˜¯è¯­è¨€å†…ç½®æ”¯æŒçš„æ“ä½œï¼Œä¸å±äºæ“ä½œç¬¦é‡è½½ï¼Œè€Œ C++ å¯ä»¥ã€‚ Java çš„ goto æ˜¯ä¿ç•™å­—ï¼Œä½†æ˜¯ä¸å¯ç”¨ï¼ŒC++ å¯ä»¥ä½¿ç”¨ gotoã€‚ JRE or JDK JRE is the JVM program, Java application need to run on JRE. JDK is a superset of JRE, JRE + tools for developing java programs. e.g, it provides the compiler â€œjavacâ€","categories":[{"name":"Java","slug":"Java","permalink":"/categories/Java/"}],"tags":[{"name":"Java","slug":"Java","permalink":"/tags/Java/"},{"name":"IT","slug":"IT","permalink":"/tags/IT/"},{"name":"æŠ€æœ¯ç¬”è®°","slug":"æŠ€æœ¯ç¬”è®°","permalink":"/tags/%E6%8A%80%E6%9C%AF%E7%AC%94%E8%AE%B0/"},{"name":"Job","slug":"Job","permalink":"/tags/Job/"}]},{"title":"Mybatisé¢è¯•","slug":"Mybatisé¢è¯•","date":"2019-10-20T11:51:12.000Z","updated":"2019-10-20T06:03:25.382Z","comments":true,"path":"2019/10/20/Mybatisé¢è¯•/","link":"","permalink":"/2019/10/20/Mybatis%E9%9D%A2%E8%AF%95/","excerpt":"","text":"1ã€ä»€ä¹ˆæ˜¯Mybatisï¼Ÿ ï¼ˆ1ï¼‰Mybatisæ˜¯ä¸€ä¸ªåŠORMï¼ˆå¯¹è±¡å…³ç³»æ˜ å°„ï¼‰æ¡†æ¶ï¼Œå®ƒå†…éƒ¨å°è£…äº†JDBCï¼Œå¼€å‘æ—¶åªéœ€è¦å…³æ³¨SQLè¯­å¥æœ¬èº«ï¼Œä¸éœ€è¦èŠ±è´¹ç²¾åŠ›å»å¤„ç†åŠ è½½é©±åŠ¨ã€åˆ›å»ºè¿æ¥ã€åˆ›å»ºstatementç­‰ç¹æ‚çš„è¿‡ç¨‹ã€‚ç¨‹åºå‘˜ç›´æ¥ç¼–å†™åŸç”Ÿæ€sql, ä¸¥æ ¼æ§åˆ¶sqlæ‰§è¡Œæ€§èƒ½ï¼Œçµæ´»åº¦é«˜ã€‚ ï¼ˆ2ï¼‰MyBatis å¯ä»¥ä½¿ç”¨ XML æˆ–æ³¨è§£æ¥é…ç½®å’Œæ˜ å°„åŸç”Ÿä¿¡æ¯ï¼Œå°† POJOæ˜ å°„æˆæ•°æ®åº“ä¸­çš„è®°å½•ï¼Œé¿å…äº†å‡ ä¹æ‰€æœ‰çš„ JDBC ä»£ç å’Œæ‰‹åŠ¨è®¾ç½®å‚æ•°ä»¥åŠè·å–ç»“æœé›†ã€‚ ï¼ˆ3ï¼‰é€šè¿‡xml æ–‡ä»¶æˆ–æ³¨è§£çš„æ–¹å¼å°†è¦æ‰§è¡Œçš„å„ç§ statement é…ç½®èµ·æ¥ï¼Œå¹¶é€šè¿‡javaå¯¹è±¡å’Œ statementä¸­sqlçš„åŠ¨æ€å‚æ•°è¿›è¡Œæ˜ å°„ç”Ÿæˆæœ€ç»ˆæ‰§è¡Œçš„sqlè¯­å¥ï¼Œæœ€åç”±mybatisæ¡†æ¶æ‰§è¡Œsqlå¹¶å°†ç»“æœæ˜ å°„ä¸ºjavaå¯¹è±¡å¹¶è¿”å›ã€‚ï¼ˆä»æ‰§è¡Œsqlåˆ°è¿”å›resultçš„è¿‡ç¨‹). 2ã€Mybaitsçš„ä¼˜ç‚¹ï¼š ï¼ˆ1ï¼‰åŸºäºSQLè¯­å¥ç¼–ç¨‹ï¼Œç›¸å½“çµæ´»ï¼Œä¸ä¼šå¯¹åº”ç”¨ç¨‹åºæˆ–è€…æ•°æ®åº“çš„ç°æœ‰è®¾è®¡é€ æˆä»»ä½•å½±å“ï¼ŒSQLå†™åœ¨XMLé‡Œï¼Œè§£é™¤sqlä¸ç¨‹åºä»£ç çš„è€¦åˆï¼Œä¾¿äºç»Ÿä¸€ç®¡ç†ï¼›æä¾›XMLæ ‡ç­¾ï¼Œæ”¯æŒç¼–å†™åŠ¨æ€SQLè¯­å¥ï¼Œå¹¶å¯é‡ç”¨ã€‚ ï¼ˆ2ï¼‰ä¸JDBCç›¸æ¯”ï¼Œå‡å°‘äº†50%ä»¥ä¸Šçš„ä»£ç é‡ï¼Œæ¶ˆé™¤äº†JDBCå¤§é‡å†—ä½™çš„ä»£ç ï¼Œä¸éœ€è¦æ‰‹åŠ¨å¼€å…³è¿æ¥ï¼› ï¼ˆ3ï¼‰å¾ˆå¥½çš„ä¸å„ç§æ•°æ®åº“å…¼å®¹ï¼ˆå› ä¸ºMyBatisä½¿ç”¨JDBCæ¥è¿æ¥æ•°æ®åº“ï¼Œæ‰€ä»¥åªè¦JDBCæ”¯æŒçš„æ•°æ®åº“MyBatiséƒ½æ”¯æŒï¼‰ã€‚ ï¼ˆ4ï¼‰èƒ½å¤Ÿä¸Springå¾ˆå¥½çš„é›†æˆï¼› ï¼ˆ5ï¼‰æä¾›æ˜ å°„æ ‡ç­¾ï¼Œæ”¯æŒå¯¹è±¡ä¸æ•°æ®åº“çš„ORMå­—æ®µå…³ç³»æ˜ å°„ï¼›æä¾›å¯¹è±¡å…³ç³»æ˜ å°„æ ‡ç­¾ï¼Œæ”¯æŒå¯¹è±¡å…³ç³»ç»„ä»¶ç»´æŠ¤ã€‚ 3ã€MyBatisæ¡†æ¶çš„ç¼ºç‚¹ï¼š ï¼ˆ1ï¼‰SQLè¯­å¥çš„ç¼–å†™å·¥ä½œé‡è¾ƒå¤§ï¼Œå°¤å…¶å½“å­—æ®µå¤šã€å…³è”è¡¨å¤šæ—¶ï¼Œå¯¹å¼€å‘äººå‘˜ç¼–å†™SQLè¯­å¥çš„åŠŸåº•æœ‰ä¸€å®šè¦æ±‚ã€‚ ï¼ˆ2ï¼‰SQLè¯­å¥ä¾èµ–äºæ•°æ®åº“ï¼Œå¯¼è‡´æ•°æ®åº“ç§»æ¤æ€§å·®ï¼Œä¸èƒ½éšæ„æ›´æ¢æ•°æ®åº“ã€‚ 4ã€MyBatisæ¡†æ¶é€‚ç”¨åœºåˆï¼š ï¼ˆ1ï¼‰MyBatisä¸“æ³¨äºSQLæœ¬èº«ï¼Œæ˜¯ä¸€ä¸ªè¶³å¤Ÿçµæ´»çš„DAOå±‚è§£å†³æ–¹æ¡ˆã€‚ ï¼ˆ2ï¼‰å¯¹æ€§èƒ½çš„è¦æ±‚å¾ˆé«˜ï¼Œæˆ–è€…éœ€æ±‚å˜åŒ–è¾ƒå¤šçš„é¡¹ç›®ï¼Œå¦‚äº’è”ç½‘é¡¹ç›®ï¼ŒMyBatiså°†æ˜¯ä¸é”™çš„é€‰æ‹©ã€‚ 5ã€MyBatisä¸Hibernateæœ‰å“ªäº›ä¸åŒï¼Ÿ ï¼ˆ1ï¼‰Mybatiså’Œhibernateä¸åŒï¼Œå®ƒä¸å®Œå…¨æ˜¯ä¸€ä¸ªORMæ¡†æ¶ï¼Œå› ä¸ºMyBatiséœ€è¦ç¨‹åºå‘˜è‡ªå·±ç¼–å†™Sqlè¯­å¥ã€‚ ï¼ˆ2ï¼‰Mybatisç›´æ¥ç¼–å†™åŸç”Ÿæ€sqlï¼Œå¯ä»¥ä¸¥æ ¼æ§åˆ¶sqlæ‰§è¡Œæ€§èƒ½ï¼Œçµæ´»åº¦é«˜ï¼Œéå¸¸é€‚åˆå¯¹å…³ç³»æ•°æ®æ¨¡å‹è¦æ±‚ä¸é«˜çš„è½¯ä»¶å¼€å‘ï¼Œå› ä¸ºè¿™ç±»è½¯ä»¶éœ€æ±‚å˜åŒ–é¢‘ç¹ï¼Œä¸€ä½†éœ€æ±‚å˜åŒ–è¦æ±‚è¿…é€Ÿè¾“å‡ºæˆæœã€‚ä½†æ˜¯çµæ´»çš„å‰ææ˜¯mybatisæ— æ³•åšåˆ°æ•°æ®åº“æ— å…³æ€§ï¼Œå¦‚æœéœ€è¦å®ç°æ”¯æŒå¤šç§æ•°æ®åº“çš„è½¯ä»¶ï¼Œåˆ™éœ€è¦è‡ªå®šä¹‰å¤šå¥—sqlæ˜ å°„æ–‡ä»¶ï¼Œå·¥ä½œé‡å¤§ã€‚ ï¼ˆ3ï¼‰Hibernateå¯¹è±¡/å…³ç³»æ˜ å°„èƒ½åŠ›å¼ºï¼Œæ•°æ®åº“æ— å…³æ€§å¥½ï¼Œå¯¹äºå…³ç³»æ¨¡å‹è¦æ±‚é«˜çš„è½¯ä»¶ï¼Œå¦‚æœç”¨hibernateå¼€å‘å¯ä»¥èŠ‚çœå¾ˆå¤šä»£ç ï¼Œæé«˜æ•ˆç‡ã€‚ 6ã€#{}å’Œ${}çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ #{}æ˜¯é¢„ç¼–è¯‘å¤„ç†ï¼Œ${}æ˜¯å­—ç¬¦ä¸²æ›¿æ¢ã€‚ Mybatisåœ¨å¤„ç†#{}æ—¶ï¼Œä¼šå°†sqlä¸­çš„#{}æ›¿æ¢ä¸º?å·ï¼Œè°ƒç”¨PreparedStatementçš„setæ–¹æ³•æ¥èµ‹å€¼ï¼› #{} æ”¯æŒæ›´å¤šçš„æ•°æ®ç±»å‹çš„æ“ä½œ, jdbctype, javatype,â€¦ ç­‰ç­‰ Mybatisåœ¨å¤„ç†${}æ—¶ï¼Œå°±æ˜¯æŠŠ${}æ›¿æ¢æˆå˜é‡çš„å€¼ã€‚ ä½¿ç”¨#{}å¯ä»¥æœ‰æ•ˆçš„é˜²æ­¢SQLæ³¨å…¥ï¼Œæé«˜ç³»ç»Ÿå®‰å…¨æ€§ã€‚ 7ã€å½“å®ä½“ç±»ä¸­çš„å±æ€§åå’Œè¡¨ä¸­çš„å­—æ®µåä¸ä¸€æ · ï¼Œæ€ä¹ˆåŠ ï¼Ÿ ç¬¬1ç§ï¼š é€šè¿‡åœ¨æŸ¥è¯¢çš„sqlè¯­å¥ä¸­å®šä¹‰å­—æ®µåçš„åˆ«åï¼Œè®©å­—æ®µåçš„åˆ«åå’Œå®ä½“ç±»çš„å±æ€§åä¸€è‡´ã€‚ 123&lt;select id=â€selectorderâ€ parametertype=â€intâ€ resultetype=â€me.gacl.domain.orderâ€&gt; select order_id id, order_no orderno ,order_price price form orders where order_id=#&#123;id&#125;;&lt;/select&gt; ç¬¬2ç§ï¼š é€šè¿‡æ¥æ˜ å°„å­—æ®µåå’Œå®ä½“ç±»å±æ€§åçš„ä¸€ä¸€å¯¹åº”çš„å…³ç³»ã€‚ 123&lt;select id=\"getOrder\" parameterType=\"int\" resultMap=\"orderresultmap\"&gt; select * from orders where order_id=#&#123;id&#125; &lt;/select&gt; 1234567&lt;resultMap type=\"me.gacl.domain.order\" id=\"orderresultmap\"&gt; &lt;!â€“ç”¨idå±æ€§æ¥æ˜ å°„ä¸»é”®å­—æ®µâ€“&gt; &lt;id property=\"id\" column=\"order_id\"&gt; &lt;!â€“ç”¨resultå±æ€§æ¥æ˜ å°„éä¸»é”®å­—æ®µï¼Œpropertyä¸ºå®ä½“ç±»å±æ€§åï¼Œcolumnä¸ºæ•°æ®è¡¨ä¸­çš„å±æ€§â€“&gt; &lt;result property =\"orderno\" column =\"order_no\"/&gt; &lt;result property=\"price\" column=\"order_price\" /&gt;&lt;/reslutMap&gt; 8ã€ æ¨¡ç³ŠæŸ¥è¯¢likeè¯­å¥è¯¥æ€ä¹ˆå†™? ç¬¬1ç§ï¼šåœ¨Javaä»£ç ä¸­æ·»åŠ sqlé€šé…ç¬¦ã€‚ 12string wildcardname = â€œ%smi%â€;list&lt;name&gt; names = mapper.selectlike(wildcardname); 123&lt;select id=â€selectlikeâ€&gt; select * from foo where bar like #&#123;value&#125;&lt;/select&gt; ç¬¬2ç§ï¼šåœ¨sqlè¯­å¥ä¸­æ‹¼æ¥é€šé…ç¬¦ï¼Œä¼šå¼•èµ·sqlæ³¨å…¥ 12string wildcardname = â€œsmiâ€;list&lt;name&gt; names = mapper.selectlike(wildcardname); 123&lt;select id=â€selectlikeâ€&gt; select * from foo where bar like \"%\"#&#123;value&#125;\"%\"&lt;/select&gt; ç¬¬3ç§ 123456789&lt;select id=\"getEmpsTestInnerParameter\" resultType=\"Employee\"&gt; -- bind: å¯ä»¥å°†OGNLè¡¨è¾¾å¼çš„å€¼ç»‘å®šåˆ°ä¸€ä¸ªå˜é‡ä¸­ç»™,æ–¹ä¾¿åæ¥å¼•ç”¨è¿™ä¸ªå˜é‡çš„å€¼ &lt;bind name=\"likeE\" value=\"'%'+lastName'+'%'\"&gt;&lt;/bind&gt; select * from tbl_employee &lt;if test=\"_parameter!=null\"&gt; -- where id=#&#123;_parameter.id&#125; where lastName like #&#123;likeE&#125; &lt;/if&gt;&lt;/select&gt; 9ã€é€šå¸¸ä¸€ä¸ªXmlæ˜ å°„æ–‡ä»¶ï¼Œéƒ½ä¼šå†™ä¸€ä¸ªDaoæ¥å£ä¸ä¹‹å¯¹åº”ï¼Œè¯·é—®ï¼Œè¿™ä¸ªDaoæ¥å£çš„å·¥ä½œåŸç†æ˜¯ä»€ä¹ˆï¼ŸDaoæ¥å£é‡Œçš„æ–¹æ³•ï¼Œå‚æ•°ä¸åŒæ—¶ï¼Œæ–¹æ³•èƒ½é‡è½½å—ï¼Ÿ åŸç†: Mapper æ¥å£çš„å·¥ä½œåŸç†æ˜¯JDKåŠ¨æ€ä»£ç† ä¸èƒ½é‡è½½, ä½†æ˜¯å¯ä»¥æ ¹æ®æ ‡ç­¾ä¸ŠæŒ‡å®šçš„æ•°æ®åº“id, åŠ¨æ€å¾—æ‰§è¡Œsqlè¯­å¥çš„ç‰ˆæœ¬ Daoæ¥å£å³Mapperæ¥å£, æ¥å£çš„å…¨ç±»åï¼Œå°±æ˜¯æ˜ å°„æ–‡ä»¶ä¸­çš„namespaceçš„å€¼ï¼›æ¥å£çš„æ–¹æ³•åï¼Œå°±æ˜¯æ˜ å°„æ–‡ä»¶ä¸­Mapperçš„Statementçš„idå€¼ï¼›æ¥å£æ–¹æ³•å†…çš„å‚æ•°ï¼Œå°±æ˜¯ä¼ é€’ç»™sqlçš„å‚æ•°ã€‚ Mapperæ¥å£æ˜¯æ²¡æœ‰å®ç°ç±»çš„ï¼Œå½“è°ƒç”¨æ¥å£æ–¹æ³•æ—¶ï¼Œæ¥å£å…¨ç±»å+æ–¹æ³•åæ‹¼æ¥å­—ç¬¦ä¸²ä½œä¸ºkeyå€¼ï¼Œå¯å”¯ä¸€å®šä½ä¸€ä¸ªMapperStatementã€‚åœ¨Mybatisä¸­ï¼Œ==æ¯ä¸€ä¸ª&lt;select&gt;ã€&lt;insert&gt;ã€&lt;update&gt;ã€&lt;delete&gt;æ ‡ç­¾ï¼Œéƒ½ä¼šè¢«è§£æä¸ºä¸€ä¸ªMapperStatementå¯¹è±¡ã€‚== ä¸¾ä¾‹ï¼šcom.mybatis3.mappers.StudentDao.findStudentByIdï¼Œå¯ä»¥å”¯ä¸€æ‰¾åˆ°namespaceä¸ºcom.mybatis3.mappers.StudentDaoä¸‹é¢ id ä¸º findStudentById çš„ MapperStatementã€‚ Mapperæ¥å£é‡Œçš„æ–¹æ³•ï¼Œæ˜¯ä¸èƒ½é‡è½½çš„ï¼Œå› ä¸ºæ˜¯ä½¿ç”¨ å…¨ç±»å+æ–¹æ³•å çš„ä¿å­˜å’Œå¯»æ‰¾ç­–ç•¥ã€‚Mapper æ¥å£çš„å·¥ä½œåŸç†æ˜¯JDKåŠ¨æ€ä»£ç†ï¼ŒMybatisè¿è¡Œæ—¶ä¼šä½¿ç”¨JDKåŠ¨æ€ä»£ç†ä¸ºMapperæ¥å£ç”Ÿæˆä»£ç†å¯¹è±¡proxyï¼Œä»£ç†å¯¹è±¡ä¼šæ‹¦æˆªæ¥å£æ–¹æ³•ï¼Œè½¬è€Œæ‰§è¡ŒMapperStatementæ‰€ä»£è¡¨çš„sqlï¼Œç„¶åå°†sqlæ‰§è¡Œç»“æœè¿”å›ã€‚ 10ã€Mybatisæ˜¯å¦‚ä½•è¿›è¡Œåˆ†é¡µçš„ï¼Ÿåˆ†é¡µæ’ä»¶çš„åŸç†æ˜¯ä»€ä¹ˆï¼ŸMybatisä½¿ç”¨RowBoundså¯¹è±¡è¿›è¡Œåˆ†é¡µï¼Œå®ƒæ˜¯é’ˆå¯¹ResultSetç»“æœé›†æ‰§è¡Œçš„å†…å­˜åˆ†é¡µï¼Œè€Œéç‰©ç†åˆ†é¡µã€‚å¯ä»¥åœ¨sqlå†…ç›´æ¥ä¹¦å†™å¸¦æœ‰ç‰©ç†åˆ†é¡µçš„å‚æ•°æ¥å®Œæˆç‰©ç†åˆ†é¡µåŠŸèƒ½ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨åˆ†é¡µæ’ä»¶â€”-(com.github.pagehelper)æ¥å®Œæˆç‰©ç†åˆ†é¡µã€‚ åˆ†é¡µæ’ä»¶çš„åŸºæœ¬åŸç†æ˜¯ä½¿ç”¨Mybatisæä¾›çš„æ’ä»¶æ¥å£ï¼Œå®ç°è‡ªå®šä¹‰æ’ä»¶ï¼Œåœ¨æ’ä»¶çš„æ‹¦æˆªæ–¹æ³•å†…æ‹¦æˆªå¾…æ‰§è¡Œçš„sqlï¼Œç„¶åé‡å†™sqlï¼Œæ ¹æ®dialectæ–¹è¨€ï¼Œæ·»åŠ å¯¹åº”çš„ç‰©ç†åˆ†é¡µè¯­å¥å’Œç‰©ç†åˆ†é¡µå‚æ•°ã€‚ 11ã€Mybatisæ˜¯å¦‚ä½•å°†sqlæ‰§è¡Œç»“æœå°è£…ä¸ºç›®æ ‡å¯¹è±¡å¹¶è¿”å›çš„ï¼Ÿéƒ½æœ‰å“ªäº›æ˜ å°„å½¢å¼ï¼Ÿ ç¬¬ä¸€ç§æ˜¯ä½¿ç”¨æ ‡ç­¾ï¼Œé€ä¸€å®šä¹‰æ•°æ®åº“åˆ—åå’Œå¯¹è±¡å±æ€§åä¹‹é—´çš„æ˜ å°„å…³ç³»ã€‚ ç¬¬äºŒç§æ˜¯ä½¿ç”¨sqlåˆ—çš„åˆ«ååŠŸèƒ½ï¼Œå°†åˆ—çš„åˆ«åä¹¦å†™ä¸ºå¯¹è±¡å±æ€§åã€‚(è‡ªåŠ¨å°è£…) æœ‰äº†åˆ—åä¸å±æ€§åçš„æ˜ å°„å…³ç³»åï¼ŒMybatisé€šè¿‡åå°„åˆ›å»ºå¯¹è±¡ï¼ŒåŒæ—¶ä½¿ç”¨åå°„ç»™å¯¹è±¡çš„å±æ€§é€ä¸€èµ‹å€¼å¹¶è¿”å›ï¼Œé‚£äº›æ‰¾ä¸åˆ°æ˜ å°„å…³ç³»çš„å±æ€§ï¼Œæ˜¯æ— æ³•å®Œæˆèµ‹å€¼çš„ã€‚ 12ã€å¦‚ä½•æ‰§è¡Œæ‰¹é‡æ’å…¥? ç¬¬ä¸€ç§æ–¹æ³• é¦–å…ˆ,åˆ›å»ºä¸€ä¸ªç®€å•çš„insertè¯­å¥: 123&lt;insert id=â€insertnameâ€&gt; insert into names (name) values (#&#123;value&#125;)&lt;/insert&gt; ç„¶ååœ¨javaä»£ç ä¸­åƒä¸‹é¢è¿™æ ·æ‰§è¡Œæ‰¹å¤„ç†æ’å…¥: 12345list&lt;string&gt; names = new arraylist(); names.add(â€œfredâ€); names.add(â€œbarneyâ€); names.add(â€œbettyâ€); names.add(â€œwilmaâ€); 1234567891011121314151617// æ³¨æ„è¿™é‡Œ executortype.batchsqlsession sqlsession = sqlsessionfactory.opensession(executortype.batch);try &#123; namemapper mapper = sqlsession.getmapper(namemapper.class); //forå¾ªç¯æ‰§è¡Œæ’å…¥ for (string name : names) &#123; mapper.insertname(name); &#125; sqlsession.commit();&#125;catch(Exception e)&#123; e.printStackTrace(); sqlSession.rollback(); throw e; &#125; finally &#123; sqlsession.close();&#125; ç¬¬äºŒç§æ–¹æ³•: 123456789101112131415161718192021&lt;!-- æ‰¹é‡ä¿å­˜--&gt;&lt;!-- mysqlä¸‹æ‰¹é‡ä¿å­˜, å¯ä»¥foreachå®¾åˆ©, mysqlæ”¯æŒvalues(),(),()è¯­æ³•--&gt;&lt;insert id=\"addEmps\" databaseId=\"mysql\"&gt; insert into tbl_employee (lastName, gender, email, department) values &lt;foreach collection=\"emps\" item=\"emp\" separator=\",\"&gt; (#&#123;emp.lastName&#125;,#&#123;emp.gender&#125;,#&#123;emp.email&#125;,#&#123;emp.department.id&#125;) &lt;/foreach&gt;&lt;/insert&gt;&lt;!-- æ‰¹é‡ä¿å­˜ä¸€æ¬¡æ‰§è¡Œå¤šä¸ªsqlè¯­å¥éœ€è¦åœ¨urlè¿æ¥å¤„æ·»åŠ allowMultiQueries=true--&gt;&lt;insert id=\"addEmps2\" databaseId=\"oracle\"&gt; &lt;foreach collection=\"emps\" item=\"emp\" separator=\";\"&gt; insert into tbl_employee (lastName, gender, email, department) values (#&#123;emp.lastName&#125;,#&#123;emp.gender&#125;,#&#123;emp.email&#125;,#&#123;emp.department.id&#125;) &lt;/foreach&gt;&lt;/insert&gt; 13ã€å¦‚ä½•è·å–è‡ªåŠ¨ç”Ÿæˆçš„(ä¸»)é”®å€¼?insert æ–¹æ³•æ€»æ˜¯è¿”å›ä¸€ä¸ªintå€¼ ï¼Œè¿™ä¸ªå€¼ä»£è¡¨çš„æ˜¯æ’å…¥çš„è¡Œæ•°ã€‚ å¦‚æœé‡‡ç”¨è‡ªå¢é•¿ç­–ç•¥ï¼Œè‡ªåŠ¨ç”Ÿæˆçš„é”®å€¼åœ¨ insert æ–¹æ³•æ‰§è¡Œå®Œåå¯ä»¥è¢«è®¾ç½®åˆ°ä¼ å…¥çš„å‚æ•°å¯¹è±¡ä¸­ã€‚ ç¤ºä¾‹ï¼š 12345&lt;!-- useGeneratedKeys=\"true\": ä½¿ç”¨è‡ªå¢çš„é”®å€¼,ä¼šè¿”å›æ¯æ¬¡ç”Ÿæˆçš„å€¼ keyProperty=\"id\" å°†è‡ªå¢çš„ä¸»é”®å€¼èµ‹ç»™å¯¹è±¡çš„id(è‡ªå®šä¹‰)å±æ€§ --&gt;&lt;insert id=\"insertname\" usegeneratedkeys=\"true\" keyproperty=\"id\"&gt; insert into names (name) values (#&#123;name&#125;)&lt;/insert&gt; name name = new name(); name.setname(â€œfredâ€); int rows = mapper.insertname(name); // å®Œæˆå,idå·²ç»è¢«è®¾ç½®åˆ°å¯¹è±¡ä¸­ system.out.println(â€œrows inserted = â€ + rows); system.out.println(â€œgenerated key value = â€ + name.getid());14ã€åœ¨mapperä¸­å¦‚ä½•ä¼ é€’å¤šä¸ªå‚æ•°? ï¼ˆ1ï¼‰ç¬¬ä¸€ç§ï¼š 123//DAOå±‚çš„å‡½æ•°Public UserselectUser(String name,String area); //å¯¹åº”çš„xml,#&#123;0&#125;ä»£è¡¨æ¥æ”¶çš„æ˜¯daoå±‚ä¸­çš„ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œ#&#123;1&#125;ä»£è¡¨daoå±‚ä¸­ç¬¬äºŒå‚æ•°ï¼Œæ›´å¤šå‚æ•°ä¸€è‡´å¾€ååŠ å³å¯ã€‚ 123&lt;select id=\"selectUser\"resultMap=\"BaseResultMap\"&gt; select * fromuser_user_t whereuser_name = #&#123;0&#125; anduser_area=#&#123;1&#125; &lt;/select&gt; ï¼ˆ2ï¼‰ç¬¬äºŒç§ï¼š ä½¿ç”¨ @param æ³¨è§£: 123public interface usermapper &#123; user selectuser(@param(â€œusernameâ€) string username,@param(â€œhashedpasswordâ€) string hashedpassword);&#125; ç„¶å,å°±å¯ä»¥åœ¨xmlåƒä¸‹é¢è¿™æ ·ä½¿ç”¨(æ¨èå°è£…ä¸ºä¸€ä¸ªmap,ä½œä¸ºå•ä¸ªå‚æ•°ä¼ é€’ç»™mapper): 123456&lt;select id=â€selectuserâ€ resulttype=â€userâ€&gt; select id, username, hashedpassword from some_table where username = #&#123;username&#125; and hashedpassword = #&#123;hashedpassword&#125;&lt;/select&gt; ï¼ˆ3ï¼‰ç¬¬ä¸‰ç§ï¼šå¤šä¸ªå‚æ•°å°è£…æˆmap 1234567891011121314try&#123;//æ˜ å°„æ–‡ä»¶çš„å‘½åç©ºé—´.SQLç‰‡æ®µçš„IDï¼Œå°±å¯ä»¥è°ƒç”¨å¯¹åº”çš„æ˜ å°„æ–‡ä»¶ä¸­çš„SQL//ç”±äºæˆ‘ä»¬çš„å‚æ•°è¶…è¿‡äº†ä¸¤ä¸ªï¼Œè€Œæ–¹æ³•ä¸­åªæœ‰ä¸€ä¸ªObjectå‚æ•°æ”¶é›†ï¼Œå› æ­¤æˆ‘ä»¬ä½¿ç”¨Mapé›†åˆæ¥è£…è½½æˆ‘ä»¬çš„å‚æ•°Map&lt;String, Object&gt; map = new HashMap(); map.put(\"start\", start); map.put(\"end\", end); return sqlSession.selectList(\"StudentID.pagination\", map); &#125;catch(Exception e)&#123; e.printStackTrace(); sqlSession.rollback(); throw e; &#125;finally&#123; MybatisUtil.closeSqlSession(); &#125; 15ã€MybatisåŠ¨æ€sqlæœ‰ä»€ä¹ˆç”¨ï¼Ÿæ‰§è¡ŒåŸç†ï¼Ÿæœ‰å“ªäº›åŠ¨æ€sqlï¼ŸMybatisåŠ¨æ€sqlå¯ä»¥åœ¨Xmlæ˜ å°„æ–‡ä»¶å†…ï¼Œä»¥æ ‡ç­¾çš„å½¢å¼ç¼–å†™åŠ¨æ€sqlï¼Œæ‰§è¡ŒåŸç†æ˜¯æ ¹æ®è¡¨è¾¾å¼çš„å€¼ å®Œæˆé€»è¾‘åˆ¤æ–­å¹¶åŠ¨æ€æ‹¼æ¥sqlçš„åŠŸèƒ½ã€‚ç±»ä¼¼äºOGNLè¡¨è¾¾å¼ Mybatisæä¾›äº†9ç§åŠ¨æ€sqlæ ‡ç­¾ï¼štrim | where | set | foreach | if | choose | when | otherwise | bindã€‚ 16ã€Xmlæ˜ å°„æ–‡ä»¶ä¸­ï¼Œé™¤äº†å¸¸è§çš„select|insert|updae|deleteæ ‡ç­¾ä¹‹å¤–ï¼Œè¿˜æœ‰å“ªäº›æ ‡ç­¾ï¼Ÿç­”ï¼šã€ã€ã€ã€ï¼ŒåŠ ä¸ŠåŠ¨æ€sqlçš„9ä¸ªæ ‡ç­¾ï¼Œå…¶ä¸­ä¸ºsqlç‰‡æ®µæ ‡ç­¾, å¯é‡ç”¨ï¼Œé€šè¿‡æ ‡ç­¾å¼•å…¥sqlç‰‡æ®µï¼Œä¸ºä¸æ”¯æŒè‡ªå¢çš„ä¸»é”®ç”Ÿæˆç­–ç•¥æ ‡ç­¾ã€‚ 17ã€Mybatisçš„Xmlæ˜ å°„æ–‡ä»¶ä¸­ï¼Œä¸åŒçš„Xmlæ˜ å°„æ–‡ä»¶ï¼Œidæ˜¯å¦å¯ä»¥é‡å¤ï¼Ÿä¸åŒçš„Xmlæ˜ å°„æ–‡ä»¶ï¼Œå¦‚æœé…ç½®äº†namespaceï¼Œé‚£ä¹ˆidå¯ä»¥é‡å¤ï¼›å¦‚æœæ²¡æœ‰é…ç½®namespaceï¼Œé‚£ä¹ˆidä¸èƒ½é‡å¤ï¼› åŸå› å°±æ˜¯namespace+idæ˜¯ä½œä¸ºMap&lt;String, MapperStatement&gt;çš„keyä½¿ç”¨çš„ï¼Œå¦‚æœæ²¡æœ‰namespaceï¼Œå°±å‰©ä¸‹idï¼Œé‚£ä¹ˆï¼Œidé‡å¤ä¼šå¯¼è‡´æ•°æ®äº’ç›¸è¦†ç›–ã€‚æœ‰äº†namespaceï¼Œè‡ªç„¶idå°±å¯ä»¥é‡å¤ï¼Œnamespaceä¸åŒï¼Œnamespace+idè‡ªç„¶ä¹Ÿå°±ä¸åŒã€‚ 18ã€ä¸ºä»€ä¹ˆè¯´Mybatisæ˜¯åŠè‡ªåŠ¨ORMæ˜ å°„å·¥å…·ï¼Ÿå®ƒä¸å…¨è‡ªåŠ¨çš„åŒºåˆ«åœ¨å“ªé‡Œï¼ŸHibernateå±äºå…¨è‡ªåŠ¨ORMæ˜ å°„å·¥å…·ï¼Œä½¿ç”¨HibernateæŸ¥è¯¢å…³è”å¯¹è±¡æˆ–è€…å…³è”é›†åˆå¯¹è±¡æ—¶ï¼Œå¯ä»¥æ ¹æ®å¯¹è±¡å…³ç³»æ¨¡å‹ç›´æ¥è·å–ï¼Œæ‰€ä»¥å®ƒæ˜¯å…¨è‡ªåŠ¨çš„ã€‚è€ŒMybatisåœ¨æŸ¥è¯¢å…³è”å¯¹è±¡æˆ–å…³è”é›†åˆå¯¹è±¡æ—¶ï¼Œéœ€è¦æ‰‹åŠ¨ç¼–å†™sqlæ¥å®Œæˆï¼Œæ‰€ä»¥ï¼Œç§°ä¹‹ä¸ºåŠè‡ªåŠ¨ORMæ˜ å°„å·¥å…·ã€‚ 19ã€ ä¸€å¯¹ä¸€ã€ä¸€å¯¹å¤šçš„å…³è”æŸ¥è¯¢ ï¼Ÿ ä¸€å¯¹ä¸€ 123456789101112131415&lt;mapper namespace=\"com.lcb.mapping.userMapper\"&gt; &lt;select id=\"getClass\" parameterType=\"int\" resultMap=\"ClassesResultMap\"&gt; select * from class c,teacher t where c.teacher_id=t.t_id and c.c_id=#&#123;id&#125; &lt;/select&gt; &lt;!--association ä¸€å¯¹ä¸€å…³è”æŸ¥è¯¢ --&gt; &lt;resultMap type=\"com.lcb.user.Classes\" id=\"ClassesResultMap\"&gt; &lt;!-- å®ä½“ç±»çš„å­—æ®µåå’Œæ•°æ®è¡¨çš„å­—æ®µåæ˜ å°„ --&gt; &lt;id property=\"id\" column=\"c_id\"/&gt; &lt;result property=\"name\" column=\"c_name\"/&gt; &lt;association property=\"teacher\" javaType=\"com.lcb.user.Teacher\"&gt; &lt;id property=\"id\" column=\"t_id\"/&gt; &lt;result property=\"name\" column=\"t_name\"/&gt; &lt;/association&gt; &lt;/resultMap&gt; &lt;/mapper&gt; ä¸€å¯¹å¤šçš„å…³è”æŸ¥è¯¢ 12345678910111213141516171819&lt;mapper namespace=\"com.lcb.mapping.userMapper\"&gt; &lt;!--collection ä¸€å¯¹å¤šå…³è”æŸ¥è¯¢ --&gt; &lt;select id=\"getClass2\" parameterType=\"int\" resultMap=\"ClassesResultMap2\"&gt; select * from class c,teacher t,student s where c.teacher_id=t.t_id and c.c_id=s.class_id and c.c_id=#&#123;id&#125; &lt;/select&gt; &lt;resultMap type=\"com.lcb.user.Classes\" id=\"ClassesResultMap2\"&gt; &lt;id property=\"id\" column=\"c_id\"/&gt; &lt;result property=\"name\" column=\"c_name\"/&gt; &lt;association property=\"teacher\" javaType=\"com.lcb.user.Teacher\"&gt; &lt;id property=\"id\" column=\"t_id\"/&gt; &lt;result property=\"name\" column=\"t_name\"/&gt; &lt;/association&gt; &lt;collection property=\"student\" ofType=\"com.lcb.user.Student\"&gt; &lt;id property=\"id\" column=\"s_id\"/&gt; &lt;result property=\"name\" column=\"s_name\"/&gt; &lt;/collection&gt; &lt;/resultMap&gt; &lt;/mapper&gt; 20ã€MyBatiså®ç°ä¸€å¯¹ä¸€æœ‰å‡ ç§æ–¹å¼?å…·ä½“æ€ä¹ˆæ“ä½œçš„ï¼Ÿ æœ‰è”åˆæŸ¥è¯¢ è”åˆæŸ¥è¯¢æ˜¯å‡ ä¸ªè¡¨è”åˆæŸ¥è¯¢,åªæŸ¥è¯¢ä¸€æ¬¡, é€šè¿‡åœ¨resultMapé‡Œé¢é…ç½®associationèŠ‚ç‚¹é…ç½®ä¸€å¯¹ä¸€çš„ç±»å°±å¯ä»¥å®Œæˆï¼› å’ŒåµŒå¥—æŸ¥è¯¢ åµŒå¥—æŸ¥è¯¢æ˜¯å…ˆæŸ¥ä¸€ä¸ªè¡¨ï¼Œæ ¹æ®è¿™ä¸ªè¡¨é‡Œé¢çš„ç»“æœçš„ å¤–é”®idï¼Œå»å†å¦å¤–ä¸€ä¸ªè¡¨é‡Œé¢æŸ¥è¯¢æ•°æ®,ä¹Ÿæ˜¯é€šè¿‡associationé…ç½®ï¼Œä½†å¦å¤–ä¸€ä¸ªè¡¨çš„æŸ¥è¯¢é€šè¿‡selectå±æ€§é…ç½®ã€‚ 12345678910&lt;resultMap id=\"EmpAndDept3\" type=\"emp\"&gt; &lt;id column=\"id\" property=\"id\"&gt;&lt;/id&gt; &lt;result column=\"lastName\" property=\"lastName\"&gt;&lt;/result&gt; &lt;result column=\"email\" property=\"email\"&gt;&lt;/result&gt; &lt;result column=\"gender\" property=\"gender\"&gt;&lt;/result&gt; &lt;!-- æŒ‡å®šå“ªä¸ªå±æ€§æ˜¯è”åˆå¯¹è±¡--&gt; &lt;association property=\"department\" select=\"com.yeung.mapper.annotation.DepartmentMapperAnnotation.getDeptById\" column=\"department\"&gt; &lt;/association&gt;&lt;/resultMap&gt; 21ã€MyBatiså®ç°ä¸€å¯¹å¤šæœ‰å‡ ç§æ–¹å¼,æ€ä¹ˆæ“ä½œçš„ï¼Ÿ æœ‰è”åˆæŸ¥è¯¢ è”åˆæŸ¥è¯¢æ˜¯å‡ ä¸ªè¡¨è”åˆæŸ¥è¯¢,åªæŸ¥è¯¢ä¸€æ¬¡,é€šè¿‡åœ¨resultMapé‡Œé¢çš„collectionèŠ‚ç‚¹é…ç½®ä¸€å¯¹å¤šçš„ç±»å°±å¯ä»¥å®Œæˆï¼› åµŒå¥—æŸ¥è¯¢ åµŒå¥—æŸ¥è¯¢æ˜¯å…ˆæŸ¥ä¸€ä¸ªè¡¨,æ ¹æ®è¿™ä¸ªè¡¨é‡Œé¢çš„ ç»“æœçš„å¤–é”®id,å»å†å¦å¤–ä¸€ä¸ªè¡¨é‡Œé¢æŸ¥è¯¢æ•°æ®,ä¹Ÿæ˜¯é€šè¿‡é…ç½®collection,ä½†å¦å¤–ä¸€ä¸ªè¡¨çš„æŸ¥è¯¢é€šè¿‡selectèŠ‚ç‚¹é…ç½®ã€‚ 22ã€Mybatisæ˜¯å¦æ”¯æŒå»¶è¿ŸåŠ è½½ï¼Ÿå¦‚æœæ”¯æŒï¼Œå®ƒçš„å®ç°åŸç†æ˜¯ä»€ä¹ˆï¼Ÿç­”ï¼šMybatisä»…æ”¯æŒassociationå…³è”å¯¹è±¡å’Œcollectionå…³è”é›†åˆå¯¹è±¡çš„å»¶è¿ŸåŠ è½½ associationæŒ‡çš„å°±æ˜¯ä¸€å¯¹ä¸€ collectionæŒ‡çš„å°±æ˜¯ä¸€å¯¹å¤šæŸ¥è¯¢ åœ¨Mybatisé…ç½®æ–‡ä»¶ä¸­ï¼Œå¯ä»¥é…ç½®æ˜¯å¦å¯ç”¨å»¶è¿ŸåŠ è½½lazyLoadingEnabled=true|falseã€‚ å®ƒçš„åŸç†æ˜¯ï¼Œä½¿ç”¨CGLIBåˆ›å»ºç›®æ ‡å¯¹è±¡çš„ä»£ç†å¯¹è±¡ï¼Œå½“è°ƒç”¨ç›®æ ‡æ–¹æ³•æ—¶ï¼Œè¿›å…¥æ‹¦æˆªå™¨æ–¹æ³•ï¼Œæ¯”å¦‚è°ƒç”¨a.getB().getName()ï¼Œæ‹¦æˆªå™¨invoke()æ–¹æ³•å‘ç°a.getB()æ˜¯nullå€¼ï¼Œé‚£ä¹ˆå°±ä¼šå•ç‹¬å‘é€äº‹å…ˆä¿å­˜å¥½çš„æŸ¥è¯¢å…³è”Bå¯¹è±¡çš„sqlï¼ŒæŠŠBæŸ¥è¯¢ä¸Šæ¥ï¼Œç„¶åè°ƒç”¨a.setB(b)ï¼Œäºæ˜¯açš„å¯¹è±¡bå±æ€§å°±æœ‰å€¼äº†ï¼Œæ¥ç€å®Œæˆa.getB().getName()æ–¹æ³•çš„è°ƒç”¨ã€‚è¿™å°±æ˜¯å»¶è¿ŸåŠ è½½çš„åŸºæœ¬åŸç†ã€‚ å½“ç„¶äº†ï¼Œä¸å…‰æ˜¯Mybatisï¼Œå‡ ä¹æ‰€æœ‰çš„åŒ…æ‹¬Hibernateï¼Œæ”¯æŒå»¶è¿ŸåŠ è½½çš„åŸç†éƒ½æ˜¯ä¸€æ ·çš„ã€‚ 23ã€Mybatisçš„ä¸€çº§ã€äºŒçº§ç¼“å­˜: 1ï¼‰ä¸€çº§ç¼“å­˜: åŸºäº PerpetualCache çš„ HashMap æœ¬åœ°ç¼“å­˜ï¼Œå…¶å­˜å‚¨ä½œç”¨åŸŸä¸º Sessionï¼Œå½“ Session flush æˆ– close ä¹‹åï¼Œè¯¥ Session ä¸­çš„æ‰€æœ‰ Cache å°±å°†æ¸…ç©ºï¼Œé»˜è®¤æ‰“å¼€ä¸€çº§ç¼“å­˜ã€‚ 2ï¼‰äºŒçº§ç¼“å­˜ä¸ä¸€çº§ç¼“å­˜å…¶æœºåˆ¶ç›¸åŒï¼Œé»˜è®¤ä¹Ÿæ˜¯é‡‡ç”¨ PerpetualCacheï¼ŒHashMap å­˜å‚¨ï¼Œä¸åŒåœ¨äºå…¶å­˜å‚¨ä½œç”¨åŸŸä¸º Mapper(Namespace)ï¼Œå¹¶ä¸”å¯è‡ªå®šä¹‰å­˜å‚¨æºï¼Œå¦‚ Ehcacheã€‚é»˜è®¤ä¸æ‰“å¼€äºŒçº§ç¼“å­˜ï¼Œè¦å¼€å¯äºŒçº§ç¼“å­˜ï¼Œä½¿ç”¨äºŒçº§ç¼“å­˜å±æ€§ç±»éœ€è¦å®ç°Serializableåºåˆ—åŒ–æ¥å£(å¯ç”¨æ¥ä¿å­˜å¯¹è±¡çš„çŠ¶æ€),å¯åœ¨å®ƒçš„æ˜ å°„æ–‡ä»¶ä¸­é…ç½® ï¼› 3ï¼‰å¯¹äºç¼“å­˜æ•°æ®æ›´æ–°æœºåˆ¶ï¼Œå½“æŸä¸€ä¸ªä½œç”¨åŸŸ(ä¸€çº§ç¼“å­˜ Session/äºŒçº§ç¼“å­˜Namespaces)çš„è¿›è¡Œäº†C/U/D æ“ä½œåï¼Œé»˜è®¤è¯¥ä½œç”¨åŸŸä¸‹æ‰€æœ‰ select ä¸­çš„ç¼“å­˜å°†è¢« clearã€‚==(å³, æ‰§è¡Œäº† å¢åˆ æ”¹æ“ä½œ, é‚£ä¹ˆå°±ä¼šæ¸…ç©ºæ‰ç¼“å­˜ä¸­çš„è¯¥æ•°æ®, ä¿è¯æ•°æ®å¼æœ€æ–°çš„)== 24ã€ä»€ä¹ˆæ˜¯MyBatisçš„æ¥å£ç»‘å®šï¼Ÿæœ‰å“ªäº›å®ç°æ–¹å¼ï¼Ÿæ¥å£ç»‘å®šï¼Œå°±æ˜¯åœ¨MyBatisä¸­ä»»æ„å®šä¹‰æ¥å£,ç„¶åæŠŠæ¥å£é‡Œé¢çš„æ–¹æ³•å’ŒSQLè¯­å¥ç»‘å®š, æˆ‘ä»¬ç›´æ¥è°ƒç”¨æ¥å£æ–¹æ³•å°±å¯ä»¥,è¿™æ ·æ¯”èµ·åŸæ¥äº†SqlSessionæä¾›çš„æ–¹æ³•æˆ‘ä»¬å¯ä»¥æœ‰æ›´åŠ çµæ´»çš„é€‰æ‹©å’Œè®¾ç½®ã€‚ æ¥å£ç»‘å®šæœ‰ä¸¤ç§å®ç°æ–¹å¼,ä¸€ç§æ˜¯é€šè¿‡æ³¨è§£ç»‘å®šï¼Œå°±æ˜¯åœ¨æ¥å£çš„æ–¹æ³•ä¸Šé¢åŠ ä¸Š @Selectã€@Updateç­‰æ³¨è§£ï¼Œé‡Œé¢åŒ…å«Sqlè¯­å¥æ¥ç»‘å®šï¼›å¦å¤–ä¸€ç§å°±æ˜¯é€šè¿‡xmlé‡Œé¢å†™SQLæ¥ç»‘å®š, åœ¨è¿™ç§æƒ…å†µä¸‹,è¦æŒ‡å®šxmlæ˜ å°„æ–‡ä»¶é‡Œé¢çš„namespaceå¿…é¡»ä¸ºæ¥å£çš„å…¨è·¯å¾„åã€‚å½“Sqlè¯­å¥æ¯”è¾ƒç®€å•æ—¶å€™,ç”¨æ³¨è§£ç»‘å®š, å½“SQLè¯­å¥æ¯”è¾ƒå¤æ‚æ—¶å€™,ç”¨xmlç»‘å®š,ä¸€èˆ¬ç”¨xmlç»‘å®šçš„æ¯”è¾ƒå¤šã€‚ 25ã€ä½¿ç”¨MyBatisçš„mapperæ¥å£è°ƒç”¨æ—¶æœ‰å“ªäº›è¦æ±‚ï¼Ÿ â‘  Mapperæ¥å£æ–¹æ³•åå’Œmapper.xmlä¸­å®šä¹‰çš„æ¯ä¸ªsqlçš„idç›¸åŒï¼›â‘¡ Mapperæ¥å£æ–¹æ³•çš„è¾“å…¥å‚æ•°ç±»å‹å’Œmapper.xmlä¸­å®šä¹‰çš„æ¯ä¸ªsql çš„parameterTypeçš„ç±»å‹ç›¸åŒï¼›â‘¢ Mapperæ¥å£æ–¹æ³•çš„è¾“å‡ºå‚æ•°ç±»å‹å’Œmapper.xmlä¸­å®šä¹‰çš„æ¯ä¸ªsqlçš„resultTypeçš„ç±»å‹ç›¸åŒï¼›â‘£ Mapper.xmlæ–‡ä»¶ä¸­çš„namespaceå³æ˜¯mapperæ¥å£çš„ç±»è·¯å¾„ã€‚ 26ã€Mapperç¼–å†™æœ‰å“ªå‡ ç§æ–¹å¼ï¼Ÿ ç¬¬ä¸€ç§ï¼šæ¥å£å®ç°ç±»ç»§æ‰¿SqlSessionDaoSupportï¼šä½¿ç”¨æ­¤ç§æ–¹æ³•éœ€è¦ç¼–å†™mapperæ¥å£ï¼Œmapperæ¥å£å®ç°ç±»ã€mapper.xmlæ–‡ä»¶ã€‚ ï¼ˆ1ï¼‰åœ¨sqlMapConfig.xmlä¸­é…ç½®mapper.xmlçš„ä½ç½® 1234&lt;mappers&gt; &lt;mapper resource=\"mapper.xmlæ–‡ä»¶çš„åœ°å€\" /&gt; &lt;mapper resource=\"mapper.xmlæ–‡ä»¶çš„åœ°å€\" /&gt;&lt;/mappers&gt; ï¼ˆ2ï¼‰å®šä¹‰mapperæ¥å£ ï¼ˆ3ï¼‰å®ç°ç±»é›†æˆSqlSessionDaoSupport mapperæ–¹æ³•ä¸­å¯ä»¥this.getSqlSession()è¿›è¡Œæ•°æ®å¢åˆ æ”¹æŸ¥ã€‚ ï¼ˆ4ï¼‰spring é…ç½® 123&lt;bean id=\" \" class=\"mapperæ¥å£çš„å®ç°\"&gt; &lt;property name=\"sqlSessionFactory\" ref=\"sqlSessionFactory\"&gt;&lt;/property&gt;&lt;/bean&gt; ç¬¬äºŒç§ï¼šä½¿ç”¨org.mybatis.spring.mapper.MapperFactoryBeanï¼š ï¼ˆ1ï¼‰åœ¨sqlMapConfig.xmlä¸­é…ç½®mapper.xmlçš„ä½ç½®ï¼Œå¦‚æœmapper.xmlå’Œmappreæ¥å£çš„åç§°ç›¸åŒä¸”åœ¨åŒä¸€ä¸ªç›®å½•ï¼Œè¿™é‡Œå¯ä»¥ä¸ç”¨é…ç½® 1234&lt;mappers&gt; &lt;mapper resource=\"mapper.xmlæ–‡ä»¶çš„åœ°å€\" /&gt; &lt;mapper resource=\"mapper.xmlæ–‡ä»¶çš„åœ°å€\" /&gt;&lt;/mappers&gt; ï¼ˆ2ï¼‰å®šä¹‰mapperæ¥å£ï¼š â‘ mapper.xmlä¸­çš„namespaceä¸ºmapperæ¥å£çš„åœ°å€ â‘¡mapperæ¥å£ä¸­çš„æ–¹æ³•åå’Œmapper.xmlä¸­çš„å®šä¹‰çš„statementçš„idä¿æŒä¸€è‡´ â‘¢Springä¸­å®šä¹‰ 1234&lt;bean id=\"\" class=\"org.mybatis.spring.mapper.MapperFactoryBean\"&gt; &lt;property name=\"mapperInterface\" value=\"mapperæ¥å£åœ°å€\" /&gt; &lt;property name=\"sqlSessionFactory\" ref=\"sqlSessionFactory\" /&gt; &lt;/bean&gt; ç¬¬ä¸‰ç§ï¼šä½¿ç”¨mapperæ‰«æå™¨ï¼š ï¼ˆ1ï¼‰mapper.xmlæ–‡ä»¶ç¼–å†™ï¼š mapper.xmlä¸­çš„namespaceä¸ºmapperæ¥å£çš„åœ°å€ï¼›mapperæ¥å£ä¸­çš„æ–¹æ³•åå’Œmapper.xmlä¸­çš„å®šä¹‰çš„statementçš„idä¿æŒä¸€è‡´ï¼›å¦‚æœå°†mapper.xmlå’Œmapperæ¥å£çš„åç§°ä¿æŒä¸€è‡´åˆ™ä¸ç”¨åœ¨sqlMapConfig.xmlä¸­è¿›è¡Œé…ç½®ã€‚ ï¼ˆ2ï¼‰å®šä¹‰mapperæ¥å£ï¼šæ³¨æ„mapper.xmlçš„æ–‡ä»¶åå’Œmapperçš„æ¥å£åç§°ä¿æŒä¸€è‡´ï¼Œä¸”æ”¾åœ¨åŒä¸€ä¸ªç›®å½• ï¼ˆ3ï¼‰é…ç½®mapperæ‰«æå™¨ï¼š 1234&lt;bean class=\"org.mybatis.spring.mapper.MapperScannerConfigurer\"&gt; &lt;property name=\"basePackage\" value=\"mapperæ¥å£åŒ…åœ°å€\"&gt;&lt;/property&gt; &lt;property name=\"sqlSessionFactoryBeanName\" value=\"sqlSessionFactory\"/&gt; &lt;/bean&gt; ï¼ˆ4ï¼‰ä½¿ç”¨æ‰«æå™¨åä»springå®¹å™¨ä¸­è·å–mapperçš„å®ç°å¯¹è±¡ã€‚ 27ã€ç®€è¿°Mybatisçš„æ’ä»¶è¿è¡ŒåŸç†ï¼Œä»¥åŠå¦‚ä½•ç¼–å†™ä¸€ä¸ªæ’ä»¶ã€‚ ParameterHandlerã€ ResultSetHandlerã€ StatementHandlerã€ Executor ç­”ï¼šMybatisä»…å¯ä»¥ç¼–å†™é’ˆå¯¹è¿™4ç§æ¥å£çš„æ’ä»¶ï¼ŒMybatisä½¿ç”¨JDKçš„åŠ¨æ€ä»£ç†ï¼Œä¸ºéœ€è¦æ‹¦æˆªçš„æ¥å£ç”Ÿæˆä»£ç†å¯¹è±¡ä»¥å®ç°æ¥å£æ–¹æ³•æ‹¦æˆªåŠŸèƒ½ï¼Œæ¯å½“æ‰§è¡Œè¿™4ç§æ¥å£å¯¹è±¡çš„æ–¹æ³•æ—¶ï¼Œå°±ä¼šè¿›å…¥æ‹¦æˆªæ–¹æ³•ï¼Œå…·ä½“å°±æ˜¯InvocationHandlerçš„invoke()æ–¹æ³•ï¼Œå½“ç„¶ï¼Œåªä¼šæ‹¦æˆªé‚£äº›ä½ æŒ‡å®šéœ€è¦æ‹¦æˆªçš„æ–¹æ³•ã€‚ 123456/** * æ’ä»¶çš„ç¼–å†™æ–¹æ³•: * 1. ç¼–å†™Interceptorçš„å®ç°ç±» * 2. ä½¿ç”¨@Interceptsæ³¨è§£å®Œæˆæ’ä»¶çš„ç­¾å * 3. å°†å†™å¥½çš„æ’ä»¶æ³¨å†Œåˆ°å…¨å±€é…ç½®æ–‡ä»¶ä¸­ */ 28ã€SSMä¼˜ç¼ºç‚¹ã€ä½¿ç”¨åœºæ™¯ï¼Ÿ Mybatiså’Œhibernateä¸åŒï¼Œå®ƒä¸å®Œå…¨æ˜¯ä¸€ä¸ªORMæ¡†æ¶ï¼Œå› ä¸ºMyBatiséœ€è¦ç¨‹åºå‘˜è‡ªå·±ç¼–å†™Sqlè¯­å¥ï¼Œä¸è¿‡mybatiså¯ä»¥é€šè¿‡XMLæˆ–æ³¨è§£æ–¹å¼çµæ´»é…ç½®è¦è¿è¡Œçš„sqlè¯­å¥ï¼Œå¹¶å°†javaå¯¹è±¡å’Œsqlè¯­å¥æ˜ å°„ç”Ÿæˆæœ€ç»ˆæ‰§è¡Œçš„sqlï¼Œæœ€åå°†sqlæ‰§è¡Œçš„ç»“æœå†æ˜ å°„ç”Ÿæˆjavaå¯¹è±¡ã€‚ Mybatiså­¦ä¹ é—¨æ§›ä½ï¼Œç®€å•æ˜“å­¦ï¼Œç¨‹åºå‘˜ç›´æ¥ç¼–å†™åŸç”Ÿæ€sqlï¼Œå¯ä¸¥æ ¼æ§åˆ¶sqlæ‰§è¡Œæ€§èƒ½ï¼Œçµæ´»åº¦é«˜ï¼Œéå¸¸é€‚åˆå¯¹å…³ç³»æ•°æ®æ¨¡å‹è¦æ±‚ä¸é«˜çš„è½¯ä»¶å¼€å‘ï¼Œä¾‹å¦‚äº’è”ç½‘è½¯ä»¶ã€ä¼ä¸šè¿è¥ç±»è½¯ä»¶ç­‰ï¼Œå› ä¸ºè¿™ç±»è½¯ä»¶éœ€æ±‚å˜åŒ–é¢‘ç¹ï¼Œä¸€ä½†éœ€æ±‚å˜åŒ–è¦æ±‚æˆæœè¾“å‡ºè¿…é€Ÿã€‚ä½†æ˜¯çµæ´»çš„å‰ææ˜¯mybatisæ— æ³•åšåˆ°æ•°æ®åº“æ— å…³æ€§ï¼Œå¦‚æœéœ€è¦å®ç°æ”¯æŒå¤šç§æ•°æ®åº“çš„è½¯ä»¶åˆ™éœ€è¦è‡ªå®šä¹‰å¤šå¥—sqlæ˜ å°„æ–‡ä»¶ï¼Œå·¥ä½œé‡å¤§ã€‚ Hibernateå¯¹è±¡/å…³ç³»æ˜ å°„èƒ½åŠ›å¼ºï¼Œæ•°æ®åº“æ— å…³æ€§å¥½ï¼Œå¯¹äºå…³ç³»æ¨¡å‹è¦æ±‚é«˜çš„è½¯ä»¶ï¼ˆä¾‹å¦‚éœ€æ±‚å›ºå®šçš„å®šåˆ¶åŒ–è½¯ä»¶ï¼‰å¦‚æœç”¨hibernateå¼€å‘å¯ä»¥èŠ‚çœå¾ˆå¤šä»£ç ï¼Œæé«˜æ•ˆç‡ã€‚ä½†æ˜¯Hibernateçš„å­¦ä¹ é—¨æ§›é«˜ï¼Œè¦ç²¾é€šé—¨æ§›æ›´é«˜ï¼Œè€Œä¸”æ€ä¹ˆè®¾è®¡O/Ræ˜ å°„ï¼Œåœ¨æ€§èƒ½å’Œå¯¹è±¡æ¨¡å‹ä¹‹é—´å¦‚ä½•æƒè¡¡ï¼Œä»¥åŠæ€æ ·ç”¨å¥½Hibernateéœ€è¦å…·æœ‰å¾ˆå¼ºçš„ç»éªŒå’Œèƒ½åŠ›æ‰è¡Œã€‚ æ€»ä¹‹ï¼ŒæŒ‰ç…§ç”¨æˆ·çš„éœ€æ±‚åœ¨æœ‰é™çš„èµ„æºç¯å¢ƒä¸‹åªè¦èƒ½åšå‡ºç»´æŠ¤æ€§ã€æ‰©å±•æ€§è‰¯å¥½çš„è½¯ä»¶æ¶æ„éƒ½æ˜¯å¥½æ¶æ„ï¼Œæ‰€ä»¥æ¡†æ¶åªæœ‰é€‚åˆæ‰æ˜¯æœ€å¥½ã€‚ 29ã€ ç®€å•ä»‹ç»ä¸‹ä½ å¯¹mybatisçš„ç†è§£ï¼Ÿ mybatisé…ç½® SqlMapConfig.xmlï¼Œæ­¤æ–‡ä»¶ä½œä¸ºmybatisçš„å…¨å±€é…ç½®æ–‡ä»¶ï¼Œé…ç½®äº†mybatisçš„è¿è¡Œç¯å¢ƒç­‰ä¿¡æ¯ã€‚ mapper.xmlæ–‡ä»¶å³sqlæ˜ å°„æ–‡ä»¶ï¼Œæ–‡ä»¶ä¸­é…ç½®äº†æ“ä½œæ•°æ®åº“çš„sqlè¯­å¥ã€‚æ­¤æ–‡ä»¶éœ€è¦åœ¨SqlMapConfig.xmlä¸­åŠ è½½ã€‚ é€šè¿‡mybatisç¯å¢ƒç­‰é…ç½®ä¿¡æ¯æ„é€ SqlSessionFactoryå³ä¼šè¯å·¥å‚ ç”±ä¼šè¯å·¥å‚åˆ›å»ºsqlSessionå³ä¼šè¯ï¼Œæ“ä½œæ•°æ®åº“éœ€è¦é€šè¿‡sqlSessionè¿›è¡Œã€‚ mybatisåº•å±‚è‡ªå®šä¹‰äº†Executoræ‰§è¡Œå™¨æ¥å£æ“ä½œæ•°æ®åº“ï¼ŒExecutoræ¥å£æœ‰ä¸¤ä¸ªå®ç°ï¼Œä¸€ä¸ªæ˜¯åŸºæœ¬æ‰§è¡Œå™¨ã€ä¸€ä¸ªæ˜¯ç¼“å­˜æ‰§è¡Œå™¨ã€‚ Mapped Statementä¹Ÿæ˜¯mybatisä¸€ä¸ªåº•å±‚å°è£…å¯¹è±¡ï¼Œå®ƒåŒ…è£…äº†mybatisé…ç½®ä¿¡æ¯åŠsqlæ˜ å°„ä¿¡æ¯ç­‰ã€‚mapper.xmlæ–‡ä»¶ä¸­ä¸€ä¸ªsqlå¯¹åº”ä¸€ä¸ªMapped Statementå¯¹è±¡ï¼Œsqlçš„idå³æ˜¯Mapped statementçš„idã€‚ Mapped Statementå¯¹sqlæ‰§è¡Œè¾“å…¥å‚æ•°è¿›è¡Œå®šä¹‰ï¼ŒåŒ…æ‹¬HashMapã€åŸºæœ¬ç±»å‹ã€pojoï¼ŒExecutoré€šè¿‡Mapped Statementåœ¨æ‰§è¡Œsqlå‰å°†è¾“å…¥çš„javaå¯¹è±¡æ˜ å°„è‡³sqlä¸­ï¼Œè¾“å…¥å‚æ•°æ˜ å°„å°±æ˜¯jdbcç¼–ç¨‹ä¸­å¯¹preparedStatementè®¾ç½®å‚æ•°ã€‚ Mapped Statementå¯¹sqlæ‰§è¡Œè¾“å‡ºç»“æœè¿›è¡Œå®šä¹‰ï¼ŒåŒ…æ‹¬HashMapã€åŸºæœ¬ç±»å‹ã€pojoï¼ŒExecutoré€šè¿‡Mapped Statementåœ¨æ‰§è¡Œsqlåå°†è¾“å‡ºç»“æœæ˜ å°„è‡³javaå¯¹è±¡ä¸­ï¼Œè¾“å‡ºç»“æœæ˜ å°„è¿‡ç¨‹ç›¸å½“äºjdbcç¼–ç¨‹ä¸­å¯¹ç»“æœçš„è§£æå¤„ç†è¿‡ç¨‹ã€‚","categories":[],"tags":[{"name":"IT","slug":"IT","permalink":"/tags/IT/"},{"name":"æŠ€æœ¯ç¬”è®°","slug":"æŠ€æœ¯ç¬”è®°","permalink":"/tags/%E6%8A%80%E6%9C%AF%E7%AC%94%E8%AE%B0/"},{"name":"æ•°æ®åº“","slug":"æ•°æ®åº“","permalink":"/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/"},{"name":"Job","slug":"Job","permalink":"/tags/Job/"},{"name":"Mybatis","slug":"Mybatis","permalink":"/tags/Mybatis/"}]},{"title":"zookeeperçš„ä½¿ç”¨","slug":"zookeeperæ•™ç¨‹","date":"2019-10-20T11:51:12.000Z","updated":"2019-10-20T06:05:26.979Z","comments":true,"path":"2019/10/20/zookeeperæ•™ç¨‹/","link":"","permalink":"/2019/10/20/zookeeper%E6%95%99%E7%A8%8B/","excerpt":"","text":"1.zookeeperçš„æ¦‚è¿°Zookeeperæ˜¯ä¸€ä¸ªå¼€æºçš„åˆ†å¸ƒå¼çš„ï¼Œä¸ºåˆ†å¸ƒå¼åº”ç”¨æä¾›åè°ƒæœåŠ¡çš„Apacheé¡¹ç›®ã€‚ Zookeeperä»è®¾è®¡æ¨¡å¼è§’åº¦æ¥ç†è§£ï¼šæ˜¯ä¸€ä¸ªåŸºäºè§‚å¯Ÿè€…æ¨¡å¼è®¾è®¡çš„åˆ†å¸ƒå¼æœåŠ¡ç®¡ç†æ¡†æ¶ï¼Œå®ƒè´Ÿè´£å­˜å‚¨å’Œç®¡ç†å¤§å®¶éƒ½å…³å¿ƒçš„æ•°æ®ï¼Œç„¶åæ¥å—è§‚å¯Ÿè€…çš„æ³¨å†Œï¼Œä¸€æ—¦è¿™äº›æ•°æ®çš„çŠ¶æ€å‘ç”Ÿå˜åŒ–ï¼ŒZookeeperå°±å°†è´Ÿè´£é€šçŸ¥å·²ç»åœ¨Zookeeperä¸Šæ³¨å†Œçš„é‚£äº›è§‚å¯Ÿè€…åšå‡ºç›¸åº”çš„ååº”ï¼Œä»è€Œå®ç°é›†ç¾¤ä¸­ç±»ä¼¼Master/Slaveç®¡ç†æ¨¡å¼ Zookeeper=æ–‡ä»¶ç³»ç»Ÿ+é€šçŸ¥æœºåˆ¶ 2.åº”ç”¨åœºæ™¯æä¾›çš„æœåŠ¡åŒ…æ‹¬ï¼šåˆ†å¸ƒå¼æ¶ˆæ¯åŒæ­¥å’Œåè°ƒæœºåˆ¶ã€æœåŠ¡å™¨èŠ‚ç‚¹åŠ¨æ€ä¸Šä¸‹çº¿ã€ç»Ÿä¸€é…ç½®ç®¡ç†ã€è´Ÿè½½å‡è¡¡ã€é›†ç¾¤ç®¡ç†ï¼Œåˆ†å¸ƒå¼é” 3.å®æˆ˜3.1 å®‰è£…å‰å‡†å¤‡ï¼š ï¼ˆ1ï¼‰å®‰è£…jdk ï¼ˆ2ï¼‰é€šè¿‡filezillaå·¥å…·æ‹·è´zookeeperåˆ°åˆ°linuxç³»ç»Ÿä¸‹ ï¼ˆ3ï¼‰ä¿®æ”¹taråŒ…æƒé™chmod u+x zookeeper-3.4.10.tar.gz ï¼ˆ4ï¼‰è§£å‹åˆ°æŒ‡å®šç›®å½•[atguigu@hadoop102 software]$ tar -zxvf zookeeper-3.4.10.tar.gz -C /opt/module/ 3.2 é…ç½®ä¿®æ”¹å°†/opt/module/zookeeper-3.4.10/confè¿™ä¸ªè·¯å¾„ä¸‹çš„zoo_sample.cfgä¿®æ”¹ä¸ºzoo.cfgï¼› è¿›å…¥zoo.cfgæ–‡ä»¶ï¼švim zoo.cfg ä¿®æ”¹dataDirè·¯å¾„ä¸º dataDir=/opt/module/zookeeper-3.4.10/data/zkData åœ¨/opt/module/zookeeper-3.4.10/è¿™ä¸ªç›®å½•ä¸Šåˆ›å»ºdata/zkDataæ–‡ä»¶å¤¹ mkdir -p data/zkData 3.3 æ“ä½œzookeeperï¼ˆ1ï¼‰å¯åŠ¨zookeeper[atguigu@hadoop102 zookeeper-3.4.10]$ bin/zkServer.sh start ï¼ˆ2ï¼‰æŸ¥çœ‹è¿›ç¨‹æ˜¯å¦å¯åŠ¨[atguigu@hadoop102 zookeeper-3.4.10]$ jps 4020 Jps 4001 QuorumPeerMain ï¼ˆ3ï¼‰æŸ¥çœ‹çŠ¶æ€ï¼š[atguigu@hadoop102 zookeeper-3.4.10]$ bin/zkServer.sh status ZooKeeper JMX enabled by default Using config: /opt/module/zookeeper-3.4.10/bin/../conf/zoo.cfg Mode: standalone ï¼ˆ4ï¼‰å¯åŠ¨å®¢æˆ·ç«¯ï¼š[atguigu@hadoop102 zookeeper-3.4.10]$ bin/zkCli.sh ï¼ˆ5ï¼‰é€€å‡ºå®¢æˆ·ç«¯ï¼š[zk: localhost:2181(CONNECTED) 0] quit ï¼ˆ6ï¼‰åœæ­¢zookeeper[atguigu@hadoop102 zookeeper-3.4.10]$ bin/zkServer.sh stop 3.4 é…ç½®å‚æ•°è§£è¯»3.41 è§£è¯»zoo.cfg æ–‡ä»¶ä¸­å‚æ•°å«ä¹‰ 1ï¼‰tickTimeï¼šé€šä¿¡å¿ƒè·³æ•°ï¼ŒZookeeperæœåŠ¡å™¨å¿ƒè·³æ—¶é—´ï¼Œå•ä½æ¯«ç§’Zookeeperä½¿ç”¨çš„åŸºæœ¬æ—¶é—´ï¼ŒæœåŠ¡å™¨ä¹‹é—´æˆ–å®¢æˆ·ç«¯ä¸æœåŠ¡å™¨ä¹‹é—´ç»´æŒå¿ƒè·³çš„æ—¶é—´é—´éš”ï¼Œä¹Ÿå°±æ˜¯æ¯ä¸ªtickTimeæ—¶é—´å°±ä¼šå‘é€ä¸€ä¸ªå¿ƒè·³ï¼Œæ—¶é—´å•ä½ä¸ºæ¯«ç§’ã€‚ å®ƒç”¨äºå¿ƒè·³æœºåˆ¶ï¼Œå¹¶ä¸”è®¾ç½®æœ€å°çš„sessionè¶…æ—¶æ—¶é—´ä¸ºä¸¤å€å¿ƒè·³æ—¶é—´ã€‚(sessionçš„æœ€å°è¶…æ—¶æ—¶é—´æ˜¯2*tickTime) 2ï¼‰initLimitï¼šLFåˆå§‹é€šä¿¡æ—¶é™é›†ç¾¤ä¸­çš„followerè·Ÿéšè€…æœåŠ¡å™¨(F)ä¸leaderé¢†å¯¼è€…æœåŠ¡å™¨(L)ä¹‹é—´åˆå§‹è¿æ¥æ—¶èƒ½å®¹å¿çš„æœ€å¤šå¿ƒè·³æ•°ï¼ˆtickTimeçš„æ•°é‡ï¼‰ï¼Œç”¨å®ƒæ¥é™å®šé›†ç¾¤ä¸­çš„ZookeeperæœåŠ¡å™¨è¿æ¥åˆ°Leaderçš„æ—¶é™ã€‚ æŠ•ç¥¨é€‰ä¸¾æ–°leaderçš„åˆå§‹åŒ–æ—¶é—´ Followeråœ¨å¯åŠ¨è¿‡ç¨‹ä¸­ï¼Œä¼šä»LeaderåŒæ­¥æ‰€æœ‰æœ€æ–°æ•°æ®ï¼Œç„¶åç¡®å®šè‡ªå·±èƒ½å¤Ÿå¯¹å¤–æœåŠ¡çš„èµ·å§‹çŠ¶æ€ã€‚ Leaderå…è®¸Fåœ¨initLimitæ—¶é—´å†…å®Œæˆè¿™ä¸ªå·¥ä½œã€‚ 3ï¼‰syncLimitï¼šLFåŒæ­¥é€šä¿¡æ—¶é™é›†ç¾¤ä¸­Leaderä¸Followerä¹‹é—´çš„æœ€å¤§å“åº”æ—¶é—´å•ä½ï¼Œå‡å¦‚å“åº”è¶…è¿‡syncLimit * tickTimeï¼Œ Leaderè®¤ä¸ºFollweræ­»æ‰ï¼Œä»æœåŠ¡å™¨åˆ—è¡¨ä¸­åˆ é™¤Follwerã€‚ åœ¨è¿è¡Œè¿‡ç¨‹ä¸­ï¼ŒLeaderè´Ÿè´£ä¸ZKé›†ç¾¤ä¸­æ‰€æœ‰æœºå™¨è¿›è¡Œé€šä¿¡ï¼Œä¾‹å¦‚é€šè¿‡ä¸€äº›å¿ƒè·³æ£€æµ‹æœºåˆ¶ï¼Œæ¥æ£€æµ‹æœºå™¨çš„å­˜æ´»çŠ¶æ€ã€‚ å¦‚æœLå‘å‡ºå¿ƒè·³åŒ…åœ¨syncLimitä¹‹åï¼Œè¿˜æ²¡æœ‰ä»Fé‚£æ”¶åˆ°å“åº”ï¼Œé‚£ä¹ˆå°±è®¤ä¸ºè¿™ä¸ªFå·²ç»ä¸åœ¨çº¿äº†ã€‚ 4ï¼‰dataDirï¼šæ•°æ®æ–‡ä»¶ç›®å½•+æ•°æ®æŒä¹…åŒ–è·¯å¾„ä¿å­˜å†…å­˜æ•°æ®åº“å¿«ç…§ä¿¡æ¯çš„ä½ç½®ï¼Œå¦‚æœæ²¡æœ‰å…¶ä»–è¯´æ˜ï¼Œæ›´æ–°çš„äº‹åŠ¡æ—¥å¿—ä¹Ÿä¿å­˜åˆ°æ•°æ®åº“ã€‚ 5ï¼‰clientPortï¼šå®¢æˆ·ç«¯è¿æ¥ç«¯å£ç›‘å¬å®¢æˆ·ç«¯è¿æ¥çš„ç«¯å£ 4. æ•°æ®ç»“æ„ZooKeeperæ•°æ®æ¨¡å‹çš„ç»“æ„ä¸Unixæ–‡ä»¶ç³»ç»Ÿå¾ˆç±»ä¼¼ï¼Œæ•´ä½“ä¸Šå¯ä»¥çœ‹ä½œæ˜¯ä¸€æ£µæ ‘ï¼Œæ¯ä¸ªèŠ‚ç‚¹ç§°åšä¸€ä¸ªZNodeã€‚ å¾ˆæ˜¾ç„¶zookeeperé›†ç¾¤è‡ªèº«ç»´æŠ¤äº†ä¸€å¥—æ•°æ®ç»“æ„ã€‚è¿™ä¸ªå­˜å‚¨ç»“æ„æ˜¯ä¸€ä¸ªæ ‘å½¢ç»“æ„ï¼Œå…¶ä¸Šçš„æ¯ä¸€ä¸ªèŠ‚ç‚¹ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸ºâ€znodeâ€ï¼Œæ¯ä¸€ä¸ªznodeé»˜è®¤èƒ½å¤Ÿå­˜å‚¨1MBçš„æ•°æ®ï¼Œæ¯ä¸ªZNodeéƒ½å¯ä»¥é€šè¿‡å…¶è·¯å¾„å”¯ä¸€æ ‡è¯† 5. èŠ‚ç‚¹ç±»å‹1ï¼‰Znodeæœ‰ä¸¤ç§ç±»å‹ï¼š çŸ­æš‚ï¼ˆephemeralï¼‰ï¼šå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç«¯æ–­å¼€è¿æ¥åï¼Œåˆ›å»ºçš„èŠ‚ç‚¹è‡ªå·±åˆ é™¤ æŒä¹…ï¼ˆpersistentï¼‰ï¼šå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç«¯æ–­å¼€è¿æ¥åï¼Œåˆ›å»ºçš„èŠ‚ç‚¹ä¸åˆ é™¤ 2ï¼‰Znodeæœ‰å››ç§å½¢å¼çš„ç›®å½•èŠ‚ç‚¹ï¼ˆé»˜è®¤æ˜¯persistent ï¼‰ ï¼ˆ1ï¼‰æŒä¹…åŒ–ç›®å½•èŠ‚ç‚¹ï¼ˆPERSISTENTï¼‰ å®¢æˆ·ç«¯ä¸zookeeperæ–­å¼€è¿æ¥åï¼Œè¯¥èŠ‚ç‚¹ä¾æ—§å­˜åœ¨ ï¼ˆ2ï¼‰æŒä¹…åŒ–é¡ºåºç¼–å·ç›®å½•èŠ‚ç‚¹ï¼ˆPERSISTENT_SEQUENTIALï¼‰ å®¢æˆ·ç«¯ä¸zookeeperæ–­å¼€è¿æ¥åï¼Œè¯¥èŠ‚ç‚¹ä¾æ—§å­˜åœ¨ï¼Œåªæ˜¯Zookeeperç»™è¯¥èŠ‚ç‚¹åç§°è¿›è¡Œé¡ºåºç¼–å· ï¼ˆ3ï¼‰ä¸´æ—¶ç›®å½•èŠ‚ç‚¹ï¼ˆEPHEMERALï¼‰ å®¢æˆ·ç«¯ä¸zookeeperæ–­å¼€è¿æ¥åï¼Œè¯¥èŠ‚ç‚¹è¢«åˆ é™¤ ï¼ˆ4ï¼‰ä¸´æ—¶é¡ºåºç¼–å·ç›®å½•èŠ‚ç‚¹ï¼ˆEPHEMERAL_SEQUENTIALï¼‰ å®¢æˆ·ç«¯ä¸zookeeperæ–­å¼€è¿æ¥åï¼Œè¯¥èŠ‚ç‚¹è¢«åˆ é™¤ï¼Œåªæ˜¯Zookeeperç»™è¯¥èŠ‚ç‚¹åç§°è¿›è¡Œé¡ºåºç¼–å· 6. ç‰¹ç‚¹ 1ï¼‰Zookeeperï¼šä¸€ä¸ªé¢†å¯¼è€…ï¼ˆleaderï¼‰ï¼Œå¤šä¸ªè·Ÿéšè€…ï¼ˆfollowerï¼‰ç»„æˆçš„é›†ç¾¤ã€‚ 2ï¼‰Leaderè´Ÿè´£è¿›è¡ŒæŠ•ç¥¨çš„å‘èµ·å’Œå†³è®®ï¼Œæ›´æ–°ç³»ç»ŸçŠ¶æ€ 3ï¼‰Followerç”¨äºæ¥æ”¶å®¢æˆ·è¯·æ±‚å¹¶å‘å®¢æˆ·ç«¯è¿”å›ç»“æœï¼Œåœ¨é€‰ä¸¾Leaderè¿‡ç¨‹ä¸­å‚ä¸æŠ•ç¥¨ 4ï¼‰é›†ç¾¤ä¸­åªè¦æœ‰åŠæ•°ä»¥ä¸ŠèŠ‚ç‚¹å­˜æ´»ï¼ŒZookeeperé›†ç¾¤å°±èƒ½æ­£å¸¸æœåŠ¡ã€‚ 5ï¼‰å…¨å±€æ•°æ®ä¸€è‡´ï¼šæ¯ä¸ªserverä¿å­˜ä¸€ä»½ç›¸åŒçš„æ•°æ®å‰¯æœ¬ï¼Œclientæ— è®ºè¿æ¥åˆ°å“ªä¸ªserverï¼Œæ•°æ®éƒ½æ˜¯ä¸€è‡´çš„ã€‚ 6ï¼‰æ›´æ–°è¯·æ±‚é¡ºåºè¿›è¡Œï¼Œæ¥è‡ªåŒä¸€ä¸ªclientçš„æ›´æ–°è¯·æ±‚æŒ‰å…¶å‘é€é¡ºåºä¾æ¬¡æ‰§è¡Œã€‚ 7ï¼‰æ•°æ®æ›´æ–°åŸå­æ€§ï¼Œä¸€æ¬¡æ•°æ®æ›´æ–°è¦ä¹ˆæˆåŠŸï¼Œè¦ä¹ˆå¤±è´¥ã€‚ 8ï¼‰å®æ—¶æ€§ï¼Œåœ¨ä¸€å®šæ—¶é—´èŒƒå›´å†…ï¼Œclientèƒ½è¯»åˆ°æœ€æ–°æ•°æ®ã€‚ 7. é€‰ä¸¾æœºåˆ¶ 1ï¼‰åŠæ•°æœºåˆ¶ï¼šé›†ç¾¤ä¸­åŠæ•°ä»¥ä¸Šæœºå™¨å­˜æ´»ï¼Œé›†ç¾¤å¯ç”¨ã€‚æ‰€ä»¥zookeeperé€‚åˆè£…åœ¨å¥‡æ•°å°æœºå™¨ä¸Šã€‚ 2ï¼‰Zookeeperè™½ç„¶åœ¨é…ç½®æ–‡ä»¶ä¸­å¹¶æ²¡æœ‰æŒ‡å®šmasterå’Œslaveã€‚ä½†æ˜¯ï¼Œzookeeperå·¥ä½œæ—¶ï¼Œæ˜¯æœ‰ä¸€ä¸ªèŠ‚ç‚¹ä¸ºleaderï¼Œå…¶ä»–åˆ™ä¸ºfollowerï¼ŒLeaderæ˜¯é€šè¿‡å†…éƒ¨çš„é€‰ä¸¾æœºåˆ¶ä¸´æ—¶äº§ç”Ÿçš„ 3ï¼‰ä»¥ä¸€ä¸ªç®€å•çš„ä¾‹å­æ¥è¯´æ˜æ•´ä¸ªé€‰ä¸¾çš„è¿‡ç¨‹ã€‚ å‡è®¾æœ‰äº”å°æœåŠ¡å™¨ç»„æˆçš„zookeeperé›†ç¾¤ï¼Œå®ƒä»¬çš„idä»1-5ï¼ŒåŒæ—¶å®ƒä»¬éƒ½æ˜¯æœ€æ–°å¯åŠ¨çš„ï¼Œä¹Ÿå°±æ˜¯æ²¡æœ‰å†å²æ•°æ®ï¼Œåœ¨å­˜æ”¾æ•°æ®é‡è¿™ä¸€ç‚¹ä¸Šï¼Œéƒ½æ˜¯ä¸€æ ·çš„ã€‚å‡è®¾è¿™äº›æœåŠ¡å™¨ä¾åºå¯åŠ¨ï¼Œæ¥çœ‹çœ‹ä¼šå‘ç”Ÿä»€ä¹ˆã€‚ 12345678910#é€‰ä¸¾leaderæ¡ˆä¾‹ï¼ˆ1ï¼‰æœåŠ¡å™¨1å¯åŠ¨ï¼Œæ­¤æ—¶åªæœ‰å®ƒä¸€å°æœåŠ¡å™¨å¯åŠ¨äº†ï¼Œå®ƒå‘å‡ºå»çš„æŠ¥æ²¡æœ‰ä»»ä½•å“åº”ï¼Œæ‰€ä»¥å®ƒçš„é€‰ä¸¾çŠ¶æ€ä¸€ç›´æ˜¯LOOKINGçŠ¶æ€ã€‚ï¼ˆ2ï¼‰æœåŠ¡å™¨2å¯åŠ¨ï¼Œå®ƒä¸æœ€å¼€å§‹å¯åŠ¨çš„æœåŠ¡å™¨1è¿›è¡Œé€šä¿¡ï¼Œäº’ç›¸äº¤æ¢è‡ªå·±çš„é€‰ä¸¾ç»“æœï¼Œç”±äºä¸¤è€…éƒ½æ²¡æœ‰å†å²æ•°æ®ï¼Œæ‰€ä»¥idå€¼è¾ƒå¤§çš„æœåŠ¡å™¨2èƒœå‡ºï¼Œä½†æ˜¯ç”±äºæ²¡æœ‰è¾¾åˆ°è¶…è¿‡åŠæ•°ä»¥ä¸Šçš„æœåŠ¡å™¨éƒ½åŒæ„é€‰ä¸¾å®ƒ(è¿™ä¸ªä¾‹å­ä¸­çš„åŠæ•°ä»¥ä¸Šæ˜¯3)ï¼Œæ‰€ä»¥æœåŠ¡å™¨1ã€2è¿˜æ˜¯ç»§ç»­ä¿æŒLOOKINGçŠ¶æ€ã€‚ï¼ˆ3ï¼‰æœåŠ¡å™¨3å¯åŠ¨ï¼Œæ ¹æ®å‰é¢çš„ç†è®ºåˆ†æï¼ŒæœåŠ¡å™¨3æˆä¸ºæœåŠ¡å™¨1ã€2ã€3ä¸­çš„è€å¤§ï¼Œè€Œä¸ä¸Šé¢ä¸åŒçš„æ˜¯ï¼Œæ­¤æ—¶æœ‰ä¸‰å°æœåŠ¡å™¨é€‰ä¸¾äº†å®ƒï¼Œæ‰€ä»¥å®ƒæˆä¸ºäº†è¿™æ¬¡é€‰ä¸¾çš„leaderã€‚ï¼ˆ4ï¼‰æœåŠ¡å™¨4å¯åŠ¨ï¼Œæ ¹æ®å‰é¢çš„åˆ†æï¼Œç†è®ºä¸ŠæœåŠ¡å™¨4åº”è¯¥æ˜¯æœåŠ¡å™¨1ã€2ã€3ã€4ä¸­æœ€å¤§çš„ï¼Œä½†æ˜¯ç”±äºå‰é¢å·²ç»æœ‰åŠæ•°ä»¥ä¸Šçš„æœåŠ¡å™¨é€‰ä¸¾äº†æœåŠ¡å™¨3ï¼Œæ‰€ä»¥å®ƒåªèƒ½æ¥æ”¶å½“å°å¼Ÿçš„å‘½äº†ã€‚ï¼ˆ5ï¼‰æœåŠ¡å™¨5å¯åŠ¨ï¼ŒåŒ4ä¸€æ ·å½“å°å¼Ÿã€‚ 8. ç›‘å¬å™¨åŸç†ç›‘å¬å™¨æ˜¯ä¸€ä¸ªæ¥å£ï¼Œæˆ‘ä»¬çš„ä»£ç ä¸­å¯ä»¥å®ç°Watherè¿™ä¸ªæ¥å£ï¼Œå®ç°å…¶ä¸­çš„processæ–¹æ³•ï¼Œæ–¹æ³•ä¸­å³æˆ‘ä»¬è‡ªå·±çš„ä¸šåŠ¡é€»è¾‘ ç›‘å¬å™¨çš„æ³¨å†Œæ˜¯åœ¨è·å–æ•°æ®çš„æ“ä½œä¸­å®ç°ï¼š getData(path,watch?)ç›‘å¬çš„äº‹ä»¶æ˜¯ï¼šèŠ‚ç‚¹æ•°æ®å˜åŒ–äº‹ä»¶ getChildren(path,watch?)ç›‘å¬çš„äº‹ä»¶æ˜¯ï¼šèŠ‚ç‚¹ä¸‹çš„å­èŠ‚ç‚¹å¢å‡å˜åŒ–äº‹ä»¶ 9.0 åˆ†å¸ƒå¼zookeeperçš„æ­å»º9.1 é›†ç¾¤è§„åˆ’åœ¨hadoop2ã€hadoop3å’Œhadoop4ä¸‰ä¸ªèŠ‚ç‚¹ä¸Šéƒ¨ç½²Zookeeperã€‚ 9.2 è§£å‹å®‰è£…ï¼ˆ1ï¼‰è§£å‹zookeeperå®‰è£…åŒ…åˆ°/opt/module/ç›®å½•ä¸‹[atguigu@hadoop102 software]$ tar -zxvf zookeeper-3.4.10.tar.gz -C /opt/module/ ï¼ˆ2ï¼‰åœ¨/opt/module/zookeeper-3.4.10/è¿™ä¸ªç›®å½•ä¸‹åˆ›å»ºdata/zkDatamkdir -p data/zkData ï¼ˆ3ï¼‰é‡å‘½å/opt/module/zookeeper-3.4.10/confè¿™ä¸ªç›®å½•ä¸‹çš„zoo_sample.cfgä¸ºzoo.cfgmv zoo_sample.cfg zoo.cfg 9.3 é…ç½®zoo.cfgæ–‡ä»¶ï¼ˆ1ï¼‰å…·ä½“é…ç½®dataDir=/opt/module/zookeeper-3.4.10/data/zkData å¢åŠ å¦‚ä¸‹é…ç½® #######################cluster########################## server.2=hadoop102:2888:3888 server.3=hadoop103:2888:3888 server.4=hadoop104:2888:3888 ï¼ˆ2ï¼‰é…ç½®å‚æ•°è§£è¯»Server.A=B:C:Dã€‚ Aæ˜¯ä¸€ä¸ªæ•°å­—ï¼Œè¡¨ç¤ºè¿™ä¸ªæ˜¯ç¬¬å‡ å·æœåŠ¡å™¨ï¼› Bæ˜¯è¿™ä¸ªæœåŠ¡å™¨çš„ipåœ°å€ï¼› Cæ˜¯è¿™ä¸ªæœåŠ¡å™¨ä¸é›†ç¾¤ä¸­çš„LeaderæœåŠ¡å™¨äº¤æ¢ä¿¡æ¯çš„ç«¯å£ï¼› Dæ˜¯ä¸‡ä¸€é›†ç¾¤ä¸­çš„LeaderæœåŠ¡å™¨æŒ‚äº†ï¼Œéœ€è¦ä¸€ä¸ªç«¯å£æ¥é‡æ–°è¿›è¡Œé€‰ä¸¾ï¼Œé€‰å‡ºä¸€ä¸ªæ–°çš„Leaderï¼Œè€Œè¿™ä¸ªç«¯å£å°±æ˜¯ç”¨æ¥æ‰§è¡Œé€‰ä¸¾æ—¶æœåŠ¡å™¨ç›¸äº’é€šä¿¡çš„ç«¯å£ã€‚ é›†ç¾¤æ¨¡å¼ä¸‹é…ç½®ä¸€ä¸ªæ–‡ä»¶myidï¼Œè¿™ä¸ªæ–‡ä»¶åœ¨dataDirç›®å½•ä¸‹ï¼Œè¿™ä¸ªæ–‡ä»¶é‡Œé¢æœ‰ä¸€ä¸ªæ•°æ®å°±æ˜¯Açš„å€¼ï¼ŒZookeeperå¯åŠ¨æ—¶è¯»å–æ­¤æ–‡ä»¶ï¼Œæ‹¿åˆ°é‡Œé¢çš„æ•°æ®ä¸zoo.cfgé‡Œé¢çš„é…ç½®ä¿¡æ¯æ¯”è¾ƒä»è€Œåˆ¤æ–­åˆ°åº•æ˜¯å“ªä¸ªserverã€‚ 9.4 é›†ç¾¤æ“ä½œï¼ˆ1ï¼‰åœ¨/opt/module/zookeeper-3.4.10/data/zkDataç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªmyidçš„æ–‡ä»¶touch myid æ·»åŠ myidæ–‡ä»¶ï¼Œæ³¨æ„ä¸€å®šè¦åœ¨linuxé‡Œé¢åˆ›å»ºï¼Œåœ¨notepad++é‡Œé¢å¾ˆå¯èƒ½ä¹±ç  ï¼ˆ2ï¼‰ç¼–è¾‘myidæ–‡ä»¶vi myid åœ¨æ–‡ä»¶ä¸­æ·»åŠ ä¸serverå¯¹åº”çš„ç¼–å·ï¼šå¦‚2 ï¼ˆ3ï¼‰æ‹·è´é…ç½®å¥½çš„zookeeperåˆ°å…¶ä»–æœºå™¨ä¸Šscp -r zookeeper-3.4.10/ root@hadoop3.atguigu.com:/opt/app/ scp -r zookeeper-3.4.10/ root@hadoop4.atguigu.com:/opt/app/ å¹¶åˆ†åˆ«ä¿®æ”¹myidæ–‡ä»¶ä¸­å†…å®¹ä¸º3ã€4 ï¼ˆ4ï¼‰åˆ†åˆ«å¯åŠ¨zookeeper[root@hadoop2 zookeeper-3.4.10]# bin/zkServer.sh start [root@hadoop3 zookeeper-3.4.10]# bin/zkServer.sh start [root@hadoop4 zookeeper-3.4.10]# bin/zkServer.sh start ï¼ˆ5ï¼‰æŸ¥çœ‹çŠ¶æ€[root@hadoop2 zookeeper-3.4.10]# bin/zkServer.sh status JMX enabled by default Using config: /opt/module/zookeeper-3.4.10/bin/../conf/zoo.cfg Mode: follower [root@hadoop3 zookeeper-3.4.10]# bin/zkServer.sh status JMX enabled by default Using config: /opt/module/zookeeper-3.4.10/bin/../conf/zoo.cfg Mode: leader [root@hadoop4 zookeeper-3.4.5]# bin/zkServer.sh status JMX enabled by default Using config: /opt/module/zookeeper-3.4.10/bin/../conf/zoo.cfg Mode: follower 9.5 å®¢æˆ·ç«¯å‘½ä»¤è¡Œæ“ä½œ1ï¼‰å¯åŠ¨å®¢æˆ·ç«¯[atguigu@hadoop103 zookeeper-3.4.10]$ bin/zkCli.sh 2ï¼‰æ˜¾ç¤ºæ‰€æœ‰æ“ä½œå‘½ä»¤[zk: localhost:2181(CONNECTED) 1] help 3ï¼‰æŸ¥çœ‹å½“å‰znodeä¸­æ‰€åŒ…å«çš„å†…å®¹[zk: localhost:2181(CONNECTED) 0] ls / [zookeeper] 4ï¼‰æŸ¥çœ‹å½“å‰èŠ‚ç‚¹æ•°æ®å¹¶èƒ½çœ‹åˆ°æ›´æ–°æ¬¡æ•°ç­‰æ•°æ®[zk: localhost:2181(CONNECTED) 1] ls2 / 12345678910111213#æ ¹ç›®å½•ä¸‹çš„æ•°æ®[zookeeper]cZxid = 0x0ctime = Thu Jan 01 08:00:00 CST 1970mZxid = 0x0mtime = Thu Jan 01 08:00:00 CST 1970pZxid = 0x0cversion = -1dataVersion = 0aclVersion = 0ephemeralOwner = 0x0dataLength = 0numChildren = 1 5ï¼‰åˆ›å»ºæ™®é€šèŠ‚ç‚¹[zk: localhost:2181(CONNECTED) 2] create /app1 â€œhello app1â€ Created /app1 [zk: localhost:2181(CONNECTED) 4] create /app1/server101 â€œ192.168.1.101â€ Created /app1/server101 6ï¼‰è·å¾—èŠ‚ç‚¹çš„å€¼[zk: localhost:2181(CONNECTED) 6] get /app1 123456789101112hello app1cZxid = 0x20000000actime = Mon Jul 17 16:08:35 CST 2017mZxid = 0x20000000amtime = Mon Jul 17 16:08:35 CST 2017pZxid = 0x20000000bcversion = 1dataVersion = 0aclVersion = 0ephemeralOwner = 0x0dataLength = 10numChildren = 1 [zk: localhost:2181(CONNECTED) 8] get /app1/server101 123456789101112192.168.1.101cZxid = 0x20000000bctime = Mon Jul 17 16:11:04 CST 2017mZxid = 0x20000000bmtime = Mon Jul 17 16:11:04 CST 2017pZxid = 0x20000000bcversion = 0dataVersion = 0aclVersion = 0ephemeralOwner = 0x0dataLength = 13numChildren = 0 7ï¼‰åˆ›å»ºçŸ­æš‚èŠ‚ç‚¹[zk: localhost:2181(CONNECTED) 9] create -e /app-emphemeral 8888 ï¼ˆ1ï¼‰åœ¨å½“å‰å®¢æˆ·ç«¯æ˜¯èƒ½æŸ¥çœ‹åˆ°çš„[zk: localhost:2181(CONNECTED) 10] ls / [app1, app-emphemeral, zookeeper] ï¼ˆ2ï¼‰é€€å‡ºå½“å‰å®¢æˆ·ç«¯ç„¶åå†é‡å¯å¯åŠ¨å®¢æˆ·ç«¯[zk: localhost:2181(CONNECTED) 12] quit [atguigu@hadoop104 zookeeper-3.4.10]$ bin/zkCli.sh ï¼ˆ3ï¼‰å†æ¬¡æŸ¥çœ‹æ ¹ç›®å½•ä¸‹çŸ­æš‚èŠ‚ç‚¹å·²ç»åˆ é™¤[zk: localhost:2181(CONNECTED) 0] ls / [app1, zookeeper] 8ï¼‰åˆ›å»ºå¸¦åºå·çš„èŠ‚ç‚¹ï¼ˆ1ï¼‰å…ˆåˆ›å»ºä¸€ä¸ªæ™®é€šçš„æ ¹èŠ‚ç‚¹app2[zk: localhost:2181(CONNECTED) 11] create /app2 â€œapp2â€ ï¼ˆ2ï¼‰åˆ›å»ºå¸¦åºå·çš„èŠ‚ç‚¹[zk: localhost:2181(CONNECTED) 13] create -s /app2/aa 888 Created /app2/aa0000000000 [zk: localhost:2181(CONNECTED) 14] create -s /app2/bb 888 Created /app2/bb0000000001 [zk: localhost:2181(CONNECTED) 15] create -s /app2/cc 888 Created /app2/cc0000000002 å¦‚æœåŸèŠ‚ç‚¹ä¸‹æœ‰1ä¸ªèŠ‚ç‚¹ï¼Œåˆ™å†æ’åºæ—¶ä»1å¼€å§‹ï¼Œä»¥æ­¤ç±»æ¨ã€‚ [zk: localhost:2181(CONNECTED) 16] create -s /app1/aa 888 Created /app1/aa0000000001 9ï¼‰ä¿®æ”¹èŠ‚ç‚¹æ•°æ®å€¼[zk: localhost:2181(CONNECTED) 2] set /app1 999 10ï¼‰èŠ‚ç‚¹çš„å€¼å˜åŒ–ç›‘å¬ï¼ˆ1ï¼‰åœ¨104ä¸»æœºä¸Šæ³¨å†Œç›‘å¬/app1èŠ‚ç‚¹æ•°æ®å˜åŒ– [zk: localhost:2181(CONNECTED) 26] get /app1 watch ï¼ˆ2ï¼‰åœ¨103ä¸»æœºä¸Šä¿®æ”¹/app1èŠ‚ç‚¹çš„æ•°æ® [zk: localhost:2181(CONNECTED) 5] set /app1 777 ï¼ˆ3ï¼‰è§‚å¯Ÿ104ä¸»æœºæ”¶åˆ°æ•°æ®å˜åŒ–çš„ç›‘å¬ WATCHER:: WatchedEvent state:SyncConnected type:NodeDataChanged path:/app1 11ï¼‰èŠ‚ç‚¹çš„å­èŠ‚ç‚¹å˜åŒ–ç›‘å¬ï¼ˆè·¯å¾„å˜åŒ–ï¼‰ï¼ˆ1ï¼‰åœ¨104ä¸»æœºä¸Šæ³¨å†Œç›‘å¬/app1èŠ‚ç‚¹çš„å­èŠ‚ç‚¹å˜åŒ–[zk: localhost:2181(CONNECTED) 1] ls /app1 watch [aa0000000001, server101] ï¼ˆ2ï¼‰åœ¨103ä¸»æœº/app1èŠ‚ç‚¹ä¸Šåˆ›å»ºå­èŠ‚ç‚¹[zk: localhost:2181(CONNECTED) 6] create /app1/bb 666 Created /app1/bb ï¼ˆ3ï¼‰è§‚å¯Ÿ104ä¸»æœºæ”¶åˆ°å­èŠ‚ç‚¹å˜åŒ–çš„ç›‘å¬WATCHER:: WatchedEvent state:SyncConnected type:NodeChildrenChanged path:/app1 12ï¼‰åˆ é™¤èŠ‚ç‚¹[zk: localhost:2181(CONNECTED) 4] delete /app1/bb 13ï¼‰é€’å½’åˆ é™¤èŠ‚ç‚¹[zk: localhost:2181(CONNECTED) 7] rmr /app2 14ï¼‰æŸ¥çœ‹èŠ‚ç‚¹çŠ¶æ€123456789101112[zk: localhost:2181(CONNECTED) 12] stat /app1cZxid = 0x20000000actime = Mon Jul 17 16:08:35 CST 2017mZxid = 0x200000018mtime = Mon Jul 17 16:54:38 CST 2017pZxid = 0x20000001ccversion = 4dataVersion = 2aclVersion = 0ephemeralOwner = 0x0dataLength = 3numChildren = 2 9.6 æ“ä½œå‘½ä»¤ åˆ›å»ºèŠ‚ç‚¹ï¼šcreate /è·¯å¾„ å€¼ åˆ›å»ºæ—¶çš„å¯é€‰å‚æ•°ï¼š -eï¼ˆè¡¨ç¤ºçŸ­æš‚èŠ‚ç‚¹ï¼‰ï¼Œ -sï¼ˆè¡¨ç¤ºé¡ºåºèŠ‚ç‚¹ï¼‰ åˆ é™¤èŠ‚ç‚¹å€¼ï¼š delete /è·¯å¾„ é€’å½’åˆ é™¤ï¼šrmr /è·¯å¾„ ä¿®æ”¹æ•°æ®ï¼šset /è·¯å¾„ æ–°çš„å€¼ è·å–æ•°æ®ï¼šget /è·¯å¾„ æŸ¥çœ‹æ‰€æœ‰èŠ‚ç‚¹ï¼šls /è·¯å¾„","categories":[],"tags":[{"name":"IT","slug":"IT","permalink":"/tags/IT/"},{"name":"æŠ€æœ¯ç¬”è®°","slug":"æŠ€æœ¯ç¬”è®°","permalink":"/tags/%E6%8A%80%E6%9C%AF%E7%AC%94%E8%AE%B0/"},{"name":"Job","slug":"Job","permalink":"/tags/Job/"},{"name":"æœåŠ¡ç«¯å¼€å‘","slug":"æœåŠ¡ç«¯å¼€å‘","permalink":"/tags/%E6%9C%8D%E5%8A%A1%E7%AB%AF%E5%BC%80%E5%8F%91/"},{"name":"zookeeper","slug":"zookeeper","permalink":"/tags/zookeeper/"}]},{"title":"åˆ†å¸ƒå¼","slug":"åˆ†å¸ƒå¼","date":"2019-10-20T11:51:12.000Z","updated":"2019-10-20T13:37:31.542Z","comments":true,"path":"2019/10/20/åˆ†å¸ƒå¼/","link":"","permalink":"/2019/10/20/%E5%88%86%E5%B8%83%E5%BC%8F/","excerpt":"","text":"åˆ†å¸ƒå¼å•ç³»ç»Ÿ æ‰€æœ‰çš„ä»£ç éƒ½åœ¨ä¸€ä¸ªå·¥ç¨‹é‡Œï¼Œæœ€å¤šå¯èƒ½å°±æ˜¯é€šè¿‡mavenç­‰æ„ä»¶å·¥å…·æ‹†åˆ†äº†ä¸€ä¸‹ä»£ç å·¥ç¨‹æ¨¡å—ï¼Œä¸åŒçš„æ¨¡å—å¯ä»¥æ”¾åœ¨ä¸åŒçš„å·¥ç¨‹ä»£ç é‡Œã€‚ åœ¨éƒ¨ç½²çš„æ—¶å€™ï¼Œå¯èƒ½å°±æ˜¯ç›´æ¥åœ¨çº¿ä¸Šçš„å‡ å°æœºå™¨é‡Œç›´æ¥æ”¾åˆ°é‡Œé¢çš„tomcatä¸‹æ¥è¿è¡Œã€‚å¾ˆå¤šæµé‡å¾ˆå°çš„ä¼ä¸šå†…éƒ¨ç³»ç»Ÿï¼Œæ¯”å¦‚OAã€CRMã€è´¢åŠ¡ç­‰ç³»ç»Ÿï¼Œç”šè‡³å¯èƒ½å°±ç›´æ¥åœ¨ä¸€å°æœºå™¨çš„tomcatä¸‹éƒ¨ç½²ä¸€ä¸‹ã€‚ç„¶åç›´æ¥é…ç½®ä¸€ä¸‹åŸŸåè§£æï¼Œå°±å¯ä»¥è®©è¿™ä¸ªç³»ç»Ÿçš„å¯èƒ½å‡ åä¸ªï¼Œæˆ–è€…å‡ ç™¾ä¸ªç”¨æˆ·é€šè¿‡è®¿é—®åŸŸåæ¥ä½¿ç”¨è¿™ä¸ªè½¯ä»¶äº†ã€‚ åªä¸è¿‡ä¸ºäº†æ‰€è°“çš„â€œé«˜å¯ç”¨â€ï¼Œå¯èƒ½ä¸€èˆ¬ä¼šéƒ¨ç½²ä¸¤å°æœºå™¨ï¼Œå‰é¢åŠ ä¸€å±‚è´Ÿè½½å‡è¡¡è®¾å¤‡ï¼Œè¿™æ ·å…¶ä¸­ä¸€ä¸ªæœºå™¨æŒ‚äº†ï¼Œå¦å¤–ä¸€ä¸ªæœºå™¨ä¸Šè¿˜æœ‰ä¸€ä¸ªç³»ç»Ÿå¯ä»¥ç”¨ã€‚ ä½†æ˜¯å›¢é˜Ÿè¶Šæ¥è¶Šå¤§ï¼Œä¸šåŠ¡è¶Šæ¥è¶Šå¤æ‚, å°å›¢é˜Ÿä½ æä¸€ä¸ªä»£ç ä»“åº“ï¼Œç„¶åå°±ä¸€ä»½ä»£ç ï¼Œæ¯ä¸ªäººéƒ½åœ¨è‡ªå·±æœ¬åœ°å†™ä»£ç ï¼Œæœ€åæŠŠä»£ç åˆå¹¶ä¸€ä¸‹ï¼Œåšåšæµ‹è¯•ï¼Œç„¶åå°±ç›´æ¥éƒ¨ç½²åŸºäºTomcatæ¥å°±å¯ä»¥äº†ã€‚å‡ åä¸ªäººç»´æŠ¤ä¸€ä¸ªå•å—ç³»ç»Ÿï¼Œå¤§å®¶åœ¨ä¸€ä¸ªå·¥ç¨‹é‡Œå†™ä»£ç ï¼Œå¤§é‡çš„å†²çªä»¥åŠä»£ç åˆå¹¶éƒ½ä¼šè®©äººå´©æºƒã€‚æ¯”å¦‚æŸä¸ªåŠŸèƒ½æ¨¡å—è¦ä¸Šçº¿äº†ï¼Œä½†æ˜¯ä»–å¿…é¡»å¾—æŠŠæ•´ä¸ªå•å—ç³»ç»Ÿæ‰€æœ‰çš„åŠŸèƒ½éƒ½å›å½’æµ‹è¯•ä¸€éæ‰æ•¢ä¸Šçº¿. å› ä¸º`å¤§å®¶çš„ä»£ç éƒ½åœ¨ä¸€ä¸ªå·¥ç¨‹é‡Œï¼Œéƒ½æ˜¯è€¦åˆåœ¨ä¸€èµ·çš„ï¼Œä½ ä¿®æ”¹äº†ä»£ç ï¼Œå¿…é¡»å…¨éƒ¨æµ‹è¯•ä¸€éæ‰èƒ½ä¿è¯ç³»ç»Ÿæ­£å¸¸ã€‚ åˆ†å¸ƒå¼ç³»ç»Ÿå› æ­¤åˆ†å¸ƒå¼å‡ºç°ï¼šåºå¤§ç³»ç»Ÿåˆ†è€Œæ²»ä¹‹ è¿™ä¸ªæ—¶å€™å°±å¯ä»¥å°è¯•æŠŠä¸€ä¸ªå¤§çš„ç³»ç»Ÿæ‹†åˆ†ä¸ºå¾ˆå¤šå°çš„ç³»ç»Ÿï¼Œç”šè‡³å¾ˆå¤šå°çš„æœåŠ¡ï¼Œç„¶åå‡ ä¸ªäººç»„æˆä¸€ä¸ªå°ç»„å°±ä¸“é—¨ç»´æŠ¤å…¶ä¸­ä¸€ä¸ªå°ç³»ç»Ÿï¼Œæˆ–è€…æ¯ä¸ªäººç»´æŠ¤ä¸€ä¸ªå°æœåŠ¡ã€‚ç®€å•æ¥è¯´ï¼Œå°±æ˜¯åˆ†è€Œæ²»ä¹‹ï¼Œè¿™æ ·æ¯ä¸ªäººå¯ä»¥ä¸“æ³¨ç»´æŠ¤è‡ªå·±çš„ä»£ç ã€‚ ä¸åŒçš„å°ç³»ç»Ÿè‡ªå·±å¼€å‘ã€æµ‹è¯•å’Œä¸Šçº¿ï¼Œéƒ½ä¸ä¼šè·Ÿåˆ«äººè€¦åˆåœ¨ä¸€èµ·ï¼Œå¯ä»¥è‡ªå·±ç‹¬ç«‹è¿›è¡Œï¼Œéå¸¸çš„æ–¹ä¾¿ï¼Œå¤§å¤§ç®€åŒ–äº†å¤§è§„æ¨¡ç³»ç»Ÿçš„å¼€å‘æˆæœ¬ã€‚ ä¸åŒçš„å­ç³»ç»Ÿä¹‹é—´ï¼Œå°±æ˜¯é€šè¿‡æ¥å£äº’ç›¸æ¥å›è°ƒç”¨ï¼Œæ¯ä¸ªå­ç³»ç»Ÿéƒ½æœ‰è‡ªå·±çš„æ•°æ®åº“ï¼Œå¤§å®¶çœ‹ä¸‹é¢çš„å›¾ã€‚ åˆ†å¸ƒå¼ç³»ç»Ÿæ‰€å¸¦æ¥çš„æŠ€æœ¯é—®é¢˜ ä½ çš„ç³»ç»Ÿä¸€æ—¦åˆ†å¸ƒå¼äº†ä¹‹åï¼Œé€šä¿¡ã€ç¼“å­˜ã€æ¶ˆæ¯ã€äº‹åŠ¡ã€é”ã€é…ç½®ã€æ—¥å¿—ã€ç›‘æ§ã€ä¼šè¯ï¼Œç­‰ç­‰å„ç§åŸæ¥å•å—ç³»ç»Ÿåœºæ™¯ä¸‹å¾ˆå®¹æ˜“è§£å†³çš„é—®é¢˜ï¼Œéƒ½ä¼šå˜å¾—å¾ˆå¤æ‚ï¼Œéœ€è¦å¼•å…¥å¤§é‡å¤–éƒ¨çš„æŠ€æœ¯ã€‚ (1)åˆ†å¸ƒå¼æœåŠ¡æ¡†æ¶ä½ å¦‚æœè¦è®©ä¸åŒçš„å­ç³»ç»Ÿæˆ–è€…æœåŠ¡ä¹‹é—´äº’ç›¸é€šä¿¡ï¼Œé¦–å…ˆå¿…é¡»æœ‰ä¸€å¥—åˆ†å¸ƒå¼æœåŠ¡æ¡†æ¶ã€‚ä¹Ÿå°±æ˜¯å„ä¸ªæœåŠ¡å¯ä»¥äº’ç›¸æ„ŸçŸ¥åˆ°å¯¹æ–¹åœ¨å“ªé‡Œï¼Œå¯ä»¥å‘é€è¯·æ±‚è¿‡å»ï¼Œå¯ä»¥é€šè¿‡HTTPæˆ–è€…RPCçš„æ–¹å¼ã€‚åœ¨è¿™é‡Œï¼Œæœ€å¸¸è§çš„æŠ€æœ¯å°±æ˜¯dubboä»¥åŠspring cloudï¼Œå½“ç„¶å¤§å‚ä¸€èˆ¬éƒ½æ˜¯è‡ªå·±æœ‰æœåŠ¡æ¡†æ¶ (2)åˆ†å¸ƒå¼äº‹åŠ¡ä¸€æ—¦ä½ çš„ç³»ç»Ÿæ‹†åˆ†ä¸ºäº†å¤šä¸ªå­ç³»ç»Ÿä¹‹åï¼Œé‚£ä¹ˆä¸€ä¸ªè´¯ç©¿å…¨å±€çš„åˆ†å¸ƒå¼äº‹åŠ¡åº”è¯¥æ€ä¹ˆæ¥å®ç°? è¿™ä¸ªä½ éœ€è¦äº†è§£TCCã€æœ€ç»ˆä¸€è‡´æ€§ã€2PCç­‰åˆ†å¸ƒå¼äº‹åŠ¡çš„å®ç°æ–¹æ¡ˆå’Œå¼€æºæŠ€æœ¯ã€‚ (3)åˆ†å¸ƒå¼é”ä¸åŒçš„ç³»ç»Ÿä¹‹é—´å¦‚æœéœ€è¦åœ¨å…¨å±€åŠ é”è·å–æŸä¸ªèµ„æºçš„é”å®šï¼Œæ­¤æ—¶åº”è¯¥æ€ä¹ˆæ¥åš? æ¯•ç«Ÿå¤§å®¶ä¸æ˜¯åœ¨ä¸€ä¸ªJVMé‡Œäº†ï¼Œä¸å¯èƒ½ç”¨synchronizedæ¥åœ¨å¤šä¸ªå­ç³»ç»Ÿä¹‹é—´å®ç°é” (4)åˆ†å¸ƒå¼ç¼“å­˜å¦‚æœä½ åŸæ¥å°±æ˜¯ä¸ªå•å—ç³»ç»Ÿï¼Œé‚£ä¹ˆä½ å…¶å®æ˜¯å¯ä»¥åœ¨å•ä¸ªJVMé‡Œè¿›è¡Œæœ¬åœ°ç¼“å­˜å°±å¯ä»¥äº†ï¼Œæ¯”å¦‚æä¸€ä¸ªHashMapæ¥ç¼“å­˜ä¸€äº›æ•°æ®ã€‚ä½†æ˜¯ç°åœ¨ä½ æœ‰å¾ˆå¤šä¸ªå­ç³»ç»Ÿï¼Œä»–ä»¬å¦‚æœè¦å…±äº«ä¸€ä¸ªç¼“å­˜ï¼Œä½ åº”è¯¥æ€ä¹ˆåŠ?æ˜¯ä¸æ˜¯éœ€è¦å¼•å…¥Redisç­‰ç¼“å­˜ç³»ç»Ÿ? (5)åˆ†å¸ƒå¼æ¶ˆæ¯ç³»ç»Ÿåœ¨å•å—ç³»ç»Ÿå†…ï¼Œå°±ä¸€ä¸ªJVMè¿›ç¨‹å†…éƒ¨ï¼Œä½ å¯ä»¥ç”¨ç±»ä¼¼LinkedListä¹‹ç±»çš„æ•°æ®ç»“æ„ä½œä¸ºä¸€ä¸ªæœ¬åœ°å†…å­˜é‡Œçš„é˜Ÿåˆ—ã€‚ ä½†æ˜¯å¤šä¸ªå­ç³»ç»Ÿä¹‹é—´è¦è¿›è¡Œæ¶ˆæ¯é˜Ÿåˆ—çš„ä¼ é€’å‘¢?é‚£æ˜¯ä¸æ˜¯è¦å¼•å…¥ç±»ä¼¼RabbitMQä¹‹ç±»çš„åˆ†å¸ƒå¼æ¶ˆæ¯ä¸­é—´ä»¶? (6)åˆ†å¸ƒå¼æœç´¢ç³»ç»Ÿå¦‚æœåœ¨å•å—ç³»ç»Ÿå†…ï¼Œä½ å¯ä»¥æ¯”å¦‚åœ¨æœ¬åœ°å°±åŸºäºLuceneæ¥å¼€å‘ä¸€ä¸ªå…¨æ–‡æ£€ç´¢æ¨¡å—ï¼Œä½†æ˜¯å¦‚æœæ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿä¸‹çš„å¾ˆå¤šå­ç³»ç»Ÿï¼Œä½ è¿˜èƒ½ç›´æ¥åŸºäºLuceneå—? æ˜æ˜¾ä¸è¡Œï¼Œä½ éœ€è¦åœ¨ç³»ç»Ÿé‡Œå¼•å…¥ä¸€ä¸ªå¤–éƒ¨çš„åˆ†å¸ƒå¼æœç´¢ç³»ç»Ÿï¼Œæ¯”å¦‚Elasticsearchã€‚ (7)å…¶ä»–å¾ˆå¤šçš„æŠ€æœ¯æ¯”å¦‚è¯´åˆ†å¸ƒå¼é…ç½®ä¸­å¿ƒã€åˆ†å¸ƒå¼æ—¥å¿—ä¸­å¿ƒã€åˆ†å¸ƒå¼ç›‘æ§å‘Šè­¦ä¸­å¿ƒã€åˆ†å¸ƒå¼ä¼šè¯ï¼Œç­‰ç­‰ï¼Œéƒ½æ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿåœºæ™¯ä¸‹ä½ éœ€è¦ä½¿ç”¨å’Œäº†è§£çš„ä¸€äº›æŠ€æœ¯ã€‚å› ä¸ºæ²¿ç”¨å•å—ç³»ç»Ÿæ—¶ä»£çš„é‚£äº›æŠ€æœ¯å·²ç»ä¸è¡Œäº†ï¼Œæ¯”å¦‚è¯´ä½ å•å—ç³»ç»Ÿçš„æ—¶å€™ï¼Œç›´æ¥åœ¨æœ¬åœ°ç”¨ä¸€ä¸ªpropertiesæ–‡ä»¶å­˜æ”¾è‡ªå·±çš„é…ç½®å³å¯ï¼Œæ—¥å¿—ä¹Ÿå†™åˆ°æœ¬åœ°å³å¯ã€‚","categories":[{"name":"åˆ†å¸ƒå¼","slug":"åˆ†å¸ƒå¼","permalink":"/categories/%E5%88%86%E5%B8%83%E5%BC%8F/"}],"tags":[{"name":"IT","slug":"IT","permalink":"/tags/IT/"},{"name":"æŠ€æœ¯ç¬”è®°","slug":"æŠ€æœ¯ç¬”è®°","permalink":"/tags/%E6%8A%80%E6%9C%AF%E7%AC%94%E8%AE%B0/"},{"name":"åˆ†å¸ƒå¼","slug":"åˆ†å¸ƒå¼","permalink":"/tags/%E5%88%86%E5%B8%83%E5%BC%8F/"}]},{"title":"Kafkaé¢è¯•","slug":"Kafkaé¢è¯•","date":"2019-10-20T11:51:12.000Z","updated":"2019-10-20T08:52:31.449Z","comments":true,"path":"2019/10/20/Kafkaé¢è¯•/","link":"","permalink":"/2019/10/20/Kafka%E9%9D%A2%E8%AF%95/","excerpt":"","text":"KafkaåŸºæœ¬ç†è®ºçŸ¥è¯†è¯·è¯´æ˜ä»€ä¹ˆæ˜¯Apache Kafka?Apache Kafkaæ˜¯ç”±Apacheå¼€å‘çš„ä¸€ç§å‘å¸ƒè®¢é˜…æ¶ˆæ¯ç³»ç»Ÿï¼Œå®ƒæ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼çš„ã€åˆ†åŒºçš„å’Œé‡å¤çš„æ—¥å¿—æœåŠ¡ã€‚ è¯·è¯´æ˜ä»€ä¹ˆæ˜¯ä¼ ç»Ÿçš„æ¶ˆæ¯ä¼ é€’æ–¹æ³•?ä¼ ç»Ÿçš„æ¶ˆæ¯ä¼ é€’æ–¹æ³•åŒ…æ‹¬ä¸¤ç§ï¼š æ’é˜Ÿï¼šåœ¨é˜Ÿåˆ—ä¸­ï¼Œä¸€ç»„ç”¨æˆ·å¯ä»¥ä»æœåŠ¡å™¨ä¸­è¯»å–æ¶ˆæ¯ï¼Œæ¯æ¡æ¶ˆæ¯éƒ½å‘é€ç»™å…¶ä¸­ä¸€ä¸ªäººã€‚ å‘å¸ƒ-è®¢é˜…ï¼šåœ¨è¿™ä¸ªæ¨¡å‹ä¸­ï¼Œæ¶ˆæ¯è¢«å¹¿æ’­ç»™æ‰€æœ‰çš„ç”¨æˆ·ã€‚ Kafka ä¸ä¼ ç»Ÿæ¶ˆæ¯ç³»ç»Ÿä¹‹é—´æœ‰ä¸‰ä¸ªå…³é”®åŒºåˆ« Kafka æŒä¹…åŒ–æ—¥å¿—ï¼Œè¿™äº›æ—¥å¿—å¯ä»¥è¢«é‡å¤è¯»å–å’Œæ— é™æœŸä¿ç•™ Kafka æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿï¼šå®ƒä»¥é›†ç¾¤çš„æ–¹å¼è¿è¡Œï¼Œå¯ä»¥çµæ´»ä¼¸ç¼©ï¼Œåœ¨å†…éƒ¨é€šè¿‡å¤åˆ¶æ•°æ®æå‡å®¹é”™èƒ½åŠ›å’Œé«˜å¯ç”¨æ€§ Kafka æ”¯æŒå®æ—¶çš„æµå¼å¤„ç† åˆ—ä¸¾kafkaçš„åº”ç”¨åœºæ™¯ æ—¥å¿—æ”¶é›†ï¼šä¸€ä¸ªå…¬å¸å¯ä»¥ç”¨Kafkaå¯ä»¥æ”¶é›†å„ç§æœåŠ¡çš„logï¼Œé€šè¿‡kafkaä»¥ç»Ÿä¸€æ¥å£æœåŠ¡çš„æ–¹å¼å¼€æ”¾ç»™å„ç§consumerï¼Œä¾‹å¦‚Hadoopã€Hbaseã€Solrç­‰ æ¶ˆæ¯ç³»ç»Ÿï¼šè§£è€¦å’Œç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…ã€ç¼“å­˜æ¶ˆæ¯ç­‰ ç”¨æˆ·æ´»åŠ¨è·Ÿè¸ªï¼šKafkaç»å¸¸è¢«ç”¨æ¥è®°å½•webç”¨æˆ·æˆ–è€…appç”¨æˆ·çš„å„ç§æ´»åŠ¨ï¼Œå¦‚æµè§ˆç½‘é¡µã€æœç´¢ã€ç‚¹å‡»ç­‰æ´»åŠ¨ï¼Œè¿™äº›æ´»åŠ¨ä¿¡æ¯è¢«å„ä¸ªæœåŠ¡å™¨å‘å¸ƒåˆ°kafkaçš„topicä¸­ï¼Œç„¶åè®¢é˜…è€…é€šè¿‡è®¢é˜…è¿™äº›topicæ¥åšå®æ—¶çš„ç›‘æ§åˆ†æï¼Œæˆ–è€…è£…è½½åˆ°Hadoopã€æ•°æ®ä»“åº“ä¸­åšç¦»çº¿åˆ†æå’ŒæŒ–æ˜ è¿è¥æŒ‡æ ‡ï¼šKafkaä¹Ÿç»å¸¸ç”¨æ¥è®°å½•è¿è¥ç›‘æ§æ•°æ®ã€‚åŒ…æ‹¬æ”¶é›†å„ç§åˆ†å¸ƒå¼åº”ç”¨çš„æ•°æ®ï¼Œç”Ÿäº§å„ç§æ“ä½œçš„é›†ä¸­åé¦ˆï¼Œæ¯”å¦‚æŠ¥è­¦å’ŒæŠ¥å‘Š æµå¼å¤„ç†ï¼šæ¯”å¦‚spark streamingå’Œstorm äº‹ä»¶æº ISRé—®é¢˜ Kafkaä¸­çš„ISRã€ARåˆä»£è¡¨ä»€ä¹ˆï¼ŸISRçš„ä¼¸ç¼©åˆæŒ‡ä»€ä¹ˆ ISR: In-Sync Replicas å‰¯æœ¬åŒæ­¥é˜Ÿåˆ— AR: Assigned Replicas æ‰€æœ‰å‰¯æœ¬ ISRæ˜¯ç”±leaderç»´æŠ¤ï¼Œfollowerä»leaderåŒæ­¥æ•°æ®æœ‰ä¸€äº›å»¶è¿Ÿï¼ˆåŒ…æ‹¬å»¶è¿Ÿæ—¶é—´replica.lag.time.max.mså’Œå»¶è¿Ÿæ¡æ•°replica.lag.max.messagesä¸¤ä¸ªç»´åº¦, å½“å‰æœ€æ–°çš„ç‰ˆæœ¬0.10.xä¸­åªæ”¯æŒreplica.lag.time.max.msè¿™ä¸ªç»´åº¦ï¼‰ï¼Œä»»æ„ä¸€ä¸ªè¶…è¿‡é˜ˆå€¼éƒ½ä¼šæŠŠfollowerå‰”é™¤å‡ºISR, å­˜å…¥OSRï¼ˆOutof-Sync Replicasï¼‰åˆ—è¡¨ï¼Œæ–°åŠ å…¥çš„followerä¹Ÿä¼šå…ˆå­˜æ”¾åœ¨OSRä¸­ã€‚AR=ISR+OSRã€‚ å¦‚æœå‰¯æœ¬åœ¨ISRä¸­åœç•™äº†å¾ˆé•¿æ—¶é—´è¡¨æ˜ä»€ä¹ˆ?å¦‚æœä¸€ä¸ªå‰¯æœ¬åœ¨ISRä¸­ä¿ç•™äº†å¾ˆé•¿ä¸€æ®µæ—¶é—´ï¼Œé‚£ä¹ˆå®ƒå°±è¡¨æ˜ï¼Œè·Ÿè¸ªå™¨æ— æ³•åƒåœ¨leaderæ”¶é›†æ•°æ®é‚£æ ·å¿«é€Ÿåœ°è·å–æ•°æ®ã€‚ è¯·è¯´æ˜å¦‚æœé¦–é€‰çš„å‰¯æœ¬ä¸åœ¨ISRä¸­ä¼šå‘ç”Ÿä»€ä¹ˆ?å¦‚æœé¦–é€‰çš„å‰¯æœ¬ä¸åœ¨ISRä¸­ï¼Œæ§åˆ¶å™¨å°†æ— æ³•å°†leadershipè½¬ç§»åˆ°é¦–é€‰çš„å‰¯æœ¬ã€‚ è§£é‡Šå¦‚ä½•å‡å°‘ISRä¸­çš„æ‰°åŠ¨? brokerä»€ä¹ˆæ—¶å€™ç¦»å¼€ISR?ISRæ˜¯ä¸€ç»„ä¸leaderså®Œå…¨åŒæ­¥çš„æ¶ˆæ¯å‰¯æœ¬ï¼Œä¹Ÿå°±æ˜¯è¯´ISRä¸­åŒ…å«äº†æ‰€æœ‰æäº¤çš„æ¶ˆæ¯ã€‚ISRåº”è¯¥æ€»æ˜¯åŒ…å«æ‰€æœ‰çš„å‰¯æœ¬ï¼Œç›´åˆ°å‡ºç°çœŸæ­£çš„æ•…éšœã€‚å¦‚æœä¸€ä¸ªå‰¯æœ¬ä»leaderä¸­è„±ç¦»å‡ºæ¥ï¼Œå°†ä¼šä»ISRä¸­åˆ é™¤ã€‚ ISRé›†åˆæ˜¯ä»€ä¹ˆï¼Ÿè°ç»´æŠ¤ç€ï¼Ÿå¦‚ä½•ç»´æŠ¤ï¼ŸISRï¼ˆIn-Sync Replicaï¼‰é›†åˆè¡¨ç¤ºçš„æ˜¯ç›®å‰å¯ç”¨å¹¶ä¸”æ¶ˆæ¯é‡ä¸leaderç›¸å·®ä¸å¤šçš„å‰¯æœ¬é›†åˆï¼Œè¿™æ˜¯æ•´ä¸ªå‰¯æœ¬é›†åˆçš„ä¸€ä¸ªå­é›†, ISRé›†åˆçš„å‰¯æœ¬å¿…é¡»æ»¡è¶³ï¼š å‰¯æœ¬æ‰€åœ¨èŠ‚ç‚¹å¿…é¡»ç»´æŒç€ä¸zookeeperçš„è¿æ¥ï¼› å‰¯æœ¬æœ€åä¸€æ¡æ¶ˆæ¯çš„offsetä¸leaderå‰¯æœ¬æœ€åä¸€æ¡æ¶ˆæ¯çš„offsetä¹‹é—´çš„å·®å€¼ä¸èƒ½è¶…å‡ºæŒ‡å®šçš„é˜ˆå€¼ æ¯ä¸ªåˆ†åŒºçš„leaderå‰¯æœ¬éƒ½ä¼šç»´æŠ¤æ­¤åˆ†åŒºçš„ISRé›†åˆï¼Œå†™è¯·æ±‚é¦–å…ˆç”±leaderå‰¯æœ¬å¤„ç†ï¼Œä¹‹åfollowerå‰¯æœ¬ä¼šä»leaderå‰¯æœ¬ä¸Šæ‹‰å–å†™å…¥çš„æ¶ˆæ¯ï¼Œè¿™ä¸ªè¿‡ç¨‹ä¼šæœ‰ä¸€å®šçš„å»¶è¿Ÿï¼Œå¯¼è‡´followerå‰¯æœ¬ä¸­ä¿å­˜çš„æ¶ˆæ¯ç•¥å°‘äºleaderå‰¯æœ¬ï¼Œåªè¦æœªè¶…å‡ºé˜ˆå€¼éƒ½æ˜¯å¯ä»¥å®¹å¿çš„ è¯·è¯´æ˜Kafkaç›¸å¯¹ä¼ ç»ŸæŠ€æœ¯æœ‰ä»€ä¹ˆä¼˜åŠ¿? å¿«é€Ÿï¼šå•ä¸€çš„Kafkaä»£ç†å¯ä»¥å¤„ç†æˆåƒä¸Šä¸‡çš„å®¢æˆ·ç«¯ï¼Œæ¯ç§’å¤„ç†æ•°å…†å­—èŠ‚çš„è¯»å†™æ“ä½œã€‚ å¯ä¼¸ç¼©ï¼šåœ¨ä¸€ç»„æœºå™¨ä¸Šå¯¹æ•°æ®è¿›è¡Œåˆ†åŒºå’Œç®€åŒ–ï¼Œä»¥æ”¯æŒæ›´å¤§çš„æ•°æ® æŒä¹…(å®¹é”™æ€§é«˜)ï¼šæ¶ˆæ¯æ˜¯æŒä¹…æ€§çš„ï¼Œå¹¶åœ¨é›†ç¾¤ä¸­è¿›è¡Œå¤åˆ¶ï¼Œä»¥é˜²æ­¢æ•°æ®ä¸¢å¤±ã€‚ è®¾è®¡ï¼šå®ƒæä¾›äº†å®¹é”™ä¿è¯å’ŒæŒä¹…æ€§ åœ¨Kafkaä¸­brokerçš„æ„ä¹‰æ˜¯ä»€ä¹ˆ?æ¥æ”¶Producerå‘è¿‡æ¥çš„æ•°æ®ï¼Œå¹¶ä¸”å°†å®ƒæŒä¹…åŒ–ï¼ŒåŒæ—¶æä¾›ç»™Consumerå»è®¢é˜…ç»„æˆKafkaé›†ç¾¤èŠ‚ç‚¹ï¼Œä¹‹é—´æ²¡æœ‰ä¸»ä»å…³ç³»ï¼Œä¾èµ–ZooKeeperæ¥åè°ƒï¼Œbrokerè´Ÿè´£æ¶ˆæ¯çš„è¯»å–å’Œå­˜å‚¨ï¼Œä¸€ä¸ªbrokerå¯ä»¥ç®¡ç†å¤šä¸ªpartition ä»€ä¹ˆæ˜¯brokerï¼Ÿä½œç”¨æ˜¯ä»€ä¹ˆ? ä¸€ä¸ªå•ç‹¬çš„kafka serverå°±æ˜¯ä¸€ä¸ªbrokerï¼Œbrokerä¸»è¦å·¥ä½œå°±æ˜¯æ¥æ”¶ç”Ÿäº§è€…å‘è¿‡æ¥çš„æ¶ˆæ¯ï¼Œåˆ†é…offsetï¼Œä¹‹åä¿å­˜åˆ°ç£ç›˜ä¸­ã€‚åŒæ—¶ï¼Œæ¥æ”¶æ¶ˆè´¹è€…ã€å…¶ä»–brokerçš„è¯·æ±‚ï¼Œæ ¹æ®è¯·æ±‚ç±»å‹è¿›è¡Œç›¸åº”çš„å¤„ç†å¹¶è¿”å›å“åº”ï¼Œåœ¨ä¸€èˆ¬çš„ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œä¸€ä¸ªbrokerç‹¬å ä¸€å°ç‰©ç†æœåŠ¡å™¨ KafkaæœåŠ¡å™¨èƒ½æ¥æ”¶åˆ°çš„æœ€å¤§ä¿¡æ¯æ˜¯å¤šå°‘?KafkaæœåŠ¡å™¨å¯ä»¥æ¥æ”¶åˆ°çš„æ¶ˆæ¯çš„æœ€å¤§å¤§å°æ˜¯1000000å­—èŠ‚ã€‚1MB=1000kb è§£é‡ŠKafkaçš„Zookeeperæ˜¯ä»€ä¹ˆ?æˆ‘ä»¬å¯ä»¥åœ¨æ²¡æœ‰Zookeeperçš„æƒ…å†µä¸‹ä½¿ç”¨Kafkaå—?Zookeeperæ˜¯ä¸€ä¸ªå¼€æ”¾æºç çš„ã€é«˜æ€§èƒ½çš„åè°ƒæœåŠ¡ï¼Œå®ƒç”¨äºKafkaçš„åˆ†å¸ƒå¼åº”ç”¨ã€‚ä½œç”¨ï¼šåè°ƒKafka Brokerï¼Œå­˜å‚¨åŸæ•°æ®ï¼š==consumerçš„offset+brokerä¿¡æ¯+topicä¿¡æ¯+partitionä¸ªæ•°ä¿¡æ¯==ã€‚ä¸ï¼Œä¸å¯èƒ½è¶Šè¿‡Zookeeperï¼Œç›´æ¥è”ç³»Kafka brokerã€‚ä¸€æ—¦Zookeeperåœæ­¢å·¥ä½œï¼Œå®ƒå°±ä¸èƒ½æœåŠ¡å®¢æˆ·ç«¯è¯·æ±‚ã€‚ Zookeeperä¸»è¦ç”¨äºåœ¨é›†ç¾¤ä¸­ä¸åŒèŠ‚ç‚¹ä¹‹é—´è¿›è¡Œé€šä¿¡ åœ¨Kafkaä¸­ï¼Œå®ƒè¢«ç”¨äºæäº¤åç§»é‡ï¼Œå› æ­¤å¦‚æœèŠ‚ç‚¹åœ¨ä»»ä½•æƒ…å†µä¸‹éƒ½å¤±è´¥äº†ï¼Œå®ƒéƒ½å¯ä»¥ä»ä¹‹å‰æäº¤çš„åç§»é‡ä¸­è·å– é™¤æ­¤ä¹‹å¤–ï¼Œå®ƒè¿˜æ‰§è¡Œå…¶ä»–æ´»åŠ¨ï¼Œå¦‚: ==leaderæ£€æµ‹ã€åˆ†å¸ƒå¼åŒæ­¥ã€é…ç½®ç®¡ç†ã€è¯†åˆ«æ–°èŠ‚ç‚¹ä½•æ—¶ç¦»å¼€æˆ–è¿æ¥ã€é›†ç¾¤ã€èŠ‚ç‚¹å®æ—¶çŠ¶æ€ç­‰ç­‰ã€‚== è§£é‡ŠKafkaçš„ç”¨æˆ·å¦‚ä½•æ¶ˆè´¹ä¿¡æ¯?åœ¨Kafkaä¸­ä¼ é€’æ¶ˆæ¯æ˜¯é€šè¿‡ä½¿ç”¨sendfileã€é›¶æ‹·è´ã€‘ APIå®Œæˆçš„ã€‚å®ƒæ”¯æŒå°†å­—èŠ‚ä»å¥—æ¥å£è½¬ç§»åˆ°ç£ç›˜ï¼Œé€šè¿‡å†…æ ¸ç©ºé—´ä¿å­˜å‰¯æœ¬ï¼Œå¹¶åœ¨å†…æ ¸ç”¨æˆ·ä¹‹é—´è°ƒç”¨å†…æ ¸ã€‚é›¶æ‹·è´ï¼šç”¨æˆ·å‘å†…æ ¸å»å‘é€ä¸€ä¸ªå‘½ä»¤ï¼Œæˆ‘è¦æ“ä½œé‚£äº›æ•°æ®ï¼Œç„¶åç›´æ¥ä»ç£ç›˜è½¬æˆSocket Bufferï¼Œå†ä»Socket Bufferåˆ°ç½‘å¡Bufferï¼Œå†ä¼ å‡ºå»ã€å°‘äº†ä¸¤æ¬¡çš„copyã€‘ è§£é‡Šå¦‚ä½•æé«˜è¿œç¨‹ç”¨æˆ·çš„ååé‡?å¦‚æœç”¨æˆ·ä½äºä¸brokerä¸åŒçš„æ•°æ®ä¸­å¿ƒï¼Œåˆ™å¯èƒ½éœ€è¦è°ƒä¼˜å¥—æ¥å£ç¼“å†²åŒºå¤§å°ï¼Œä»¥å¯¹é•¿ç½‘ç»œå»¶è¿Ÿè¿›è¡Œæ‘Šé”€ã€‚ è§£é‡Šä¸€ä¸‹ï¼Œåœ¨æ•°æ®åˆ¶ä½œè¿‡ç¨‹ä¸­ï¼Œä½ å¦‚ä½•èƒ½ä»Kafkaå¾—åˆ°å‡†ç¡®çš„ä¿¡æ¯?åœ¨æ•°æ®ä¸­ï¼Œä¸ºäº†ç²¾ç¡®åœ°è·å¾—Kafkaçš„æ¶ˆæ¯ï¼Œä½ å¿…é¡»éµå¾ªä¸¤ä»¶äº‹: åœ¨æ•°æ®æ¶ˆè€—æœŸé—´é¿å…é‡å¤ åœ¨æ•°æ®ç”Ÿäº§è¿‡ç¨‹ä¸­é¿å…é‡å¤ è¿™é‡Œæœ‰ä¸¤ç§æ–¹æ³•ï¼Œå¯ä»¥åœ¨æ•°æ®ç”Ÿæˆæ—¶å‡†ç¡®åœ°è·å¾—ä¸€ä¸ªè¯­ä¹‰ æ¯ä¸ªåˆ†åŒºä½¿ç”¨ä¸€ä¸ªå•ç‹¬çš„å†™å…¥å™¨ï¼Œæ¯å½“ä½ å‘ç°ä¸€ä¸ªç½‘ç»œé”™è¯¯ï¼Œæ£€æŸ¥è¯¥åˆ†åŒºä¸­çš„æœ€åä¸€æ¡æ¶ˆæ¯ï¼Œä»¥æŸ¥çœ‹æ‚¨çš„æœ€åä¸€æ¬¡å†™å…¥æ˜¯å¦æˆåŠŸ åœ¨æ¶ˆæ¯ä¸­åŒ…å«ä¸€ä¸ªä¸»é”®(UUIDæˆ–å…¶ä»–)ï¼Œå¹¶åœ¨ç”¨æˆ·ä¸­è¿›è¡Œåå¤åˆ¶ Kafkaä¸ºä»€ä¹ˆéœ€è¦å¤åˆ¶?==Kafkaçš„æ•°æ®å¤åˆ¶ç¡®ä¿äº†ä»»ä½•å·²å‘å¸ƒçš„æ¶ˆæ¯ä¸ä¼šä¸¢å¤±ï¼Œå¹¶ä¸”å¯ä»¥åœ¨æœºå™¨é”™è¯¯ã€ç¨‹åºé”™è¯¯æˆ–æ›´å¸¸è§äº›çš„è½¯ä»¶å‡çº§ä¸­ä½¿ç”¨ã€‚== æœ‰å¯èƒ½åœ¨ç”Ÿäº§åå‘ç”Ÿæ¶ˆæ¯åç§»å—?åœ¨å¤§å¤šæ•°é˜Ÿåˆ—ç³»ç»Ÿä¸­ï¼Œä½œä¸ºç”Ÿäº§è€…çš„ç±»æ— æ³•åšåˆ°è¿™ä¸€ç‚¹ï¼Œå®ƒçš„ä½œç”¨æ˜¯è§¦å‘å¹¶å¿˜è®°æ¶ˆæ¯ã€‚ brokerå°†å®Œæˆå‰©ä¸‹çš„å·¥ä½œï¼Œæ¯”å¦‚ä½¿ç”¨idè¿›è¡Œé€‚å½“çš„å…ƒæ•°æ®å¤„ç†ã€åç§»é‡ç­‰ã€‚ä½œä¸ºæ¶ˆæ¯çš„ç”¨æˆ·ï¼Œä½ å¯ä»¥ä»Kafka brokerä¸­è·å¾—è¡¥å¿ã€‚å¦‚æœä½ æ³¨è§†SimpleConsumerç±»ï¼Œä½ ä¼šæ³¨æ„åˆ°å®ƒä¼šè·å–åŒ…æ‹¬åç§»é‡ä½œä¸ºåˆ—è¡¨çš„MultiFetchResponseå¯¹è±¡ã€‚æ­¤å¤–ï¼Œå½“ä½ å¯¹Kafkaæ¶ˆæ¯è¿›è¡Œè¿­ä»£æ—¶ï¼Œä½ ä¼šæ‹¥æœ‰åŒ…æ‹¬åç§»é‡å’Œæ¶ˆæ¯å‘é€çš„MessageAndOffsetå¯¹è±¡ã€‚ kafkaä¸»è¦ç‰¹å¾ kafkaå…·æœ‰è¿‘ä¹å®æ—¶æ€§çš„æ¶ˆæ¯å¤„ç†èƒ½åŠ›ï¼Œé¢å¯¹æµ·é‡æ•°æ®ï¼Œé«˜æ•ˆçš„å­˜å‚¨æ¶ˆæ¯å’ŒæŸ¥è¯¢æ¶ˆæ¯ã€‚kafkaå°†æ¶ˆæ¯ä¿å­˜åœ¨ç£ç›˜ä¸­ï¼Œä»¥é¡ºåºè¯»å†™çš„æ–¹å¼è®¿é—®ç£ç›˜ï¼Œä»è€Œé¿å…äº†éšæœºè¯»å†™ç£ç›˜å¯¼è‡´çš„æ€§èƒ½ç“¶é¢ˆ kafkaæ”¯æŒæ‰¹é‡è¯»å†™æ¶ˆæ¯ï¼Œå¹¶ä¸”å¯¹æ¶ˆæ¯æ‰¹é‡å‹ç¼©ï¼Œæé«˜äº†ç½‘ç»œåˆ©ç”¨ç‡å’Œå‹ç¼©æ•ˆç‡ kafkaæ”¯æŒæ¶ˆæ¯åˆ†åŒºï¼Œæ¯ä¸ªåˆ†åŒºä¸­çš„æ¶ˆæ¯ä¿è¯é¡ºåºä¼ è¾“ï¼Œè€Œåˆ†åŒºä¹‹é—´å¯ä»¥å¹¶å‘æ“ä½œï¼Œæé«˜äº†kafkaçš„å¹¶å‘èƒ½åŠ› kafkaæ”¯æŒåœ¨çº¿å¢åŠ åˆ†åŒºï¼Œæ”¯æŒåœ¨çº¿æ°´å¹³æ‰©å±• kafkaæ”¯æŒä¸ºæ¯ä¸ªåˆ†åŒºåˆ›å»ºå¤šä¸ªå‰¯æœ¬ï¼Œå…¶ä¸­åªä¼šæœ‰ä¸€ä¸ªleaderå‰¯æœ¬è´Ÿè´£è¯»å†™ï¼Œå…¶ä»–å‰¯æœ¬åªè´Ÿè´£ä¸leaderå‰¯æœ¬åŒæ­¥ï¼Œè¿™ç§æ–¹å¼æé«˜äº†æ•°æ®çš„å®¹ç¾èƒ½åŠ›ï¼Œkafkaä¼šå°†leaderå‰¯æœ¬å‡åŒ€çš„åˆ†å¸ƒåœ¨é›†ç¾¤ä¸­çš„æœåŠ¡å™¨ä¸Šï¼Œå®ç°æ€§èƒ½æœ€å¤§åŒ– kafkaä¸»é¢˜åˆ†åŒºçš„ä½œç”¨?kafkaçš„æ¯ä¸ªtopicéƒ½å¯ä»¥åˆ†ä¸ºå¤šä¸ªpartitionï¼Œæ¯ä¸ªpartitionéƒ½æœ‰å¤šä¸ªreplicaï¼ˆå‰¯æœ¬ï¼‰ï¼Œæ¯ä¸ªåˆ†åŒºä¸­çš„æ¶ˆæ¯æ˜¯ä¸åŒçš„ï¼Œæé«˜äº†å¹¶å‘è¯»å†™çš„èƒ½åŠ›ï¼Œè€ŒåŒä¸€åˆ†åŒºçš„ä¸åŒå‰¯æœ¬ä¸­ä¿å­˜çš„æ˜¯ç›¸åŒçš„æ¶ˆæ¯ï¼Œå‰¯æœ¬ä¹‹é—´æ˜¯ä¸€ä¸»å¤šä»å…³ç³»ï¼Œå…¶ä¸­leaderå‰¯æœ¬å¤„ç†è¯»å†™è¯·æ±‚ï¼Œfollowerå‰¯æœ¬åªä¸leaderå‰¯æœ¬è¿›è¡Œæ¶ˆæ¯åŒæ­¥ï¼Œå½“leaderå‰¯æœ¬å‡ºç°æ•…éšœæ—¶ï¼Œåˆ™ä»followerå‰¯æœ¬ä¸­é‡æ–°é€‰ä¸¾leaderå‰¯æœ¬å¯¹å¤–æä¾›æœåŠ¡ã€‚è¿™æ ·ï¼Œé€šè¿‡æé«˜åˆ†åŒºçš„æ•°é‡ï¼Œå°±å¯ä»¥å®ç°æ°´å¹³æ‰©å±•ï¼Œé€šè¿‡æé«˜å‰¯æœ¬æ•°é‡ï¼Œå°±å¯ä»¥æé«˜å®¹ç¾èƒ½åŠ› consumeræ°´å¹³æ‰©å±•å¦‚ä½•å®ç°?kafkaæ”¯æŒconsumeræ°´å¹³æ‰©å±•ï¼Œå¯ä»¥è®©å¤šä¸ªconsumeråŠ å…¥ä¸€ä¸ªconsumer groupï¼Œåœ¨ä¸€ä¸ªconsumer groupä¸­ï¼Œæ¯ä¸ªåˆ†åŒºåªèƒ½åˆ†é…ç»™ä¸€ä¸ªconsumerï¼Œå½“kafkaæœåŠ¡ç«¯å¢åŠ åˆ†åŒºæ•°é‡è¿›è¡Œæ°´å¹³æ‰©å±•åï¼Œå¯ä»¥å‘consumer groupä¸­å¢åŠ æ–°çš„consumeræ¥æé«˜æ•´ä¸ªconsumer groupçš„æ¶ˆè´¹èƒ½åŠ›ï¼Œå½“consumer group ä¸­çš„ä¸€ä¸ªconsumerå‡ºç°æ•…éšœä¸‹çº¿æ—¶ï¼Œä¼šé€šè¿‡rebalanceæ“ä½œä¸‹çº¿çš„consumerï¼Œå®ƒè´Ÿè´£å¤„ç†çš„åˆ†åŒºå°†åˆ†é…ç»™å…¶ä»–consumer æ¶ˆæ¯çš„é¡ºåºkafkaä¿è¯ä¸€ä¸ªpartitionå†…æ¶ˆæ¯æ˜¯æœ‰åºçš„ï¼Œä½†æ˜¯å¹¶ä¸ä¿è¯å¤šä¸ªpartitionä¹‹é—´çš„æ•°æ®æœ‰é¡ºåºï¼Œæ¯ä¸ªtopicå¯ä»¥åˆ’åˆ†æˆå¤šä¸ªåˆ†åŒºï¼ŒåŒä¸€ä¸ªtopicä¸‹çš„ä¸åŒåˆ†åŒºåŒ…å«çš„æ¶ˆæ¯æ˜¯ä¸åŒçš„ï¼Œæ¯ä¸ªæ¶ˆæ¯åœ¨è¢«æ·»åŠ åˆ°åˆ†åŒºæ—¶ï¼Œéƒ½ä¼šè¢«åˆ†é…ä¸€ä¸ªoffsetï¼Œå®ƒæ˜¯æ­¤æ¶ˆæ¯åœ¨åˆ†åŒºä¸­çš„å”¯ä¸€ç¼–å·ï¼Œkafkaé€šè¿‡offsetä¿è¯æ¶ˆæ¯åœ¨åˆ†åŒºå†…çš„é¡ºåºï¼Œoffseté¡ºåºä¸è·¨åˆ†åŒºï¼Œå³kafkaåªä¿è¯åœ¨åŒä¸€ä¸ªåˆ†åŒºå†…çš„æ¶ˆæ¯æ˜¯æœ‰åºçš„ ä¸ºäº†é¿å…ç£ç›˜è¢«å æ»¡ï¼Œkafkaä¼šå‘¨æœŸæ€§çš„åˆ é™¤é™ˆæ—§çš„æ¶ˆæ¯ï¼Œåˆ é™¤ç­–ç•¥æ˜¯ä»€ä¹ˆ? ä¸€ç§æ˜¯æ ¹æ®æ¶ˆæ¯ä¿ç•™çš„æ—¶é—´ ä¸€ç§æ˜¯æ ¹æ®topicå­˜å‚¨çš„æ•°æ®å¤§å° ä»€ä¹ˆæ˜¯æ—¥å¿—å‹ç¼©?åœ¨å¾ˆå¤šåœºæ™¯ä¸­ï¼Œæ¶ˆæ¯çš„keyä¸valueä¹‹é—´çš„å¯¹åº”å…³ç³»æ˜¯ä¸æ–­å˜åŒ–çš„ï¼Œæ¶ˆè´¹è€…åªå…³å¿ƒkeyå¯¹åº”çš„æœ€æ–°valueï¼Œæ­¤æ—¶ï¼Œå¯ä»¥å¼€å¯kafkaçš„æ—¥å¿—å‹ç¼©åŠŸèƒ½ï¼Œkafkaä¼šåœ¨åå°å¯åŠ¨ä¸€ä¸ªçº¿ç¨‹ï¼Œå®šæœŸå°†ç›¸åŒkeyçš„æ¶ˆæ¯è¿›è¡Œåˆå¹¶ï¼Œåªä¿ç•™æœ€æ–°çš„valueå€¼ åŒä¸€åˆ†åŒºçš„å¤šä¸ªå‰¯æœ¬åŒ…æ‹¬çš„æ¶ˆæ¯æ˜¯å¦ä¸€è‡´ï¼Ÿæ¯ä¸ªå‰¯æœ¬ä¸­åŒ…å«çš„æ¶ˆæ¯æ˜¯ä¸€æ ·çš„ï¼Œä½†æ˜¯å†åŒä¸€æ—¶åˆ»ï¼Œå‰¯æœ¬ä¹‹é—´å¹¶ä¸æ˜¯å®Œå…¨ä¸€æ ·çš„ Kafkaçš„è®¾è®¡æ—¶ä»€ä¹ˆæ ·çš„å‘¢ï¼Ÿ Kafkaå°†æ¶ˆæ¯ä»¥topicä¸ºå•ä½è¿›è¡Œå½’çº³ å°†å‘Kafka topicå‘å¸ƒæ¶ˆæ¯çš„ç¨‹åºæˆä¸ºproducer å°†é¢„è®¢topicså¹¶æ¶ˆè´¹æ¶ˆæ¯çš„ç¨‹åºæˆä¸ºconsumer Kafkaä»¥é›†ç¾¤çš„æ–¹å¼è¿è¡Œï¼Œå¯ä»¥ç”±ä¸€ä¸ªæˆ–å¤šä¸ªæœåŠ¡ç»„æˆï¼Œæ¯ä¸ªæœåŠ¡å«åšä¸€ä¸ªbroker producersé€šè¿‡ç½‘ç»œå°†æ¶ˆæ¯å‘é€åˆ°Kafkaé›†ç¾¤ï¼Œé›†ç¾¤å‘æ¶ˆè´¹è€…æä¾›æ¶ˆæ¯ æ•°æ®ä¼ è¾“çš„äº‹ç‰©å®šä¹‰æœ‰å“ªä¸‰ç§ï¼Ÿæ•°æ®ä¼ è¾“çš„äº‹åŠ¡å®šä¹‰é€šå¸¸æœ‰ä»¥ä¸‹ä¸‰ç§çº§åˆ«ï¼šï¼ˆ1ï¼‰æœ€å¤šä¸€æ¬¡ï¼šæ¶ˆæ¯ä¸ä¼šè¢«é‡å¤å‘é€ï¼Œæœ€å¤šè¢«ä¼ è¾“ä¸€æ¬¡ï¼Œä½†ä¹Ÿæœ‰å¯èƒ½ä¸€æ¬¡ä¸ä¼ è¾“ï¼ˆ2ï¼‰æœ€å°‘ä¸€æ¬¡ï¼šæ¶ˆæ¯ä¸ä¼šè¢«æ¼å‘é€ï¼Œæœ€å°‘è¢«ä¼ è¾“ä¸€æ¬¡ï¼Œä½†ä¹Ÿæœ‰å¯èƒ½è¢«é‡å¤ä¼ è¾“.ï¼ˆ3ï¼‰ç²¾ç¡®çš„ä¸€æ¬¡ï¼ˆExactly onceï¼‰ï¼šä¸ä¼šæ¼ä¼ è¾“ä¹Ÿä¸ä¼šé‡å¤ä¼ è¾“,æ¯ä¸ªæ¶ˆæ¯éƒ½ä¼ è¾“è¢«ä¸€æ¬¡è€Œä¸”ä»…ä»…è¢«ä¼ è¾“ä¸€æ¬¡ï¼Œè¿™æ˜¯å¤§å®¶æ‰€æœŸæœ›çš„ Kafkaåˆ¤æ–­ä¸€ä¸ªèŠ‚ç‚¹æ˜¯å¦è¿˜æ´»ç€æœ‰é‚£ä¸¤ä¸ªæ¡ä»¶ï¼Ÿå¿ƒè·³æœºåˆ¶,å»¶æ—¶é™åˆ¶ èŠ‚ç‚¹å¿…é¡»å¯ä»¥ç»´æŠ¤å’ŒZooKeeperçš„è¿æ¥ï¼ŒZookeeperé€šè¿‡å¿ƒè·³æœºåˆ¶æ£€æŸ¥æ¯ä¸ªèŠ‚ç‚¹çš„è¿æ¥ å¦‚æœèŠ‚ç‚¹æ˜¯ä¸ªfollower,ä»–å¿…é¡»èƒ½åŠæ—¶çš„åŒæ­¥leaderçš„å†™æ“ä½œï¼Œå»¶æ—¶ä¸èƒ½å¤ªä¹… produceræ˜¯å¦ç›´æ¥å°†æ•°æ®å‘é€åˆ°brokerçš„leader(ä¸»èŠ‚ç‚¹)ï¼Ÿå¯ä»¥producerç›´æ¥å°†æ•°æ®å‘é€åˆ°brokerçš„leader(ä¸»èŠ‚ç‚¹)ï¼Œä¸éœ€è¦åœ¨å¤šä¸ªèŠ‚ç‚¹è¿›è¡Œåˆ†å‘ï¼Œä¸ºäº†å¸®åŠ©produceråšåˆ°è¿™ç‚¹ï¼Œæ‰€æœ‰çš„KafkaèŠ‚ç‚¹éƒ½å¯ä»¥åŠæ—¶çš„å‘ŠçŸ¥ï¼šå“ªäº›èŠ‚ç‚¹æ˜¯æ´»åŠ¨çš„ï¼Œç›®æ ‡topicç›®æ ‡åˆ†åŒºçš„leaderåœ¨å“ªã€‚è¿™æ ·producerå°±å¯ä»¥ç›´æ¥å°†æ¶ˆæ¯å‘é€åˆ°ç›®çš„åœ°äº† Kafka consumeræ˜¯å¦å¯ä»¥æ¶ˆè´¹æŒ‡å®šåˆ†åŒºæ¶ˆæ¯ï¼ŸKafka consumeræ¶ˆè´¹æ¶ˆæ¯æ—¶ï¼Œå‘brokerå‘å‡ºâ€fetchâ€è¯·æ±‚å»æ¶ˆè´¹ç‰¹å®šåˆ†åŒºçš„æ¶ˆæ¯ï¼ŒconsumeræŒ‡å®šæ¶ˆæ¯åœ¨æ—¥å¿—ä¸­çš„åç§»é‡ï¼ˆoffsetï¼‰ï¼Œå°±å¯ä»¥æ¶ˆè´¹ä»è¿™ä¸ªä½ç½®å¼€å§‹çš„æ¶ˆæ¯ï¼Œcustomeræ‹¥æœ‰äº†offsetçš„æ§åˆ¶æƒï¼Œå¯ä»¥å‘åå›æ»šå»é‡æ–°æ¶ˆè´¹ä¹‹å‰çš„æ¶ˆæ¯ï¼Œè¿™æ˜¯å¾ˆæœ‰æ„ä¹‰çš„ Kafkaæ¶ˆæ¯æ˜¯é‡‡ç”¨Pullæ¨¡å¼ï¼Œè¿˜æ˜¯Pushæ¨¡å¼ï¼Ÿkafkaä½¿ç”¨äº†pullæ¨¡å¼, æ ¹æ®è®¢é˜…è€…çš„æ¶ˆè´¹èƒ½åŠ›è¿›è¡Œæ‹‰å–æ•°æ®,Kafkaæœ€åˆè€ƒè™‘çš„é—®é¢˜æ˜¯ï¼Œcustomeråº”è¯¥ä»brokersæ‹‰å–æ¶ˆæ¯è¿˜æ˜¯brokerså°†æ¶ˆæ¯æ¨é€åˆ°consumerï¼Œä¹Ÿå°±æ˜¯pullè¿˜pushã€‚åœ¨è¿™æ–¹é¢ï¼ŒKafkaéµå¾ªäº†ä¸€ç§å¤§éƒ¨åˆ†æ¶ˆæ¯ç³»ç»Ÿå…±åŒçš„ä¼ ç»Ÿçš„è®¾è®¡ï¼šproducerå°†æ¶ˆæ¯æ¨é€åˆ°brokerï¼Œconsumerä»brokeræ‹‰å–æ¶ˆæ¯ä¸€äº›æ¶ˆæ¯ç³»ç»Ÿæ¯”å¦‚Scribeå’ŒApache Flumeé‡‡ç”¨äº†pushæ¨¡å¼ï¼Œå°†æ¶ˆæ¯æ¨é€åˆ°ä¸‹æ¸¸çš„consumerã€‚è¿™æ ·åšæœ‰å¥½å¤„ä¹Ÿæœ‰åå¤„ï¼šç”±brokerå†³å®šæ¶ˆæ¯æ¨é€çš„é€Ÿç‡ï¼Œå¯¹äºä¸åŒæ¶ˆè´¹é€Ÿç‡çš„consumerå°±ä¸å¤ªå¥½å¤„ç†äº†ã€‚æ¶ˆæ¯ç³»ç»Ÿéƒ½è‡´åŠ›äºè®©consumerä»¥æœ€å¤§çš„é€Ÿç‡æœ€å¿«é€Ÿçš„æ¶ˆè´¹æ¶ˆæ¯ï¼Œä½†ä¸å¹¸çš„æ˜¯ï¼Œpushæ¨¡å¼ä¸‹ï¼Œå½“brokeræ¨é€çš„é€Ÿç‡è¿œå¤§äºconsumeræ¶ˆè´¹çš„é€Ÿç‡æ—¶ï¼Œconsumerææ€•å°±è¦å´©æºƒäº†ã€‚æœ€ç»ˆKafkaè¿˜æ˜¯é€‰å–äº†ä¼ ç»Ÿçš„pullæ¨¡å¼Pullæ¨¡å¼çš„å¦å¤–ä¸€ä¸ªå¥½å¤„æ˜¯consumerå¯ä»¥è‡ªä¸»å†³å®šæ˜¯å¦æ‰¹é‡çš„ä»brokeræ‹‰å–æ•°æ®ã€‚Pushæ¨¡å¼å¿…é¡»åœ¨ä¸çŸ¥é“ä¸‹æ¸¸consumeræ¶ˆè´¹èƒ½åŠ›å’Œæ¶ˆè´¹ç­–ç•¥çš„æƒ…å†µä¸‹å†³å®šæ˜¯ç«‹å³æ¨é€æ¯æ¡æ¶ˆæ¯è¿˜æ˜¯ç¼“å­˜ä¹‹åæ‰¹é‡æ¨é€ã€‚å¦‚æœä¸ºäº†é¿å…consumerå´©æºƒè€Œé‡‡ç”¨è¾ƒä½çš„æ¨é€é€Ÿç‡ï¼Œå°†å¯èƒ½å¯¼è‡´ä¸€æ¬¡åªæ¨é€è¾ƒå°‘çš„æ¶ˆæ¯è€Œé€ æˆæµªè´¹ã€‚Pullæ¨¡å¼ä¸‹ï¼Œconsumerå°±å¯ä»¥æ ¹æ®è‡ªå·±çš„æ¶ˆè´¹èƒ½åŠ›å»å†³å®šè¿™äº›ç­–ç•¥Pullæœ‰ä¸ªç¼ºç‚¹æ˜¯ï¼Œå¦‚æœbrokeræ²¡æœ‰å¯ä¾›æ¶ˆè´¹çš„æ¶ˆæ¯ï¼Œå°†å¯¼è‡´consumerä¸æ–­åœ¨å¾ªç¯ä¸­è½®è¯¢ï¼Œç›´åˆ°æ–°æ¶ˆæ¯åˆ°tè¾¾ã€‚ä¸ºäº†é¿å…è¿™ç‚¹ï¼ŒKafkaæœ‰ä¸ªå‚æ•°å¯ä»¥è®©consumeré˜»å¡çŸ¥é“æ–°æ¶ˆæ¯åˆ°è¾¾(å½“ç„¶ä¹Ÿå¯ä»¥é˜»å¡çŸ¥é“æ¶ˆæ¯çš„æ•°é‡è¾¾åˆ°æŸä¸ªç‰¹å®šçš„é‡è¿™æ ·å°±å¯ä»¥æ‰¹é‡å‘ Kafkaå­˜å‚¨åœ¨ç¡¬ç›˜ä¸Šçš„æ¶ˆæ¯æ ¼å¼æ˜¯ä»€ä¹ˆï¼Ÿ==ç‰ˆæœ¬å·(1ä¸ªå­—èŠ‚)+æ ¡éªŒç (4ä¸ªå­—èŠ‚)+æ¶ˆæ¯(nä¸ªå­—èŠ‚)== æ¶ˆæ¯ç”±ä¸€ä¸ªå›ºå®šé•¿åº¦çš„å¤´éƒ¨å’Œå¯å˜é•¿åº¦çš„å­—èŠ‚æ•°ç»„ç»„æˆã€‚å¤´éƒ¨åŒ…å«äº†ä¸€ä¸ªç‰ˆæœ¬å·å’ŒCRC32æ ¡éªŒç ã€‚ 1234æ¶ˆæ¯é•¿åº¦: 4 bytes (value: 1+4+n)ç‰ˆæœ¬å·: 1 byteCRC32æ ¡éªŒç : 4 byteså…·ä½“çš„æ¶ˆæ¯: n bytes Kafkaé«˜æ•ˆæ–‡ä»¶å­˜å‚¨è®¾è®¡ç‰¹ç‚¹ï¼š KafkaæŠŠtopicä¸­ä¸€ä¸ªpartitionå¤§æ–‡ä»¶åˆ†æˆå¤šä¸ªå°æ–‡ä»¶æ®µï¼Œé€šè¿‡å¤šä¸ªå°æ–‡ä»¶æ®µï¼Œå°±å®¹æ˜“å®šæœŸæ¸…é™¤æˆ–åˆ é™¤å·²ç»æ¶ˆè´¹å®Œæ–‡ä»¶ï¼Œå‡å°‘ç£ç›˜å ç”¨ã€‚ é€šè¿‡ç´¢å¼•ä¿¡æ¯å¯ä»¥å¿«é€Ÿå®šä½messageå’Œç¡®å®šresponseçš„æœ€å¤§å¤§å°ã€‚ é€šè¿‡indexå…ƒæ•°æ®å…¨éƒ¨æ˜ å°„åˆ°memoryï¼Œå¯ä»¥é¿å…segment fileçš„IOç£ç›˜æ“ä½œã€‚ é€šè¿‡ç´¢å¼•æ–‡ä»¶ç¨€ç–å­˜å‚¨ï¼Œå¯ä»¥å¤§å¹…é™ä½indexæ–‡ä»¶å…ƒæ•°æ®å ç”¨ç©ºé—´å¤§å°ã€‚ Kafkaåˆ›å»ºTopicæ—¶å¦‚ä½•å°†åˆ†åŒºæ”¾ç½®åˆ°ä¸åŒçš„Brokerä¸­ å‰¯æœ¬å› å­ä¸èƒ½å¤§äº Broker çš„ä¸ªæ•°ï¼› ç¬¬ä¸€ä¸ªåˆ†åŒºï¼ˆç¼–å·ä¸º0ï¼‰çš„ç¬¬ä¸€ä¸ªå‰¯æœ¬æ”¾ç½®ä½ç½®æ˜¯éšæœºä» brokerList é€‰æ‹©çš„ï¼›å…¶ä»–åˆ†åŒºçš„ç¬¬ä¸€ä¸ªå‰¯æœ¬æ”¾ç½®ä½ç½®ç›¸å¯¹äºç¬¬0ä¸ªåˆ†åŒºä¾æ¬¡å¾€åç§»ã€‚ä¹Ÿå°±æ˜¯å¦‚æœæˆ‘ä»¬æœ‰5ä¸ª Brokerï¼Œ5ä¸ªåˆ†åŒºï¼Œå‡è®¾ç¬¬ä¸€ä¸ªåˆ†åŒºæ”¾åœ¨ç¬¬å››ä¸ª Broker ä¸Šï¼Œé‚£ä¹ˆç¬¬äºŒä¸ªåˆ†åŒºå°†ä¼šæ”¾åœ¨ç¬¬äº”ä¸ª Broker ä¸Šï¼›ç¬¬ä¸‰ä¸ªåˆ†åŒºå°†ä¼šæ”¾åœ¨ç¬¬ä¸€ä¸ª Broker ä¸Šï¼›ç¬¬å››ä¸ªåˆ†åŒºå°†ä¼šæ”¾åœ¨ç¬¬äºŒä¸ª Broker ä¸Šï¼Œä¾æ¬¡ç±»æ¨ï¼› å‰©ä½™çš„å‰¯æœ¬ç›¸å¯¹äºç¬¬ä¸€ä¸ªå‰¯æœ¬æ”¾ç½®ä½ç½®å…¶å®æ˜¯ç”± nextReplicaShift å†³å®šçš„ï¼Œè€Œè¿™ä¸ªæ•°ä¹Ÿæ˜¯éšæœºäº§ç”Ÿçš„Kafkaæ–°å»ºçš„åˆ†åŒºä¼šåœ¨å“ªä¸ªç›®å½•ä¸‹åˆ›å»ºåœ¨å¯åŠ¨ Kafka é›†ç¾¤ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦é…ç½®å¥½ log.dirs å‚æ•°ï¼Œå…¶å€¼æ˜¯ Kafka æ•°æ®çš„å­˜æ”¾ç›®å½•ï¼Œè¿™ä¸ªå‚æ•°å¯ä»¥é…ç½®å¤šä¸ªç›®å½•ï¼Œç›®å½•ä¹‹é—´ä½¿ç”¨é€—å·åˆ†éš”ï¼Œé€šå¸¸è¿™äº›ç›®å½•æ˜¯åˆ†å¸ƒåœ¨ä¸åŒçš„ç£ç›˜ä¸Šç”¨äºæé«˜è¯»å†™æ€§èƒ½ã€‚å½“ç„¶æˆ‘ä»¬ä¹Ÿå¯ä»¥é…ç½® log.dir å‚æ•°ï¼Œå«ä¹‰ä¸€æ ·ã€‚åªéœ€è¦è®¾ç½®å…¶ä¸­ä¸€ä¸ªå³å¯ã€‚å¦‚æœ log.dirs å‚æ•°åªé…ç½®äº†ä¸€ä¸ªç›®å½•ï¼Œé‚£ä¹ˆåˆ†é…åˆ°å„ä¸ª Broker ä¸Šçš„åˆ†åŒºè‚¯å®šåªèƒ½åœ¨è¿™ä¸ªç›®å½•ä¸‹åˆ›å»ºæ–‡ä»¶å¤¹ç”¨äºå­˜æ”¾æ•°æ®ã€‚ä½†æ˜¯å¦‚æœ log.dirs å‚æ•°é…ç½®äº†å¤šä¸ªç›®å½•ï¼Œé‚£ä¹ˆ Kafka ä¼šåœ¨å“ªä¸ªæ–‡ä»¶å¤¹ä¸­åˆ›å»ºåˆ†åŒºç›®å½•å‘¢ï¼Ÿç­”æ¡ˆæ˜¯ï¼šKafka ä¼šåœ¨å«æœ‰åˆ†åŒºç›®å½•æœ€å°‘çš„æ–‡ä»¶å¤¹ä¸­åˆ›å»ºæ–°çš„åˆ†åŒºç›®å½•ï¼Œåˆ†åŒºç›®å½•åä¸º Topicå+åˆ†åŒºIDã€‚æ³¨æ„ï¼Œæ˜¯åˆ†åŒºæ–‡ä»¶å¤¹æ€»æ•°æœ€å°‘çš„ç›®å½•ï¼Œè€Œä¸æ˜¯ç£ç›˜ä½¿ç”¨é‡æœ€å°‘çš„ç›®å½•ï¼ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœä½ ç»™ log.dirs å‚æ•°æ–°å¢äº†ä¸€ä¸ªæ–°çš„ç£ç›˜ï¼Œæ–°çš„åˆ†åŒºç›®å½•è‚¯å®šæ˜¯å…ˆåœ¨è¿™ä¸ªæ–°çš„ç£ç›˜ä¸Šåˆ›å»ºç›´åˆ°è¿™ä¸ªæ–°çš„ç£ç›˜ç›®å½•æ‹¥æœ‰çš„åˆ†åŒºç›®å½•ä¸æ˜¯æœ€å°‘ä¸ºæ­¢ã€‚ partitionçš„æ•°æ®å¦‚ä½•ä¿å­˜åˆ°ç¡¬ç›˜? topicä¸­çš„å¤šä¸ªpartitionä»¥æ–‡ä»¶å¤¹çš„å½¢å¼ä¿å­˜åˆ°brokerï¼Œæ¯ä¸ªåˆ†åŒºåºå·ä»0é€’å¢ï¼Œä¸”æ¶ˆæ¯æœ‰åº Partitionæ–‡ä»¶ä¸‹æœ‰å¤šä¸ªsegmentï¼ˆxxx.indexï¼Œxxx.logï¼‰,segment æ–‡ä»¶é‡Œçš„ å¤§å°å’Œé…ç½®æ–‡ä»¶å¤§å°ä¸€è‡´å¯ä»¥æ ¹æ®è¦æ±‚ä¿®æ”¹ é»˜è®¤ä¸º1g, å¦‚æœå¤§å°å¤§äº1gæ—¶ï¼Œä¼šæ»šåŠ¨ä¸€ä¸ªæ–°çš„segmentå¹¶ä¸”ä»¥ä¸Šä¸€ä¸ªsegmentæœ€åä¸€æ¡æ¶ˆæ¯çš„åç§»é‡å‘½å kafkaçš„ackæœºåˆ¶ç”Ÿäº§é˜¶æ®µå¯èƒ½ä¼šä¸¢æ•°æ®, ä½†æ˜¯å‘ä¸å‡ºå»ä¹‹åå°±ä¸ä¼šä¸¢==ç”Ÿäº§é˜¶æ®µå¯èƒ½ä¼šä¸¢æ•°æ®, ä½†æ˜¯å‘ä¸å‡ºå»ä¹‹åå°±ä¸ä¼šä¸¢==(ä¼šå¤‡ä»½) request.required.acksæœ‰ä¸‰ä¸ªå€¼ 0ã€1ã€-1ï¼š 0 (ç”Ÿäº§è€…åªè´Ÿè´£ç”Ÿäº§ä¸ç®¡å…¶ä»–çš„)ï¼šç”Ÿäº§è€…ä¸ä¼šç­‰å¾…brokerçš„ackï¼Œè¿™ä¸ªå»¶è¿Ÿæœ€ä½ä½†æ˜¯å­˜å‚¨çš„ä¿è¯æœ€å¼±å½“serveræŒ‚æ‰çš„æ—¶å€™å°±ä¼šä¸¢æ•°æ® 1 (ç”Ÿäº§è€…ç­‰å¾…leaderçš„å‰¯æœ¬ä¹‹, è¿˜æ˜¯å¯èƒ½ä¸¢æ•°æ®)ï¼šæœåŠ¡ç«¯ä¼šç­‰å¾…ackå€¼ leaderå‰¯æœ¬ç¡®è®¤æ¥æ”¶åˆ°æ¶ˆæ¯åå‘é€ackä½†æ˜¯å¦‚æœleaderæŒ‚æ‰åä»–ä¸ç¡®ä¿æ˜¯å¦å¤åˆ¶å®Œæˆæ–°leaderä¹Ÿä¼šå¯¼è‡´æ•°æ®ä¸¢å¤± -1(æ‰€æœ‰äººéƒ½å“åº”äº†,æ‰ç»§ç»­ç”Ÿäº§)ï¼šåŒæ ·åœ¨1çš„åŸºç¡€ä¸Š æœåŠ¡ç«¯ä¼šç­‰æ‰€æœ‰çš„followerçš„å‰¯æœ¬å—åˆ°æ•°æ®åæ‰ä¼šå—åˆ°leaderå‘å‡ºçš„ackï¼Œè¿™æ ·æ•°æ®ä¸ä¼šä¸¢å¤± Kafkaçš„æ¶ˆè´¹è€…å¦‚ä½•æ¶ˆè´¹æ•°æ®==è®°å½•åç§»é‡, ä¸‹æ¬¡æ¥ç€æ¶ˆè´¹== æ¶ˆè´¹è€…æ¯æ¬¡æ¶ˆè´¹æ•°æ®çš„æ—¶å€™ï¼Œæ¶ˆè´¹è€…éƒ½ä¼šè®°å½•æ¶ˆè´¹çš„ç‰©ç†åç§»é‡ï¼ˆoffsetï¼‰çš„ä½ç½®, ç­‰åˆ°ä¸‹æ¬¡æ¶ˆè´¹æ—¶ï¼Œä»–ä¼šæ¥ç€ä¸Šæ¬¡ä½ç½®ç»§ç»­æ¶ˆè´¹ æ¶ˆè´¹è€…è´Ÿè½½å‡è¡¡ç­–ç•¥ä¸€ä¸ªæ¶ˆè´¹è€…ç»„ä¸­çš„ä¸€ä¸ªåˆ†ç‰‡å¯¹åº”ä¸€ä¸ªæ¶ˆè´¹è€…æˆå‘˜ï¼Œä»–èƒ½ä¿è¯æ¯ä¸ªæ¶ˆè´¹è€…æˆå‘˜éƒ½èƒ½è®¿é—®ï¼Œå¦‚æœç»„ä¸­æˆå‘˜å¤ªå¤šä¼šæœ‰ç©ºé—²çš„æˆå‘˜ æ•°æ®æœ‰åº ä¸€ä¸ªæ¶ˆè´¹è€…ç»„é‡Œå®ƒçš„å†…éƒ¨æ˜¯æœ‰åºçš„ æ¶ˆè´¹è€…ç»„ä¸æ¶ˆè´¹è€…ç»„ä¹‹é—´æ˜¯æ— åºçš„ kafkaç”Ÿäº§æ•°æ®æ—¶æ•°æ®çš„åˆ†ç»„ç­–ç•¥ ç”Ÿäº§è€…å†³å®šæ•°æ®äº§ç”Ÿåˆ°é›†ç¾¤çš„å“ªä¸ªpartitionä¸­ æ¯ä¸€æ¡æ¶ˆæ¯éƒ½æ˜¯ä»¥ï¼ˆkeyï¼Œvalueï¼‰æ ¼å¼, Keyæ˜¯ç”±ç”Ÿäº§è€…å‘é€æ•°æ®ä¼ å…¥, æ‰€ä»¥ç”Ÿäº§è€…ï¼ˆkeyï¼‰å†³å®šäº†æ•°æ®äº§ç”Ÿåˆ°é›†ç¾¤çš„å“ªä¸ªpartition é¢è¯•é¢˜1. Kafkaä¸­çš„HWã€LEOã€LSOã€LWç­‰åˆ†åˆ«ä»£è¡¨ä»€ä¹ˆï¼Ÿ HW:High Watermark é«˜æ°´ä½ï¼Œå–ä¸€ä¸ªpartitionå¯¹åº”çš„ISRä¸­æœ€å°çš„LEOä½œä¸ºHWï¼Œconsumeræœ€å¤šåªèƒ½æ¶ˆè´¹åˆ°HWæ‰€åœ¨çš„ä½ç½®ä¸Šä¸€æ¡ä¿¡æ¯ã€‚ LEO:LogEndOffset å½“å‰æ—¥å¿—æ–‡ä»¶ä¸­ä¸‹ä¸€æ¡å¾…å†™ä¿¡æ¯çš„offset HW/LEOè¿™ä¸¤ä¸ªéƒ½æ˜¯æŒ‡æœ€åä¸€æ¡çš„ä¸‹ä¸€æ¡çš„ä½ç½®è€Œä¸æ˜¯æŒ‡æœ€åä¸€æ¡çš„ä½ç½®ã€‚ LSO:Last Stable Offset å¯¹æœªå®Œæˆçš„äº‹åŠ¡è€Œè¨€ï¼ŒLSO çš„å€¼ç­‰äºäº‹åŠ¡ä¸­ç¬¬ä¸€æ¡æ¶ˆæ¯çš„ä½ç½®(firstUnstableOffset)ï¼Œå¯¹å·²å®Œæˆçš„äº‹åŠ¡è€Œè¨€ï¼Œå®ƒçš„å€¼åŒ HW ç›¸åŒ LW:Low Watermark ä½æ°´ä½, ä»£è¡¨ AR é›†åˆä¸­æœ€å°çš„ logStartOffset å€¼ 2. Kafkaä¸­çš„åˆ†åŒºå™¨ã€åºåˆ—åŒ–å™¨ã€æ‹¦æˆªå™¨æ˜¯å¦äº†è§£ï¼Ÿå®ƒä»¬ä¹‹é—´çš„å¤„ç†é¡ºåºæ˜¯ä»€ä¹ˆï¼Ÿæ‹¦æˆªå™¨-&gt;åºåˆ—åŒ–å™¨-&gt;åˆ†åŒºå™¨ 3. Kafkaç”Ÿäº§è€…å®¢æˆ·ç«¯ä¸­ä½¿ç”¨äº†å‡ ä¸ªçº¿ç¨‹æ¥å¤„ç†ï¼Ÿåˆ†åˆ«æ˜¯ä»€ä¹ˆï¼Ÿ2ä¸ªï¼Œä¸»çº¿ç¨‹å’ŒSenderçº¿ç¨‹ã€‚ä¸»çº¿ç¨‹è´Ÿè´£åˆ›å»ºæ¶ˆæ¯ï¼Œç„¶åé€šè¿‡åˆ†åŒºå™¨ã€åºåˆ—åŒ–å™¨ã€æ‹¦æˆªå™¨ä½œç”¨ä¹‹åç¼“å­˜åˆ°ç´¯åŠ å™¨RecordAccumulatorä¸­ã€‚Senderçº¿ç¨‹è´Ÿè´£å°†RecordAccumulatorä¸­æ¶ˆæ¯å‘é€åˆ°kafkaä¸­. 4. â€œæ¶ˆè´¹ç»„ä¸­çš„æ¶ˆè´¹è€…ä¸ªæ•°å¦‚æœè¶…è¿‡topicçš„åˆ†åŒºï¼Œé‚£ä¹ˆå°±ä¼šæœ‰æ¶ˆè´¹è€…æ¶ˆè´¹ä¸åˆ°æ•°æ®â€è¿™å¥è¯æ˜¯å¦æ­£ç¡®ï¼Ÿå¦‚æœä¸æ­£ç¡®ï¼Œé‚£ä¹ˆæœ‰æ²¡æœ‰ä»€ä¹ˆhackçš„æ‰‹æ®µï¼Ÿä¸æ­£ç¡®ï¼Œé€šè¿‡è‡ªå®šä¹‰åˆ†åŒºåˆ†é…ç­–ç•¥ï¼Œå¯ä»¥å°†ä¸€ä¸ªconsumeræŒ‡å®šæ¶ˆè´¹æ‰€æœ‰partitionã€‚ 5. æ¶ˆè´¹è€…æäº¤æ¶ˆè´¹ä½ç§»æ—¶æäº¤çš„æ˜¯å½“å‰æ¶ˆè´¹åˆ°çš„æœ€æ–°æ¶ˆæ¯çš„offsetè¿˜æ˜¯offset+1?offset+1 6. æœ‰å“ªäº›æƒ…å½¢ä¼šé€ æˆé‡å¤æ¶ˆè´¹ï¼Ÿæ¶ˆè´¹è€…æ¶ˆè´¹åæ²¡æœ‰commit offset(ç¨‹åºå´©æºƒ/å¼ºè¡Œkill/æ¶ˆè´¹è€—æ—¶/è‡ªåŠ¨æäº¤åç§»æƒ…å†µä¸‹unscrible) 7. é‚£äº›æƒ…æ™¯ä¸‹ä¼šé€ æˆæ¶ˆæ¯æ¼æ¶ˆè´¹ï¼Ÿ==æ¶ˆè´¹è€…æ²¡æœ‰å¤„ç†å®Œæ¶ˆæ¯ æäº¤offset(è‡ªåŠ¨æäº¤åç§» æœªå¤„ç†æƒ…å†µä¸‹ç¨‹åºå¼‚å¸¸ç»“æŸ)== 8. Kafka Consumeræ˜¯éçº¿ç¨‹å®‰å…¨çš„ï¼Œé‚£ä¹ˆæ€ä¹ˆæ ·å®ç°å¤šçº¿ç¨‹æ¶ˆè´¹ï¼Ÿ1.åœ¨æ¯ä¸ªçº¿ç¨‹ä¸­æ–°å»ºä¸€ä¸ªKafka Consumer 2.å•çº¿ç¨‹åˆ›å»ºKafka Consumerï¼Œå¤šä¸ªå¤„ç†çº¿ç¨‹å¤„ç†æ¶ˆæ¯ï¼ˆéš¾ç‚¹åœ¨äºæ˜¯å¦è¦è€ƒè™‘æ¶ˆæ¯é¡ºåºæ€§ï¼Œoffsetçš„æäº¤æ–¹å¼ï¼‰ 9. å½“ä½ ä½¿ç”¨kafka-topics.shåˆ›å»ºï¼ˆåˆ é™¤ï¼‰äº†ä¸€ä¸ªtopicä¹‹åï¼ŒKafkaèƒŒåä¼šæ‰§è¡Œä»€ä¹ˆé€»è¾‘ï¼Ÿåˆ›å»º:åœ¨zkä¸Š/brokers/topics/ä¸‹èŠ‚ç‚¹ kafkabrokerä¼šç›‘å¬èŠ‚ç‚¹å˜åŒ–åˆ›å»ºä¸»é¢˜åˆ é™¤:è°ƒç”¨è„šæœ¬åˆ é™¤topicä¼šåœ¨zkä¸Šå°†topicè®¾ç½®å¾…åˆ é™¤æ ‡å¿—ï¼Œkafkaåå°æœ‰å®šæ—¶çš„çº¿ç¨‹ä¼šæ‰«ææ‰€æœ‰éœ€è¦åˆ é™¤çš„topicè¿›è¡Œåˆ é™¤ 10. åˆ›å»ºtopicæ—¶å¦‚ä½•é€‰æ‹©åˆé€‚çš„åˆ†åŒºæ•°ï¼Ÿæ ¹æ®é›†ç¾¤çš„æœºå™¨æ•°é‡å’Œéœ€è¦çš„ååé‡æ¥å†³å®šé€‚åˆçš„åˆ†åŒºæ•° 11. Kafkaç›®å‰æœ‰é‚£äº›å†…éƒ¨topicï¼Œå®ƒä»¬éƒ½æœ‰ä»€ä¹ˆç‰¹å¾ï¼Ÿå„è‡ªçš„ä½œç”¨åˆæ˜¯ä»€ä¹ˆï¼Ÿ__consumer_offsets ä»¥ä¸‹åˆ’çº¿å¼€å¤´ï¼Œä¿å­˜æ¶ˆè´¹ç»„çš„åç§» 12. ä¼˜å…ˆå‰¯æœ¬æ˜¯ä»€ä¹ˆï¼Ÿå®ƒæœ‰ä»€ä¹ˆç‰¹æ®Šçš„ä½œç”¨ï¼Ÿä¼˜å…ˆå‰¯æœ¬ ä¼šæ˜¯é»˜è®¤çš„leaderå‰¯æœ¬ å‘ç”Ÿleaderå˜åŒ–æ—¶é‡é€‰ä¸¾ä¼šä¼˜å…ˆé€‰æ‹©ä¼˜å…ˆå‰¯æœ¬ä½œä¸ºleader 13. Kafkaæœ‰å“ªå‡ å¤„åœ°æ–¹æœ‰åˆ†åŒºåˆ†é…çš„æ¦‚å¿µï¼Ÿç®€è¿°å¤§è‡´çš„è¿‡ç¨‹åŠåŸç†åˆ›å»ºä¸»é¢˜æ—¶å¦‚æœä¸æ‰‹åŠ¨æŒ‡å®šåˆ†é…æ–¹å¼ æœ‰ä¸¤ç§åˆ†é…æ–¹å¼ æ¶ˆè´¹ç»„å†…åˆ†é… 14. ç®€è¿°Kafkaçš„æ—¥å¿—ç›®å½•ç»“æ„æ¯ä¸ªpartitionä¸€ä¸ªæ–‡ä»¶å¤¹ï¼ŒåŒ…å«å››ç±»æ–‡ä»¶.index .log .timeindex leader-epoch-checkpoint.index .log .timeindex ä¸‰ä¸ªæ–‡ä»¶æˆå¯¹å‡ºç° å‰ç¼€ä¸ºä¸Šä¸€ä¸ªsegmentçš„æœ€åä¸€ä¸ªæ¶ˆæ¯çš„åç§» logæ–‡ä»¶ä¸­ä¿å­˜äº†æ‰€æœ‰çš„æ¶ˆæ¯ indexæ–‡ä»¶ä¸­ä¿å­˜äº†ç¨€ç–çš„ç›¸å¯¹åç§»çš„ç´¢å¼• timeindexä¿å­˜çš„åˆ™æ˜¯æ—¶é—´ç´¢å¼•leader-epoch-checkpointä¸­ä¿å­˜äº†æ¯ä¸€ä»»leaderå¼€å§‹å†™å…¥æ¶ˆæ¯æ—¶çš„offset ä¼šå®šæ—¶æ›´æ–°followerè¢«é€‰ä¸ºleaderæ—¶ä¼šæ ¹æ®è¿™ä¸ªç¡®å®šå“ªäº›æ¶ˆæ¯å¯ç”¨ 15. Kafkaä¸­æœ‰é‚£äº›ç´¢å¼•æ–‡ä»¶ï¼Ÿå¦‚ä¸Š 16. å¦‚æœæˆ‘æŒ‡å®šäº†ä¸€ä¸ªoffsetï¼ŒKafkaæ€ä¹ˆæŸ¥æ‰¾åˆ°å¯¹åº”çš„æ¶ˆæ¯ï¼Ÿ1.é€šè¿‡æ–‡ä»¶åå‰ç¼€æ•°å­—xæ‰¾åˆ°è¯¥ç»å¯¹offset å¯¹åº”æ¶ˆæ¯æ‰€åœ¨æ–‡ä»¶ 2.offset-xä¸ºåœ¨æ–‡ä»¶ä¸­çš„ç›¸å¯¹åç§» 3.é€šè¿‡indexæ–‡ä»¶ä¸­è®°å½•çš„ç´¢å¼•æ‰¾åˆ°æœ€è¿‘çš„æ¶ˆæ¯çš„ä½ç½® 4.ä»æœ€è¿‘ä½ç½®å¼€å§‹é€æ¡å¯»æ‰¾ 17. å¦‚æœæˆ‘æŒ‡å®šäº†ä¸€ä¸ªtimestampï¼ŒKafkaæ€ä¹ˆæŸ¥æ‰¾åˆ°å¯¹åº”çš„æ¶ˆæ¯ï¼ŸåŸç†åŒä¸Š ä½†æ˜¯æ—¶é—´çš„å› ä¸ºæ¶ˆæ¯ä½“ä¸­ä¸å¸¦æœ‰æ—¶é—´æˆ³ æ‰€ä»¥ä¸ç²¾ç¡® 18. èŠä¸€èŠä½ å¯¹Kafkaçš„Log Retentionçš„ç†è§£kafkaç•™å­˜ç­–ç•¥åŒ…æ‹¬ åˆ é™¤å’Œå‹ç¼©ä¸¤ç§ åˆ é™¤: æ ¹æ®æ—¶é—´å’Œå¤§å°ä¸¤ä¸ªæ–¹å¼è¿›è¡Œåˆ é™¤ å¤§å°æ˜¯æ•´ä¸ªpartitionæ—¥å¿—æ–‡ä»¶çš„å¤§å°, è¶…è¿‡çš„ä¼šä»è€åˆ°æ–°ä¾æ¬¡åˆ é™¤ æ—¶é—´æŒ‡æ—¥å¿—æ–‡ä»¶ä¸­çš„æœ€å¤§æ—¶é—´æˆ³è€Œéæ–‡ä»¶çš„æœ€åä¿®æ”¹æ—¶é—´ å‹ç¼©: ç›¸åŒkeyçš„valueåªä¿å­˜ä¸€ä¸ª å‹ç¼©è¿‡çš„æ˜¯clean æœªå‹ç¼©çš„dirty å‹ç¼©ä¹‹åçš„åç§»é‡ä¸è¿ç»­ æœªå‹ç¼©æ—¶è¿ç»­ 19. èŠä¸€èŠä½ å¯¹Kafkaåº•å±‚å­˜å‚¨çš„ç†è§£ï¼ˆé¡µç¼“å­˜ã€å†…æ ¸å±‚ã€å—å±‚ã€è®¾å¤‡å±‚ï¼‰20. æ¶ˆè´¹å†å‡è¡¡çš„åŸç†æ˜¯ä»€ä¹ˆï¼Ÿï¼ˆæç¤ºï¼šæ¶ˆè´¹è€…åè°ƒå™¨å’Œæ¶ˆè´¹ç»„åè°ƒå™¨ï¼‰21. Kafkaä¸­çš„äº‹åŠ¡æ˜¯æ€ä¹ˆå®ç°çš„ï¼ˆè¿™é¢˜æˆ‘å»é¢è¯•6å®¶è¢«é—®4æ¬¡ï¼Œç…§ç€ç­”æ¡ˆå¿µä¹Ÿè¦å¿µåå‡ åˆ†é’Ÿï¼Œé¢è¯•å®˜ç®€ç›´å‡‘ä¸è¦è„¸ã€‚å®åœ¨è®°ä¸ä½çš„è¯â€¦åªè¦ç®€å†ä¸Šä¸å†™ç²¾é€šKafkaä¸€èˆ¬ä¸ä¼šé—®åˆ°ï¼Œæˆ‘ç®€å†ä¸Šå†™çš„æ˜¯â€œç†Ÿæ‚‰Kafkaï¼Œäº†è§£RabbitMQâ€¦.â€ï¼‰22. Kafkaä¸­æœ‰é‚£äº›åœ°æ–¹éœ€è¦é€‰ä¸¾ï¼Ÿè¿™äº›åœ°æ–¹çš„é€‰ä¸¾ç­–ç•¥åˆæœ‰å“ªäº›ï¼Ÿ23. å¤±æ•ˆå‰¯æœ¬æ˜¯æŒ‡ä»€ä¹ˆï¼Ÿæœ‰é‚£äº›åº”å¯¹æªæ–½ï¼Ÿ24. å¤šå‰¯æœ¬ä¸‹ï¼Œå„ä¸ªå‰¯æœ¬ä¸­çš„HWå’ŒLEOçš„æ¼”å˜è¿‡ç¨‹25. ä¸ºä»€ä¹ˆKafkaä¸æ”¯æŒè¯»å†™åˆ†ç¦»ï¼Ÿ26. Kafkaåœ¨å¯é æ€§æ–¹é¢åšäº†å“ªäº›æ”¹è¿›ï¼Ÿï¼ˆHW, LeaderEpochï¼‰27. Kafkaä¸­æ€ä¹ˆå®ç°æ­»ä¿¡é˜Ÿåˆ—å’Œé‡è¯•é˜Ÿåˆ—ï¼Ÿ28. Kafkaä¸­çš„å»¶è¿Ÿé˜Ÿåˆ—æ€ä¹ˆå®ç°ï¼ˆè¿™é¢˜è¢«é—®çš„æ¯”äº‹åŠ¡é‚£é¢˜è¿˜è¦å¤šï¼ï¼ï¼å¬è¯´ä½ ä¼šKafkaï¼Œé‚£ä½ è¯´è¯´å»¶è¿Ÿé˜Ÿåˆ—æ€ä¹ˆå®ç°ï¼Ÿï¼‰29. Kafkaæœ‰å“ªäº›æŒ‡æ ‡éœ€è¦ç€é‡å…³æ³¨ï¼Ÿç”Ÿäº§è€…å…³æ³¨MessagesInPerSecã€BytesOutPerSecã€BytesInPerSec æ¶ˆè´¹è€…å…³æ³¨æ¶ˆè´¹å»¶è¿ŸLag 30. æ€ä¹ˆè®¡ç®—Lagï¼Ÿ(æ³¨æ„read_uncommittedå’Œread_committedçŠ¶æ€ä¸‹çš„ä¸åŒ)å‚è€ƒ å¦‚ä½•ç›‘æ§kafkaæ¶ˆè´¹Lagæƒ…å†µ 31. Kafkaçš„é‚£äº›è®¾è®¡è®©å®ƒæœ‰å¦‚æ­¤é«˜çš„æ€§èƒ½ï¼Ÿé›¶æ‹·è´ï¼Œé¡µç¼“å­˜ï¼Œé¡ºåºå†™ 32. Kafkaæœ‰ä»€ä¹ˆä¼˜ç¼ºç‚¹ï¼Ÿ33. ä¸ºä»€ä¹ˆé€‰æ‹©Kafka?ååé‡é«˜ï¼Œå¤§æ•°æ®æ¶ˆæ¯ç³»ç»Ÿå”¯ä¸€é€‰æ‹©ã€‚ 34. æ€ä¹ˆæ ·æ‰èƒ½ç¡®ä¿Kafkaæå¤§ç¨‹åº¦ä¸Šçš„å¯é æ€§ï¼Ÿ","categories":[],"tags":[{"name":"IT","slug":"IT","permalink":"/tags/IT/"},{"name":"æŠ€æœ¯ç¬”è®°","slug":"æŠ€æœ¯ç¬”è®°","permalink":"/tags/%E6%8A%80%E6%9C%AF%E7%AC%94%E8%AE%B0/"},{"name":"Job","slug":"Job","permalink":"/tags/Job/"},{"name":"Kafka","slug":"Kafka","permalink":"/tags/Kafka/"}],"author":"èœ—ç‰›å›"},{"title":"Springé¢è¯•","slug":"Springé¢è¯•","date":"2019-10-20T11:51:12.000Z","updated":"2019-10-20T06:04:59.622Z","comments":true,"path":"2019/10/20/Springé¢è¯•/","link":"","permalink":"/2019/10/20/Spring%E9%9D%A2%E8%AF%95/","excerpt":"","text":"Spring1. Springæ˜¯ä»€ä¹ˆ?â€‹ Springæ˜¯ä¸€ä¸ªè½»é‡çº§çš„IoCå’ŒAOPå®¹å™¨æ¡†æ¶ã€‚æ˜¯ä¸ºJavaåº”ç”¨ç¨‹åºæä¾›åŸºç¡€æ€§æœåŠ¡çš„ä¸€å¥—æ¡†æ¶ï¼Œç›®çš„æ˜¯ç”¨äºç®€åŒ–ä¼ä¸šåº”ç”¨ç¨‹åºçš„å¼€å‘ï¼Œå®ƒä½¿å¾—å¼€å‘è€…åªéœ€è¦å…³å¿ƒä¸šåŠ¡éœ€æ±‚ã€‚å¸¸è§çš„é…ç½®æ–¹å¼æœ‰ä¸‰ç§ï¼šåŸºäºXMLçš„é…ç½®ã€åŸºäºæ³¨è§£çš„é…ç½®ã€åŸºäºJavaçš„é…ç½®ã€‚ ä¸»è¦ç”±ä»¥ä¸‹å‡ ä¸ªæ¨¡å—ç»„æˆï¼š Spring Coreï¼šæ ¸å¿ƒç±»åº“ï¼Œæä¾›IOCæœåŠ¡ï¼› Spring Contextï¼šæä¾›æ¡†æ¶å¼çš„Beanè®¿é—®æ–¹å¼ï¼Œä»¥åŠä¼ä¸šçº§åŠŸèƒ½ï¼ˆJNDIã€å®šæ—¶ä»»åŠ¡ç­‰ï¼‰ï¼› Spring AOPï¼šAOPæœåŠ¡ï¼› Spring DAOï¼šå¯¹JDBCçš„æŠ½è±¡ï¼Œç®€åŒ–äº†æ•°æ®è®¿é—®å¼‚å¸¸çš„å¤„ç†ï¼› Spring ORM (å¯¹è±¡å…³ç³»æ˜ å°„)ï¼šå¯¹ç°æœ‰çš„ORMæ¡†æ¶çš„æ”¯æŒï¼› Spring Webï¼šæä¾›äº†åŸºæœ¬çš„é¢å‘Webçš„ç»¼åˆç‰¹æ€§ï¼Œä¾‹å¦‚å¤šæ–¹æ–‡ä»¶ä¸Šä¼ ï¼› Spring MVCï¼šæä¾›é¢å‘Webåº”ç”¨çš„Model-View-Controllerå®ç°ã€‚ 2. Spring çš„ä¼˜ç‚¹ï¼Ÿï¼ˆ1ï¼‰springå±äºä½ä¾µå…¥å¼è®¾è®¡ï¼Œä»£ç çš„æ±¡æŸ“æä½ï¼› ï¼ˆ2ï¼‰springçš„DIæœºåˆ¶å°†å¯¹è±¡ä¹‹é—´çš„ä¾èµ–å…³ç³»äº¤ç”±æ¡†æ¶å¤„ç†ï¼Œå‡ä½ç»„ä»¶çš„è€¦åˆæ€§ï¼› ï¼ˆ3ï¼‰Springæä¾›äº†AOPæŠ€æœ¯ï¼Œæ”¯æŒå°†ä¸€äº›é€šç”¨ä»»åŠ¡ï¼Œå¦‚å®‰å…¨ã€äº‹åŠ¡ã€æ—¥å¿—ã€æƒé™ç­‰è¿›è¡Œé›†ä¸­å¼ç®¡ç†ï¼Œä»è€Œæä¾›æ›´å¥½çš„å¤ç”¨ã€‚ ï¼ˆ4ï¼‰springå¯¹äºä¸»æµçš„åº”ç”¨æ¡†æ¶æä¾›äº†é›†æˆæ”¯æŒã€‚ 3ã€Springçš„AOPç†è§£ï¼šOOPé¢å‘å¯¹è±¡ï¼Œå…è®¸å¼€å‘è€…å®šä¹‰çºµå‘çš„å…³ç³»ï¼Œä½†å¹¶é€‚ç”¨äºå®šä¹‰æ¨ªå‘çš„å…³ç³»ï¼Œå¯¼è‡´äº†å¤§é‡ä»£ç çš„é‡å¤ï¼Œè€Œä¸åˆ©äºå„ä¸ªæ¨¡å—çš„é‡ç”¨ã€‚ ç®€å•è¯´å°±æ˜¯AOPå¯ä»¥åœ¨ä¸ä¿®æ”¹ç°æœ‰ä»£ç çš„æƒ…å†µä¸‹å¯¹ç°æœ‰ä»£ç å¢åŠ ä¸€äº›åŠŸèƒ½ï¼Œé‚£ä¹ˆè¿™å°±æ˜¯AOPæœ€å¼ºå¤§çš„åŠŸèƒ½ã€‚ Aspectï¼ˆåˆ‡é¢ï¼‰ï¼š Aspect å£°æ˜ç±»ä¼¼äº Java ä¸­çš„ç±»å£°æ˜ï¼Œåœ¨ Aspect ä¸­ä¼šåŒ…å«ç€ä¸€äº› Pointcut ä»¥åŠç›¸åº”çš„ Adviceã€‚ Joint pointï¼ˆè¿æ¥ç‚¹ï¼‰ï¼šè¡¨ç¤ºåœ¨ç¨‹åºä¸­æ˜ç¡®å®šä¹‰çš„ç‚¹ï¼Œå…¸å‹çš„åŒ…æ‹¬æ–¹æ³•è°ƒç”¨ï¼Œå¯¹ç±»æˆå‘˜çš„è®¿é—®ä»¥åŠå¼‚å¸¸å¤„ç†ç¨‹åºå—çš„æ‰§è¡Œç­‰ç­‰ï¼Œå®ƒè‡ªèº«è¿˜å¯ä»¥åµŒå¥—å…¶å®ƒ joint pointã€‚ Pointcutï¼ˆåˆ‡ç‚¹ï¼‰ï¼šè¡¨ç¤ºä¸€ç»„ joint pointï¼Œè¿™äº› joint point æˆ–æ˜¯é€šè¿‡é€»è¾‘å…³ç³»ç»„åˆèµ·æ¥ï¼Œæˆ–æ˜¯é€šè¿‡é€šé…ã€æ­£åˆ™è¡¨è¾¾å¼ç­‰æ–¹å¼é›†ä¸­èµ·æ¥ï¼Œå®ƒå®šä¹‰äº†ç›¸åº”çš„ Advice å°†è¦å‘ç”Ÿçš„åœ°æ–¹ã€‚ pAdviceï¼ˆå¢å¼ºï¼‰ï¼šAdvice å®šä¹‰äº†åœ¨ Pointcut é‡Œé¢å®šä¹‰çš„ç¨‹åºç‚¹å…·ä½“è¦åšçš„æ“ä½œï¼Œå®ƒé€šè¿‡ beforeã€after å’Œ around æ¥åŒºåˆ«æ˜¯åœ¨æ¯ä¸ª joint point ä¹‹å‰ã€ä¹‹åè¿˜æ˜¯ä»£æ›¿æ‰§è¡Œçš„ä»£ç ã€‚ Targetï¼ˆç›®æ ‡å¯¹è±¡ï¼‰ï¼šç»‡å…¥ Advice çš„ç›®æ ‡å¯¹è±¡. Weavingï¼ˆç»‡å…¥ï¼‰ï¼šå°† Aspect å’Œå…¶ä»–å¯¹è±¡è¿æ¥èµ·æ¥, å¹¶åˆ›å»º AOPï¼Œä¸€èˆ¬ç§°ä¸ºé¢å‘åˆ‡é¢ï¼Œä½œä¸ºé¢å‘å¯¹è±¡çš„ä¸€ç§è¡¥å……ï¼Œç”¨äºå°†é‚£äº›ä¸ä¸šåŠ¡æ— å…³ï¼Œä½†å´å¯¹å¤šä¸ªå¯¹è±¡äº§ç”Ÿå½±å“çš„å…¬å…±è¡Œä¸ºå’Œé€»è¾‘ï¼ŒæŠ½å–å¹¶å°è£…ä¸ºä¸€ä¸ªå¯é‡ç”¨çš„æ¨¡å—ï¼Œè¿™ä¸ªæ¨¡å—è¢«å‘½åä¸ºâ€œåˆ‡é¢â€ï¼ˆAspectï¼‰ï¼Œå‡å°‘ç³»ç»Ÿä¸­çš„é‡å¤ä»£ç ï¼Œé™ä½äº†æ¨¡å—é—´çš„è€¦åˆåº¦ï¼ŒåŒæ—¶æé«˜äº†ç³»ç»Ÿçš„å¯ç»´æŠ¤æ€§ã€‚å¯ç”¨äºæƒé™è®¤è¯ã€æ—¥å¿—ã€äº‹åŠ¡å¤„ç†ã€‚ ==AOPå®ç°çš„å…³é”®åœ¨äº ä»£ç†æ¨¡å¼==ï¼ŒAOPä»£ç†ä¸»è¦åˆ†ä¸ºé™æ€ä»£ç†å’ŒåŠ¨æ€ä»£ç†ã€‚ é™æ€ä»£ç†çš„ä»£è¡¨ä¸ºAspectJï¼› AspectJæ˜¯é™æ€ä»£ç†çš„å¢å¼ºï¼Œæ‰€è°“é™æ€ä»£ç†ï¼Œå°±æ˜¯AOPæ¡†æ¶ä¼šåœ¨ç¼–è¯‘é˜¶æ®µç”ŸæˆAOPä»£ç†ç±»ï¼Œå› æ­¤ä¹Ÿç§°ä¸ºç¼–è¯‘æ—¶å¢å¼ºï¼Œä»–ä¼šåœ¨ç¼–è¯‘é˜¶æ®µå°†AspectJ(åˆ‡é¢)ç»‡å…¥åˆ°Javaå­—èŠ‚ç ä¸­ï¼Œè¿è¡Œçš„æ—¶å€™å°±æ˜¯å¢å¼ºä¹‹åçš„AOPå¯¹è±¡ã€‚ åŠ¨æ€ä»£ç†åˆ™ä»¥Spring AOPä¸ºä»£è¡¨ã€‚ Spring AOPä½¿ç”¨çš„åŠ¨æ€ä»£ç†ï¼Œæ‰€è°“çš„åŠ¨æ€ä»£ç†å°±æ˜¯è¯´AOPæ¡†æ¶ä¸ä¼šå»ä¿®æ”¹å­—èŠ‚ç ï¼Œè€Œæ˜¯æ¯æ¬¡è¿è¡Œæ—¶åœ¨å†…å­˜ä¸­ä¸´æ—¶ä¸ºæ–¹æ³•ç”Ÿæˆä¸€ä¸ªAOPå¯¹è±¡ï¼Œè¿™ä¸ªAOPå¯¹è±¡åŒ…å«äº†ç›®æ ‡å¯¹è±¡çš„å…¨éƒ¨æ–¹æ³•ï¼Œå¹¶ä¸”åœ¨ç‰¹å®šçš„åˆ‡ç‚¹åšäº†å¢å¼ºå¤„ç†ï¼Œå¹¶å›è°ƒåŸå¯¹è±¡çš„æ–¹æ³•ã€‚ Spring AOPä¸­çš„åŠ¨æ€ä»£ç†ä¸»è¦æœ‰ä¸¤ç§æ–¹å¼ï¼ŒJDKåŠ¨æ€ä»£ç†å’ŒCGLIBåŠ¨æ€ä»£ç†ï¼š invocation è°ƒç”¨, å¯ç”¨ â‘ JDKåŠ¨æ€ä»£ç†åªæä¾›æ¥å£çš„ä»£ç†ï¼Œä¸æ”¯æŒç±»çš„ä»£ç†ã€‚æ ¸å¿ƒInvocationHandleræ¥å£å’ŒProxyç±»ï¼ŒInvocationHandler é€šè¿‡invoke()æ–¹æ³•åå°„æ¥è°ƒç”¨ç›®æ ‡ç±»ä¸­çš„ä»£ç ï¼ŒåŠ¨æ€åœ°å°†æ¨ªåˆ‡é€»è¾‘å’Œä¸šåŠ¡ç¼–ç»‡åœ¨ä¸€èµ·ï¼›æ¥ç€ï¼ŒProxyåˆ©ç”¨ InvocationHandleråŠ¨æ€åˆ›å»ºä¸€ä¸ªç¬¦åˆæŸä¸€æ¥å£çš„çš„å®ä¾‹, ç”Ÿæˆç›®æ ‡ç±»çš„ä»£ç†å¯¹è±¡ã€‚ â‘¡å¦‚æœä»£ç†ç±»æ²¡æœ‰å®ç° InvocationHandler æ¥å£ï¼Œé‚£ä¹ˆSpring AOPä¼šé€‰æ‹©ä½¿ç”¨CGLIBæ¥åŠ¨æ€ä»£ç†ç›®æ ‡ç±»ã€‚CGLIBï¼ˆCode Generation Libraryï¼‰ï¼Œæ˜¯ä¸€ä¸ªä»£ç ç”Ÿæˆçš„ç±»åº“ï¼Œå¯ä»¥åœ¨è¿è¡Œæ—¶åŠ¨æ€çš„ç”ŸæˆæŒ‡å®šç±»çš„ä¸€ä¸ªå­ç±»å¯¹è±¡ï¼Œå¹¶è¦†ç›–å…¶ä¸­ç‰¹å®šæ–¹æ³•å¹¶æ·»åŠ å¢å¼ºä»£ç ï¼Œä»è€Œå®ç°AOPã€‚CGLIBæ˜¯é€šè¿‡ç»§æ‰¿çš„æ–¹å¼åšçš„åŠ¨æ€ä»£ç†ï¼Œå› æ­¤å¦‚æœæŸä¸ªç±»è¢«æ ‡è®°ä¸ºfinalï¼Œé‚£ä¹ˆå®ƒæ˜¯æ— æ³•ä½¿ç”¨CGLIBåšåŠ¨æ€ä»£ç†çš„ã€‚ é™æ€ä»£ç†ä¸åŠ¨æ€ä»£ç†åŒºåˆ«åœ¨äºç”ŸæˆAOPä»£ç†å¯¹è±¡çš„æ—¶æœºä¸åŒï¼Œç›¸å¯¹æ¥è¯´AspectJçš„é™æ€ä»£ç†æ–¹å¼å…·æœ‰æ›´å¥½çš„æ€§èƒ½ï¼Œä½†æ˜¯AspectJéœ€è¦ç‰¹å®šçš„ç¼–è¯‘å™¨è¿›è¡Œå¤„ç†ï¼Œè€ŒSpring AOPåˆ™æ— éœ€ç‰¹å®šçš„ç¼–è¯‘å™¨å¤„ç†ã€‚ InvocationHandler çš„ invoke(Object proxy,Method method,Object[] args)ï¼šproxyæ˜¯æœ€ç»ˆç”Ÿæˆçš„ä»£ç†å®ä¾‹; method æ˜¯è¢«ä»£ç†ç›®æ ‡å®ä¾‹çš„æŸä¸ªå…·ä½“æ–¹æ³•; args æ˜¯è¢«ä»£ç†ç›®æ ‡å®ä¾‹æŸä¸ªæ–¹æ³•çš„å…·ä½“å…¥å‚, åœ¨æ–¹æ³•åå°„è°ƒç”¨æ—¶ä½¿ç”¨ã€‚ 4ã€Springçš„IoCç†è§£ï¼šï¼ˆ1ï¼‰IOCå°±æ˜¯æ§åˆ¶åè½¬ï¼Œæ˜¯æŒ‡åˆ›å»ºå¯¹è±¡çš„æ§åˆ¶æƒçš„è½¬ç§»ï¼Œä»¥å‰åˆ›å»ºå¯¹è±¡çš„ä¸»åŠ¨æƒå’Œæ—¶æœºæ˜¯ç”±è‡ªå·±æŠŠæ§çš„ï¼Œè€Œç°åœ¨è¿™ç§æƒåŠ›è½¬ç§»åˆ°Springå®¹å™¨ä¸­ï¼Œå¹¶ç”±å®¹å™¨æ ¹æ®é…ç½®æ–‡ä»¶å»åˆ›å»ºå®ä¾‹å’Œç®¡ç†å„ä¸ªå®ä¾‹ä¹‹é—´çš„ä¾èµ–å…³ç³»ï¼Œå¯¹è±¡ä¸å¯¹è±¡ä¹‹é—´æ¾æ•£è€¦åˆï¼Œä¹Ÿåˆ©äºåŠŸèƒ½çš„å¤ç”¨ã€‚DIä¾èµ–æ³¨å…¥ï¼Œå’Œæ§åˆ¶åè½¬æ˜¯åŒä¸€ä¸ªæ¦‚å¿µçš„ä¸åŒè§’åº¦çš„æè¿°ï¼Œå³ åº”ç”¨ç¨‹åºåœ¨è¿è¡Œæ—¶ä¾èµ–IoCå®¹å™¨æ¥åŠ¨æ€æ³¨å…¥å¯¹è±¡éœ€è¦çš„å¤–éƒ¨èµ„æºã€‚ ï¼ˆ2ï¼‰æœ€ç›´è§‚çš„è¡¨è¾¾å°±æ˜¯ï¼ŒIOCè®©å¯¹è±¡çš„åˆ›å»ºä¸ç”¨å»newäº†ï¼Œå¯ä»¥ç”±springè‡ªåŠ¨ç”Ÿäº§ï¼Œä½¿ç”¨javaçš„åå°„æœºåˆ¶ï¼Œæ ¹æ®é…ç½®æ–‡ä»¶åœ¨è¿è¡Œæ—¶åŠ¨æ€çš„å»åˆ›å»ºå¯¹è±¡ä»¥åŠç®¡ç†å¯¹è±¡ï¼Œå¹¶è°ƒç”¨å¯¹è±¡çš„æ–¹æ³•çš„ã€‚ ï¼ˆ3ï¼‰Springçš„IOCæœ‰ä¸‰ç§æ³¨å…¥æ–¹å¼ ï¼š æ„é€ å™¨æ³¨å…¥ setteræ–¹æ³•æ³¨å…¥ æ ¹æ®æ³¨è§£æ³¨å…¥ IoCè®©ç›¸äº’åä½œçš„ç»„ä»¶ä¿æŒæ¾æ•£çš„è€¦åˆï¼Œè€ŒAOPç¼–ç¨‹å…è®¸ä½ æŠŠéå¸ƒäºåº”ç”¨å„å±‚çš„åŠŸèƒ½åˆ†ç¦»å‡ºæ¥å½¢æˆå¯é‡ç”¨çš„åŠŸèƒ½ç»„ä»¶ã€‚ 5ã€BeanFactoryå’ŒApplicationContextæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿâ€‹ BeanFactoryå’ŒApplicationContextæ˜¯Springçš„ä¸¤å¤§æ ¸å¿ƒæ¥å£ï¼Œéƒ½å¯ä»¥å½“åšSpringçš„å®¹å™¨ã€‚å…¶ä¸­ApplicationContextæ˜¯BeanFactoryçš„å­æ¥å£ã€‚ ï¼ˆ1ï¼‰BeanFactoryï¼šæ˜¯Springé‡Œé¢æœ€åº•å±‚çš„æ¥å£ï¼ŒåŒ…å«äº†å„ç§Beançš„å®šä¹‰ï¼Œè¯»å–beané…ç½®æ–‡æ¡£ï¼Œç®¡ç†beançš„åŠ è½½ã€å®ä¾‹åŒ–ï¼Œæ§åˆ¶beançš„ç”Ÿå‘½å‘¨æœŸï¼Œç»´æŠ¤beanä¹‹é—´çš„ä¾èµ–å…³ç³»ã€‚ApplicationContextæ¥å£ä½œä¸ºBeanFactoryçš„æ´¾ç”Ÿï¼Œé™¤äº†æä¾›BeanFactoryæ‰€å…·æœ‰çš„åŠŸèƒ½å¤–ï¼Œè¿˜æä¾›äº†æ›´å®Œæ•´çš„æ¡†æ¶åŠŸèƒ½ï¼š â‘ ç»§æ‰¿MessageSourceï¼Œå› æ­¤æ”¯æŒå›½é™…åŒ–ã€‚ â‘¡ç»Ÿä¸€çš„èµ„æºæ–‡ä»¶è®¿é—®æ–¹å¼ã€‚ â‘¢æä¾›åœ¨ç›‘å¬å™¨ä¸­æ³¨å†Œbeançš„äº‹ä»¶ã€‚ â‘£åŒæ—¶åŠ è½½å¤šä¸ªé…ç½®æ–‡ä»¶ã€‚ â‘¤è½½å…¥å¤šä¸ªï¼ˆæœ‰ç»§æ‰¿å…³ç³»ï¼‰ä¸Šä¸‹æ–‡ ï¼Œä½¿å¾—æ¯ä¸€ä¸ªä¸Šä¸‹æ–‡éƒ½ä¸“æ³¨äºä¸€ä¸ªç‰¹å®šçš„å±‚æ¬¡ï¼Œæ¯”å¦‚åº”ç”¨çš„webå±‚ã€‚ ï¼ˆ2ï¼‰â‘ ==BeanFactroyé‡‡ç”¨çš„æ˜¯å»¶è¿ŸåŠ è½½å½¢å¼æ¥æ³¨å…¥Beançš„==ï¼Œå³åªæœ‰åœ¨ä½¿ç”¨åˆ°æŸä¸ªBeanæ—¶(è°ƒç”¨getBean())ï¼Œæ‰å¯¹è¯¥Beanè¿›è¡ŒåŠ è½½å®ä¾‹åŒ–ã€‚è¿™æ ·ï¼Œæˆ‘ä»¬å°±ä¸èƒ½å‘ç°ä¸€äº›å­˜åœ¨çš„Springçš„é…ç½®é—®é¢˜ã€‚å¦‚æœBeançš„æŸä¸€ä¸ªå±æ€§æ²¡æœ‰æ³¨å…¥ï¼ŒBeanFacotryåŠ è½½åï¼Œç›´è‡³ç¬¬ä¸€æ¬¡ä½¿ç”¨è°ƒç”¨getBeanæ–¹æ³•æ‰ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚ â‘¡==ApplicationContextï¼Œå®ƒæ˜¯åœ¨å®¹å™¨å¯åŠ¨æ—¶ï¼Œä¸€æ¬¡æ€§åˆ›å»ºäº†æ‰€æœ‰çš„Bean==ã€‚è¿™æ ·ï¼Œåœ¨å®¹å™¨å¯åŠ¨æ—¶ï¼Œæˆ‘ä»¬å°±å¯ä»¥å‘ç°Springä¸­å­˜åœ¨çš„é…ç½®é”™è¯¯ï¼Œè¿™æ ·æœ‰åˆ©äºæ£€æŸ¥æ‰€ä¾èµ–å±æ€§æ˜¯å¦æ³¨å…¥ã€‚ ApplicationContextå¯åŠ¨åé¢„è½½å…¥æ‰€æœ‰çš„å•å®ä¾‹Beanï¼Œé€šè¿‡é¢„è½½å…¥å•å®ä¾‹bean ,ç¡®ä¿å½“ä½ éœ€è¦çš„æ—¶å€™ï¼Œä½ å°±ä¸ç”¨ç­‰å¾…ï¼Œå› ä¸ºå®ƒä»¬å·²ç»åˆ›å»ºå¥½äº†ã€‚ â‘¢ç›¸å¯¹äºåŸºæœ¬çš„BeanFactoryï¼ŒApplicationContext å”¯ä¸€çš„ä¸è¶³æ˜¯å ç”¨å†…å­˜ç©ºé—´ã€‚å½“åº”ç”¨ç¨‹åºé…ç½®Beanè¾ƒå¤šæ—¶ï¼Œç¨‹åºå¯åŠ¨è¾ƒæ…¢ã€‚ ï¼ˆ3ï¼‰BeanFactoryé€šå¸¸ä»¥ç¼–ç¨‹çš„æ–¹å¼è¢«åˆ›å»ºï¼ŒApplicationContextè¿˜èƒ½ä»¥å£°æ˜çš„æ–¹å¼åˆ›å»ºï¼Œå¦‚ä½¿ç”¨ContextLoaderã€‚ ï¼ˆ4ï¼‰BeanFactoryå’ŒApplicationContextéƒ½æ”¯æŒBeanPostProcessorã€BeanFactoryPostProcessorçš„ä½¿ç”¨ï¼Œä½†ä¸¤è€…ä¹‹é—´çš„åŒºåˆ«æ˜¯ï¼šBeanFactoryéœ€è¦æ‰‹åŠ¨æ³¨å†Œï¼Œè€ŒApplicationContextåˆ™æ˜¯è‡ªåŠ¨æ³¨å†Œã€‚ 6ã€è¯·è§£é‡ŠSpring Beançš„ç”Ÿå‘½å‘¨æœŸï¼Ÿspringä¸­çš„æ ¸å¿ƒç±»ç­”ï¼šBeanFactoryï¼šäº§ç”Ÿä¸€ä¸ªæ–°çš„å®ä¾‹ï¼Œå¯ä»¥å®ç°å•ä¾‹æ¨¡å¼ BeanWrapperï¼šæä¾›ç»Ÿä¸€çš„getåŠsetæ–¹æ³• ApplicationContext:æä¾›æ¡†æ¶çš„å®ç°ï¼ŒåŒ…æ‹¬BeanFactoryçš„æ‰€æœ‰åŠŸèƒ½ é¦–å…ˆè¯´ä¸€ä¸‹Servletçš„ç”Ÿå‘½å‘¨æœŸï¼š å®ä¾‹åŒ– åˆå§‹init æ¥æ”¶è¯·æ±‚service é”€æ¯destroy Springä¸Šä¸‹æ–‡ä¸­çš„Beanç”Ÿå‘½å‘¨æœŸä¹Ÿç±»ä¼¼ï¼Œå¦‚ä¸‹ï¼šï¼ˆ1ï¼‰å®ä¾‹åŒ–Beanï¼š å¯¹äºBeanFactoryå®¹å™¨ï¼Œå½“å®¢æˆ·å‘å®¹å™¨è¯·æ±‚ä¸€ä¸ªå°šæœªåˆå§‹åŒ–çš„beanæ—¶ï¼Œæˆ–åˆå§‹åŒ–beançš„æ—¶å€™éœ€è¦æ³¨å…¥å¦ä¸€ä¸ªå°šæœªåˆå§‹åŒ–çš„ä¾èµ–æ—¶ï¼Œå®¹å™¨å°±ä¼šè°ƒç”¨createBeanè¿›è¡Œå®ä¾‹åŒ–ã€‚å¯¹äºApplicationContextå®¹å™¨ï¼Œå½“å®¹å™¨å¯åŠ¨ç»“æŸåï¼Œé€šè¿‡è·å–BeanDefinitionå¯¹è±¡ä¸­çš„ä¿¡æ¯ï¼Œå®ä¾‹åŒ–æ‰€æœ‰çš„beanã€‚ ï¼ˆ2ï¼‰è®¾ç½®å¯¹è±¡å±æ€§ï¼ˆä¾èµ–æ³¨å…¥ï¼‰ï¼š==å…ˆè°ƒç”¨ç©ºçš„æ„é€ å™¨, ç„¶åå†ä¾æ¬¡æ³¨å…¥æ•°æ®çš„== å®ä¾‹åŒ–åçš„å¯¹è±¡è¢«å°è£…åœ¨BeanWrapperå¯¹è±¡ä¸­ï¼Œç´§æ¥ç€ï¼ŒSpringæ ¹æ®BeanDefinitionä¸­çš„ä¿¡æ¯ ä»¥åŠ é€šè¿‡BeanWrapperæä¾›çš„è®¾ç½®å±æ€§çš„æ¥å£å®Œæˆä¾èµ–æ³¨å…¥ã€‚ ï¼ˆ3ï¼‰å¤„ç†Awareæ¥å£ï¼š æ¥ç€ï¼ŒSpringä¼šæ£€æµ‹è¯¥å¯¹è±¡æ˜¯å¦å®ç°äº†xxxAwareæ¥å£ï¼Œå¹¶å°†ç›¸å…³çš„xxxAwareå®ä¾‹æ³¨å…¥ç»™Beanï¼š â‘ å¦‚æœè¿™ä¸ªBeanå·²ç»å®ç°äº†BeanNameAwareæ¥å£ï¼Œä¼šè°ƒç”¨å®ƒå®ç°çš„setBeanName(String beanId)æ–¹æ³•ï¼Œæ­¤å¤„ä¼ é€’çš„å°±æ˜¯Springé…ç½®æ–‡ä»¶ä¸­Beançš„idå€¼ï¼› â‘¡å¦‚æœè¿™ä¸ªBeanå·²ç»å®ç°äº†BeanFactoryAwareæ¥å£ï¼Œä¼šè°ƒç”¨å®ƒå®ç°çš„setBeanFactory()æ–¹æ³•ï¼Œä¼ é€’çš„æ˜¯Springå·¥å‚è‡ªèº«ã€‚ â‘¢å¦‚æœè¿™ä¸ªBeanå·²ç»å®ç°äº†ApplicationContextAwareæ¥å£ï¼Œä¼šè°ƒç”¨setApplicationContext(ApplicationContext)æ–¹æ³•ï¼Œä¼ å…¥Springä¸Šä¸‹æ–‡ï¼› ï¼ˆ4ï¼‰BeanPostProcessorï¼š å¦‚æœæƒ³å¯¹Beanè¿›è¡Œä¸€äº›è‡ªå®šä¹‰çš„å¤„ç†ï¼Œé‚£ä¹ˆå¯ä»¥è®©Beanå®ç°äº†BeanPostProcessoræ¥å£ï¼Œé‚£å°†ä¼šè°ƒç”¨postProcessBeforeInitialization(Object obj, String s)æ–¹æ³•ã€‚ç”±äºè¿™ä¸ªæ–¹æ³•æ˜¯åœ¨Beanåˆå§‹åŒ–ç»“æŸæ—¶è°ƒç”¨çš„ï¼Œæ‰€ä»¥å¯ä»¥è¢«åº”ç”¨äºå†…å­˜æˆ–ç¼“å­˜æŠ€æœ¯ï¼› ï¼ˆ5ï¼‰InitializingBean ä¸ init-methodï¼š å¦‚æœBeanåœ¨Springé…ç½®æ–‡ä»¶ä¸­é…ç½®äº† init-method å±æ€§ï¼Œåˆ™ä¼šè‡ªåŠ¨è°ƒç”¨å…¶é…ç½®çš„åˆå§‹åŒ–æ–¹æ³•ã€‚ ï¼ˆ6ï¼‰å¦‚æœè¿™ä¸ªBeanå®ç°äº†BeanPostProcessoræ¥å£ï¼Œå°†ä¼šè°ƒç”¨postProcessAfterInitialization(Object obj, String s)æ–¹æ³•ï¼› ä»¥ä¸Šå‡ ä¸ªæ­¥éª¤å®Œæˆåï¼ŒBeanå°±å·²ç»è¢«æ­£ç¡®åˆ›å»ºäº†ï¼Œä¹‹åå°±å¯ä»¥ä½¿ç”¨è¿™ä¸ªBeanäº†ã€‚ ï¼ˆ7ï¼‰DisposableBeanï¼š å½“Beanä¸å†éœ€è¦æ—¶ï¼Œä¼šç»è¿‡æ¸…ç†é˜¶æ®µï¼Œå¦‚æœBeanå®ç°äº†DisposableBeanè¿™ä¸ªæ¥å£ï¼Œä¼šè°ƒç”¨å…¶å®ç°çš„destroy()æ–¹æ³•ï¼› ï¼ˆ8ï¼‰destroy-methodï¼š æœ€åï¼Œå¦‚æœè¿™ä¸ªBeançš„Springé…ç½®ä¸­é…ç½®äº†destroy-methodå±æ€§ï¼Œä¼šè‡ªåŠ¨è°ƒç”¨å…¶é…ç½®çš„é”€æ¯æ–¹æ³•ã€‚ 7ã€ è§£é‡ŠSpringæ”¯æŒçš„å‡ ç§beançš„ä½œç”¨åŸŸã€‚Springå®¹å™¨ä¸­çš„beanå¯ä»¥åˆ†ä¸º5ä¸ªèŒƒå›´ï¼š ï¼ˆ1ï¼‰==singletonï¼šé»˜è®¤==ï¼Œæ¯ä¸ªå®¹å™¨ä¸­åªæœ‰ä¸€ä¸ªbeançš„å®ä¾‹ï¼Œå•ä¾‹çš„æ¨¡å¼ç”±BeanFactoryè‡ªèº«æ¥ç»´æŠ¤ã€‚ ï¼ˆ2ï¼‰prototypeï¼šä¸ºæ¯ä¸€ä¸ªbeanè¯·æ±‚æä¾›ä¸€ä¸ªå®ä¾‹ã€‚(==é€‚ç”¨äºæœ‰çŠ¶æ€çš„, å¤šçº¿ç¨‹å®‰å…¨æƒ…å†µ==) ï¼ˆ3ï¼‰requestï¼šä¸ºæ¯ä¸€ä¸ªç½‘ç»œè¯·æ±‚åˆ›å»ºä¸€ä¸ªå®ä¾‹ï¼Œåœ¨è¯·æ±‚å®Œæˆä»¥åï¼Œbeanä¼šå¤±æ•ˆå¹¶è¢«åƒåœ¾å›æ”¶å™¨å›æ”¶ã€‚ ï¼ˆ4ï¼‰sessionï¼šä¸requestèŒƒå›´ç±»ä¼¼ï¼Œç¡®ä¿æ¯ä¸ªsessionä¸­æœ‰ä¸€ä¸ªbeançš„å®ä¾‹ï¼Œåœ¨sessionè¿‡æœŸåï¼Œbeanä¼šéšä¹‹å¤±æ•ˆã€‚ ï¼ˆ5ï¼‰global-sessionï¼šå…¨å±€ä½œç”¨åŸŸï¼Œglobal-sessionå’ŒPortletåº”ç”¨ç›¸å…³ã€‚å½“ä½ çš„åº”ç”¨éƒ¨ç½²åœ¨Portletå®¹å™¨ä¸­å·¥ä½œæ—¶ï¼Œå®ƒåŒ…å«å¾ˆå¤športletã€‚å¦‚æœä½ æƒ³è¦å£°æ˜è®©æ‰€æœ‰çš„portletå…±ç”¨å…¨å±€çš„å­˜å‚¨å˜é‡çš„è¯ï¼Œé‚£ä¹ˆè¿™å…¨å±€å˜é‡éœ€è¦å­˜å‚¨åœ¨global-sessionä¸­ã€‚å…¨å±€ä½œç”¨åŸŸä¸Servletä¸­çš„sessionä½œç”¨åŸŸæ•ˆæœç›¸åŒã€‚ 8ã€Springæ¡†æ¶ä¸­çš„å•ä¾‹Beansæ˜¯çº¿ç¨‹å®‰å…¨çš„ä¹ˆï¼Ÿå¯ä»¥è§†ä¸ºå®‰å…¨ Springæ¡†æ¶å¹¶æ²¡æœ‰å¯¹å•ä¾‹beanè¿›è¡Œä»»ä½•å¤šçº¿ç¨‹çš„å°è£…å¤„ç†ã€‚å…³äºå•ä¾‹beançš„çº¿ç¨‹å®‰å…¨å’Œå¹¶å‘é—®é¢˜éœ€è¦å¼€å‘è€…è‡ªè¡Œå»æå®šã€‚ä½†å®é™…ä¸Šï¼Œå¤§éƒ¨åˆ†çš„Spring beanå¹¶æ²¡æœ‰å¯å˜çš„çŠ¶æ€(æ¯”å¦‚Serviewç±»å’ŒDAOç±»)ï¼Œæ‰€ä»¥åœ¨æŸç§ç¨‹åº¦ä¸Šè¯´Springçš„å•ä¾‹beanæ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚å¦‚æœä½ çš„beanæœ‰å¤šç§çŠ¶æ€çš„è¯ï¼ˆæ¯”å¦‚ View Model å¯¹è±¡ï¼‰ï¼Œå°±éœ€è¦è‡ªè¡Œä¿è¯çº¿ç¨‹å®‰å…¨ã€‚æœ€æµ…æ˜¾çš„è§£å†³åŠæ³•å°±æ˜¯å°†å¤šæ€beançš„ä½œç”¨åŸŸç”±â€œsingletonâ€å˜æ›´ä¸ºâ€œprototypeâ€ã€‚ 9ã€Springå¦‚ä½•å¤„ç†çº¿ç¨‹å¹¶å‘é—®é¢˜ï¼Ÿ æ— çŠ¶æ€å¯¹è±¡: å³æ— çŠ¶æ€ç±»ï¼Œæ˜¯æŒ‡å…¶æœ¬èº«æ²¡æœ‰å†…éƒ¨å˜é‡å’Œå¤–éƒ¨å˜é‡çš„æ“ä½œçš„ï¼Œåœ¨æ¯ä¸ªç”¨æˆ·è®¿é—®çš„çº¿ç¨‹æ ˆä¸­éƒ½æ˜¯ä¸€ä¸ªå„è‡ªçš„å®ä¾‹ã€‚ åœ¨ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œåªæœ‰æ— çŠ¶æ€çš„Beanæ‰å¯ä»¥åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹å…±äº«ï¼Œåœ¨Springä¸­ï¼Œç»å¤§éƒ¨åˆ†Beanéƒ½å¯ä»¥å£°æ˜ä¸ºsingletonä½œç”¨åŸŸï¼Œå› ä¸º==Springå¯¹ä¸€äº›Beanä¸­éçº¿ç¨‹å®‰å…¨çŠ¶æ€é‡‡ç”¨ThreadLocalè¿›è¡Œå¤„ç†ï¼Œè§£å†³çº¿ç¨‹å®‰å…¨é—®é¢˜==ã€‚ ThreadLocalå’Œçº¿ç¨‹åŒæ­¥æœºåˆ¶éƒ½æ˜¯ä¸ºäº†è§£å†³å¤šçº¿ç¨‹ä¸­ç›¸åŒå˜é‡çš„è®¿é—®å†²çªé—®é¢˜ã€‚åŒæ­¥æœºåˆ¶é‡‡ç”¨äº†â€œæ—¶é—´æ¢ç©ºé—´â€çš„æ–¹å¼ï¼Œä»…æä¾›ä¸€ä»½å˜é‡ï¼Œä¸åŒçš„çº¿ç¨‹åœ¨è®¿é—®å‰éœ€è¦è·å–é”ï¼Œæ²¡è·å¾—é”çš„çº¿ç¨‹åˆ™éœ€è¦æ’é˜Ÿã€‚è€ŒThreadLocalé‡‡ç”¨äº†â€œç©ºé—´æ¢æ—¶é—´â€çš„æ–¹å¼ã€‚ ThreadLocalä¼šä¸ºæ¯ä¸€ä¸ªçº¿ç¨‹æä¾›ä¸€ä¸ªç‹¬ç«‹çš„å˜é‡å‰¯æœ¬ï¼Œä»è€Œéš”ç¦»äº†å¤šä¸ªçº¿ç¨‹å¯¹æ•°æ®çš„è®¿é—®å†²çªã€‚å› ä¸ºæ¯ä¸€ä¸ªçº¿ç¨‹éƒ½æ‹¥æœ‰è‡ªå·±çš„å˜é‡å‰¯æœ¬ï¼Œä»è€Œä¹Ÿå°±æ²¡æœ‰å¿…è¦å¯¹è¯¥å˜é‡è¿›è¡ŒåŒæ­¥äº†ã€‚ThreadLocalæä¾›äº†çº¿ç¨‹å®‰å…¨çš„å…±äº«å¯¹è±¡ï¼Œåœ¨ç¼–å†™å¤šçº¿ç¨‹ä»£ç æ—¶ï¼Œå¯ä»¥æŠŠä¸å®‰å…¨çš„å˜é‡å°è£…è¿›ThreadLocalã€‚ 10-1ã€SpringåŸºäºxmlæ³¨å…¥beançš„å‡ ç§æ–¹å¼ï¼šï¼ˆ1ï¼‰Setæ–¹æ³•æ³¨å…¥ï¼›setæ–¹æ³•ï¼ˆè¿™æ˜¯iocçš„æ³¨å…¥å…¥å£ï¼‰ ï¼ˆ2ï¼‰æ„é€ å™¨æ³¨å…¥ï¼šè¿™ç§æ–¹å¼çš„æ³¨å…¥æ˜¯æŒ‡å¸¦æœ‰å‚æ•°çš„æ„é€ å‡½æ•°æ³¨å…¥ public SpringAction(SpringDao springDao,User user){}â‘ é€šè¿‡indexè®¾ç½®å‚æ•°çš„ä½ç½®ï¼› &lt;bean name=&quot;springAction&quot; class=&quot;com.bless.springdemo.action.SpringAction&quot;&gt; &lt;constructor-arg index=&quot;0&quot; ref=&quot;springDao&quot;&gt;&lt;/constructor-arg&gt; &lt;constructor-arg index=&quot;1&quot; ref=&quot;user&quot;&gt;&lt;/constructor-arg&gt; &lt;/bean&gt; 123456789101112- â‘¡é€šè¿‡typeè®¾ç½®å‚æ•°ç±»å‹ï¼› ```xml &lt;!--é…ç½®bean,é…ç½®åè¯¥ç±»ç”±springç®¡ç†--&gt; &lt;bean name=&quot;springAction&quot; class=&quot;com.bless.springdemo.action.SpringAction&quot;&gt; &lt;!--(2)åˆ›å»ºæ„é€ å™¨æ³¨å…¥,å¦‚æœä¸»ç±»æœ‰å¸¦å‚çš„æ„é€ æ–¹æ³•åˆ™éœ€æ·»åŠ æ­¤é…ç½®--&gt; &lt;constructor-arg ref=&quot;springDao&quot;&gt;&lt;/constructor-arg&gt; &lt;constructor-arg ref=&quot;user&quot;&gt;&lt;/constructor-arg&gt; &lt;/bean&gt; &lt;bean name=&quot;springDao&quot; class=&quot;com.bless.springdemo.dao.impl.SpringDaoImpl&quot;&gt;&lt;/bean&gt; &lt;bean name=&quot;user&quot; class=&quot;com.bless.springdemo.vo.User&quot;&gt;&lt;/bean&gt; ï¼ˆ3ï¼‰é™æ€å·¥å‚æ³¨å…¥ï¼›å°±æ˜¯é€šè¿‡è°ƒç”¨é™æ€å·¥å‚çš„æ–¹æ³•æ¥è·å–è‡ªå·±éœ€è¦çš„å¯¹è±¡ï¼Œä¸ºäº†è®©springç®¡ç†æ‰€æœ‰å¯¹è±¡ï¼Œæˆ‘ä»¬ä¸èƒ½ç›´æ¥é€šè¿‡â€å·¥ç¨‹ç±».é™æ€æ–¹æ³•()â€æ¥è·å–å¯¹è±¡ï¼Œè€Œæ˜¯ä¾ç„¶é€šè¿‡springæ³¨å…¥çš„å½¢å¼è·å– 123456789101112package com.bless.springdemo.factory; import com.bless.springdemo.dao.FactoryDao; import com.bless.springdemo.dao.impl.FactoryDaoImpl; import com.bless.springdemo.dao.impl.StaticFacotryDaoImpl; public class DaoFactory &#123; //é™æ€å·¥å‚ public static final FactoryDao getStaticFactoryDaoImpl()&#123; return new StaticFacotryDaoImpl(); &#125; &#125; 12345678&lt;!--é…ç½®bean,é…ç½®åè¯¥ç±»ç”±springç®¡ç†--&gt; &lt;bean name=\"springAction\" class=\"com.bless.springdemo.action.SpringAction\" &gt; &lt;!--(3)ä½¿ç”¨é™æ€å·¥å‚çš„æ–¹æ³•æ³¨å…¥å¯¹è±¡,å¯¹åº”ä¸‹é¢çš„é…ç½®æ–‡ä»¶(3)--&gt; &lt;property name=\"staticFactoryDao\" ref=\"staticFactoryDao\"&gt;&lt;/property&gt; &lt;/property&gt; &lt;/bean&gt; &lt;!--(3)æ­¤å¤„è·å–å¯¹è±¡çš„æ–¹å¼æ˜¯ä»å·¥å‚ç±»ä¸­è·å–é™æ€æ–¹æ³•--&gt; &lt;bean name=\"staticFactoryDao\" class=\"com.bless.springdemo.factory.DaoFactory\" factory-method=\"getStaticFactoryDaoImpl\"&gt;&lt;/bean&gt; ï¼ˆ4ï¼‰å®ä¾‹å·¥å‚ï¼›å…ˆnew å·¥å‚ç±», å†é€šè¿‡å·¥å‚ç±»new å®ä¾‹ 123456789&lt;!--é…ç½®bean,é…ç½®åè¯¥ç±»ç”±springç®¡ç†--&gt; &lt;bean name=\"springAction\" class=\"com.bless.springdemo.action.SpringAction\"&gt; &lt;!--(4)ä½¿ç”¨å®ä¾‹å·¥å‚çš„æ–¹æ³•æ³¨å…¥å¯¹è±¡,å¯¹åº”ä¸‹é¢çš„é…ç½®æ–‡ä»¶(4)--&gt; &lt;property name=\"factoryDao\" ref=\"factoryDao\"&gt;&lt;/property&gt; &lt;/bean&gt; &lt;!--(4)æ­¤å¤„è·å–å¯¹è±¡çš„æ–¹å¼æ˜¯ä»å·¥å‚ç±»ä¸­è·å–å®ä¾‹æ–¹æ³•--&gt; &lt;bean name=\"daoFactory\" class=\"com.bless.springdemo.factory.DaoFactory\"&gt;&lt;/bean&gt; &lt;bean name=\"factoryDao\" factory-bean=\"daoFactory\" factory-method=\"getFactoryDaoImpl\"&gt;&lt;/bean&gt; è¯¦ç»†å†…å®¹å¯ä»¥é˜…è¯»ï¼šhttps://blog.csdn.net/a745233700/article/details/89307518 10-2ã€Springçš„è‡ªåŠ¨è£…é…ï¼šåœ¨springä¸­ï¼Œå¯¹è±¡æ— éœ€è‡ªå·±æŸ¥æ‰¾æˆ–åˆ›å»ºä¸å…¶å…³è”çš„å…¶ä»–å¯¹è±¡ï¼Œç”±å®¹å™¨è´Ÿè´£æŠŠéœ€è¦ç›¸äº’åä½œçš„å¯¹è±¡å¼•ç”¨èµ‹äºˆå„ä¸ªå¯¹è±¡ï¼Œä½¿ç”¨autowireæ¥é…ç½®è‡ªåŠ¨è£…è½½æ¨¡å¼ã€‚ åœ¨Springæ¡†æ¶xmlé…ç½®ä¸­å…±æœ‰5ç§è‡ªåŠ¨è£…é…ï¼š ï¼ˆ1ï¼‰noï¼šé»˜è®¤çš„æ–¹å¼æ˜¯ä¸è¿›è¡Œè‡ªåŠ¨è£…é…çš„ï¼Œé€šè¿‡æ‰‹å·¥è®¾ç½®refå±æ€§æ¥è¿›è¡Œè£…é…beanã€‚ ï¼ˆ2ï¼‰byNameï¼šé€šè¿‡beançš„åç§°è¿›è¡Œè‡ªåŠ¨è£…é…ï¼Œå¦‚æœä¸€ä¸ªbeançš„ property ä¸å¦ä¸€bean çš„name ç›¸åŒï¼Œå°±è¿›è¡Œè‡ªåŠ¨è£…é…ã€‚ ï¼ˆ3ï¼‰byTypeï¼šé€šè¿‡å‚æ•°çš„æ•°æ®ç±»å‹è¿›è¡Œè‡ªåŠ¨è£…é…ã€‚ ï¼ˆ4ï¼‰constructorï¼šåˆ©ç”¨æ„é€ å‡½æ•°è¿›è¡Œè£…é…ï¼Œå¹¶ä¸”æ„é€ å‡½æ•°çš„å‚æ•°é€šè¿‡byTypeè¿›è¡Œè£…é…ã€‚ ï¼ˆ5ï¼‰autodetectï¼šè‡ªåŠ¨æ¢æµ‹ï¼Œå¦‚æœæœ‰æ„é€ æ–¹æ³•ï¼Œé€šè¿‡ constructçš„æ–¹å¼è‡ªåŠ¨è£…é…ï¼Œå¦åˆ™ä½¿ç”¨ byTypeçš„æ–¹å¼è‡ªåŠ¨è£…é…ã€‚ åŸºäºæ³¨è§£çš„æ–¹å¼ï¼šä½¿ç”¨@Autowiredæ³¨è§£æ¥è‡ªåŠ¨è£…é…æŒ‡å®šçš„beanã€‚åœ¨ä½¿ç”¨@Autowiredæ³¨è§£ä¹‹å‰éœ€è¦åœ¨Springé…ç½®æ–‡ä»¶è¿›è¡Œé…ç½®ï¼Œ&lt;context:annotation-config /&gt;ã€‚åœ¨å¯åŠ¨spring IoCæ—¶ï¼Œå®¹å™¨è‡ªåŠ¨è£…è½½äº†ä¸€ä¸ªAutowiredAnnotationBeanPostProcessoråç½®å¤„ç†å™¨ï¼Œå½“å®¹å™¨æ‰«æåˆ°@Autowiedã€@Resourceæˆ–@Injectæ—¶ï¼Œå°±ä¼šåœ¨IoCå®¹å™¨è‡ªåŠ¨æŸ¥æ‰¾éœ€è¦çš„beanï¼Œå¹¶è£…é…ç»™è¯¥å¯¹è±¡çš„å±æ€§ã€‚åœ¨ä½¿ç”¨@Autowiredæ—¶ï¼Œé¦–å…ˆåœ¨å®¹å™¨ä¸­æŸ¥è¯¢å¯¹åº”ç±»å‹çš„beanï¼š å¦‚æœæŸ¥è¯¢ç»“æœåˆšå¥½ä¸ºä¸€ä¸ªï¼Œå°±å°†è¯¥beanè£…é…ç»™@AutowiredæŒ‡å®šçš„æ•°æ®ï¼› å¦‚æœæŸ¥è¯¢çš„ç»“æœä¸æ­¢ä¸€ä¸ªï¼Œé‚£ä¹ˆ@Autowiredä¼šæ ¹æ®åç§°æ¥æŸ¥æ‰¾ï¼› å¦‚æœä¸Šè¿°æŸ¥æ‰¾çš„ç»“æœä¸ºç©ºï¼Œé‚£ä¹ˆä¼šæŠ›å‡ºå¼‚å¸¸ã€‚è§£å†³æ–¹æ³•æ—¶ï¼Œä½¿ç”¨required=falseã€‚ @Autowiredå¯ç”¨äºï¼šæ„é€ å‡½æ•°ã€æˆå‘˜å˜é‡ã€Setteræ–¹æ³• æ³¨ï¼š@Autowiredå’Œ@Resourceä¹‹é—´çš„åŒºåˆ«(1) @Autowiredé»˜è®¤æ˜¯æŒ‰ç…§ç±»å‹è£…é…æ³¨å…¥çš„ï¼Œé»˜è®¤æƒ…å†µä¸‹å®ƒè¦æ±‚ä¾èµ–å¯¹è±¡å¿…é¡»å­˜åœ¨ï¼ˆå¯ä»¥è®¾ç½®å®ƒrequiredå±æ€§ä¸ºfalseï¼‰ã€‚ (2) @Resourceé»˜è®¤æ˜¯æŒ‰ç…§åç§°æ¥è£…é…æ³¨å…¥çš„ï¼Œåªæœ‰å½“æ‰¾ä¸åˆ°ä¸åç§°åŒ¹é…çš„beanæ‰ä¼šæŒ‰ç…§ç±»å‹æ¥è£…é…æ³¨å…¥ã€‚ 11ã€Spring æ¡†æ¶ä¸­éƒ½ç”¨åˆ°äº†å“ªäº›è®¾è®¡æ¨¡å¼ï¼Ÿ!!!!! ï¼ˆ1ï¼‰å·¥å‚æ¨¡å¼ï¼šBeanFactoryå°±æ˜¯ç®€å•å·¥å‚æ¨¡å¼çš„ä½“ç°ï¼Œç”¨æ¥åˆ›å»ºå¯¹è±¡çš„å®ä¾‹ï¼› ï¼ˆ2ï¼‰å•ä¾‹æ¨¡å¼ï¼šBeané»˜è®¤ä¸ºå•ä¾‹æ¨¡å¼ã€‚ ï¼ˆ3ï¼‰ä»£ç†æ¨¡å¼ï¼šSpringçš„AOPåŠŸèƒ½ç”¨åˆ°äº†JDKçš„åŠ¨æ€ä»£ç†å’ŒCGLIBå­—èŠ‚ç ç”ŸæˆæŠ€æœ¯ï¼› ï¼ˆ4ï¼‰æ¨¡æ¿æ–¹æ³•ï¼šç”¨æ¥è§£å†³ä»£ç é‡å¤çš„é—®é¢˜ã€‚æ¯”å¦‚. RestTemplate, JmsTemplate, JpaTemplateã€‚ ï¼ˆ5ï¼‰è§‚å¯Ÿè€…æ¨¡å¼ï¼šå®šä¹‰å¯¹è±¡é”®ä¸€ç§ä¸€å¯¹å¤šçš„ä¾èµ–å…³ç³»ï¼Œå½“ä¸€ä¸ªå¯¹è±¡çš„çŠ¶æ€å‘ç”Ÿæ”¹å˜æ—¶ï¼Œæ‰€æœ‰ä¾èµ–äºå®ƒçš„å¯¹è±¡éƒ½ä¼šå¾—åˆ°é€šçŸ¥è¢«åˆ¶åŠ¨æ›´æ–°ï¼Œå¦‚Springä¸­listenerçš„å®ç°â€“ApplicationListenerã€‚ 12ã€Springäº‹åŠ¡çš„å®ç°æ–¹å¼å’Œå®ç°åŸç†ï¼šSpringäº‹åŠ¡çš„æœ¬è´¨å…¶å®å°±æ˜¯æ•°æ®åº“å¯¹äº‹åŠ¡çš„æ”¯æŒï¼Œæ²¡æœ‰æ•°æ®åº“çš„äº‹åŠ¡æ”¯æŒï¼Œspringæ˜¯æ— æ³•æä¾›äº‹åŠ¡åŠŸèƒ½çš„ã€‚çœŸæ­£çš„æ•°æ®åº“å±‚çš„äº‹åŠ¡æäº¤å’Œå›æ»šæ˜¯é€šè¿‡binlogæˆ–è€…redo logå®ç°çš„ã€‚ ï¼ˆ1ï¼‰Springäº‹åŠ¡çš„ç§ç±»ï¼šspringæ”¯æŒç¼–ç¨‹å¼äº‹åŠ¡ç®¡ç†å’Œå£°æ˜å¼äº‹åŠ¡ç®¡ç†ä¸¤ç§æ–¹å¼ï¼šç¼–ç¨‹å¼,é¡¾åæ€ä¹‰éœ€è¦ä½“ç°åœ¨ä¸šåŠ¡ä»£ç çš„ç¼–å†™ä¸­, è€Œå£°æ˜å¼ç›¸å½“äºæ³¨è§£çš„æ–¹å¼, å†™ä¸Šæ³¨è§£ä¹‹å,springæ¡†æ¶åˆ©ç”¨aopæŠ€æœ¯è¿›è¡Œäº‹åŠ¡ç®¡ç† â‘ ç¼–ç¨‹å¼äº‹åŠ¡ç®¡ç†ä½¿ç”¨TransactionTemplateã€‚ â‘¡å£°æ˜å¼äº‹åŠ¡ç®¡ç†å»ºç«‹åœ¨AOPä¹‹ä¸Šçš„ã€‚å…¶æœ¬è´¨æ˜¯é€šè¿‡AOPåŠŸèƒ½ï¼Œå¯¹æ–¹æ³•å‰åè¿›è¡Œæ‹¦æˆªï¼Œå°†äº‹åŠ¡å¤„ç†çš„åŠŸèƒ½ç¼–ç»‡åˆ°æ‹¦æˆªçš„æ–¹æ³•ä¸­ï¼Œä¹Ÿå°±æ˜¯åœ¨ç›®æ ‡æ–¹æ³•å¼€å§‹ä¹‹å‰åŠ å…¥ä¸€ä¸ªäº‹åŠ¡ï¼Œåœ¨æ‰§è¡Œå®Œç›®æ ‡æ–¹æ³•ä¹‹åæ ¹æ®æ‰§è¡Œæƒ…å†µæäº¤æˆ–è€…å›æ»šäº‹åŠ¡ã€‚ å£°æ˜å¼äº‹åŠ¡æœ€å¤§çš„ä¼˜ç‚¹å°±æ˜¯ä¸éœ€è¦åœ¨ä¸šåŠ¡é€»è¾‘ä»£ç ä¸­æºæ‚äº‹åŠ¡ç®¡ç†çš„ä»£ç ï¼Œåªéœ€åœ¨é…ç½®æ–‡ä»¶ä¸­åšç›¸å…³çš„äº‹åŠ¡è§„åˆ™å£°æ˜æˆ–é€šè¿‡@Transactionalæ³¨è§£çš„æ–¹å¼ï¼Œä¾¿å¯ä»¥å°†äº‹åŠ¡è§„åˆ™åº”ç”¨åˆ°ä¸šåŠ¡é€»è¾‘ä¸­ã€‚ å£°æ˜å¼äº‹åŠ¡ç®¡ç†è¦ä¼˜äºç¼–ç¨‹å¼äº‹åŠ¡ç®¡ç†ï¼Œè¿™æ­£æ˜¯springå€¡å¯¼çš„éä¾µå…¥å¼çš„å¼€å‘æ–¹å¼ï¼Œä½¿ä¸šåŠ¡ä»£ç ä¸å—æ±¡æŸ“ï¼Œåªè¦åŠ ä¸Šæ³¨è§£å°±å¯ä»¥è·å¾—å®Œå…¨çš„äº‹åŠ¡æ”¯æŒã€‚å”¯ä¸€ä¸è¶³åœ°æ–¹æ˜¯ï¼Œæœ€ç»†ç²’åº¦åªèƒ½ä½œç”¨åˆ°æ–¹æ³•çº§åˆ«ï¼Œæ— æ³•åšåˆ°åƒç¼–ç¨‹å¼äº‹åŠ¡é‚£æ ·å¯ä»¥ä½œç”¨åˆ°ä»£ç å—çº§åˆ«ã€‚ ï¼ˆ2ï¼‰springçš„äº‹åŠ¡ä¼ æ’­è¡Œä¸ºï¼špropagation ä¼ æ’­, ç»§æ‰¿ springäº‹åŠ¡çš„ä¼ æ’­è¡Œä¸ºè¯´çš„æ˜¯ï¼Œå½“å¤šä¸ªäº‹åŠ¡åŒæ—¶å­˜åœ¨çš„æ—¶å€™ï¼Œspringå¦‚ä½•å¤„ç†è¿™äº›äº‹åŠ¡çš„è¡Œä¸ºã€‚ ==â‘  PROPAGATION_REQUIREDï¼šå¦‚æœå½“å‰æ²¡æœ‰äº‹åŠ¡ï¼Œå°±åˆ›å»ºä¸€ä¸ªæ–°äº‹åŠ¡ï¼Œå¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œå°±åŠ å…¥è¯¥äº‹åŠ¡ï¼Œè¯¥è®¾ç½®æ˜¯æœ€å¸¸ç”¨çš„è®¾ç½®ã€‚== â‘¡ PROPAGATION_SUPPORTSï¼šæ”¯æŒå½“å‰äº‹åŠ¡ï¼Œå¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œå°±åŠ å…¥è¯¥äº‹åŠ¡ï¼Œå¦‚æœå½“å‰ä¸å­˜åœ¨äº‹åŠ¡ï¼Œå°±ä»¥éäº‹åŠ¡æ‰§è¡Œã€‚â€˜ â‘¢ PROPAGATION_MANDATORYï¼šæ”¯æŒå½“å‰äº‹åŠ¡ï¼Œå¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œå°±åŠ å…¥è¯¥äº‹åŠ¡ï¼Œå¦‚æœå½“å‰ä¸å­˜åœ¨äº‹åŠ¡ï¼Œå°±æŠ›å‡ºå¼‚å¸¸ã€‚ ==â‘£ PROPAGATION_REQUIRES_NEWï¼šåˆ›å»ºæ–°äº‹åŠ¡ï¼Œæ— è®ºå½“å‰å­˜ä¸å­˜åœ¨äº‹åŠ¡ï¼Œéƒ½åˆ›å»ºæ–°äº‹åŠ¡ã€‚== â‘¤ PROPAGATION_NOT_SUPPORTEDï¼šä»¥éäº‹åŠ¡æ–¹å¼æ‰§è¡Œæ“ä½œï¼Œå¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œå°±æŠŠå½“å‰äº‹åŠ¡æŒ‚èµ·ã€‚ â‘¥ PROPAGATION_NEVERï¼šä»¥éäº‹åŠ¡æ–¹å¼æ‰§è¡Œï¼Œå¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸ã€‚ ==â‘¦ PROPAGATION_NESTEDï¼šå¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™åœ¨åµŒå¥—äº‹åŠ¡å†…æ‰§è¡Œã€‚å¦‚æœå½“å‰æ²¡æœ‰äº‹åŠ¡ï¼Œåˆ™æŒ‰REQUIREDå±æ€§æ‰§è¡Œã€‚== ï¼ˆ3ï¼‰Springä¸­çš„éš”ç¦»çº§åˆ«ï¼š â‘  ISOLATION_DEFAULTï¼šè¿™æ˜¯ä¸ª PlatfromTransactionManager é»˜è®¤çš„éš”ç¦»çº§åˆ«ï¼Œä½¿ç”¨æ•°æ®åº“é»˜è®¤çš„äº‹åŠ¡éš”ç¦»çº§åˆ«ã€‚ â‘¡ ISOLATION_READ_UNCOMMITTEDï¼šè¯»æœªæäº¤ï¼Œå…è®¸å¦å¤–ä¸€ä¸ªäº‹åŠ¡å¯ä»¥çœ‹åˆ°è¿™ä¸ªäº‹åŠ¡æœªæäº¤çš„æ•°æ®ã€‚ â‘¢ ISOLATION_READ_COMMITTEDï¼šè¯»å·²æäº¤ï¼Œä¿è¯ä¸€ä¸ªäº‹åŠ¡ä¿®æ”¹çš„æ•°æ®æäº¤åæ‰èƒ½è¢«å¦ä¸€äº‹åŠ¡è¯»å–ï¼Œè€Œä¸”èƒ½çœ‹åˆ°è¯¥äº‹åŠ¡å¯¹å·²æœ‰è®°å½•çš„æ›´æ–°ã€‚ â‘£ ISOLATION_REPEATABLE_READï¼šå¯é‡å¤è¯»ï¼Œä¿è¯ä¸€ä¸ªäº‹åŠ¡ä¿®æ”¹çš„æ•°æ®æäº¤åæ‰èƒ½è¢«å¦ä¸€äº‹åŠ¡è¯»å–ï¼Œä½†æ˜¯ä¸èƒ½çœ‹åˆ°è¯¥äº‹åŠ¡å¯¹å·²æœ‰è®°å½•çš„æ›´æ–°ã€‚ â‘¤ ISOLATION_SERIALIZABLEï¼šä¸€ä¸ªäº‹åŠ¡åœ¨æ‰§è¡Œçš„è¿‡ç¨‹ä¸­å®Œå…¨çœ‹ä¸åˆ°å…¶ä»–äº‹åŠ¡å¯¹æ•°æ®åº“æ‰€åšçš„æ›´æ–°ã€‚ 13ã€Springæ¡†æ¶ä¸­æœ‰å“ªäº›ä¸åŒç±»å‹çš„äº‹ä»¶ï¼ŸSpring æä¾›äº†ä»¥ä¸‹5ç§æ ‡å‡†çš„äº‹ä»¶ï¼š ï¼ˆ1ï¼‰ä¸Šä¸‹æ–‡æ›´æ–°äº‹ä»¶ï¼ˆContextRefreshedEventï¼‰ï¼šåœ¨è°ƒç”¨ConfigurableApplicationContext æ¥å£ä¸­çš„refresh()æ–¹æ³•æ—¶è¢«è§¦å‘ã€‚ ï¼ˆ2ï¼‰ä¸Šä¸‹æ–‡å¼€å§‹äº‹ä»¶ï¼ˆContextStartedEventï¼‰ï¼šå½“å®¹å™¨è°ƒç”¨ConfigurableApplicationContextçš„Start()æ–¹æ³•å¼€å§‹/é‡æ–°å¼€å§‹å®¹å™¨æ—¶è§¦å‘è¯¥äº‹ä»¶ã€‚ ï¼ˆ3ï¼‰ä¸Šä¸‹æ–‡åœæ­¢äº‹ä»¶ï¼ˆContextStoppedEventï¼‰ï¼šå½“å®¹å™¨è°ƒç”¨ConfigurableApplicationContextçš„Stop()æ–¹æ³•åœæ­¢å®¹å™¨æ—¶è§¦å‘è¯¥äº‹ä»¶ã€‚ ï¼ˆ4ï¼‰ä¸Šä¸‹æ–‡å…³é—­äº‹ä»¶ï¼ˆContextClosedEventï¼‰ï¼šå½“ApplicationContextè¢«å…³é—­æ—¶è§¦å‘è¯¥äº‹ä»¶ã€‚å®¹å™¨è¢«å…³é—­æ—¶ï¼Œå…¶ç®¡ç†çš„æ‰€æœ‰å•ä¾‹Beanéƒ½è¢«é”€æ¯ã€‚ ï¼ˆ5ï¼‰è¯·æ±‚å¤„ç†äº‹ä»¶ï¼ˆRequestHandledEventï¼‰ï¼šåœ¨Webåº”ç”¨ä¸­ï¼Œå½“ä¸€ä¸ªhttpè¯·æ±‚ï¼ˆrequestï¼‰ç»“æŸè§¦å‘è¯¥äº‹ä»¶ã€‚ å¦‚æœä¸€ä¸ªbeanå®ç°äº†ApplicationListeneræ¥å£ï¼Œå½“ä¸€ä¸ªApplicationEvent è¢«å‘å¸ƒä»¥åï¼Œbeanä¼šè‡ªåŠ¨è¢«é€šçŸ¥ã€‚ 14ã€è§£é‡Šä¸€ä¸‹Spring AOPé‡Œé¢çš„å‡ ä¸ªåè¯ï¼š ï¼ˆ1ï¼‰åˆ‡é¢ï¼ˆAspectï¼‰ï¼šè¢«æŠ½å–çš„å…¬å…±æ¨¡å—ï¼Œå¯èƒ½ä¼šæ¨ªåˆ‡å¤šä¸ªå¯¹è±¡ã€‚ åœ¨Spring AOPä¸­ï¼Œåˆ‡é¢å¯ä»¥ä½¿ç”¨é€šç”¨ç±»ï¼ˆåŸºäºæ¨¡å¼çš„é£æ ¼ï¼‰ æˆ–è€…åœ¨æ™®é€šç±»ä¸­ä»¥ @AspectJ æ³¨è§£æ¥å®ç°ã€‚ ï¼ˆ2ï¼‰è¿æ¥ç‚¹ï¼ˆJoin pointï¼‰ï¼šæŒ‡æ–¹æ³•ï¼Œåœ¨Spring AOPä¸­ï¼Œä¸€ä¸ªè¿æ¥ç‚¹ æ€»æ˜¯ ä»£è¡¨ä¸€ä¸ªæ–¹æ³•çš„æ‰§è¡Œã€‚ ï¼ˆ3ï¼‰é€šçŸ¥ï¼ˆAdviceï¼‰ï¼šåœ¨åˆ‡é¢çš„æŸä¸ªç‰¹å®šçš„è¿æ¥ç‚¹ï¼ˆJoin pointï¼‰ä¸Šæ‰§è¡Œçš„åŠ¨ä½œã€‚é€šçŸ¥æœ‰å„ç§ç±»å‹ï¼Œå…¶ä¸­åŒ…æ‹¬â€œaroundâ€ã€â€œbeforeâ€å’Œâ€œafterâ€ç­‰é€šçŸ¥ã€‚è®¸å¤šAOPæ¡†æ¶ï¼ŒåŒ…æ‹¬Springï¼Œéƒ½æ˜¯ä»¥æ‹¦æˆªå™¨åšé€šçŸ¥æ¨¡å‹ï¼Œ å¹¶ç»´æŠ¤ä¸€ä¸ªä»¥è¿æ¥ç‚¹ä¸ºä¸­å¿ƒçš„æ‹¦æˆªå™¨é“¾ã€‚ ï¼ˆ4ï¼‰åˆ‡å…¥ç‚¹ï¼ˆPointcutï¼‰ï¼šåˆ‡å…¥ç‚¹æ˜¯æŒ‡ æˆ‘ä»¬è¦å¯¹å“ªäº›Join pointè¿›è¡Œæ‹¦æˆªçš„å®šä¹‰ã€‚é€šè¿‡åˆ‡å…¥ç‚¹è¡¨è¾¾å¼ï¼ŒæŒ‡å®šæ‹¦æˆªçš„æ–¹æ³•ï¼Œæ¯”å¦‚æŒ‡å®šæ‹¦æˆªaddã€searchã€‚ ï¼ˆ5ï¼‰å¼•å…¥ï¼ˆIntroductionï¼‰ï¼šï¼ˆä¹Ÿè¢«ç§°ä¸ºå†…éƒ¨ç±»å‹å£°æ˜ï¼ˆinter-type declarationï¼‰ï¼‰ã€‚å£°æ˜é¢å¤–çš„æ–¹æ³•æˆ–è€…æŸä¸ªç±»å‹çš„å­—æ®µã€‚Springå…è®¸å¼•å…¥æ–°çš„æ¥å£ï¼ˆä»¥åŠä¸€ä¸ªå¯¹åº”çš„å®ç°ï¼‰åˆ°ä»»ä½•è¢«ä»£ç†çš„å¯¹è±¡ã€‚ä¾‹å¦‚ï¼Œä½ å¯ä»¥ä½¿ç”¨ä¸€ä¸ªå¼•å…¥æ¥ä½¿beanå®ç° IsModified æ¥å£ï¼Œä»¥ä¾¿ç®€åŒ–ç¼“å­˜æœºåˆ¶ã€‚ ï¼ˆ6ï¼‰ç›®æ ‡å¯¹è±¡ï¼ˆTarget Objectï¼‰ï¼š è¢«ä¸€ä¸ªæˆ–è€…å¤šä¸ªåˆ‡é¢ï¼ˆaspectï¼‰æ‰€é€šçŸ¥ï¼ˆadviseï¼‰çš„å¯¹è±¡ã€‚ä¹Ÿæœ‰äººæŠŠå®ƒå«åš è¢«é€šçŸ¥ï¼ˆadvicedï¼‰ å¯¹è±¡ã€‚ æ—¢ç„¶Spring AOPæ˜¯é€šè¿‡è¿è¡Œæ—¶ä»£ç†å®ç°çš„ï¼Œè¿™ä¸ªå¯¹è±¡æ°¸è¿œæ˜¯ä¸€ä¸ª è¢«ä»£ç†ï¼ˆproxiedï¼‰ å¯¹è±¡ã€‚ ï¼ˆ7ï¼‰ç»‡å…¥ï¼ˆWeavingï¼‰ï¼šæŒ‡æŠŠå¢å¼ºåº”ç”¨åˆ°ç›®æ ‡å¯¹è±¡æ¥åˆ›å»ºæ–°çš„ä»£ç†å¯¹è±¡çš„è¿‡ç¨‹ã€‚Springæ˜¯åœ¨è¿è¡Œæ—¶å®Œæˆç»‡å…¥ã€‚ åˆ‡å…¥ç‚¹ï¼ˆpointcutï¼‰å’Œè¿æ¥ç‚¹ï¼ˆjoin pointï¼‰åŒ¹é…çš„æ¦‚å¿µæ˜¯AOPçš„å…³é”®ï¼Œè¿™ä½¿å¾—AOPä¸åŒäºå…¶å®ƒä»…ä»…æä¾›æ‹¦æˆªåŠŸèƒ½çš„æ—§æŠ€æœ¯ã€‚ åˆ‡å…¥ç‚¹ä½¿å¾—å®šä½é€šçŸ¥ï¼ˆadviceï¼‰å¯ç‹¬ç«‹äºOOå±‚æ¬¡ã€‚ ä¾‹å¦‚ï¼Œä¸€ä¸ªæä¾›å£°æ˜å¼äº‹åŠ¡ç®¡ç†çš„aroundé€šçŸ¥å¯ä»¥è¢«åº”ç”¨åˆ°ä¸€ç»„æ¨ªè·¨å¤šä¸ªå¯¹è±¡ä¸­çš„æ–¹æ³•ä¸Šï¼ˆä¾‹å¦‚æœåŠ¡å±‚çš„æ‰€æœ‰ä¸šåŠ¡æ“ä½œï¼‰ã€‚ 15ã€Springé€šçŸ¥æœ‰å“ªäº›ç±»å‹ï¼Ÿhttps://blog.csdn.net/qq_32331073/article/details/80596084 ï¼ˆ1ï¼‰å‰ç½®é€šçŸ¥ï¼ˆBefore adviceï¼‰ï¼šåœ¨æŸè¿æ¥ç‚¹ï¼ˆjoin pointï¼‰ä¹‹å‰æ‰§è¡Œçš„é€šçŸ¥ï¼Œä½†è¿™ä¸ªé€šçŸ¥ä¸èƒ½é˜»æ­¢è¿æ¥ç‚¹å‰çš„æ‰§è¡Œï¼ˆé™¤éå®ƒæŠ›å‡ºä¸€ä¸ªå¼‚å¸¸ï¼‰ã€‚ ï¼ˆ2ï¼‰è¿”å›åé€šçŸ¥ï¼ˆAfter returning adviceï¼‰ï¼šåœ¨æŸè¿æ¥ç‚¹ï¼ˆjoin pointï¼‰æ­£å¸¸å®Œæˆåæ‰§è¡Œçš„é€šçŸ¥ï¼šä¾‹å¦‚ï¼Œä¸€ä¸ªæ–¹æ³•æ²¡æœ‰æŠ›å‡ºä»»ä½•å¼‚å¸¸ï¼Œæ­£å¸¸è¿”å›ã€‚ ï¼ˆ3ï¼‰æŠ›å‡ºå¼‚å¸¸åé€šçŸ¥ï¼ˆAfter throwing adviceï¼‰ï¼šåœ¨æ–¹æ³•æŠ›å‡ºå¼‚å¸¸é€€å‡ºæ—¶æ‰§è¡Œçš„é€šçŸ¥ã€‚ ï¼ˆ4ï¼‰åé€šçŸ¥ï¼ˆAfter (finally) adviceï¼‰ï¼šå½“æŸè¿æ¥ç‚¹é€€å‡ºçš„æ—¶å€™æ‰§è¡Œçš„é€šçŸ¥ï¼ˆä¸è®ºæ˜¯æ­£å¸¸è¿”å›è¿˜æ˜¯å¼‚å¸¸é€€å‡ºï¼‰ã€‚ ï¼ˆ5ï¼‰ç¯ç»•é€šçŸ¥ï¼ˆAround Adviceï¼‰ï¼šåŒ…å›´ä¸€ä¸ªè¿æ¥ç‚¹ï¼ˆjoin pointï¼‰çš„é€šçŸ¥ï¼Œå¦‚æ–¹æ³•è°ƒç”¨ã€‚è¿™æ˜¯æœ€å¼ºå¤§çš„ä¸€ç§é€šçŸ¥ç±»å‹ã€‚ ç¯ç»•é€šçŸ¥å¯ä»¥åœ¨æ–¹æ³•è°ƒç”¨å‰åå®Œæˆè‡ªå®šä¹‰çš„è¡Œä¸ºã€‚å®ƒä¹Ÿä¼šé€‰æ‹©æ˜¯å¦ç»§ç»­æ‰§è¡Œè¿æ¥ç‚¹æˆ–ç›´æ¥è¿”å›å®ƒä»¬è‡ªå·±çš„è¿”å›å€¼æˆ–æŠ›å‡ºå¼‚å¸¸æ¥ç»“æŸæ‰§è¡Œã€‚ ç¯ç»•é€šçŸ¥æ˜¯æœ€å¸¸ç”¨çš„ä¸€ç§é€šçŸ¥ç±»å‹ã€‚å¤§éƒ¨åˆ†åŸºäºæ‹¦æˆªçš„AOPæ¡†æ¶ï¼Œä¾‹å¦‚Nanningå’ŒJBoss4ï¼Œéƒ½åªæä¾›ç¯ç»•é€šçŸ¥ã€‚ åŒä¸€ä¸ªaspectï¼Œä¸åŒadviceçš„æ‰§è¡Œé¡ºåºï¼š â‘ æ²¡æœ‰å¼‚å¸¸æƒ…å†µä¸‹çš„æ‰§è¡Œé¡ºåºï¼š *around *before advice before advice target method æ‰§è¡Œ around after advice after advice afterReturning â‘¡æœ‰å¼‚å¸¸æƒ…å†µä¸‹çš„æ‰§è¡Œé¡ºåºï¼š around before advice before advice target method æ‰§è¡Œ around** after advice after advice afterThrowing:å¼‚å¸¸å‘ç”Ÿ java.lang.RuntimeException: å¼‚å¸¸å‘ç”Ÿ Springmvc[TOC] 1ã€ä»€ä¹ˆæ˜¯Spring MVC ï¼Ÿç®€å•ä»‹ç»ä¸‹ä½ å¯¹springMVCçš„ç†è§£?Spring MVCæ˜¯ä¸€ä¸ªåŸºäºJavaçš„å®ç°äº†MVCè®¾è®¡æ¨¡å¼çš„è¯·æ±‚é©±åŠ¨ç±»å‹çš„è½»é‡çº§Webæ¡†æ¶ï¼Œé€šè¿‡æŠŠModelï¼ŒViewï¼ŒControlleråˆ†ç¦»ï¼Œå°†webå±‚è¿›è¡ŒèŒè´£è§£è€¦ï¼ŒæŠŠå¤æ‚çš„webåº”ç”¨åˆ†æˆé€»è¾‘æ¸…æ™°çš„å‡ éƒ¨åˆ†ï¼Œç®€åŒ–å¼€å‘ï¼Œå‡å°‘å‡ºé”™ï¼Œæ–¹ä¾¿ç»„å†…å¼€å‘äººå‘˜ä¹‹é—´çš„é…åˆã€‚ 2ã€SpringMVCçš„æµç¨‹ï¼Ÿï¼ˆ1ï¼‰ç”¨æˆ·å‘é€è¯·æ±‚è‡³å‰ç«¯æ§åˆ¶å™¨DispatcherServletï¼›ï¼ˆ2ï¼‰ DispatcherServletæ”¶åˆ°è¯·æ±‚åï¼Œè°ƒç”¨HandlerMappingå¤„ç†å™¨æ˜ å°„å™¨ï¼Œè¯·æ±‚è·å–Handleï¼›ï¼ˆ3ï¼‰å¤„ç†å™¨æ˜ å°„å™¨æ ¹æ®è¯·æ±‚urlæ‰¾åˆ°å…·ä½“çš„å¤„ç†å™¨ï¼Œç”Ÿæˆå¤„ç†å™¨å¯¹è±¡åŠå¤„ç†å™¨æ‹¦æˆªå™¨(å¦‚æœæœ‰åˆ™ç”Ÿæˆ)ä¸€å¹¶è¿”å›ç»™DispatcherServletï¼›ï¼ˆ4ï¼‰DispatcherServlet è°ƒç”¨ HandlerAdapterå¤„ç†å™¨é€‚é…å™¨ï¼›ï¼ˆ5ï¼‰HandlerAdapter ç»è¿‡é€‚é…è°ƒç”¨ å…·ä½“å¤„ç†å™¨(Handlerï¼Œä¹Ÿå«åç«¯æ§åˆ¶å™¨)ï¼›ï¼ˆ6ï¼‰Handleræ‰§è¡Œå®Œæˆè¿”å›ModelAndViewï¼›ï¼ˆ7ï¼‰HandlerAdapterå°†Handleræ‰§è¡Œç»“æœModelAndViewè¿”å›ç»™DispatcherServletï¼›ï¼ˆ8ï¼‰DispatcherServletå°†ModelAndViewä¼ ç»™ViewResolverè§†å›¾è§£æå™¨è¿›è¡Œè§£æï¼›ï¼ˆ9ï¼‰ViewResolverè§£æåè¿”å›å…·ä½“Viewï¼›ï¼ˆ10ï¼‰DispatcherServletå¯¹Viewè¿›è¡Œæ¸²æŸ“è§†å›¾ï¼ˆå³å°†æ¨¡å‹æ•°æ®å¡«å……è‡³è§†å›¾ä¸­ï¼‰ï¼ˆ11ï¼‰DispatcherServletå“åº”ç”¨æˆ·ã€‚ 3ã€Springmvcçš„ä¼˜ç‚¹:ï¼ˆ1ï¼‰å¯ä»¥æ”¯æŒå„ç§è§†å›¾æŠ€æœ¯,è€Œä¸ä»…ä»…å±€é™äºJSPï¼› ï¼ˆ2ï¼‰ä¸Springæ¡†æ¶é›†æˆï¼ˆå¦‚IoCå®¹å™¨ã€AOPç­‰ï¼‰ï¼› ï¼ˆ3ï¼‰æ¸…æ™°çš„è§’è‰²åˆ†é…ï¼šå‰ç«¯æ§åˆ¶å™¨(dispatcherServlet) , è¯·æ±‚åˆ°å¤„ç†å™¨æ˜ å°„ï¼ˆhandlerMapping), å¤„ç†å™¨é€‚é…å™¨ï¼ˆHandlerAdapter), è§†å›¾è§£æå™¨ï¼ˆViewResolverï¼‰ã€‚ ï¼ˆ4ï¼‰ æ”¯æŒå„ç§è¯·æ±‚èµ„æºçš„æ˜ å°„ç­–ç•¥ã€‚ 4ã€Spring MVCçš„ä¸»è¦ç»„ä»¶ï¼Ÿï¼ˆ1ï¼‰å‰ç«¯æ§åˆ¶å™¨ DispatcherServletï¼ˆä¸éœ€è¦ç¨‹åºå‘˜å¼€å‘ï¼‰ ä½œç”¨ï¼šæ¥æ”¶è¯·æ±‚ã€å“åº”ç»“æœï¼Œç›¸å½“äºè½¬å‘å™¨ï¼Œæœ‰äº†DispatcherServlet å°±å‡å°‘äº†å…¶å®ƒç»„ä»¶ä¹‹é—´çš„è€¦åˆåº¦ã€‚ ï¼ˆ2ï¼‰å¤„ç†å™¨æ˜ å°„å™¨HandlerMappingï¼ˆä¸éœ€è¦ç¨‹åºå‘˜å¼€å‘ï¼‰ ä½œç”¨ï¼šæ ¹æ®è¯·æ±‚çš„URLæ¥æŸ¥æ‰¾Handler ï¼ˆ3ï¼‰==å¤„ç†å™¨é€‚é…å™¨HandlerAdapter== æ³¨æ„ï¼šåœ¨ç¼–å†™Handlerçš„æ—¶å€™è¦æŒ‰ç…§HandlerAdapterè¦æ±‚çš„è§„åˆ™å»ç¼–å†™ï¼Œè¿™æ ·é€‚é…å™¨HandlerAdapteræ‰å¯ä»¥æ­£ç¡®çš„å»æ‰§è¡ŒHandlerã€‚ ï¼ˆ4ï¼‰==å¤„ç†å™¨Handlerï¼ˆéœ€è¦ç¨‹åºå‘˜å¼€å‘ï¼‰== ï¼ˆ5ï¼‰è§†å›¾è§£æå™¨ ViewResolverï¼ˆä¸éœ€è¦ç¨‹åºå‘˜å¼€å‘ï¼‰ ä½œç”¨ï¼šè¿›è¡Œè§†å›¾çš„è§£æï¼Œæ ¹æ®è§†å›¾é€»è¾‘åè§£ææˆçœŸæ­£çš„è§†å›¾ï¼ˆviewï¼‰ ï¼ˆ6ï¼‰==è§†å›¾Viewï¼ˆéœ€è¦ç¨‹åºå‘˜å¼€å‘jspï¼‰== Viewæ˜¯ä¸€ä¸ªæ¥å£ï¼Œ å®ƒçš„å®ç°ç±»æ”¯æŒä¸åŒçš„è§†å›¾ç±»å‹ï¼ˆjspï¼Œfreemarkerï¼Œpdfç­‰ç­‰ï¼‰ 5ã€springMVCå’Œstruts2çš„åŒºåˆ«æœ‰å“ªäº›?ï¼ˆ1ï¼‰springmvcçš„å…¥å£æ˜¯ä¸€ä¸ªservletå³å‰ç«¯æ§åˆ¶å™¨ï¼ˆDispatchServletï¼‰ï¼Œè€Œstruts2å…¥å£æ˜¯ä¸€ä¸ªfilterè¿‡è™‘å™¨ï¼ˆStrutsPrepareAndExecuteFilterï¼‰ã€‚ ï¼ˆ2ï¼‰springmvcæ˜¯åŸºäºæ–¹æ³•å¼€å‘(ä¸€ä¸ªurlå¯¹åº”ä¸€ä¸ªæ–¹æ³•)ï¼Œè¯·æ±‚å‚æ•°ä¼ é€’åˆ°æ–¹æ³•çš„å½¢å‚ï¼Œå¯ä»¥è®¾è®¡ä¸ºå•ä¾‹æˆ–å¤šä¾‹(å»ºè®®å•ä¾‹)ï¼Œstruts2æ˜¯åŸºäºç±»å¼€å‘ï¼Œä¼ é€’å‚æ•°æ˜¯é€šè¿‡ç±»çš„å±æ€§ï¼Œåªèƒ½è®¾è®¡ä¸ºå¤šä¾‹ã€‚ ï¼ˆ3ï¼‰Strutsé‡‡ç”¨å€¼æ ˆå­˜å‚¨è¯·æ±‚å’Œå“åº”çš„æ•°æ®ï¼Œé€šè¿‡OGNLå­˜å–æ•°æ®ï¼Œspringmvcé€šè¿‡å‚æ•°è§£æå™¨æ˜¯å°†requestè¯·æ±‚å†…å®¹è§£æï¼Œå¹¶ç»™æ–¹æ³•å½¢å‚èµ‹å€¼ï¼Œå°†æ•°æ®å’Œè§†å›¾å°è£…æˆModelAndViewå¯¹è±¡ï¼Œæœ€ååˆå°†ModelAndViewä¸­çš„æ¨¡å‹æ•°æ®é€šè¿‡requesåŸŸä¼ è¾“åˆ°é¡µé¢ã€‚Jspè§†å›¾è§£æå™¨é»˜è®¤ä½¿ç”¨jstlã€‚ 6ã€SpringMVCæ€ä¹ˆæ ·è®¾å®šé‡å®šå‘å’Œè½¬å‘çš„ï¼Ÿï¼ˆ1ï¼‰è½¬å‘ï¼šåœ¨è¿”å›å€¼å‰é¢åŠ â€forward:â€œï¼Œè­¬å¦‚â€forward:user.do?name=method4â€ ï¼ˆ2ï¼‰é‡å®šå‘ï¼šåœ¨è¿”å›å€¼å‰é¢åŠ â€redirect:â€œï¼Œè­¬å¦‚â€redirect:http://www.baidu.com&quot; 7ã€SpringMvcæ€ä¹ˆå’ŒAJAXç›¸äº’è°ƒç”¨çš„ï¼Ÿé€šè¿‡Jacksonæ¡†æ¶å°±å¯ä»¥æŠŠJavaé‡Œé¢çš„å¯¹è±¡ç›´æ¥è½¬åŒ–æˆJså¯ä»¥è¯†åˆ«çš„Jsonå¯¹è±¡ã€‚å…·ä½“æ­¥éª¤å¦‚ä¸‹ ï¼š ï¼ˆ1ï¼‰åŠ å…¥Jackson.jar, éœ€è¦ç›¸åº”çš„ä¾èµ–åŒ… ï¼ˆ2ï¼‰åœ¨é…ç½®æ–‡ä»¶ä¸­é…ç½®jsonçš„æ˜ å°„, é…ç½®jsonæ•°æ®çš„æ˜ å°„ ï¼ˆ3ï¼‰åœ¨æ¥å—Ajaxæ–¹æ³•é‡Œé¢å¯ä»¥ç›´æ¥è¿”å›Object,Listç­‰,ä½†æ–¹æ³•å‰é¢è¦åŠ ä¸Š@ResponseBodyæ³¨è§£ã€‚ 8ã€å¦‚ä½•è§£å†³POSTè¯·æ±‚ä¸­æ–‡ä¹±ç é—®é¢˜ï¼ŒGETçš„åˆå¦‚ä½•å¤„ç†å‘¢ï¼Ÿï¼ˆ1ï¼‰è§£å†³postè¯·æ±‚ä¹±ç é—®é¢˜ï¼šåœ¨web.xmlä¸­é…ç½®ä¸€ä¸ªCharacterEncodingFilterè¿‡æ»¤å™¨ï¼Œè®¾ç½®æˆutf-8ï¼› 12345678910111213&lt;filter&gt;&lt;filter-name&gt;CharacterEncodingFilter&lt;/filter-name&gt;&lt;filter-class&gt;org.springframework.web.filter.CharacterEncodingFilter&lt;/filter-class&gt;&lt;init-param&gt; &lt;param-name&gt;encoding&lt;/param-name&gt; &lt;param-value&gt;utf-8&lt;/param-value&gt;&lt;/init-param&gt;&lt;/filter&gt;&lt;filter-mapping&gt;&lt;filter-name&gt;CharacterEncodingFilter&lt;/filter-name&gt; &lt;!--è¿‡æ»¤å…¨å±€çš„è¯·æ±‚, éƒ½æŠŠå­—ç¬¦é›†è®¾ä¸ºutf-8 --&gt;&lt;url-pattern&gt;/*&lt;/url-pattern&gt;&lt;/filter-mapping&gt; ï¼ˆ2ï¼‰getè¯·æ±‚ä¸­æ–‡å‚æ•°å‡ºç°ä¹±ç è§£å†³æ–¹æ³•æœ‰ä¸¤ä¸ªï¼šâ‘ ä¿®æ”¹tomcaté…ç½®æ–‡ä»¶æ·»åŠ ç¼–ç ä¸å·¥ç¨‹ç¼–ç ä¸€è‡´ï¼Œå¦‚ä¸‹ï¼š &lt;ConnectorURIEncoding=â€utf-8â€ connectionTimeout=â€20000â€ port=â€8080â€ protocol=â€HTTP/1.1â€ redirectPort=â€8443â€/&gt; â‘¡å¦å¤–ä¸€ç§æ–¹æ³•å¯¹å‚æ•°è¿›è¡Œé‡æ–°ç¼–ç ï¼š String userName = new String(request.getParamter(â€œuserNameâ€).getBytes(â€œISO8859-1â€),â€utf-8â€) ISO8859-1æ˜¯tomcaté»˜è®¤ç¼–ç ï¼Œéœ€è¦å°†tomcatç¼–ç åçš„å†…å®¹æŒ‰utf-8ç¼–ç ã€‚ 9ã€Spring MVCçš„å¼‚å¸¸å¤„ç† ï¼Ÿç­”ï¼šå¯ä»¥å°†å¼‚å¸¸æŠ›ç»™Springæ¡†æ¶ï¼Œç”±Springæ¡†æ¶æ¥å¤„ç†ï¼›æˆ‘ä»¬åªéœ€è¦é…ç½®ç®€å•çš„å¼‚å¸¸å¤„ç†å™¨ï¼Œåœ¨å¼‚å¸¸å¤„ç†å™¨ä¸­æ·»è§†å›¾é¡µé¢å³å¯ã€‚ 10ã€SpringMvcçš„æ§åˆ¶å™¨æ˜¯ä¸æ˜¯å•ä¾‹æ¨¡å¼,å¦‚æœæ˜¯,æœ‰ä»€ä¹ˆé—®é¢˜,æ€ä¹ˆè§£å†³ï¼Ÿ!!!ç­”ï¼šæ˜¯å•ä¾‹æ¨¡å¼,æ‰€ä»¥åœ¨å¤šçº¿ç¨‹è®¿é—®çš„æ—¶å€™æœ‰çº¿ç¨‹å®‰å…¨é—®é¢˜,ä¸è¦ç”¨åŒæ­¥,ä¼šå½±å“æ€§èƒ½çš„,è§£å†³æ–¹æ¡ˆæ˜¯åœ¨æ§åˆ¶å™¨é‡Œé¢ä¸èƒ½å†™å­—æ®µã€‚ ä¸å†™å­—æ®µå°±ä¸ä¼šå­˜åœ¨,æœ‰çŠ¶æ€çš„èµ„æºå…±äº«, å°±ä¸ä¼šæœ‰çº¿ç¨‹å®‰å…¨é—®é¢˜ 11ã€ SpringMVCå¸¸ç”¨çš„æ³¨è§£æœ‰å“ªäº›ï¼Ÿ@RequestMappingï¼šç”¨äºå¤„ç†è¯·æ±‚ url æ˜ å°„çš„æ³¨è§£ï¼Œå¯ç”¨äºç±»æˆ–æ–¹æ³•ä¸Šã€‚ç”¨äºç±»ä¸Šï¼Œåˆ™è¡¨ç¤ºç±»ä¸­çš„æ‰€æœ‰å“åº”è¯·æ±‚çš„æ–¹æ³•éƒ½æ˜¯ä»¥è¯¥åœ°å€ä½œä¸ºçˆ¶è·¯å¾„ã€‚ @RequestBodyï¼šæ³¨è§£å®ç°æ¥æ”¶httpè¯·æ±‚çš„jsonæ•°æ®ï¼Œå°†jsonè½¬æ¢ä¸ºjavaå¯¹è±¡ã€‚ @ResponseBodyï¼šæ³¨è§£å®ç°å°†conreolleræ–¹æ³•è¿”å›å¯¹è±¡è½¬åŒ–ä¸ºjsonå¯¹è±¡å“åº”ç»™å®¢æˆ·ã€‚ 12ã€SpingMvcä¸­çš„æ§åˆ¶å™¨çš„æ³¨è§£ä¸€èˆ¬ç”¨é‚£ä¸ª,æœ‰æ²¡æœ‰åˆ«çš„æ³¨è§£å¯ä»¥æ›¿ä»£ï¼Ÿç­”ï¼šä¸€èˆ¬ç”¨@Conntrolleræ³¨è§£,è¡¨ç¤ºæ˜¯è¡¨ç°å±‚,ä¸èƒ½ç”¨åˆ«çš„æ³¨è§£ä»£æ›¿ã€‚ 13ã€å¦‚æœåœ¨æ‹¦æˆªè¯·æ±‚ä¸­ï¼Œæˆ‘æƒ³æ‹¦æˆªgetæ–¹å¼æäº¤çš„æ–¹æ³•,æ€ä¹ˆé…ç½®ï¼Ÿç­”ï¼šå¯ä»¥åœ¨@RequestMappingæ³¨è§£é‡Œé¢åŠ ä¸Šmethod=RequestMethod.GETã€‚ 14ã€æ€æ ·åœ¨æ–¹æ³•é‡Œé¢å¾—åˆ°Request,æˆ–è€…Sessionï¼Ÿç­”ï¼šç›´æ¥åœ¨æ–¹æ³•çš„å½¢å‚ä¸­å£°æ˜request,SpringMvcå°±è‡ªåŠ¨æŠŠrequestå¯¹è±¡ä¼ å…¥ã€‚ 15ã€å¦‚æœæƒ³åœ¨æ‹¦æˆªçš„æ–¹æ³•é‡Œé¢å¾—åˆ°ä»å‰å°ä¼ å…¥çš„å‚æ•°,æ€ä¹ˆå¾—åˆ°ï¼Ÿç­”ï¼šç›´æ¥åœ¨å½¢å‚é‡Œé¢å£°æ˜è¿™ä¸ªå‚æ•°å°±å¯ä»¥,ä½†å¿…é¡»åå­—å’Œä¼ è¿‡æ¥çš„å‚æ•°ä¸€æ ·ã€‚==spirngmvcé€šè¿‡nameå±æ€§æ¥æ³¨å…¥, ä¸æ˜¯é€šè¿‡htmlä¸­çš„idç†Ÿæ‚‰== 16ã€å¦‚æœå‰å°æœ‰å¾ˆå¤šä¸ªå‚æ•°ä¼ å…¥,å¹¶ä¸”è¿™äº›å‚æ•°éƒ½æ˜¯ä¸€ä¸ªå¯¹è±¡çš„,é‚£ä¹ˆæ€ä¹ˆæ ·å¿«é€Ÿå¾—åˆ°è¿™ä¸ªå¯¹è±¡ï¼Ÿç­”ï¼šç›´æ¥åœ¨æ–¹æ³•ä¸­å£°æ˜è¿™ä¸ªå¯¹è±¡,SpringMvcå°±è‡ªåŠ¨ä¼šæŠŠå±æ€§èµ‹å€¼åˆ°è¿™ä¸ªå¯¹è±¡é‡Œé¢ã€‚ 17ã€SpringMvcä¸­å‡½æ•°çš„è¿”å›å€¼æ˜¯ä»€ä¹ˆï¼Ÿç­”ï¼šè¿”å›å€¼å¯ä»¥æœ‰å¾ˆå¤šç±»å‹,æœ‰String, ModelAndViewã€‚ModelAndViewç±»æŠŠè§†å›¾å’Œæ•°æ®éƒ½åˆå¹¶çš„ä¸€èµ·çš„ï¼Œä½†ä¸€èˆ¬ç”¨Stringæ¯”è¾ƒå¥½, ==å¦‚æœåŠ äº†jsonçš„æ”¯æŒ, å¯ä»¥è¿”å›ä»»ä½•ç±»å‹;== 18ã€SpringMvcç”¨ä»€ä¹ˆå¯¹è±¡ä»åå°å‘å‰å°ä¼ é€’æ•°æ®çš„ï¼Ÿç­”ï¼šé€šè¿‡ModelMapå¯¹è±¡,å¯ä»¥åœ¨è¿™ä¸ªå¯¹è±¡é‡Œé¢è°ƒç”¨putæ–¹æ³•,æŠŠå¯¹è±¡åŠ åˆ°é‡Œé¢,å‰å°å°±å¯ä»¥é€šè¿‡elè¡¨è¾¾å¼æ‹¿åˆ°ã€‚ 19ã€æ€ä¹ˆæ ·æŠŠModelMapé‡Œé¢çš„æ•°æ®æ”¾å…¥Sessioné‡Œé¢ï¼Ÿç­”ï¼šå¯ä»¥åœ¨ç±»ä¸Šé¢åŠ ä¸Š@SessionAttributesæ³¨è§£,é‡Œé¢åŒ…å«çš„å­—ç¬¦ä¸²å°±æ˜¯è¦æ”¾å…¥sessioné‡Œé¢çš„keyã€‚ 20ã€SpringMvcé‡Œé¢æ‹¦æˆªå™¨æ˜¯æ€ä¹ˆå†™çš„ï¼š ç°HandlerInterceptoræ¥å£, æ¥ç€åœ¨æ¥å£æ–¹æ³•å½“ä¸­ï¼Œå®ç°å¤„ç†é€»è¾‘ï¼› ç»§æ‰¿é€‚é…å™¨ç±», é‡å†™ç›¸åº”çš„æ–¹æ³• ç„¶ååœ¨SpringMvcçš„é…ç½®æ–‡ä»¶ä¸­é…ç½®æ‹¦æˆªå™¨å³å¯ï¼š 123456789&lt;mvc:interceptors&gt;&lt;!-- é…ç½®ä¸€ä¸ªæ‹¦æˆªå™¨çš„Beanå°±å¯ä»¥äº† é»˜è®¤æ˜¯å¯¹æ‰€æœ‰è¯·æ±‚éƒ½æ‹¦æˆª --&gt; &lt;bean id=\"myInterceptor\" class=\"com.zwp.action.MyHandlerInterceptor\"&gt;&lt;/bean&gt;&lt;!-- åªé’ˆå¯¹éƒ¨åˆ†è¯·æ±‚æ‹¦æˆª --&gt;&lt;mvc:interceptor&gt; &lt;mvc:mapping path=\"/modelMap.do\" /&gt; &lt;bean class=\"com.zwp.action.MyHandlerInterceptorAdapter\" /&gt;&lt;/mvc:interceptor&gt;&lt;/mvc:interceptors&gt;&gt; 21ã€æ³¨è§£åŸç†ï¼šæ³¨è§£æœ¬è´¨æ˜¯ä¸€ä¸ªç»§æ‰¿äº†Annotationçš„ç‰¹æ®Šæ¥å£ï¼Œå…¶å…·ä½“å®ç°ç±»æ˜¯Javaè¿è¡Œæ—¶ç”Ÿæˆçš„åŠ¨æ€ä»£ç†ç±»ã€‚æˆ‘ä»¬é€šè¿‡åå°„è·å–æ³¨è§£æ—¶ï¼Œè¿”å›çš„æ˜¯Javaè¿è¡Œæ—¶ç”Ÿæˆçš„åŠ¨æ€ä»£ç†å¯¹è±¡ã€‚é€šè¿‡ä»£ç†å¯¹è±¡è°ƒç”¨è‡ªå®šä¹‰æ³¨è§£çš„æ–¹æ³•ï¼Œä¼šæœ€ç»ˆè°ƒç”¨AnnotationInvocationHandlerçš„invokeæ–¹æ³•ã€‚è¯¥æ–¹æ³•ä¼šä»memberValuesè¿™ä¸ªMapä¸­ç´¢å¼•å‡ºå¯¹åº”çš„å€¼ã€‚è€ŒmemberValuesçš„æ¥æºæ˜¯Javaå¸¸é‡æ± ã€‚","categories":[],"tags":[{"name":"IT","slug":"IT","permalink":"/tags/IT/"},{"name":"æŠ€æœ¯ç¬”è®°","slug":"æŠ€æœ¯ç¬”è®°","permalink":"/tags/%E6%8A%80%E6%9C%AF%E7%AC%94%E8%AE%B0/"},{"name":"Job","slug":"Job","permalink":"/tags/Job/"},{"name":"æœåŠ¡ç«¯å¼€å‘","slug":"æœåŠ¡ç«¯å¼€å‘","permalink":"/tags/%E6%9C%8D%E5%8A%A1%E7%AB%AF%E5%BC%80%E5%8F%91/"},{"name":"Spring","slug":"Spring","permalink":"/tags/Spring/"}]},{"title":"è®¡ç®—æœºç½‘ç»œ","slug":"è®¡ç®—æœºç½‘ç»œ","date":"2019-10-20T11:51:12.000Z","updated":"2019-10-20T05:56:58.326Z","comments":true,"path":"2019/10/20/è®¡ç®—æœºç½‘ç»œ/","link":"","permalink":"/2019/10/20/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/","excerpt":"","text":"URIURI åŒ…å« URL å’Œ URNã€‚ è¯·æ±‚å’Œå“åº”æŠ¥æ–‡1. è¯·æ±‚æŠ¥æ–‡ 2. å“åº”æŠ¥æ–‡ HTTP æ–¹æ³• å®¢æˆ·ç«¯å‘é€çš„ è¯·æ±‚æŠ¥æ–‡ ç¬¬ä¸€è¡Œä¸ºè¯·æ±‚è¡Œï¼ŒåŒ…å«äº†æ–¹æ³•å­—æ®µã€‚ GET è·å–èµ„æº å½“å‰ç½‘ç»œè¯·æ±‚ä¸­ï¼Œç»å¤§éƒ¨åˆ†ä½¿ç”¨çš„æ˜¯ GET æ–¹æ³•ã€‚ HEAD è·å–æŠ¥æ–‡é¦–éƒ¨ å’Œ GET æ–¹æ³•ç±»ä¼¼ï¼Œä½†æ˜¯ä¸è¿”å›æŠ¥æ–‡å®ä½“ä¸»ä½“éƒ¨åˆ†ã€‚ ä¸»è¦ç”¨äºç¡®è®¤ URL çš„æœ‰æ•ˆæ€§ä»¥åŠèµ„æºæ›´æ–°çš„æ—¥æœŸæ—¶é—´ç­‰ã€‚ POST ä¼ è¾“å®ä½“ä¸»ä½“ POST ä¸»è¦ç”¨æ¥ä¼ è¾“æ•°æ®ï¼Œè€Œ GET ä¸»è¦ç”¨æ¥è·å–èµ„æºã€‚ æ›´å¤š POST ä¸ GET çš„æ¯”è¾ƒè¯·è§ç¬¬ä¹ç« ã€‚ PUT ä¸Šä¼ æ–‡ä»¶ ç”±äºè‡ªèº«ä¸å¸¦éªŒè¯æœºåˆ¶ï¼Œä»»ä½•äººéƒ½å¯ä»¥ä¸Šä¼ æ–‡ä»¶ï¼Œå› æ­¤å­˜åœ¨å®‰å…¨æ€§é—®é¢˜ï¼Œä¸€èˆ¬ä¸ä½¿ç”¨è¯¥æ–¹æ³•ã€‚ 123456PUT /new.html HTTP/1.1Host: example.comContent-type: text/htmlContent-length: 16&lt;p&gt;New File&lt;/p&gt;Copy to clipboardErrorCopied PATCH å¯¹èµ„æºè¿›è¡Œéƒ¨åˆ†ä¿®æ”¹ PUT ä¹Ÿå¯ä»¥ç”¨äºä¿®æ”¹èµ„æºï¼Œä½†æ˜¯åªèƒ½å®Œå…¨æ›¿ä»£åŸå§‹èµ„æºï¼ŒPATCH å…è®¸éƒ¨åˆ†ä¿®æ”¹ã€‚ 1234567PATCH /file.txt HTTP/1.1Host: www.example.comContent-Type: application/exampleIf-Match: \"e0023aa4e\"Content-Length: 100[description of changes]Copy to clipboardErrorCopied DELETE åˆ é™¤æ–‡ä»¶ ä¸ PUT åŠŸèƒ½ç›¸åï¼Œå¹¶ä¸”åŒæ ·ä¸å¸¦éªŒè¯æœºåˆ¶ã€‚ 1DELETE /file.html HTTP/1.1Copy to clipboardErrorCopied OPTIONS æŸ¥è¯¢æ”¯æŒçš„æ–¹æ³• æŸ¥è¯¢æŒ‡å®šçš„ URL èƒ½å¤Ÿæ”¯æŒçš„æ–¹æ³•ã€‚ ä¼šè¿”å› Allow: GET, POST, HEAD, OPTIONS è¿™æ ·çš„å†…å®¹ã€‚ CONNECT è¦æ±‚åœ¨ä¸ä»£ç†æœåŠ¡å™¨é€šä¿¡æ—¶å»ºç«‹éš§é“ ä½¿ç”¨ SSLï¼ˆSecure Sockets Layerï¼Œå®‰å…¨å¥—æ¥å±‚ï¼‰å’Œ TLSï¼ˆTransport Layer Securityï¼Œä¼ è¾“å±‚å®‰å…¨ï¼‰åè®®æŠŠé€šä¿¡å†…å®¹åŠ å¯†åç»ç½‘ç»œéš§é“ä¼ è¾“ã€‚ 1CONNECT www.example.com:443 HTTP/1.1Copy to clipboardErrorCopied TRACE è¿½è¸ªè·¯å¾„ æœåŠ¡å™¨ä¼šå°†é€šä¿¡è·¯å¾„è¿”å›ç»™å®¢æˆ·ç«¯ã€‚ å‘é€è¯·æ±‚æ—¶ï¼Œåœ¨ Max-Forwards é¦–éƒ¨å­—æ®µä¸­å¡«å…¥æ•°å€¼ï¼Œæ¯ç»è¿‡ä¸€ä¸ªæœåŠ¡å™¨å°±ä¼šå‡ 1ï¼Œå½“æ•°å€¼ä¸º 0 æ—¶å°±åœæ­¢ä¼ è¾“ã€‚ é€šå¸¸ä¸ä¼šä½¿ç”¨ TRACEï¼Œå¹¶ä¸”å®ƒå®¹æ˜“å—åˆ° XST æ”»å‡»ï¼ˆCross-Site Tracingï¼Œè·¨ç«™è¿½è¸ªï¼‰ã€‚ HTTP çŠ¶æ€ç æœåŠ¡å™¨è¿”å›çš„ å“åº”æŠ¥æ–‡ ä¸­ç¬¬ä¸€è¡Œä¸ºçŠ¶æ€è¡Œï¼ŒåŒ…å«äº†çŠ¶æ€ç ä»¥åŠåŸå› çŸ­è¯­ï¼Œç”¨æ¥å‘ŠçŸ¥å®¢æˆ·ç«¯è¯·æ±‚çš„ç»“æœã€‚ çŠ¶æ€ç  ç±»åˆ« å«ä¹‰ 1XX Informationalï¼ˆä¿¡æ¯æ€§çŠ¶æ€ç ï¼‰ æ¥æ”¶çš„è¯·æ±‚æ­£åœ¨å¤„ç† 2XX Successï¼ˆæˆåŠŸçŠ¶æ€ç ï¼‰ è¯·æ±‚æ­£å¸¸å¤„ç†å®Œæ¯• 3XX Redirectionï¼ˆé‡å®šå‘çŠ¶æ€ç ï¼‰ éœ€è¦è¿›è¡Œé™„åŠ æ“ä½œä»¥å®Œæˆè¯·æ±‚ 4XX Client Errorï¼ˆå®¢æˆ·ç«¯é”™è¯¯çŠ¶æ€ç ï¼‰ æœåŠ¡å™¨æ— æ³•å¤„ç†è¯·æ±‚ 5XX Server Errorï¼ˆæœåŠ¡å™¨é”™è¯¯çŠ¶æ€ç ï¼‰ æœåŠ¡å™¨å¤„ç†è¯·æ±‚å‡ºé”™ 1XX ä¿¡æ¯ 100 Continue ï¼šè¡¨æ˜åˆ°ç›®å‰ä¸ºæ­¢éƒ½å¾ˆæ­£å¸¸ï¼Œå®¢æˆ·ç«¯å¯ä»¥ç»§ç»­å‘é€è¯·æ±‚æˆ–è€…å¿½ç•¥è¿™ä¸ªå“åº”ã€‚ 2XX æˆåŠŸ 200 OK 204 No Content ï¼šè¯·æ±‚å·²ç»æˆåŠŸå¤„ç†ï¼Œä½†æ˜¯è¿”å›çš„å“åº”æŠ¥æ–‡ä¸åŒ…å«å®ä½“çš„ä¸»ä½“éƒ¨åˆ†ã€‚ä¸€èˆ¬åœ¨åªéœ€è¦ä»å®¢æˆ·ç«¯å¾€æœåŠ¡å™¨å‘é€ä¿¡æ¯ï¼Œè€Œä¸éœ€è¦è¿”å›æ•°æ®æ—¶ä½¿ç”¨ã€‚ 206 Partial Content ï¼šè¡¨ç¤ºå®¢æˆ·ç«¯è¿›è¡Œäº†èŒƒå›´è¯·æ±‚ï¼Œå“åº”æŠ¥æ–‡åŒ…å«ç”± Content-Range æŒ‡å®šèŒƒå›´çš„å®ä½“å†…å®¹ã€‚ 3XX é‡å®šå‘ 301 Moved Permanently ï¼šæ°¸ä¹…æ€§é‡å®šå‘ 302 Found ï¼šä¸´æ—¶æ€§é‡å®šå‘ 303 See Other ï¼šå’Œ 302 æœ‰ç€ç›¸åŒçš„åŠŸèƒ½ï¼Œä½†æ˜¯ 303 æ˜ç¡®è¦æ±‚å®¢æˆ·ç«¯åº”è¯¥é‡‡ç”¨ GET æ–¹æ³•è·å–èµ„æºã€‚ æ³¨ï¼šè™½ç„¶ HTTP åè®®è§„å®š 301ã€302 çŠ¶æ€ä¸‹é‡å®šå‘æ—¶ä¸å…è®¸æŠŠ POST æ–¹æ³•æ”¹æˆ GET æ–¹æ³•ï¼Œä½†æ˜¯å¤§å¤šæ•°æµè§ˆå™¨éƒ½ä¼šåœ¨ 301ã€302 å’Œ 303 çŠ¶æ€ä¸‹çš„é‡å®šå‘æŠŠ POST æ–¹æ³•æ”¹æˆ GET æ–¹æ³•ã€‚ 304 Not Modified ï¼šå¦‚æœè¯·æ±‚æŠ¥æ–‡é¦–éƒ¨åŒ…å«ä¸€äº›æ¡ä»¶ï¼Œä¾‹å¦‚ï¼šIf-Matchï¼ŒIf-Modified-Sinceï¼ŒIf-None-Matchï¼ŒIf-Rangeï¼ŒIf-Unmodified-Sinceï¼Œå¦‚æœä¸æ»¡è¶³æ¡ä»¶ï¼Œåˆ™æœåŠ¡å™¨ä¼šè¿”å› 304 çŠ¶æ€ç ã€‚ 307 Temporary Redirect ï¼šä¸´æ—¶é‡å®šå‘ï¼Œä¸ 302 çš„å«ä¹‰ç±»ä¼¼ï¼Œä½†æ˜¯ 307 è¦æ±‚æµè§ˆå™¨ä¸ä¼šæŠŠé‡å®šå‘è¯·æ±‚çš„ POST æ–¹æ³•æ”¹æˆ GET æ–¹æ³•ã€‚ 4XX å®¢æˆ·ç«¯é”™è¯¯ 400 Bad Request ï¼šè¯·æ±‚æŠ¥æ–‡ä¸­å­˜åœ¨è¯­æ³•é”™è¯¯ã€‚ 401 Unauthorized ï¼šè¯¥çŠ¶æ€ç è¡¨ç¤ºå‘é€çš„è¯·æ±‚éœ€è¦æœ‰è®¤è¯ä¿¡æ¯ï¼ˆBASIC è®¤è¯ã€DIGEST è®¤è¯ï¼‰ã€‚å¦‚æœä¹‹å‰å·²è¿›è¡Œè¿‡ä¸€æ¬¡è¯·æ±‚ï¼Œåˆ™è¡¨ç¤ºç”¨æˆ·è®¤è¯å¤±è´¥ã€‚ 403 Forbidden ï¼šè¯·æ±‚è¢«æ‹’ç»ã€‚ 404 Not Found 5XX æœåŠ¡å™¨é”™è¯¯ 500 Internal Server Error ï¼šæœåŠ¡å™¨æ­£åœ¨æ‰§è¡Œè¯·æ±‚æ—¶å‘ç”Ÿé”™è¯¯ã€‚ 503 Service Unavailable ï¼šæœåŠ¡å™¨æš‚æ—¶å¤„äºè¶…è´Ÿè½½æˆ–æ­£åœ¨è¿›è¡Œåœæœºç»´æŠ¤ï¼Œç°åœ¨æ— æ³•å¤„ç†è¯·æ±‚ã€‚ å››ã€HTTP é¦–éƒ¨æœ‰ 4 ç§ç±»å‹çš„é¦–éƒ¨å­—æ®µï¼šé€šç”¨é¦–éƒ¨å­—æ®µã€è¯·æ±‚é¦–éƒ¨å­—æ®µã€å“åº”é¦–éƒ¨å­—æ®µå’Œå®ä½“é¦–éƒ¨å­—æ®µã€‚ å„ç§é¦–éƒ¨å­—æ®µåŠå…¶å«ä¹‰å¦‚ä¸‹ï¼ˆä¸éœ€è¦å…¨è®°ï¼Œä»…ä¾›æŸ¥é˜…ï¼‰ï¼š é€šç”¨é¦–éƒ¨å­—æ®µ é¦–éƒ¨å­—æ®µå è¯´æ˜ Cache-Control æ§åˆ¶ç¼“å­˜çš„è¡Œä¸º Connection æ§åˆ¶ä¸å†è½¬å‘ç»™ä»£ç†çš„é¦–éƒ¨å­—æ®µã€ç®¡ç†æŒä¹…è¿æ¥ Date åˆ›å»ºæŠ¥æ–‡çš„æ—¥æœŸæ—¶é—´ Pragma æŠ¥æ–‡æŒ‡ä»¤ Trailer æŠ¥æ–‡æœ«ç«¯çš„é¦–éƒ¨ä¸€è§ˆ Transfer-Encoding æŒ‡å®šæŠ¥æ–‡ä¸»ä½“çš„ä¼ è¾“ç¼–ç æ–¹å¼ Upgrade å‡çº§ä¸ºå…¶ä»–åè®® Via ä»£ç†æœåŠ¡å™¨çš„ç›¸å…³ä¿¡æ¯ Warning é”™è¯¯é€šçŸ¥ è¯·æ±‚é¦–éƒ¨å­—æ®µ é¦–éƒ¨å­—æ®µå è¯´æ˜ Accept ç”¨æˆ·ä»£ç†å¯å¤„ç†çš„åª’ä½“ç±»å‹ Accept-Charset ä¼˜å…ˆçš„å­—ç¬¦é›† Accept-Encoding ä¼˜å…ˆçš„å†…å®¹ç¼–ç  Accept-Language ä¼˜å…ˆçš„è¯­è¨€ï¼ˆè‡ªç„¶è¯­è¨€ï¼‰ Authorization Web è®¤è¯ä¿¡æ¯ Expect æœŸå¾…æœåŠ¡å™¨çš„ç‰¹å®šè¡Œä¸º From ç”¨æˆ·çš„ç”µå­é‚®ç®±åœ°å€ Host è¯·æ±‚èµ„æºæ‰€åœ¨æœåŠ¡å™¨ If-Match æ¯”è¾ƒå®ä½“æ ‡è®°ï¼ˆETagï¼‰ If-Modified-Since æ¯”è¾ƒèµ„æºçš„æ›´æ–°æ—¶é—´ If-None-Match æ¯”è¾ƒå®ä½“æ ‡è®°ï¼ˆä¸ If-Match ç›¸åï¼‰ If-Range èµ„æºæœªæ›´æ–°æ—¶å‘é€å®ä½“ Byte çš„èŒƒå›´è¯·æ±‚ If-Unmodified-Since æ¯”è¾ƒèµ„æºçš„æ›´æ–°æ—¶é—´ï¼ˆä¸ If-Modified-Since ç›¸åï¼‰ Max-Forwards æœ€å¤§ä¼ è¾“é€è·³æ•° Proxy-Authorization ä»£ç†æœåŠ¡å™¨è¦æ±‚å®¢æˆ·ç«¯çš„è®¤è¯ä¿¡æ¯ Range å®ä½“çš„å­—èŠ‚èŒƒå›´è¯·æ±‚ Referer å¯¹è¯·æ±‚ä¸­ URI çš„åŸå§‹è·å–æ–¹ TE ä¼ è¾“ç¼–ç çš„ä¼˜å…ˆçº§ User-Agent HTTP å®¢æˆ·ç«¯ç¨‹åºçš„ä¿¡æ¯ å“åº”é¦–éƒ¨å­—æ®µ é¦–éƒ¨å­—æ®µå è¯´æ˜ Accept-Ranges æ˜¯å¦æ¥å—å­—èŠ‚èŒƒå›´è¯·æ±‚ Age æ¨ç®—èµ„æºåˆ›å»ºç»è¿‡æ—¶é—´ ETag èµ„æºçš„åŒ¹é…ä¿¡æ¯ Location ä»¤å®¢æˆ·ç«¯é‡å®šå‘è‡³æŒ‡å®š URI Proxy-Authenticate ä»£ç†æœåŠ¡å™¨å¯¹å®¢æˆ·ç«¯çš„è®¤è¯ä¿¡æ¯ Retry-After å¯¹å†æ¬¡å‘èµ·è¯·æ±‚çš„æ—¶æœºè¦æ±‚ Server HTTP æœåŠ¡å™¨çš„å®‰è£…ä¿¡æ¯ Vary ä»£ç†æœåŠ¡å™¨ç¼“å­˜çš„ç®¡ç†ä¿¡æ¯ WWW-Authenticate æœåŠ¡å™¨å¯¹å®¢æˆ·ç«¯çš„è®¤è¯ä¿¡æ¯ å®ä½“é¦–éƒ¨å­—æ®µ é¦–éƒ¨å­—æ®µå è¯´æ˜ Allow èµ„æºå¯æ”¯æŒçš„ HTTP æ–¹æ³• Content-Encoding å®ä½“ä¸»ä½“é€‚ç”¨çš„ç¼–ç æ–¹å¼ Content-Language å®ä½“ä¸»ä½“çš„è‡ªç„¶è¯­è¨€ Content-Length å®ä½“ä¸»ä½“çš„å¤§å° Content-Location æ›¿ä»£å¯¹åº”èµ„æºçš„ URI Content-MD5 å®ä½“ä¸»ä½“çš„æŠ¥æ–‡æ‘˜è¦ Content-Range å®ä½“ä¸»ä½“çš„ä½ç½®èŒƒå›´ Content-Type å®ä½“ä¸»ä½“çš„åª’ä½“ç±»å‹ Expires å®ä½“ä¸»ä½“è¿‡æœŸçš„æ—¥æœŸæ—¶é—´ Last-Modified èµ„æºçš„æœ€åä¿®æ”¹æ—¥æœŸæ—¶é—´ äº”ã€å…·ä½“åº”ç”¨è¿æ¥ç®¡ç† 1. çŸ­è¿æ¥ä¸é•¿è¿æ¥å½“æµè§ˆå™¨è®¿é—®ä¸€ä¸ªåŒ…å«å¤šå¼ å›¾ç‰‡çš„ HTML é¡µé¢æ—¶ï¼Œé™¤äº†è¯·æ±‚è®¿é—®çš„ HTML é¡µé¢èµ„æºï¼Œè¿˜ä¼šè¯·æ±‚å›¾ç‰‡èµ„æºã€‚å¦‚æœæ¯è¿›è¡Œä¸€æ¬¡ HTTP é€šä¿¡å°±è¦æ–°å»ºä¸€ä¸ª TCP è¿æ¥ï¼Œé‚£ä¹ˆå¼€é”€ä¼šå¾ˆå¤§ã€‚ é•¿è¿æ¥åªéœ€è¦å»ºç«‹ä¸€æ¬¡ TCP è¿æ¥å°±èƒ½è¿›è¡Œå¤šæ¬¡ HTTP é€šä¿¡ã€‚ ä» HTTP/1.1 å¼€å§‹é»˜è®¤æ˜¯é•¿è¿æ¥çš„ï¼Œå¦‚æœè¦æ–­å¼€è¿æ¥ï¼Œéœ€è¦ç”±å®¢æˆ·ç«¯æˆ–è€…æœåŠ¡å™¨ç«¯æå‡ºæ–­å¼€ï¼Œä½¿ç”¨ Connection : closeï¼› åœ¨ HTTP/1.1 ä¹‹å‰é»˜è®¤æ˜¯çŸ­è¿æ¥çš„ï¼Œå¦‚æœéœ€è¦ä½¿ç”¨é•¿è¿æ¥ï¼Œåˆ™ä½¿ç”¨ Connection : Keep-Aliveã€‚ 2. æµæ°´çº¿é»˜è®¤æƒ…å†µä¸‹ï¼ŒHTTP è¯·æ±‚æ˜¯æŒ‰é¡ºåºå‘å‡ºçš„ï¼Œä¸‹ä¸€ä¸ªè¯·æ±‚åªæœ‰åœ¨å½“å‰è¯·æ±‚æ”¶åˆ°å“åº”ä¹‹åæ‰ä¼šè¢«å‘å‡ºã€‚ç”±äºå—åˆ°ç½‘ç»œå»¶è¿Ÿå’Œå¸¦å®½çš„é™åˆ¶ï¼Œåœ¨ä¸‹ä¸€ä¸ªè¯·æ±‚è¢«å‘é€åˆ°æœåŠ¡å™¨ä¹‹å‰ï¼Œå¯èƒ½éœ€è¦ç­‰å¾…å¾ˆé•¿æ—¶é—´ã€‚ æµæ°´çº¿æ˜¯åœ¨åŒä¸€æ¡é•¿è¿æ¥ä¸Šè¿ç»­å‘å‡ºè¯·æ±‚ï¼Œè€Œä¸ç”¨ç­‰å¾…å“åº”è¿”å›ï¼Œè¿™æ ·å¯ä»¥å‡å°‘å»¶è¿Ÿã€‚ CookieHTTP åè®®æ˜¯æ— çŠ¶æ€çš„ï¼Œä¸»è¦æ˜¯ä¸ºäº†è®© HTTP åè®®å°½å¯èƒ½ç®€å•ï¼Œä½¿å¾—å®ƒèƒ½å¤Ÿå¤„ç†å¤§é‡äº‹åŠ¡ã€‚HTTP/1.1 å¼•å…¥ Cookie æ¥ä¿å­˜çŠ¶æ€ä¿¡æ¯ã€‚ Cookie æ˜¯æœåŠ¡å™¨å‘é€åˆ°ç”¨æˆ·æµè§ˆå™¨å¹¶ä¿å­˜åœ¨æœ¬åœ°çš„ä¸€å°å—æ•°æ®ï¼Œå®ƒä¼šåœ¨æµè§ˆå™¨ä¹‹åå‘åŒä¸€æœåŠ¡å™¨å†æ¬¡å‘èµ·è¯·æ±‚æ—¶è¢«æºå¸¦ä¸Šï¼Œç”¨äºå‘ŠçŸ¥æœåŠ¡ç«¯ä¸¤ä¸ªè¯·æ±‚æ˜¯å¦æ¥è‡ªåŒä¸€æµè§ˆå™¨ã€‚ç”±äºä¹‹åæ¯æ¬¡è¯·æ±‚éƒ½ä¼šéœ€è¦æºå¸¦ Cookie æ•°æ®ï¼Œå› æ­¤ä¼šå¸¦æ¥é¢å¤–çš„æ€§èƒ½å¼€é”€ï¼ˆå°¤å…¶æ˜¯åœ¨ç§»åŠ¨ç¯å¢ƒä¸‹ï¼‰ã€‚ Cookie æ›¾ä¸€åº¦ç”¨äºå®¢æˆ·ç«¯æ•°æ®çš„å­˜å‚¨ï¼Œå› ä¸ºå½“æ—¶å¹¶æ²¡æœ‰å…¶å®ƒåˆé€‚çš„å­˜å‚¨åŠæ³•è€Œä½œä¸ºå”¯ä¸€çš„å­˜å‚¨æ‰‹æ®µï¼Œä½†ç°åœ¨éšç€ç°ä»£æµè§ˆå™¨å¼€å§‹æ”¯æŒå„ç§å„æ ·çš„å­˜å‚¨æ–¹å¼ï¼ŒCookie æ¸æ¸è¢«æ·˜æ±°ã€‚æ–°çš„æµè§ˆå™¨ API å·²ç»å…è®¸å¼€å‘è€…ç›´æ¥å°†æ•°æ®å­˜å‚¨åˆ°æœ¬åœ°ï¼Œå¦‚ä½¿ç”¨ Web storage APIï¼ˆæœ¬åœ°å­˜å‚¨å’Œä¼šè¯å­˜å‚¨ï¼‰æˆ– IndexedDBã€‚ 1. ç”¨é€” ä¼šè¯çŠ¶æ€ç®¡ç†ï¼ˆå¦‚ç”¨æˆ·ç™»å½•çŠ¶æ€ã€è´­ç‰©è½¦ã€æ¸¸æˆåˆ†æ•°æˆ–å…¶å®ƒéœ€è¦è®°å½•çš„ä¿¡æ¯ï¼‰ ä¸ªæ€§åŒ–è®¾ç½®ï¼ˆå¦‚ç”¨æˆ·è‡ªå®šä¹‰è®¾ç½®ã€ä¸»é¢˜ç­‰ï¼‰ æµè§ˆå™¨è¡Œä¸ºè·Ÿè¸ªï¼ˆå¦‚è·Ÿè¸ªåˆ†æç”¨æˆ·è¡Œä¸ºç­‰ï¼‰ 2. åˆ›å»ºè¿‡ç¨‹æœåŠ¡å™¨å‘é€çš„å“åº”æŠ¥æ–‡åŒ…å« Set-Cookie é¦–éƒ¨å­—æ®µï¼Œå®¢æˆ·ç«¯å¾—åˆ°å“åº”æŠ¥æ–‡åæŠŠ Cookie å†…å®¹ä¿å­˜åˆ°æµè§ˆå™¨ä¸­ã€‚ 123456HTTP/1.0 200 OKContent-type: text/htmlSet-Cookie: yummy_cookie=chocoSet-Cookie: tasty_cookie=strawberry[page content]Copy to clipboardErrorCopied å®¢æˆ·ç«¯ä¹‹åå¯¹åŒä¸€ä¸ªæœåŠ¡å™¨å‘é€è¯·æ±‚æ—¶ï¼Œä¼šä»æµè§ˆå™¨ä¸­å–å‡º Cookie ä¿¡æ¯å¹¶é€šè¿‡ Cookie è¯·æ±‚é¦–éƒ¨å­—æ®µå‘é€ç»™æœåŠ¡å™¨ã€‚ 123GET /sample_page.html HTTP/1.1Host: www.example.orgCookie: yummy_cookie=choco; tasty_cookie=strawberryCopy to clipboardErrorCopied 3. åˆ†ç±» ä¼šè¯æœŸ Cookieï¼šæµè§ˆå™¨å…³é—­ä¹‹åå®ƒä¼šè¢«è‡ªåŠ¨åˆ é™¤ï¼Œä¹Ÿå°±æ˜¯è¯´å®ƒä»…åœ¨ä¼šè¯æœŸå†…æœ‰æ•ˆã€‚ æŒä¹…æ€§ Cookieï¼šæŒ‡å®šè¿‡æœŸæ—¶é—´ï¼ˆExpiresï¼‰æˆ–æœ‰æ•ˆæœŸï¼ˆmax-ageï¼‰ä¹‹åå°±æˆä¸ºäº†æŒä¹…æ€§çš„ Cookieã€‚ 1Set-Cookie: id=a3fWa; Expires=Wed, 21 Oct 2015 07:28:00 GMT;Copy to clipboardErrorCopied 4. ä½œç”¨åŸŸDomain æ ‡è¯†æŒ‡å®šäº†å“ªäº›ä¸»æœºå¯ä»¥æ¥å— Cookieã€‚å¦‚æœä¸æŒ‡å®šï¼Œé»˜è®¤ä¸ºå½“å‰æ–‡æ¡£çš„ä¸»æœºï¼ˆä¸åŒ…å«å­åŸŸåï¼‰ã€‚å¦‚æœæŒ‡å®šäº† Domainï¼Œåˆ™ä¸€èˆ¬åŒ…å«å­åŸŸåã€‚ä¾‹å¦‚ï¼Œå¦‚æœè®¾ç½® Domain=mozilla.orgï¼Œåˆ™ Cookie ä¹ŸåŒ…å«åœ¨å­åŸŸåä¸­ï¼ˆå¦‚ developer.mozilla.orgï¼‰ã€‚ Path æ ‡è¯†æŒ‡å®šäº†ä¸»æœºä¸‹çš„å“ªäº›è·¯å¾„å¯ä»¥æ¥å— Cookieï¼ˆè¯¥ URL è·¯å¾„å¿…é¡»å­˜åœ¨äºè¯·æ±‚ URL ä¸­ï¼‰ã€‚ä»¥å­—ç¬¦ %x2F (â€œ/â€œ) ä½œä¸ºè·¯å¾„åˆ†éš”ç¬¦ï¼Œå­è·¯å¾„ä¹Ÿä¼šè¢«åŒ¹é…ã€‚ä¾‹å¦‚ï¼Œè®¾ç½® Path=/docsï¼Œåˆ™ä»¥ä¸‹åœ°å€éƒ½ä¼šåŒ¹é…ï¼š /docs /docs/Web/ /docs/Web/HTTP 5. JavaScriptæµè§ˆå™¨é€šè¿‡ document.cookie å±æ€§å¯åˆ›å»ºæ–°çš„ Cookieï¼Œä¹Ÿå¯é€šè¿‡è¯¥å±æ€§è®¿é—®é HttpOnly æ ‡è®°çš„ Cookieã€‚ 123document.cookie = \"yummy_cookie=choco\";document.cookie = \"tasty_cookie=strawberry\";console.log(document.cookie);Copy to clipboardErrorCopied 6. HttpOnlyæ ‡è®°ä¸º HttpOnly çš„ Cookie ä¸èƒ½è¢« JavaScript è„šæœ¬è°ƒç”¨ã€‚è·¨ç«™è„šæœ¬æ”»å‡» (XSS) å¸¸å¸¸ä½¿ç”¨ JavaScript çš„ document.cookie API çªƒå–ç”¨æˆ·çš„ Cookie ä¿¡æ¯ï¼Œå› æ­¤ä½¿ç”¨ HttpOnly æ ‡è®°å¯ä»¥åœ¨ä¸€å®šç¨‹åº¦ä¸Šé¿å… XSS æ”»å‡»ã€‚ 1Set-Cookie: id=a3fWa; Expires=Wed, 21 Oct 2015 07:28:00 GMT; Secure; HttpOnlyCopy to clipboardErrorCopied 7. Secureæ ‡è®°ä¸º Secure çš„ Cookie åªèƒ½é€šè¿‡è¢« HTTPS åè®®åŠ å¯†è¿‡çš„è¯·æ±‚å‘é€ç»™æœåŠ¡ç«¯ã€‚ä½†å³ä¾¿è®¾ç½®äº† Secure æ ‡è®°ï¼Œæ•æ„Ÿä¿¡æ¯ä¹Ÿä¸åº”è¯¥é€šè¿‡ Cookie ä¼ è¾“ï¼Œå› ä¸º Cookie æœ‰å…¶å›ºæœ‰çš„ä¸å®‰å…¨æ€§ï¼ŒSecure æ ‡è®°ä¹Ÿæ— æ³•æä¾›ç¡®å®çš„å®‰å…¨ä¿éšœã€‚ 8. Sessioné™¤äº†å¯ä»¥å°†ç”¨æˆ·ä¿¡æ¯é€šè¿‡ Cookie å­˜å‚¨åœ¨ç”¨æˆ·æµè§ˆå™¨ä¸­ï¼Œä¹Ÿå¯ä»¥åˆ©ç”¨ Session å­˜å‚¨åœ¨æœåŠ¡å™¨ç«¯ï¼Œå­˜å‚¨åœ¨æœåŠ¡å™¨ç«¯çš„ä¿¡æ¯æ›´åŠ å®‰å…¨ã€‚ Session å¯ä»¥å­˜å‚¨åœ¨æœåŠ¡å™¨ä¸Šçš„æ–‡ä»¶ã€æ•°æ®åº“æˆ–è€…å†…å­˜ä¸­ã€‚ä¹Ÿå¯ä»¥å°† Session å­˜å‚¨åœ¨ Redis è¿™ç§å†…å­˜å‹æ•°æ®åº“ä¸­ï¼Œæ•ˆç‡ä¼šæ›´é«˜ã€‚ ä½¿ç”¨ Session ç»´æŠ¤ç”¨æˆ·ç™»å½•çŠ¶æ€çš„è¿‡ç¨‹å¦‚ä¸‹ï¼š ç”¨æˆ·è¿›è¡Œç™»å½•æ—¶ï¼Œç”¨æˆ·æäº¤åŒ…å«ç”¨æˆ·åå’Œå¯†ç çš„è¡¨å•ï¼Œæ”¾å…¥ HTTP è¯·æ±‚æŠ¥æ–‡ä¸­ï¼› æœåŠ¡å™¨éªŒè¯è¯¥ç”¨æˆ·åå’Œå¯†ç ï¼Œå¦‚æœæ­£ç¡®åˆ™æŠŠç”¨æˆ·ä¿¡æ¯å­˜å‚¨åˆ° Redis ä¸­ï¼Œå®ƒåœ¨ Redis ä¸­çš„ Key ç§°ä¸º Session IDï¼› æœåŠ¡å™¨è¿”å›çš„å“åº”æŠ¥æ–‡çš„ Set-Cookie é¦–éƒ¨å­—æ®µåŒ…å«äº†è¿™ä¸ª Session IDï¼Œå®¢æˆ·ç«¯æ”¶åˆ°å“åº”æŠ¥æ–‡ä¹‹åå°†è¯¥ Cookie å€¼å­˜å…¥æµè§ˆå™¨ä¸­ï¼› å®¢æˆ·ç«¯ä¹‹åå¯¹åŒä¸€ä¸ªæœåŠ¡å™¨è¿›è¡Œè¯·æ±‚æ—¶ä¼šåŒ…å«è¯¥ Cookie å€¼ï¼ŒæœåŠ¡å™¨æ”¶åˆ°ä¹‹åæå–å‡º Session IDï¼Œä» Redis ä¸­å–å‡ºç”¨æˆ·ä¿¡æ¯ï¼Œç»§ç»­ä¹‹å‰çš„ä¸šåŠ¡æ“ä½œã€‚ åº”è¯¥æ³¨æ„ Session ID çš„å®‰å…¨æ€§é—®é¢˜ï¼Œä¸èƒ½è®©å®ƒè¢«æ¶æ„æ”»å‡»è€…è½»æ˜“è·å–ï¼Œé‚£ä¹ˆå°±ä¸èƒ½äº§ç”Ÿä¸€ä¸ªå®¹æ˜“è¢«çŒœåˆ°çš„ Session ID å€¼ã€‚æ­¤å¤–ï¼Œè¿˜éœ€è¦ç»å¸¸é‡æ–°ç”Ÿæˆ Session IDã€‚åœ¨å¯¹å®‰å…¨æ€§è¦æ±‚æé«˜çš„åœºæ™¯ä¸‹ï¼Œä¾‹å¦‚è½¬è´¦ç­‰æ“ä½œï¼Œé™¤äº†ä½¿ç”¨ Session ç®¡ç†ç”¨æˆ·çŠ¶æ€ä¹‹å¤–ï¼Œè¿˜éœ€è¦å¯¹ç”¨æˆ·è¿›è¡Œé‡æ–°éªŒè¯ï¼Œæ¯”å¦‚é‡æ–°è¾“å…¥å¯†ç ï¼Œæˆ–è€…ä½¿ç”¨çŸ­ä¿¡éªŒè¯ç ç­‰æ–¹å¼ã€‚ 9. æµè§ˆå™¨ç¦ç”¨ Cookieæ­¤æ—¶æ— æ³•ä½¿ç”¨ Cookie æ¥ä¿å­˜ç”¨æˆ·ä¿¡æ¯ï¼Œåªèƒ½ä½¿ç”¨ Sessionã€‚é™¤æ­¤ä¹‹å¤–ï¼Œä¸èƒ½å†å°† Session ID å­˜æ”¾åˆ° Cookie ä¸­ï¼Œè€Œæ˜¯ä½¿ç”¨ URL é‡å†™æŠ€æœ¯ï¼Œå°† Session ID ä½œä¸º URL çš„å‚æ•°è¿›è¡Œä¼ é€’ã€‚ 10. Cookie ä¸ Session é€‰æ‹© Cookie åªèƒ½å­˜å‚¨ ASCII ç å­—ç¬¦ä¸²ï¼Œè€Œ Session åˆ™å¯ä»¥å­˜å‚¨ä»»ä½•ç±»å‹çš„æ•°æ®ï¼Œå› æ­¤åœ¨è€ƒè™‘æ•°æ®å¤æ‚æ€§æ—¶é¦–é€‰ Sessionï¼› Cookie å­˜å‚¨åœ¨æµè§ˆå™¨ä¸­ï¼Œå®¹æ˜“è¢«æ¶æ„æŸ¥çœ‹ã€‚å¦‚æœéè¦å°†ä¸€äº›éšç§æ•°æ®å­˜åœ¨ Cookie ä¸­ï¼Œå¯ä»¥å°† Cookie å€¼è¿›è¡ŒåŠ å¯†ï¼Œç„¶ååœ¨æœåŠ¡å™¨è¿›è¡Œè§£å¯†ï¼› å¯¹äºå¤§å‹ç½‘ç«™ï¼Œå¦‚æœç”¨æˆ·æ‰€æœ‰çš„ä¿¡æ¯éƒ½å­˜å‚¨åœ¨ Session ä¸­ï¼Œé‚£ä¹ˆå¼€é”€æ˜¯éå¸¸å¤§çš„ï¼Œå› æ­¤ä¸å»ºè®®å°†æ‰€æœ‰çš„ç”¨æˆ·ä¿¡æ¯éƒ½å­˜å‚¨åˆ° Session ä¸­ã€‚ ç¼“å­˜1. ä¼˜ç‚¹ ç¼“è§£æœåŠ¡å™¨å‹åŠ›ï¼› é™ä½å®¢æˆ·ç«¯è·å–èµ„æºçš„å»¶è¿Ÿï¼šç¼“å­˜é€šå¸¸ä½äºå†…å­˜ä¸­ï¼Œè¯»å–ç¼“å­˜çš„é€Ÿåº¦æ›´å¿«ã€‚å¹¶ä¸”ç¼“å­˜æœåŠ¡å™¨åœ¨åœ°ç†ä½ç½®ä¸Šä¹Ÿæœ‰å¯èƒ½æ¯”æºæœåŠ¡å™¨æ¥å¾—è¿‘ï¼Œä¾‹å¦‚æµè§ˆå™¨ç¼“å­˜ã€‚ 2. å®ç°æ–¹æ³• è®©ä»£ç†æœåŠ¡å™¨è¿›è¡Œç¼“å­˜ï¼› è®©å®¢æˆ·ç«¯æµè§ˆå™¨è¿›è¡Œç¼“å­˜ã€‚ 3. Cache-ControlHTTP/1.1 é€šè¿‡ Cache-Control é¦–éƒ¨å­—æ®µæ¥æ§åˆ¶ç¼“å­˜ã€‚ 3.1 ç¦æ­¢è¿›è¡Œç¼“å­˜ no-store æŒ‡ä»¤è§„å®šä¸èƒ½å¯¹è¯·æ±‚æˆ–å“åº”çš„ä»»ä½•ä¸€éƒ¨åˆ†è¿›è¡Œç¼“å­˜ã€‚ 1Cache-Control: no-storeCopy to clipboardErrorCopied 3.2 å¼ºåˆ¶ç¡®è®¤ç¼“å­˜ no-cache æŒ‡ä»¤è§„å®šç¼“å­˜æœåŠ¡å™¨éœ€è¦å…ˆå‘æºæœåŠ¡å™¨éªŒè¯ç¼“å­˜èµ„æºçš„æœ‰æ•ˆæ€§ï¼Œåªæœ‰å½“ç¼“å­˜èµ„æºæœ‰æ•ˆæ—¶æ‰èƒ½ä½¿ç”¨è¯¥ç¼“å­˜å¯¹å®¢æˆ·ç«¯çš„è¯·æ±‚è¿›è¡Œå“åº”ã€‚ 1Cache-Control: no-cacheCopy to clipboardErrorCopied 3.3 ç§æœ‰ç¼“å­˜å’Œå…¬å…±ç¼“å­˜ private æŒ‡ä»¤è§„å®šäº†å°†èµ„æºä½œä¸ºç§æœ‰ç¼“å­˜ï¼Œåªèƒ½è¢«å•ç‹¬ç”¨æˆ·ä½¿ç”¨ï¼Œä¸€èˆ¬å­˜å‚¨åœ¨ç”¨æˆ·æµè§ˆå™¨ä¸­ã€‚ 1Cache-Control: privateCopy to clipboardErrorCopied public æŒ‡ä»¤è§„å®šäº†å°†èµ„æºä½œä¸ºå…¬å…±ç¼“å­˜ï¼Œå¯ä»¥è¢«å¤šä¸ªç”¨æˆ·ä½¿ç”¨ï¼Œä¸€èˆ¬å­˜å‚¨åœ¨ä»£ç†æœåŠ¡å™¨ä¸­ã€‚ 1Cache-Control: publicCopy to clipboardErrorCopied 3.4 ç¼“å­˜è¿‡æœŸæœºåˆ¶ max-age æŒ‡ä»¤å‡ºç°åœ¨è¯·æ±‚æŠ¥æ–‡ï¼Œå¹¶ä¸”ç¼“å­˜èµ„æºçš„ç¼“å­˜æ—¶é—´å°äºè¯¥æŒ‡ä»¤æŒ‡å®šçš„æ—¶é—´ï¼Œé‚£ä¹ˆå°±èƒ½æ¥å—è¯¥ç¼“å­˜ã€‚ max-age æŒ‡ä»¤å‡ºç°åœ¨å“åº”æŠ¥æ–‡ï¼Œè¡¨ç¤ºç¼“å­˜èµ„æºåœ¨ç¼“å­˜æœåŠ¡å™¨ä¸­ä¿å­˜çš„æ—¶é—´ã€‚ 1Cache-Control: max-age=31536000Copy to clipboardErrorCopied Expires é¦–éƒ¨å­—æ®µä¹Ÿå¯ä»¥ç”¨äºå‘ŠçŸ¥ç¼“å­˜æœåŠ¡å™¨è¯¥èµ„æºä»€ä¹ˆæ—¶å€™ä¼šè¿‡æœŸã€‚ 1Expires: Wed, 04 Jul 2012 08:26:05 GMTCopy to clipboardErrorCopied åœ¨ HTTP/1.1 ä¸­ï¼Œä¼šä¼˜å…ˆå¤„ç† max-age æŒ‡ä»¤ï¼› åœ¨ HTTP/1.0 ä¸­ï¼Œmax-age æŒ‡ä»¤ä¼šè¢«å¿½ç•¥æ‰ã€‚ 4. ç¼“å­˜éªŒè¯éœ€è¦å…ˆäº†è§£ ETag é¦–éƒ¨å­—æ®µçš„å«ä¹‰ï¼Œå®ƒæ˜¯èµ„æºçš„å”¯ä¸€æ ‡è¯†ã€‚URL ä¸èƒ½å”¯ä¸€è¡¨ç¤ºèµ„æºï¼Œä¾‹å¦‚ http://www.google.com/ æœ‰ä¸­æ–‡å’Œè‹±æ–‡ä¸¤ä¸ªèµ„æºï¼Œåªæœ‰ ETag æ‰èƒ½å¯¹è¿™ä¸¤ä¸ªèµ„æºè¿›è¡Œå”¯ä¸€æ ‡è¯†ã€‚ 1ETag: \"82e22293907ce725faf67773957acd12\"Copy to clipboardErrorCopied å¯ä»¥å°†ç¼“å­˜èµ„æºçš„ ETag å€¼æ”¾å…¥ If-None-Match é¦–éƒ¨ï¼ŒæœåŠ¡å™¨æ”¶åˆ°è¯¥è¯·æ±‚åï¼Œåˆ¤æ–­ç¼“å­˜èµ„æºçš„ ETag å€¼å’Œèµ„æºçš„æœ€æ–° ETag å€¼æ˜¯å¦ä¸€è‡´ï¼Œå¦‚æœä¸€è‡´åˆ™è¡¨ç¤ºç¼“å­˜èµ„æºæœ‰æ•ˆï¼Œè¿”å› 304 Not Modifiedã€‚ 1If-None-Match: \"82e22293907ce725faf67773957acd12\"Copy to clipboardErrorCopied Last-Modified é¦–éƒ¨å­—æ®µä¹Ÿå¯ä»¥ç”¨äºç¼“å­˜éªŒè¯ï¼Œå®ƒåŒ…å«åœ¨æºæœåŠ¡å™¨å‘é€çš„å“åº”æŠ¥æ–‡ä¸­ï¼ŒæŒ‡ç¤ºæºæœåŠ¡å™¨å¯¹èµ„æºçš„æœ€åä¿®æ”¹æ—¶é—´ã€‚ä½†æ˜¯å®ƒæ˜¯ä¸€ç§å¼±æ ¡éªŒå™¨ï¼Œå› ä¸ºåªèƒ½ç²¾ç¡®åˆ°ä¸€ç§’ï¼Œæ‰€ä»¥å®ƒé€šå¸¸ä½œä¸º ETag çš„å¤‡ç”¨æ–¹æ¡ˆã€‚å¦‚æœå“åº”é¦–éƒ¨å­—æ®µé‡Œå«æœ‰è¿™ä¸ªä¿¡æ¯ï¼Œå®¢æˆ·ç«¯å¯ä»¥åœ¨åç»­çš„è¯·æ±‚ä¸­å¸¦ä¸Š If-Modified-Since æ¥éªŒè¯ç¼“å­˜ã€‚æœåŠ¡å™¨åªåœ¨æ‰€è¯·æ±‚çš„èµ„æºåœ¨ç»™å®šçš„æ—¥æœŸæ—¶é—´ä¹‹åå¯¹å†…å®¹è¿›è¡Œè¿‡ä¿®æ”¹çš„æƒ…å†µä¸‹æ‰ä¼šå°†èµ„æºè¿”å›ï¼ŒçŠ¶æ€ç ä¸º 200 OKã€‚å¦‚æœè¯·æ±‚çš„èµ„æºä»é‚£æ—¶èµ·æœªç»ä¿®æ”¹ï¼Œé‚£ä¹ˆè¿”å›ä¸€ä¸ªä¸å¸¦æœ‰å®ä½“ä¸»ä½“çš„ 304 Not Modified å“åº”æŠ¥æ–‡ã€‚ 12Last-Modified: Wed, 21 Oct 2015 07:28:00 GMTCopy to clipboardErrorCopiedIf-Modified-Since: Wed, 21 Oct 2015 07:28:00 GMTCopy to clipboardErrorCopied å†…å®¹åå•†é€šè¿‡å†…å®¹åå•†è¿”å›æœ€åˆé€‚çš„å†…å®¹ï¼Œä¾‹å¦‚æ ¹æ®æµè§ˆå™¨çš„é»˜è®¤è¯­è¨€é€‰æ‹©è¿”å›ä¸­æ–‡ç•Œé¢è¿˜æ˜¯è‹±æ–‡ç•Œé¢ã€‚ 1. ç±»å‹1.1 æœåŠ¡ç«¯é©±åŠ¨å‹ å®¢æˆ·ç«¯è®¾ç½®ç‰¹å®šçš„ HTTP é¦–éƒ¨å­—æ®µï¼Œä¾‹å¦‚ Acceptã€Accept-Charsetã€Accept-Encodingã€Accept-Languageï¼ŒæœåŠ¡å™¨æ ¹æ®è¿™äº›å­—æ®µè¿”å›ç‰¹å®šçš„èµ„æºã€‚ å®ƒå­˜åœ¨ä»¥ä¸‹é—®é¢˜ï¼š æœåŠ¡å™¨å¾ˆéš¾çŸ¥é“å®¢æˆ·ç«¯æµè§ˆå™¨çš„å…¨éƒ¨ä¿¡æ¯ï¼› å®¢æˆ·ç«¯æä¾›çš„ä¿¡æ¯ç›¸å½“å†—é•¿ï¼ˆHTTP/2 åè®®çš„é¦–éƒ¨å‹ç¼©æœºåˆ¶ç¼“è§£äº†è¿™ä¸ªé—®é¢˜ï¼‰ï¼Œå¹¶ä¸”å­˜åœ¨éšç§é£é™©ï¼ˆHTTP æŒ‡çº¹è¯†åˆ«æŠ€æœ¯ï¼‰ï¼› ç»™å®šçš„èµ„æºéœ€è¦è¿”å›ä¸åŒçš„å±•ç°å½¢å¼ï¼Œå…±äº«ç¼“å­˜çš„æ•ˆç‡ä¼šé™ä½ï¼Œè€ŒæœåŠ¡å™¨ç«¯çš„å®ç°ä¼šè¶Šæ¥è¶Šå¤æ‚ã€‚ 1.2 ä»£ç†é©±åŠ¨å‹ æœåŠ¡å™¨è¿”å› 300 Multiple Choices æˆ–è€… 406 Not Acceptableï¼Œå®¢æˆ·ç«¯ä»ä¸­é€‰å‡ºæœ€åˆé€‚çš„é‚£ä¸ªèµ„æºã€‚ 2. Vary1Vary: Accept-LanguageCopy to clipboardErrorCopied åœ¨ä½¿ç”¨å†…å®¹åå•†çš„æƒ…å†µä¸‹ï¼Œåªæœ‰å½“ç¼“å­˜æœåŠ¡å™¨ä¸­çš„ç¼“å­˜æ»¡è¶³å†…å®¹åå•†æ¡ä»¶æ—¶ï¼Œæ‰èƒ½ä½¿ç”¨è¯¥ç¼“å­˜ï¼Œå¦åˆ™åº”è¯¥å‘æºæœåŠ¡å™¨è¯·æ±‚è¯¥èµ„æºã€‚ ä¾‹å¦‚ï¼Œä¸€ä¸ªå®¢æˆ·ç«¯å‘é€äº†ä¸€ä¸ªåŒ…å« Accept-Language é¦–éƒ¨å­—æ®µçš„è¯·æ±‚ä¹‹åï¼ŒæºæœåŠ¡å™¨è¿”å›çš„å“åº”åŒ…å« Vary: Accept-Language å†…å®¹ï¼Œç¼“å­˜æœåŠ¡å™¨å¯¹è¿™ä¸ªå“åº”è¿›è¡Œç¼“å­˜ä¹‹åï¼Œåœ¨å®¢æˆ·ç«¯ä¸‹ä¸€æ¬¡è®¿é—®åŒä¸€ä¸ª URL èµ„æºï¼Œå¹¶ä¸” Accept-Language ä¸ç¼“å­˜ä¸­çš„å¯¹åº”çš„å€¼ç›¸åŒæ—¶æ‰ä¼šè¿”å›è¯¥ç¼“å­˜ã€‚ å†…å®¹ç¼–ç å†…å®¹ç¼–ç å°†å®ä½“ä¸»ä½“è¿›è¡Œå‹ç¼©ï¼Œä»è€Œå‡å°‘ä¼ è¾“çš„æ•°æ®é‡ã€‚ å¸¸ç”¨çš„å†…å®¹ç¼–ç æœ‰ï¼šgzipã€compressã€deflateã€identityã€‚ æµè§ˆå™¨å‘é€ Accept-Encoding é¦–éƒ¨ï¼Œå…¶ä¸­åŒ…å«æœ‰å®ƒæ‰€æ”¯æŒçš„å‹ç¼©ç®—æ³•ï¼Œä»¥åŠå„è‡ªçš„ä¼˜å…ˆçº§ã€‚æœåŠ¡å™¨åˆ™ä»ä¸­é€‰æ‹©ä¸€ç§ï¼Œä½¿ç”¨è¯¥ç®—æ³•å¯¹å“åº”çš„æ¶ˆæ¯ä¸»ä½“è¿›è¡Œå‹ç¼©ï¼Œå¹¶ä¸”å‘é€ Content-Encoding é¦–éƒ¨æ¥å‘ŠçŸ¥æµè§ˆå™¨å®ƒé€‰æ‹©äº†å“ªä¸€ç§ç®—æ³•ã€‚ç”±äºè¯¥å†…å®¹åå•†è¿‡ç¨‹æ˜¯åŸºäºç¼–ç ç±»å‹æ¥é€‰æ‹©èµ„æºçš„å±•ç°å½¢å¼çš„ï¼Œå“åº”æŠ¥æ–‡çš„ Vary é¦–éƒ¨å­—æ®µè‡³å°‘è¦åŒ…å« Content-Encodingã€‚ èŒƒå›´è¯·æ±‚å¦‚æœç½‘ç»œå‡ºç°ä¸­æ–­ï¼ŒæœåŠ¡å™¨åªå‘é€äº†ä¸€éƒ¨åˆ†æ•°æ®ï¼ŒèŒƒå›´è¯·æ±‚å¯ä»¥ä½¿å¾—å®¢æˆ·ç«¯åªè¯·æ±‚æœåŠ¡å™¨æœªå‘é€çš„é‚£éƒ¨åˆ†æ•°æ®ï¼Œä»è€Œé¿å…æœåŠ¡å™¨é‡æ–°å‘é€æ‰€æœ‰æ•°æ®ã€‚ 1. Rangeåœ¨è¯·æ±‚æŠ¥æ–‡ä¸­æ·»åŠ  Range é¦–éƒ¨å­—æ®µæŒ‡å®šè¯·æ±‚çš„èŒƒå›´ã€‚ 123GET /z4d4kWk.jpg HTTP/1.1Host: i.imgur.comRange: bytes=0-1023Copy to clipboardErrorCopied è¯·æ±‚æˆåŠŸçš„è¯æœåŠ¡å™¨è¿”å›çš„å“åº”åŒ…å« 206 Partial Content çŠ¶æ€ç ã€‚ 12345HTTP/1.1 206 Partial ContentContent-Range: bytes 0-1023/146515Content-Length: 1024...(binary content)Copy to clipboardErrorCopied 2. Accept-Rangeså“åº”é¦–éƒ¨å­—æ®µ Accept-Ranges ç”¨äºå‘ŠçŸ¥å®¢æˆ·ç«¯æ˜¯å¦èƒ½å¤„ç†èŒƒå›´è¯·æ±‚ï¼Œå¯ä»¥å¤„ç†ä½¿ç”¨ bytesï¼Œå¦åˆ™ä½¿ç”¨ noneã€‚ 1Accept-Ranges: bytesCopy to clipboardErrorCopied 3. å“åº”çŠ¶æ€ç  åœ¨è¯·æ±‚æˆåŠŸçš„æƒ…å†µä¸‹ï¼ŒæœåŠ¡å™¨ä¼šè¿”å› 206 Partial Content çŠ¶æ€ç ã€‚ åœ¨è¯·æ±‚çš„èŒƒå›´è¶Šç•Œçš„æƒ…å†µä¸‹ï¼ŒæœåŠ¡å™¨ä¼šè¿”å› 416 Requested Range Not Satisfiable çŠ¶æ€ç ã€‚ åœ¨ä¸æ”¯æŒèŒƒå›´è¯·æ±‚çš„æƒ…å†µä¸‹ï¼ŒæœåŠ¡å™¨ä¼šè¿”å› 200 OK çŠ¶æ€ç ã€‚ åˆ†å—ä¼ è¾“ç¼–ç Chunked Transfer Encodingï¼Œå¯ä»¥æŠŠæ•°æ®åˆ†å‰²æˆå¤šå—ï¼Œè®©æµè§ˆå™¨é€æ­¥æ˜¾ç¤ºé¡µé¢ã€‚ å¤šéƒ¨åˆ†å¯¹è±¡é›†åˆä¸€ä»½æŠ¥æ–‡ä¸»ä½“å†…å¯å«æœ‰å¤šç§ç±»å‹çš„å®ä½“åŒæ—¶å‘é€ï¼Œæ¯ä¸ªéƒ¨åˆ†ä¹‹é—´ç”¨ boundary å­—æ®µå®šä¹‰çš„åˆ†éš”ç¬¦è¿›è¡Œåˆ†éš”ï¼Œæ¯ä¸ªéƒ¨åˆ†éƒ½å¯ä»¥æœ‰é¦–éƒ¨å­—æ®µã€‚ ä¾‹å¦‚ï¼Œä¸Šä¼ å¤šä¸ªè¡¨å•æ—¶å¯ä»¥ä½¿ç”¨å¦‚ä¸‹æ–¹å¼ï¼š 123456789101112Content-Type: multipart/form-data; boundary=AaB03x--AaB03xContent-Disposition: form-data; name=\"submit-name\"Larry--AaB03xContent-Disposition: form-data; name=\"files\"; filename=\"file1.txt\"Content-Type: text/plain... contents of file1.txt ...--AaB03x--Copy to clipboardErrorCopied è™šæ‹Ÿä¸»æœºHTTP/1.1 ä½¿ç”¨è™šæ‹Ÿä¸»æœºæŠ€æœ¯ï¼Œä½¿å¾—ä¸€å°æœåŠ¡å™¨æ‹¥æœ‰å¤šä¸ªåŸŸåï¼Œå¹¶ä¸”åœ¨é€»è¾‘ä¸Šå¯ä»¥çœ‹æˆå¤šä¸ªæœåŠ¡å™¨ã€‚ é€šä¿¡æ•°æ®è½¬å‘1. ä»£ç†ä»£ç†æœåŠ¡å™¨æ¥å—å®¢æˆ·ç«¯çš„è¯·æ±‚ï¼Œå¹¶ä¸”è½¬å‘ç»™å…¶å®ƒæœåŠ¡å™¨ã€‚ ä½¿ç”¨ä»£ç†çš„ä¸»è¦ç›®çš„æ˜¯ï¼š ç¼“å­˜ è´Ÿè½½å‡è¡¡ ç½‘ç»œè®¿é—®æ§åˆ¶ è®¿é—®æ—¥å¿—è®°å½• ä»£ç†æœåŠ¡å™¨åˆ†ä¸ºæ­£å‘ä»£ç†å’Œåå‘ä»£ç†ä¸¤ç§ï¼š ç”¨æˆ·å¯Ÿè§‰å¾—åˆ°æ­£å‘ä»£ç†çš„å­˜åœ¨ã€‚ è€Œåå‘ä»£ç†ä¸€èˆ¬ä½äºå†…éƒ¨ç½‘ç»œä¸­ï¼Œç”¨æˆ·å¯Ÿè§‰ä¸åˆ°ã€‚ 2. ç½‘å…³ä¸ä»£ç†æœåŠ¡å™¨ä¸åŒçš„æ˜¯ï¼Œç½‘å…³æœåŠ¡å™¨ä¼šå°† HTTP è½¬åŒ–ä¸ºå…¶å®ƒåè®®è¿›è¡Œé€šä¿¡ï¼Œä»è€Œè¯·æ±‚å…¶å®ƒé HTTP æœåŠ¡å™¨çš„æœåŠ¡ã€‚ 3. éš§é“ä½¿ç”¨ SSL ç­‰åŠ å¯†æ‰‹æ®µï¼Œåœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´å»ºç«‹ä¸€æ¡å®‰å…¨çš„é€šä¿¡çº¿è·¯ã€‚ å…­ã€HTTPSHTTP æœ‰ä»¥ä¸‹å®‰å…¨æ€§é—®é¢˜ï¼š ä½¿ç”¨æ˜æ–‡è¿›è¡Œé€šä¿¡ï¼Œå†…å®¹å¯èƒ½ä¼šè¢«çªƒå¬ï¼› ä¸éªŒè¯é€šä¿¡æ–¹çš„èº«ä»½ï¼Œé€šä¿¡æ–¹çš„èº«ä»½æœ‰å¯èƒ½é­é‡ä¼ªè£…ï¼› æ— æ³•è¯æ˜æŠ¥æ–‡çš„å®Œæ•´æ€§ï¼ŒæŠ¥æ–‡æœ‰å¯èƒ½é­ç¯¡æ”¹ã€‚ HTTPS å¹¶ä¸æ˜¯æ–°åè®®ï¼Œè€Œæ˜¯è®© HTTP å…ˆå’Œ SSLï¼ˆSecure Sockets Layerï¼‰é€šä¿¡ï¼Œå†ç”± SSL å’Œ TCP é€šä¿¡ï¼Œä¹Ÿå°±æ˜¯è¯´ HTTPS ä½¿ç”¨äº†éš§é“è¿›è¡Œé€šä¿¡ã€‚ é€šè¿‡ä½¿ç”¨ SSLï¼ŒHTTPS å…·æœ‰äº†åŠ å¯†ï¼ˆé˜²çªƒå¬ï¼‰ã€è®¤è¯ï¼ˆé˜²ä¼ªè£…ï¼‰å’Œå®Œæ•´æ€§ä¿æŠ¤ï¼ˆé˜²ç¯¡æ”¹ï¼‰ã€‚ åŠ å¯†1. å¯¹ç§°å¯†é’¥åŠ å¯†å¯¹ç§°å¯†é’¥åŠ å¯†ï¼ˆSymmetric-Key Encryptionï¼‰ï¼ŒåŠ å¯†å’Œè§£å¯†ä½¿ç”¨åŒä¸€å¯†é’¥ã€‚ ä¼˜ç‚¹ï¼šè¿ç®—é€Ÿåº¦å¿«ï¼› ç¼ºç‚¹ï¼šæ— æ³•å®‰å…¨åœ°å°†å¯†é’¥ä¼ è¾“ç»™é€šä¿¡æ–¹ã€‚ 2.éå¯¹ç§°å¯†é’¥åŠ å¯†éå¯¹ç§°å¯†é’¥åŠ å¯†ï¼Œåˆç§°å…¬å¼€å¯†é’¥åŠ å¯†ï¼ˆPublic-Key Encryptionï¼‰ï¼ŒåŠ å¯†å’Œè§£å¯†ä½¿ç”¨ä¸åŒçš„å¯†é’¥ã€‚ å…¬å¼€å¯†é’¥æ‰€æœ‰äººéƒ½å¯ä»¥è·å¾—ï¼Œé€šä¿¡å‘é€æ–¹è·å¾—æ¥æ”¶æ–¹çš„å…¬å¼€å¯†é’¥ä¹‹åï¼Œå°±å¯ä»¥ä½¿ç”¨å…¬å¼€å¯†é’¥è¿›è¡ŒåŠ å¯†ï¼Œæ¥æ”¶æ–¹æ”¶åˆ°é€šä¿¡å†…å®¹åä½¿ç”¨ç§æœ‰å¯†é’¥è§£å¯†ã€‚ éå¯¹ç§°å¯†é’¥é™¤äº†ç”¨æ¥åŠ å¯†ï¼Œè¿˜å¯ä»¥ç”¨æ¥è¿›è¡Œç­¾åã€‚å› ä¸ºç§æœ‰å¯†é’¥æ— æ³•è¢«å…¶ä»–äººè·å–ï¼Œå› æ­¤é€šä¿¡å‘é€æ–¹ä½¿ç”¨å…¶ç§æœ‰å¯†é’¥è¿›è¡Œç­¾åï¼Œé€šä¿¡æ¥æ”¶æ–¹ä½¿ç”¨å‘é€æ–¹çš„å…¬å¼€å¯†é’¥å¯¹ç­¾åè¿›è¡Œè§£å¯†ï¼Œå°±èƒ½åˆ¤æ–­è¿™ä¸ªç­¾åæ˜¯å¦æ­£ç¡®ã€‚ ä¼˜ç‚¹ï¼šå¯ä»¥æ›´å®‰å…¨åœ°å°†å…¬å¼€å¯†é’¥ä¼ è¾“ç»™é€šä¿¡å‘é€æ–¹ï¼› ç¼ºç‚¹ï¼šè¿ç®—é€Ÿåº¦æ…¢ã€‚ 3. HTTPS é‡‡ç”¨çš„åŠ å¯†æ–¹å¼HTTPS é‡‡ç”¨æ··åˆçš„åŠ å¯†æœºåˆ¶ï¼Œä½¿ç”¨éå¯¹ç§°å¯†é’¥åŠ å¯†ç”¨äºä¼ è¾“å¯¹ç§°å¯†é’¥æ¥ä¿è¯ä¼ è¾“è¿‡ç¨‹çš„å®‰å…¨æ€§ï¼Œä¹‹åä½¿ç”¨å¯¹ç§°å¯†é’¥åŠ å¯†è¿›è¡Œé€šä¿¡æ¥ä¿è¯é€šä¿¡è¿‡ç¨‹çš„æ•ˆç‡ã€‚ï¼ˆä¸‹å›¾ä¸­çš„ Session Key å°±æ˜¯å¯¹ç§°å¯†é’¥ï¼‰ è®¤è¯é€šè¿‡ä½¿ç”¨ è¯ä¹¦ æ¥å¯¹é€šä¿¡æ–¹è¿›è¡Œè®¤è¯ã€‚ æ•°å­—è¯ä¹¦è®¤è¯æœºæ„ï¼ˆCAï¼ŒCertificate Authorityï¼‰æ˜¯å®¢æˆ·ç«¯ä¸æœåŠ¡å™¨åŒæ–¹éƒ½å¯ä¿¡èµ–çš„ç¬¬ä¸‰æ–¹æœºæ„ã€‚ æœåŠ¡å™¨çš„è¿è¥äººå‘˜å‘ CA æå‡ºå…¬å¼€å¯†é’¥çš„ç”³è¯·ï¼ŒCA åœ¨åˆ¤æ˜æå‡ºç”³è¯·è€…çš„èº«ä»½ä¹‹åï¼Œä¼šå¯¹å·²ç”³è¯·çš„å…¬å¼€å¯†é’¥åšæ•°å­—ç­¾åï¼Œç„¶ååˆ†é…è¿™ä¸ªå·²ç­¾åçš„å…¬å¼€å¯†é’¥ï¼Œå¹¶å°†è¯¥å…¬å¼€å¯†é’¥æ”¾å…¥å…¬å¼€å¯†é’¥è¯ä¹¦åç»‘å®šåœ¨ä¸€èµ·ã€‚ è¿›è¡Œ HTTPS é€šä¿¡æ—¶ï¼ŒæœåŠ¡å™¨ä¼šæŠŠè¯ä¹¦å‘é€ç»™å®¢æˆ·ç«¯ã€‚å®¢æˆ·ç«¯å–å¾—å…¶ä¸­çš„å…¬å¼€å¯†é’¥ä¹‹åï¼Œå…ˆä½¿ç”¨æ•°å­—ç­¾åè¿›è¡ŒéªŒè¯ï¼Œå¦‚æœéªŒè¯é€šè¿‡ï¼Œå°±å¯ä»¥å¼€å§‹é€šä¿¡äº†ã€‚ å®Œæ•´æ€§ä¿æŠ¤SSL æä¾›æŠ¥æ–‡æ‘˜è¦åŠŸèƒ½æ¥è¿›è¡Œå®Œæ•´æ€§ä¿æŠ¤ã€‚ HTTP ä¹Ÿæä¾›äº† MD5 æŠ¥æ–‡æ‘˜è¦åŠŸèƒ½ï¼Œä½†ä¸æ˜¯å®‰å…¨çš„ã€‚ä¾‹å¦‚æŠ¥æ–‡å†…å®¹è¢«ç¯¡æ”¹ä¹‹åï¼ŒåŒæ—¶é‡æ–°è®¡ç®— MD5 çš„å€¼ï¼Œé€šä¿¡æ¥æ”¶æ–¹æ˜¯æ— æ³•æ„è¯†åˆ°å‘ç”Ÿäº†ç¯¡æ”¹ã€‚ HTTPS çš„æŠ¥æ–‡æ‘˜è¦åŠŸèƒ½ä¹‹æ‰€ä»¥å®‰å…¨ï¼Œæ˜¯å› ä¸ºå®ƒç»“åˆäº†åŠ å¯†å’Œè®¤è¯è¿™ä¸¤ä¸ªæ“ä½œã€‚è¯•æƒ³ä¸€ä¸‹ï¼ŒåŠ å¯†ä¹‹åçš„æŠ¥æ–‡ï¼Œé­åˆ°ç¯¡æ”¹ä¹‹åï¼Œä¹Ÿå¾ˆéš¾é‡æ–°è®¡ç®—æŠ¥æ–‡æ‘˜è¦ï¼Œå› ä¸ºæ— æ³•è½»æ˜“è·å–æ˜æ–‡ã€‚ HTTPS çš„ç¼ºç‚¹ å› ä¸ºéœ€è¦è¿›è¡ŒåŠ å¯†è§£å¯†ç­‰è¿‡ç¨‹ï¼Œå› æ­¤é€Ÿåº¦ä¼šæ›´æ…¢ï¼› éœ€è¦æ”¯ä»˜è¯ä¹¦æˆæƒçš„é«˜é¢è´¹ç”¨ã€‚ ä¸ƒã€HTTP/2.0HTTP/1.x ç¼ºé™·HTTP/1.x å®ç°ç®€å•æ˜¯ä»¥ç‰ºç‰²æ€§èƒ½ä¸ºä»£ä»·çš„ï¼š å®¢æˆ·ç«¯éœ€è¦ä½¿ç”¨å¤šä¸ªè¿æ¥æ‰èƒ½å®ç°å¹¶å‘å’Œç¼©çŸ­å»¶è¿Ÿï¼› ä¸ä¼šå‹ç¼©è¯·æ±‚å’Œå“åº”é¦–éƒ¨ï¼Œä»è€Œå¯¼è‡´ä¸å¿…è¦çš„ç½‘ç»œæµé‡ï¼› ä¸æ”¯æŒæœ‰æ•ˆçš„èµ„æºä¼˜å…ˆçº§ï¼Œè‡´ä½¿åº•å±‚ TCP è¿æ¥çš„åˆ©ç”¨ç‡ä½ä¸‹ã€‚ äºŒè¿›åˆ¶åˆ†å¸§å±‚HTTP/2.0 å°†æŠ¥æ–‡åˆ†æˆ HEADERS å¸§å’Œ DATA å¸§ï¼Œå®ƒä»¬éƒ½æ˜¯äºŒè¿›åˆ¶æ ¼å¼çš„ã€‚ åœ¨é€šä¿¡è¿‡ç¨‹ä¸­ï¼Œåªä¼šæœ‰ä¸€ä¸ª TCP è¿æ¥å­˜åœ¨ï¼Œå®ƒæ‰¿è½½äº†ä»»æ„æ•°é‡çš„åŒå‘æ•°æ®æµï¼ˆStreamï¼‰ã€‚ ä¸€ä¸ªæ•°æ®æµï¼ˆStreamï¼‰éƒ½æœ‰ä¸€ä¸ªå”¯ä¸€æ ‡è¯†ç¬¦å’Œå¯é€‰çš„ä¼˜å…ˆçº§ä¿¡æ¯ï¼Œç”¨äºæ‰¿è½½åŒå‘ä¿¡æ¯ã€‚ æ¶ˆæ¯ï¼ˆMessageï¼‰æ˜¯ä¸é€»è¾‘è¯·æ±‚æˆ–å“åº”å¯¹åº”çš„å®Œæ•´çš„ä¸€ç³»åˆ—å¸§ã€‚ å¸§ï¼ˆFrameï¼‰æ˜¯æœ€å°çš„é€šä¿¡å•ä½ï¼Œæ¥è‡ªä¸åŒæ•°æ®æµçš„å¸§å¯ä»¥äº¤é”™å‘é€ï¼Œç„¶åå†æ ¹æ®æ¯ä¸ªå¸§å¤´çš„æ•°æ®æµæ ‡è¯†ç¬¦é‡æ–°ç»„è£…ã€‚ æœåŠ¡ç«¯æ¨é€HTTP/2.0 åœ¨å®¢æˆ·ç«¯è¯·æ±‚ä¸€ä¸ªèµ„æºæ—¶ï¼Œä¼šæŠŠç›¸å…³çš„èµ„æºä¸€èµ·å‘é€ç»™å®¢æˆ·ç«¯ï¼Œå®¢æˆ·ç«¯å°±ä¸éœ€è¦å†æ¬¡å‘èµ·è¯·æ±‚äº†ã€‚ä¾‹å¦‚å®¢æˆ·ç«¯è¯·æ±‚ page.html é¡µé¢ï¼ŒæœåŠ¡ç«¯å°±æŠŠ script.js å’Œ style.css ç­‰ä¸ä¹‹ç›¸å…³çš„èµ„æºä¸€èµ·å‘ç»™å®¢æˆ·ç«¯ã€‚ é¦–éƒ¨å‹ç¼©HTTP/1.1 çš„é¦–éƒ¨å¸¦æœ‰å¤§é‡ä¿¡æ¯ï¼Œè€Œä¸”æ¯æ¬¡éƒ½è¦é‡å¤å‘é€ã€‚ HTTP/2.0 è¦æ±‚å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨åŒæ—¶ç»´æŠ¤å’Œæ›´æ–°ä¸€ä¸ªåŒ…å«ä¹‹å‰è§è¿‡çš„é¦–éƒ¨å­—æ®µè¡¨ï¼Œä»è€Œé¿å…äº†é‡å¤ä¼ è¾“ã€‚ ä¸ä»…å¦‚æ­¤ï¼ŒHTTP/2.0 ä¹Ÿä½¿ç”¨ Huffman ç¼–ç å¯¹é¦–éƒ¨å­—æ®µè¿›è¡Œå‹ç¼©ã€‚ å…«ã€HTTP/1.1 æ–°ç‰¹æ€§è¯¦ç»†å†…å®¹è¯·è§ä¸Šæ–‡ é»˜è®¤æ˜¯é•¿è¿æ¥ æ”¯æŒæµæ°´çº¿ æ”¯æŒåŒæ—¶æ‰“å¼€å¤šä¸ª TCP è¿æ¥ æ”¯æŒè™šæ‹Ÿä¸»æœº æ–°å¢çŠ¶æ€ç  100 æ”¯æŒåˆ†å—ä¼ è¾“ç¼–ç  æ–°å¢ç¼“å­˜å¤„ç†æŒ‡ä»¤ max-age ä¹ã€GET å’Œ POST æ¯”è¾ƒä½œç”¨GET ç”¨äºè·å–èµ„æºï¼Œè€Œ POST ç”¨äºä¼ è¾“å®ä½“ä¸»ä½“ã€‚ å‚æ•°GET å’Œ POST çš„è¯·æ±‚éƒ½èƒ½ä½¿ç”¨é¢å¤–çš„å‚æ•°ï¼Œä½†æ˜¯ GET çš„å‚æ•°æ˜¯ä»¥æŸ¥è¯¢å­—ç¬¦ä¸²å‡ºç°åœ¨ URL ä¸­ï¼Œè€Œ POST çš„å‚æ•°å­˜å‚¨åœ¨å®ä½“ä¸»ä½“ä¸­ã€‚ä¸èƒ½å› ä¸º POST å‚æ•°å­˜å‚¨åœ¨å®ä½“ä¸»ä½“ä¸­å°±è®¤ä¸ºå®ƒçš„å®‰å…¨æ€§æ›´é«˜ï¼Œå› ä¸ºç…§æ ·å¯ä»¥é€šè¿‡ä¸€äº›æŠ“åŒ…å·¥å…·ï¼ˆFiddlerï¼‰æŸ¥çœ‹ã€‚ å› ä¸º URL åªæ”¯æŒ ASCII ç ï¼Œå› æ­¤ GET çš„å‚æ•°ä¸­å¦‚æœå­˜åœ¨ä¸­æ–‡ç­‰å­—ç¬¦å°±éœ€è¦å…ˆè¿›è¡Œç¼–ç ã€‚ä¾‹å¦‚ ä¸­æ–‡ ä¼šè½¬æ¢ä¸º %E4%B8%AD%E6%96%87ï¼Œè€Œç©ºæ ¼ä¼šè½¬æ¢ä¸º %20ã€‚POST å‚æ•°æ”¯æŒæ ‡å‡†å­—ç¬¦é›†ã€‚ 1234GET /test/demo_form.asp?name1=value1&amp;name2=value2 HTTP/1.1Copy to clipboardErrorCopiedPOST /test/demo_form.asp HTTP/1.1Host: w3schools.comname1=value1&amp;name2=value2Copy to clipboardErrorCopied å®‰å…¨å®‰å…¨çš„ HTTP æ–¹æ³•ä¸ä¼šæ”¹å˜æœåŠ¡å™¨çŠ¶æ€ï¼Œä¹Ÿå°±æ˜¯è¯´å®ƒåªæ˜¯å¯è¯»çš„ã€‚ GET æ–¹æ³•æ˜¯å®‰å…¨çš„ï¼Œè€Œ POST å´ä¸æ˜¯ï¼Œå› ä¸º POST çš„ç›®çš„æ˜¯ä¼ é€å®ä½“ä¸»ä½“å†…å®¹ï¼Œè¿™ä¸ªå†…å®¹å¯èƒ½æ˜¯ç”¨æˆ·ä¸Šä¼ çš„è¡¨å•æ•°æ®ï¼Œä¸Šä¼ æˆåŠŸä¹‹åï¼ŒæœåŠ¡å™¨å¯èƒ½æŠŠè¿™ä¸ªæ•°æ®å­˜å‚¨åˆ°æ•°æ®åº“ä¸­ï¼Œå› æ­¤çŠ¶æ€ä¹Ÿå°±å‘ç”Ÿäº†æ”¹å˜ã€‚ å®‰å…¨çš„æ–¹æ³•é™¤äº† GET ä¹‹å¤–è¿˜æœ‰ï¼šHEADã€OPTIONSã€‚ ä¸å®‰å…¨çš„æ–¹æ³•é™¤äº† POST ä¹‹å¤–è¿˜æœ‰ PUTã€DELETEã€‚ å¹‚ç­‰æ€§å¹‚ç­‰çš„ HTTP æ–¹æ³•ï¼ŒåŒæ ·çš„è¯·æ±‚è¢«æ‰§è¡Œä¸€æ¬¡ä¸è¿ç»­æ‰§è¡Œå¤šæ¬¡çš„æ•ˆæœæ˜¯ä¸€æ ·çš„ï¼ŒæœåŠ¡å™¨çš„çŠ¶æ€ä¹Ÿæ˜¯ä¸€æ ·çš„ã€‚æ¢å¥è¯è¯´å°±æ˜¯ï¼Œå¹‚ç­‰æ–¹æ³•ä¸åº”è¯¥å…·æœ‰å‰¯ä½œç”¨ï¼ˆç»Ÿè®¡ç”¨é€”é™¤å¤–ï¼‰ã€‚ æ‰€æœ‰çš„å®‰å…¨æ–¹æ³•ä¹Ÿéƒ½æ˜¯å¹‚ç­‰çš„ã€‚ åœ¨æ­£ç¡®å®ç°çš„æ¡ä»¶ä¸‹ï¼ŒGETï¼ŒHEADï¼ŒPUT å’Œ DELETE ç­‰æ–¹æ³•éƒ½æ˜¯å¹‚ç­‰çš„ï¼Œè€Œ POST æ–¹æ³•ä¸æ˜¯ã€‚ GET /pageX HTTP/1.1 æ˜¯å¹‚ç­‰çš„ï¼Œè¿ç»­è°ƒç”¨å¤šæ¬¡ï¼Œå®¢æˆ·ç«¯æ¥æ”¶åˆ°çš„ç»“æœéƒ½æ˜¯ä¸€æ ·çš„ï¼š 1234GET /pageX HTTP/1.1GET /pageX HTTP/1.1GET /pageX HTTP/1.1GET /pageX HTTP/1.1Copy to clipboardErrorCopied POST /add_row HTTP/1.1 ä¸æ˜¯å¹‚ç­‰çš„ï¼Œå¦‚æœè°ƒç”¨å¤šæ¬¡ï¼Œå°±ä¼šå¢åŠ å¤šè¡Œè®°å½•ï¼š 123POST /add_row HTTP/1.1 -&gt; Adds a 1nd rowPOST /add_row HTTP/1.1 -&gt; Adds a 2nd rowPOST /add_row HTTP/1.1 -&gt; Adds a 3rd rowCopy to clipboardErrorCopied DELETE /idX/delete HTTP/1.1 æ˜¯å¹‚ç­‰çš„ï¼Œå³ä½¿ä¸åŒçš„è¯·æ±‚æ¥æ”¶åˆ°çš„çŠ¶æ€ç ä¸ä¸€æ ·ï¼š 123DELETE /idX/delete HTTP/1.1 -&gt; Returns 200 if idX existsDELETE /idX/delete HTTP/1.1 -&gt; Returns 404 as it just got deletedDELETE /idX/delete HTTP/1.1 -&gt; Returns 404Copy to clipboardErrorCopied å¯ç¼“å­˜å¦‚æœè¦å¯¹å“åº”è¿›è¡Œç¼“å­˜ï¼Œéœ€è¦æ»¡è¶³ä»¥ä¸‹æ¡ä»¶ï¼š è¯·æ±‚æŠ¥æ–‡çš„ HTTP æ–¹æ³•æœ¬èº«æ˜¯å¯ç¼“å­˜çš„ï¼ŒåŒ…æ‹¬ GET å’Œ HEADï¼Œä½†æ˜¯ PUT å’Œ DELETE ä¸å¯ç¼“å­˜ï¼ŒPOST åœ¨å¤šæ•°æƒ…å†µä¸‹ä¸å¯ç¼“å­˜çš„ã€‚ å“åº”æŠ¥æ–‡çš„çŠ¶æ€ç æ˜¯å¯ç¼“å­˜çš„ï¼ŒåŒ…æ‹¬ï¼š200, 203, 204, 206, 300, 301, 404, 405, 410, 414, and 501ã€‚ å“åº”æŠ¥æ–‡çš„ Cache-Control é¦–éƒ¨å­—æ®µæ²¡æœ‰æŒ‡å®šä¸è¿›è¡Œç¼“å­˜ã€‚ XMLHttpRequestä¸ºäº†é˜è¿° POST å’Œ GET çš„å¦ä¸€ä¸ªåŒºåˆ«ï¼Œéœ€è¦å…ˆäº†è§£ XMLHttpRequestï¼š XMLHttpRequest æ˜¯ä¸€ä¸ª APIï¼Œå®ƒä¸ºå®¢æˆ·ç«¯æä¾›äº†åœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´ä¼ è¾“æ•°æ®çš„åŠŸèƒ½ã€‚å®ƒæä¾›äº†ä¸€ä¸ªé€šè¿‡ URL æ¥è·å–æ•°æ®çš„ç®€å•æ–¹å¼ï¼Œå¹¶ä¸”ä¸ä¼šä½¿æ•´ä¸ªé¡µé¢åˆ·æ–°ã€‚è¿™ä½¿å¾—ç½‘é¡µåªæ›´æ–°ä¸€éƒ¨åˆ†é¡µé¢è€Œä¸ä¼šæ‰“æ‰°åˆ°ç”¨æˆ·ã€‚XMLHttpRequest åœ¨ AJAX ä¸­è¢«å¤§é‡ä½¿ç”¨ã€‚ åœ¨ä½¿ç”¨ XMLHttpRequest çš„ POST æ–¹æ³•æ—¶ï¼Œæµè§ˆå™¨ä¼šå…ˆå‘é€ Header å†å‘é€ Dataã€‚ä½†å¹¶ä¸æ˜¯æ‰€æœ‰æµè§ˆå™¨ä¼šè¿™ä¹ˆåšï¼Œä¾‹å¦‚ç«ç‹å°±ä¸ä¼šã€‚ è€Œ GET æ–¹æ³• Header å’Œ Data ä¼šä¸€èµ·å‘é€ã€‚ å‚è€ƒèµ„æ–™ ä¸Šé‡å®£. å›¾è§£ HTTP[M]. äººæ°‘é‚®ç”µå‡ºç‰ˆç¤¾, 2014. MDN : HTTP HTTP/2 ç®€ä»‹ htmlspecialchars Difference between file URI and URL in java How to Fix SQL Injection Using Java PreparedStatement &amp; CallableStatement æµ…è°ˆ HTTP ä¸­ Get ä¸ Post çš„åŒºåˆ« Are http:// and www really necessary? HTTP (HyperText Transfer Protocol) Web-VPN: Secure Proxies with SPDY &amp; Chrome File:HTTP persistent connection.svg Proxy server What Is This HTTPS/SSL Thing And Why Should You Care? What is SSL Offloading? Sun Directory Server Enterprise Edition 7.0 Reference - Key Encryption An Introduction to Mutual SSL Authentication The Difference Between URLs and URIs Cookie ä¸ Session çš„åŒºåˆ« COOKIE å’Œ SESSION æœ‰ä»€ä¹ˆåŒºåˆ« Cookie/Session çš„æœºåˆ¶ä¸å®‰å…¨ HTTPS è¯ä¹¦åŸç† What is the difference between a URI, a URL and a URN? XMLHttpRequest XMLHttpRequest (XHR) Uses Multiple Packets for HTTP POST? Symmetric vs. Asymmetric Encryption â€“ What are differences? Web æ€§èƒ½ä¼˜åŒ–ä¸ HTTP/2 HTTP/2 ç®€ä»‹ ä¸€ OSIä¸TCP/IPå„å±‚çš„ç»“æ„ä¸åŠŸèƒ½OSIçš„ä¸ƒå±‚ä½“ç³»ç»“æ„æ¦‚å¿µæ¸…æ¥šï¼Œç†è®ºä¹Ÿå¾ˆå®Œæ•´ï¼Œä½†æ˜¯å®ƒæ¯”è¾ƒå¤æ‚è€Œä¸”ä¸å®ç”¨ã€‚åœ¨è¿™é‡Œé¡ºå¸¦æä¸€ä¸‹ä¹‹å‰ä¸€ç›´è¢«ä¸€äº›å¤§å…¬å¸ç”šè‡³ä¸€äº›å›½å®¶æ”¿åºœæ”¯æŒçš„OSIå¤±è´¥çš„åŸå› ï¼š OSIçš„ä¸“å®¶ç¼ºä¹å®é™…ç»éªŒï¼Œä»–ä»¬åœ¨å®ŒæˆOSIæ ‡å‡†æ—¶ç¼ºä¹å•†ä¸šé©±åŠ¨åŠ› OSIçš„åè®®å®ç°èµ·æ¥è¿‡åˆ†å¤æ‚ï¼Œè€Œä¸”è¿è¡Œæ•ˆç‡å¾ˆä½ OSIåˆ¶å®šæ ‡å‡†çš„å‘¨æœŸå¤ªé•¿ï¼Œå› è€Œä½¿å¾—æŒ‰OSIæ ‡å‡†ç”Ÿäº§çš„è®¾å¤‡æ— æ³•åŠæ—¶è¿›å…¥å¸‚åœºï¼ˆ20ä¸–çºª90å¹´ä»£åˆæœŸï¼Œè™½ç„¶æ•´å¥—çš„OSIå›½é™…æ ‡å‡† éƒ½å·²ç»åˆ¶å®šå‡ºæ¥ï¼Œä½†åŸºäºTCP/IPçš„äº’è”ç½‘å·²ç»æŠ¢å…ˆåœ¨å…¨çƒç›¸å½“å¤§çš„èŒƒå›´æˆåŠŸè¿è¡Œäº†ï¼‰ OSIçš„å±‚æ¬¡åˆ’åˆ†ä¸å¤ªåˆç†ï¼Œæœ‰äº›åŠŸèƒ½åœ¨å¤šä¸ªå±‚æ¬¡ä¸­é‡å¤å‡ºç° äº”å±‚åè®®çš„ä½“ç³»ç»“æ„å­¦ä¹ è®¡ç®—æœºç½‘ç»œæ—¶æˆ‘ä»¬ä¸€èˆ¬é‡‡ç”¨æŠ˜ä¸­çš„åŠæ³•ï¼Œä¹Ÿå°±æ˜¯ä¸­å’ŒOSIå’ŒTCP/IPçš„æœ‰ç‚¹ï¼Œé‡‡ç”¨ä¸€ç§åªæœ‰äº”å±‚åè®®çš„ä½“ç³»ç»“æ„ï¼Œè¿™æ ·æ—¢ç®€æ´åˆèƒ½å°†æ¦‚å¿µé˜è¿°æ¸…æ¥šã€‚ 1 åº”ç”¨å±‚ï¼ˆapplication layerï¼‰-&gt; æ•°æ®ä¼ è¾“å¾—å•ä½æ˜¯: æŠ¥æ–‡ åº”ç”¨å±‚çš„ä»»åŠ¡æ˜¯é€šè¿‡åº”ç”¨è¿›ç¨‹é—´çš„äº¤äº’æ¥å®Œæˆç‰¹å®šç½‘ç»œåº”ç”¨ã€‚åº”ç”¨å±‚åè®®å®šä¹‰çš„æ˜¯åº”ç”¨è¿›ç¨‹ï¼ˆè¿›ç¨‹ï¼šä¸»æœºä¸­æ­£åœ¨è¿è¡Œçš„ç¨‹åºï¼‰é—´çš„é€šä¿¡å’Œäº¤äº’çš„è§„åˆ™ã€‚å¯¹äºä¸åŒçš„ç½‘ç»œåº”ç”¨éœ€è¦ä¸åŒçš„åº”ç”¨å±‚åè®®ã€‚ åº”ç”¨å±‚ä¸»è¦ä½¿ç”¨ä»¥ä¸‹å‡ ç§åè®®ï¼š åŸŸåç³»ç»ŸDNSï¼Œæ”¯æŒä¸‡ç»´ç½‘åº”ç”¨çš„ åŸŸåç³»ç»Ÿæ˜¯å› ç‰¹ç½‘çš„ä¸€é¡¹æ ¸å¿ƒæœåŠ¡ï¼Œå®ƒä½œä¸ºå¯ä»¥å°†åŸŸåå’ŒIPåœ°å€ç›¸äº’æ˜ å°„çš„ä¸€ä¸ªåˆ†å¸ƒå¼æ•°æ®åº“ï¼Œèƒ½å¤Ÿä½¿äººæ›´æ–¹ä¾¿çš„è®¿é—®äº’è”ç½‘ï¼Œè€Œä¸ç”¨å»è®°ä½èƒ½å¤Ÿè¢«æœºå™¨ç›´æ¥è¯»å–çš„IPæ•°ä¸²ã€‚ æ”¯æŒç”µå­é‚®ä»¶çš„SMTPåè®® HTTPåè®® è¶…æ–‡æœ¬ä¼ è¾“åè®®ï¼ˆHTTPï¼ŒHyperText Transfer Protocol)æ˜¯äº’è”ç½‘ä¸Šåº”ç”¨æœ€ä¸ºå¹¿æ³›çš„ä¸€ç§ç½‘ç»œåè®®ã€‚æ‰€æœ‰çš„WWWæ–‡ä»¶éƒ½å¿…é¡»éµå®ˆè¿™ä¸ªæ ‡å‡†ã€‚ 2 è¿è¾“å±‚ï¼ˆtransport layerï¼‰-&gt; æ•°æ®å•ä½: æŠ¥æ–‡(åˆ†æ®µ) è¿è¾“å±‚çš„ä¸»è¦ä»»åŠ¡å°±æ˜¯è´Ÿè´£å‘ä¸¤å°ä¸»æœºè¿›ç¨‹ä¹‹é—´çš„é€šä¿¡æä¾›é€šç”¨çš„æ•°æ®ä¼ è¾“æœåŠ¡ã€‚åº”ç”¨è¿›ç¨‹åˆ©ç”¨è¯¥æœåŠ¡ä¼ é€åº”ç”¨å±‚æŠ¥æ–‡ã€‚â€œé€šç”¨çš„â€æ˜¯æŒ‡å¹¶ä¸é’ˆå¯¹æŸä¸€ä¸ªç‰¹å®šçš„ç½‘ç»œåº”ç”¨ï¼Œè€Œæ˜¯å¤šç§åº”ç”¨å¯ä»¥ä½¿ç”¨åŒä¸€ä¸ªè¿è¾“å±‚æœåŠ¡ã€‚ç”±äºä¸€å°ä¸»æœºå¯åŒæ—¶è¿è¡Œå¤šä¸ªçº¿ç¨‹ï¼Œå› æ­¤è¿è¾“å±‚æœ‰å¤ç”¨å’Œåˆ†ç”¨çš„åŠŸèƒ½ã€‚æ‰€è°“å¤ç”¨å°±æ˜¯æŒ‡å¤šä¸ªåº”ç”¨å±‚è¿›ç¨‹å¯åŒæ—¶ä½¿ç”¨ä¸‹é¢è¿è¾“å±‚çš„æœåŠ¡ï¼Œåˆ†ç”¨å’Œå¤ç”¨ç›¸åï¼Œæ˜¯è¿è¾“å±‚æŠŠæ”¶åˆ°çš„ä¿¡æ¯åˆ†åˆ«äº¤ä»˜ä¸Šé¢åº”ç”¨å±‚ä¸­çš„ç›¸åº”è¿›ç¨‹ã€‚ è¿è¾“å±‚ä¸»è¦ä½¿ç”¨ä»¥ä¸‹ä¸¤ç§åè®®ï¼š ä¼ è¾“æ§åˆ¶åè®®TCPï¼ˆTransmisson Control Protocolï¼‰ â€“æä¾›é¢å‘è¿æ¥çš„ï¼Œå¯é çš„æ•°æ®ä¼ è¾“æœåŠ¡ã€‚æ¯ä¸€æ¡TCPè¿æ¥åªèƒ½æœ‰ä¸¤ä¸ªç«¯ç‚¹ï¼Œæ¯ä¸€æ¡TCPè¿æ¥åªèƒ½æ˜¯ç‚¹å¯¹ç‚¹çš„ï¼ˆä¸€å¯¹ä¸€), TCPæä¾›å¯é äº¤ä»˜çš„æœåŠ¡, TCPæä¾›å…¨åŒå·¥é€šä¿¡ã€‚TCPå…è®¸é€šä¿¡åŒæ–¹çš„åº”ç”¨è¿›ç¨‹åœ¨ä»»ä½•æ—¶å€™éƒ½èƒ½å‘é€æ•°æ®ã€‚TCPè¿æ¥çš„ä¸¤ç«¯éƒ½è®¾æœ‰å‘é€ç¼“å­˜å’Œæ¥æ”¶ç¼“å­˜ï¼Œç”¨æ¥ä¸´æ—¶å­˜æ”¾åŒæ–¹é€šä¿¡çš„æ•°æ®ï¼›é¢å‘å­—èŠ‚æµ. ç”¨æˆ·æ•°æ®åè®®UDPï¼ˆUser Datagram Protocolï¼‰ â€“æä¾›æ— è¿æ¥çš„ï¼Œå°½æœ€å¤§åŠªåŠ›çš„æ•°æ®ä¼ è¾“æœåŠ¡ï¼ˆä¸ä¿è¯æ•°æ®ä¼ è¾“çš„å¯é æ€§), å®ƒå¾—ä¼ è¾“æ˜¯é¢å‘æŠ¥æ–‡çš„, UDPæ²¡æœ‰æ‹¥å¡æ§åˆ¶ï¼Œå› æ­¤ç½‘ç»œå‡ºç°æ‹¥å¡ä¸ä¼šä½¿æºä¸»æœºçš„å‘é€é€Ÿç‡é™ä½ï¼ˆå¯¹å®æ—¶åº”ç”¨å¾ˆæœ‰ç”¨ï¼Œå¦‚IPç”µè¯ï¼Œå®æ—¶è§†é¢‘ä¼šè®®ç­‰, UDPæ”¯æŒä¸€å¯¹ä¸€ã€ä¸€å¯¹å¤šã€å¤šå¯¹ä¸€å’Œå¤šå¯¹å¤šçš„äº¤äº’é€šä¿¡, UDPçš„é¦–éƒ¨å¼€é”€å°ï¼Œåªæœ‰8ä¸ªå­—èŠ‚ï¼Œæ¯”TCPçš„20ä¸ªå­—èŠ‚çš„é¦–éƒ¨è¦çŸ­. 3 ç½‘ç»œå±‚ï¼ˆnetwork layerï¼‰-&gt;æ•°æ®å•ä½: åˆ†ç»„(åŒ…) ç½‘ç»œå±‚è´Ÿè´£ä¸ºåˆ†ç»„äº¤æ¢ç½‘ä¸Šçš„ä¸åŒä¸»æœºæä¾›é€šä¿¡æœåŠ¡ã€‚åœ¨å‘é€æ•°æ®æ—¶ï¼Œç½‘ç»œå±‚æŠŠè¿è¾“å±‚äº§ç”Ÿçš„æŠ¥æ–‡æ®µæˆ–ç”¨æˆ·æ•°æ®æŠ¥å°è£…æˆåˆ†ç»„å’ŒåŒ…è¿›è¡Œä¼ é€ã€‚åœ¨TCP/IPä½“ç³»ç»“æ„ä¸­ï¼Œç”±äºç½‘ç»œå±‚ä½¿ç”¨IPåè®®ï¼Œå› æ­¤åˆ†ç»„ä¹Ÿå«IPæ•°æ®æŠ¥ï¼Œç®€ç§°æ•°æ®æŠ¥ã€‚ è¿™é‡Œè¦æ³¨æ„ï¼šä¸è¦æŠŠè¿è¾“å±‚çš„â€œç”¨æˆ·æ•°æ®æŠ¥UDPâ€å’Œç½‘ç»œå±‚çš„â€œIPæ•°æ®æŠ¥â€å¼„æ··ã€‚å¦å¤–ï¼Œæ— è®ºæ˜¯å“ªä¸€å±‚çš„æ•°æ®å•å…ƒï¼Œéƒ½å¯ç¬¼ç»Ÿåœ°ç”¨â€œåˆ†ç»„â€æ¥è¡¨ç¤ºã€‚ ç½‘ç»œå±‚çš„å¦ä¸€ä¸ªä»»åŠ¡å°±æ˜¯é€‰æ‹©åˆé€‚çš„è·¯ç”±ï¼Œä½¿æºä¸»æœºè¿è¾“å±‚æ‰€ä¼ ä¸‹æ¥çš„åˆ†æ ªï¼Œèƒ½é€šè¿‡ç½‘ç»œå±‚ä¸­çš„è·¯ç”±å™¨æ‰¾åˆ°ç›®çš„ä¸»æœºã€‚ ==è¿™é‡Œå¼ºè°ƒæŒ‡å‡ºï¼Œç½‘ç»œå±‚ä¸­çš„â€œç½‘ç»œâ€äºŒå­—å·²ç»ä¸æ˜¯æˆ‘ä»¬é€šå¸¸è°ˆåˆ°çš„å…·ä½“ç½‘ç»œï¼Œè€Œæ˜¯æŒ‡è®¡ç®—æœºç½‘ç»œä½“ç³»ç»“æ„æ¨¡å‹ä¸­ç¬¬ä¸‰å±‚çš„åç§°.== äº’è”ç½‘æ˜¯ç”±å¤§é‡çš„å¼‚æ„ï¼ˆheterogeneousï¼‰ç½‘ç»œé€šè¿‡è·¯ç”±å™¨ï¼ˆrouterï¼‰ç›¸äº’è¿æ¥èµ·æ¥çš„ã€‚äº’è”ç½‘ä½¿ç”¨çš„ç½‘ç»œå±‚åè®®æ˜¯æ— è¿æ¥çš„ç½‘é™…åè®®ï¼ˆIntert Prococolï¼‰å’Œè®¸å¤šè·¯ç”±é€‰æ‹©åè®®ï¼Œå› æ­¤äº’è”ç½‘çš„ç½‘ç»œå±‚ä¹Ÿå«åšç½‘é™…å±‚æˆ–IPå±‚ã€‚ ä¸»è¦åè®®: TCP/IPåè®® 4 æ•°æ®é“¾è·¯å±‚ï¼ˆdata link layerï¼‰-&gt;æ•°æ®å•ä½:å¸§ æ•°æ®é“¾è·¯å±‚é€šå¸¸ç®€ç§°ä¸ºé“¾è·¯å±‚ã€‚ä¸¤å°ä¸»æœºä¹‹é—´çš„æ•°æ®ä¼ è¾“ï¼Œæ€»æ˜¯åœ¨ä¸€æ®µä¸€æ®µçš„é“¾è·¯ä¸Šä¼ é€çš„ï¼Œè¿™å°±éœ€è¦ä½¿ç”¨ä¸“é—¨çš„é“¾è·¯å±‚çš„åè®®ã€‚ åœ¨ä¸¤ä¸ªç›¸é‚»èŠ‚ç‚¹ä¹‹é—´ä¼ é€æ•°æ®æ—¶ï¼Œæ•°æ®é“¾è·¯å±‚å°†ç½‘ç»œå±‚äº¤ä¸‹æ¥çš„IPæ•°æ®æŠ¥ç»„è£…ç¨‹å¸§ï¼Œåœ¨ä¸¤ä¸ªç›¸é‚»èŠ‚ç‚¹é—´çš„é“¾è·¯ä¸Šä¼ é€å¸§ã€‚æ¯ä¸€å¸§åŒ…æ‹¬æ•°æ®å’Œå¿…è¦çš„æ§åˆ¶ä¿¡æ¯ï¼ˆå¦‚åŒæ­¥ä¿¡æ¯ï¼Œåœ°å€ä¿¡æ¯ï¼Œå·®é”™æ§åˆ¶ç­‰ï¼‰ã€‚ ä¸»è¦åè®®: PPPç‚¹åˆ°ç‚¹ ARP CDP 5 ç‰©ç†å±‚ï¼ˆphysical layerï¼‰-&gt; æ•°æ®å•ä½: æ¯”ç‰¹(ä½) åœ¨ç‰©ç†å±‚ä¸Šæ‰€ä¼ é€çš„æ•°æ®å•ä½æ˜¯æ¯”ç‰¹ã€‚ç‰©ç†å±‚çš„ä½œç”¨æ˜¯å®ç°ç›¸é‚»è®¡ç®—æœºèŠ‚ç‚¹ä¹‹é—´æ¯”ç‰¹æµçš„é€æ˜ä¼ é€ï¼Œå°½å¯èƒ½å±è”½æ‰å…·ä½“ä¼ è¾“ä»‹è´¨å’Œç‰©ç†è®¾å¤‡çš„å·®å¼‚ã€‚ä½¿å…¶ä¸Šé¢çš„æ•°æ®é“¾è·¯å±‚ä¸å¿…è€ƒè™‘ç½‘ç»œçš„å…·ä½“ä¼ è¾“ä»‹è´¨æ˜¯ä»€ä¹ˆã€‚â€œé€æ˜ä¼ é€æ¯”ç‰¹æµâ€è¡¨ç¤ºç»å®é™…ç”µè·¯ä¼ é€åçš„æ¯”ç‰¹æµæ²¡æœ‰å‘ç”Ÿå˜åŒ–ï¼Œå¯¹ä¼ é€çš„æ¯”ç‰¹æµæ¥è¯´ï¼Œè¿™ä¸ªç”µè·¯å¥½åƒæ˜¯çœ‹ä¸è§çš„ã€‚ åœ¨äº’è”ç½‘ä½¿ç”¨çš„å„ç§åä¸­æœ€é‡è¦å’Œæœ€è‘—åçš„å°±æ˜¯TCP/IPä¸¤ä¸ªåè®®ã€‚ç°åœ¨äººä»¬ç»å¸¸æåˆ°çš„TCP/IPå¹¶ä¸ä¸€å®šå•æŒ‡TCPå’ŒIPè¿™ä¸¤ä¸ªå…·ä½“çš„åè®®ï¼Œè€Œå¾€å¾€è¡¨ç¤ºäº’è”ç½‘æ‰€ä½¿ç”¨çš„æ•´ä¸ªTCP/IPåè®®æ—ã€‚ TCPä¸‰æ¬¡æ¡æ‰‹å’Œå››æ¬¡æŒ¥æ‰‹ï¼ˆé¢è¯•å¸¸å®¢ï¼‰ ç†æƒ³çŠ¶æ€ä¸‹ï¼ŒTCPè¿æ¥ä¸€æ—¦å»ºç«‹ï¼Œåœ¨é€šä¿¡åŒæ–¹ä¸­çš„ä»»ä½•ä¸€æ–¹ä¸»åŠ¨å…³é—­è¿æ¥ä¹‹å‰ï¼ŒTCP è¿æ¥éƒ½å°†è¢«ä¸€ç›´ä¿æŒä¸‹å»ã€‚ ä¸ºäº†å‡†ç¡®æ— è¯¯åœ°æŠŠæ•°æ®é€è¾¾ç›®æ ‡å¤„ï¼ŒTCPåè®®é‡‡ç”¨äº†ä¸‰æ¬¡æ¡æ‰‹ç­–ç•¥ã€‚ ç®€å•ç¤ºæ„å›¾ï¼š å®¢æˆ·ç«¯â€“å‘é€å¸¦æœ‰SYNæ ‡å¿—çš„æ•°æ®åŒ…â€“ä¸€æ¬¡æ¡æ‰‹â€“æœåŠ¡ç«¯ æœåŠ¡ç«¯â€“å‘é€å¸¦æœ‰SYN/ACKæ ‡å¿—çš„æ•°æ®åŒ…â€“äºŒæ¬¡æ¡æ‰‹â€“å®¢æˆ·ç«¯ å®¢æˆ·ç«¯â€“å‘é€å¸¦æœ‰å¸¦æœ‰ACKæ ‡å¿—çš„æ•°æ®åŒ…â€“ä¸‰æ¬¡æ¡æ‰‹â€“æœåŠ¡ç«¯ ä¸ºä»€ä¹ˆè¦ä¼ å›SYNï¼ˆå‘èµ·ä¸€ä¸ªæ–°é“¾æ¥ï¼‰ï¼Ÿ æ¥æ”¶ç«¯ä¼ å›å‘é€ç«¯æ‰€å‘é€çš„SYNæ˜¯ä¸ºäº†å‘Šè¯‰å‘é€ç«¯ï¼Œæˆ‘æ¥æ”¶åˆ°çš„ä¿¡æ¯ç¡®å®å°±æ˜¯ä½ æ‰€å‘é€çš„ä¿¡å·äº†ã€‚ ä¼ äº†SYNï¼Œä¸ºå•¥è¿˜è¦ä¼ ACKï¼ˆç¡®è®¤åºå·æœ‰æ•ˆï¼‰ï¼Ÿ åŒæ–¹é€šä¿¡æ— è¯¯å¿…é¡»æ˜¯ä¸¤è€…äº’ç›¸å‘é€ä¿¡æ¯éƒ½æ— è¯¯ã€‚ä¼ äº†SYNï¼Œè¯æ˜å‘é€æ–¹åˆ°æ¥æ”¶æ–¹çš„é€šé“æ²¡æœ‰é—®é¢˜ï¼Œä½†æ˜¯æ¥æ”¶æ–¹åˆ°å‘é€æ–¹çš„é€šé“è¿˜éœ€è¦ACKä¿¡å·æ¥è¿›è¡ŒéªŒè¯ã€‚ æ–­å¼€ä¸€ä¸ªTCPè¿æ¥åˆ™éœ€è¦â€œå››æ¬¡æŒ¥æ‰‹â€ï¼š å®¢æˆ·ç«¯-å‘é€ä¸€ä¸ªFINï¼Œç”¨æ¥å…³é—­å®¢æˆ·ç«¯åˆ°æœåŠ¡å™¨çš„æ•°æ®ä¼ é€ æœåŠ¡å™¨-æ”¶åˆ°è¿™ä¸ªFINï¼Œå®ƒå‘å›ä¸€ä¸ªACKï¼Œç¡®è®¤åºå·ä¸ºæ”¶åˆ°çš„åºå·åŠ 1 ã€‚å’ŒSYNä¸€æ ·ï¼Œä¸€ä¸ªFINå°†å ç”¨ä¸€ä¸ªåºå· æœåŠ¡å™¨-å…³é—­ä¸å®¢æˆ·ç«¯çš„è¿æ¥ï¼Œå‘é€ä¸€ä¸ªFINç»™å®¢æˆ·ç«¯ å®¢æˆ·ç«¯-å‘å›ACKæŠ¥æ–‡ç¡®è®¤ï¼Œå¹¶å°†ç¡®è®¤åºå·è®¾ç½®ä¸ºæ”¶åˆ°åºå·åŠ 1 å¸¸è§é¢è¯•é¢˜ ã€é—®é¢˜1ã€‘ä¸ºä»€ä¹ˆè¿æ¥çš„æ—¶å€™æ˜¯ä¸‰æ¬¡æ¡æ‰‹ï¼Œå…³é—­çš„æ—¶å€™å´æ˜¯å››æ¬¡æ¡æ‰‹ï¼Ÿç­”ï¼šå› ä¸ºå½“Serverç«¯æ”¶åˆ°Clientç«¯çš„SYNè¿æ¥è¯·æ±‚æŠ¥æ–‡åï¼Œå¯ä»¥ç›´æ¥å‘é€SYN+ACKæŠ¥æ–‡ã€‚å…¶ä¸­ACKæŠ¥æ–‡æ˜¯ç”¨æ¥åº”ç­”çš„ï¼ŒSYNæŠ¥æ–‡æ˜¯ç”¨æ¥åŒæ­¥çš„ã€‚ä½†æ˜¯å…³é—­è¿æ¥æ—¶ï¼Œå½“Serverç«¯æ”¶åˆ°FINæŠ¥æ–‡æ—¶ï¼Œå¾ˆå¯èƒ½å¹¶ä¸ä¼šç«‹å³å…³é—­SOCKETï¼Œæ‰€ä»¥åªèƒ½å…ˆå›å¤ä¸€ä¸ªACKæŠ¥æ–‡ï¼Œå‘Šè¯‰Clientç«¯ï¼Œâ€ä½ å‘çš„FINæŠ¥æ–‡æˆ‘æ”¶åˆ°äº†â€ã€‚åªæœ‰ç­‰åˆ°æˆ‘Serverç«¯æ‰€æœ‰çš„æŠ¥æ–‡éƒ½å‘é€å®Œäº†ï¼Œæˆ‘æ‰èƒ½å‘é€FINæŠ¥æ–‡ï¼Œå› æ­¤ä¸èƒ½ä¸€èµ·å‘é€ã€‚æ•…éœ€è¦å››æ­¥æ¡æ‰‹ã€‚ ã€é—®é¢˜2ã€‘ä¸ºä»€ä¹ˆTIME_WAITçŠ¶æ€éœ€è¦ç»è¿‡2MSL(æœ€å¤§æŠ¥æ–‡æ®µç”Ÿå­˜æ—¶é—´)æ‰èƒ½è¿”å›åˆ°CLOSEçŠ¶æ€ï¼Ÿç­”ï¼šè™½ç„¶æŒ‰é“ç†ï¼Œå››ä¸ªæŠ¥æ–‡éƒ½å‘é€å®Œæ¯•ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥è¿›å…¥CLOSEçŠ¶æ€äº†ï¼Œä½†æ˜¯æˆ‘ä»¬å¿…é¡»å‡è±¡ç½‘ç»œæ˜¯ä¸å¯é çš„ï¼Œæœ‰å¯ä»¥æœ€åä¸€ä¸ªACKä¸¢å¤±ã€‚æ‰€ä»¥TIME_WAITçŠ¶æ€å°±æ˜¯ç”¨æ¥é‡å‘å¯èƒ½ä¸¢å¤±çš„ACKæŠ¥æ–‡ã€‚åœ¨Clientå‘é€å‡ºæœ€åçš„ACKå›å¤ï¼Œä½†è¯¥ACKå¯èƒ½ä¸¢å¤±ã€‚Serverå¦‚æœæ²¡æœ‰æ”¶åˆ°ACKï¼Œå°†ä¸æ–­é‡å¤å‘é€FINç‰‡æ®µã€‚æ‰€ä»¥Clientä¸èƒ½ç«‹å³å…³é—­ï¼Œå®ƒå¿…é¡»ç¡®è®¤Serveræ¥æ”¶åˆ°äº†è¯¥ACKã€‚Clientä¼šåœ¨å‘é€å‡ºACKä¹‹åè¿›å…¥åˆ°TIME_WAITçŠ¶æ€ã€‚Clientä¼šè®¾ç½®ä¸€ä¸ªè®¡æ—¶å™¨ï¼Œç­‰å¾…2MSLçš„æ—¶é—´ã€‚å¦‚æœåœ¨è¯¥æ—¶é—´å†…å†æ¬¡æ”¶åˆ°FINï¼Œé‚£ä¹ˆClientä¼šé‡å‘ACKå¹¶å†æ¬¡ç­‰å¾…2MSLã€‚æ‰€è°“çš„2MSLæ˜¯ä¸¤å€çš„MSL(Maximum Segment Lifetime)ã€‚MSLæŒ‡ä¸€ä¸ªç‰‡æ®µåœ¨ç½‘ç»œä¸­æœ€å¤§çš„å­˜æ´»æ—¶é—´ï¼Œ2MSLå°±æ˜¯ä¸€ä¸ªå‘é€å’Œä¸€ä¸ªå›å¤æ‰€éœ€çš„æœ€å¤§æ—¶é—´ã€‚å¦‚æœç›´åˆ°2MSLï¼ŒClientéƒ½æ²¡æœ‰å†æ¬¡æ”¶åˆ°FINï¼Œé‚£ä¹ˆClientæ¨æ–­ACKå·²ç»è¢«æˆåŠŸæ¥æ”¶ï¼Œåˆ™ç»“æŸTCPè¿æ¥ã€‚ ã€é—®é¢˜3ã€‘ä¸ºä»€ä¹ˆä¸èƒ½ç”¨ä¸¤æ¬¡æ¡æ‰‹è¿›è¡Œè¿æ¥ï¼Ÿç­”ï¼š3æ¬¡æ¡æ‰‹å®Œæˆä¸¤ä¸ªé‡è¦çš„åŠŸèƒ½ï¼Œæ—¢è¦åŒæ–¹åšå¥½å‘é€æ•°æ®çš„å‡†å¤‡å·¥ä½œ(åŒæ–¹éƒ½çŸ¥é“å½¼æ­¤å·²å‡†å¤‡å¥½)ï¼Œä¹Ÿè¦å…è®¸åŒæ–¹å°±åˆå§‹åºåˆ—å·è¿›è¡Œåå•†ï¼Œè¿™ä¸ªåºåˆ—å·åœ¨æ¡æ‰‹è¿‡ç¨‹ä¸­è¢«å‘é€å’Œç¡®è®¤ã€‚ ç°åœ¨æŠŠä¸‰æ¬¡æ¡æ‰‹æ”¹æˆä»…éœ€è¦ä¸¤æ¬¡æ¡æ‰‹ï¼Œæ­»é”æ˜¯å¯èƒ½å‘ç”Ÿçš„ã€‚ä½œä¸ºä¾‹å­ï¼Œè€ƒè™‘è®¡ç®—æœºSå’ŒCä¹‹é—´çš„é€šä¿¡ï¼Œå‡å®šCç»™Så‘é€ä¸€ä¸ªè¿æ¥è¯·æ±‚åˆ†ç»„ï¼ŒSæ”¶åˆ°äº†è¿™ä¸ªåˆ†ç»„ï¼Œå¹¶å‘ é€äº†ç¡®è®¤åº”ç­”åˆ†ç»„ã€‚æŒ‰ç…§ä¸¤æ¬¡æ¡æ‰‹çš„åå®šï¼ŒSè®¤ä¸ºè¿æ¥å·²ç»æˆåŠŸåœ°å»ºç«‹äº†ï¼Œå¯ä»¥å¼€å§‹å‘é€æ•°æ®åˆ†ç»„ã€‚å¯æ˜¯ï¼ŒCåœ¨Sçš„åº”ç­”åˆ†ç»„åœ¨ä¼ è¾“ä¸­è¢«ä¸¢å¤±çš„æƒ…å†µä¸‹ï¼Œå°†ä¸çŸ¥é“S æ˜¯å¦å·²å‡†å¤‡å¥½ï¼Œä¸çŸ¥é“Så»ºç«‹ä»€ä¹ˆæ ·çš„åºåˆ—å·ï¼ŒCç”šè‡³æ€€ç–‘Sæ˜¯å¦æ”¶åˆ°è‡ªå·±çš„è¿æ¥è¯·æ±‚åˆ†ç»„ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒCè®¤ä¸ºè¿æ¥è¿˜æœªå»ºç«‹æˆåŠŸï¼Œå°†å¿½ç•¥Så‘æ¥çš„ä»»ä½•æ•°æ®åˆ† ç»„ï¼Œåªç­‰å¾…è¿æ¥ç¡®è®¤åº”ç­”åˆ†ç»„ã€‚è€ŒSåœ¨å‘å‡ºçš„åˆ†ç»„è¶…æ—¶åï¼Œé‡å¤å‘é€åŒæ ·çš„åˆ†ç»„ã€‚è¿™æ ·å°±å½¢æˆäº†æ­»é”ã€‚ ã€é—®é¢˜4ã€‘å¦‚æœå·²ç»å»ºç«‹äº†è¿æ¥ï¼Œä½†æ˜¯å®¢æˆ·ç«¯çªç„¶å‡ºç°æ•…éšœäº†æ€ä¹ˆåŠï¼ŸTCPè¿˜è®¾æœ‰ä¸€ä¸ªä¿æ´»è®¡æ—¶å™¨ï¼Œæ˜¾ç„¶ï¼Œå®¢æˆ·ç«¯å¦‚æœå‡ºç°æ•…éšœï¼ŒæœåŠ¡å™¨ä¸èƒ½ä¸€ç›´ç­‰ä¸‹å»ï¼Œç™½ç™½æµªè´¹èµ„æºã€‚æœåŠ¡å™¨æ¯æ”¶åˆ°ä¸€æ¬¡å®¢æˆ·ç«¯çš„è¯·æ±‚åéƒ½ä¼šé‡æ–°å¤ä½è¿™ä¸ªè®¡æ—¶å™¨ï¼Œæ—¶é—´é€šå¸¸æ˜¯è®¾ç½®ä¸º2å°æ—¶ï¼Œè‹¥ä¸¤å°æ—¶è¿˜æ²¡æœ‰æ”¶åˆ°å®¢æˆ·ç«¯çš„ä»»ä½•æ•°æ®ï¼ŒæœåŠ¡å™¨å°±ä¼šå‘é€ä¸€ä¸ªæ¢æµ‹æŠ¥æ–‡æ®µï¼Œä»¥åæ¯éš”75ç§’é’Ÿå‘é€ä¸€æ¬¡ã€‚è‹¥ä¸€è¿å‘é€10ä¸ªæ¢æµ‹æŠ¥æ–‡ä»ç„¶æ²¡ååº”ï¼ŒæœåŠ¡å™¨å°±è®¤ä¸ºå®¢æˆ·ç«¯å‡ºäº†æ•…éšœï¼Œæ¥ç€å°±å…³é—­è¿æ¥ã€‚ åœ¨æµè§ˆå™¨ä¸­è¾“å…¥urlåœ°å€ -&gt;&gt; æ˜¾ç¤ºä¸»é¡µçš„è¿‡ç¨‹ï¼ˆé¢è¯•å¸¸å®¢ï¼‰ æ‰“å¼€ä¸€ä¸ªç½‘é¡µï¼Œæ•´ä¸ªè¿‡ç¨‹ä¼šä½¿ç”¨å“ªäº›åè®® çŠ¶æ€ç  å„ç§åè®®ä¸HTTPåè®®ä¹‹é—´çš„å…³ç³»ä¸€èˆ¬é¢è¯•å®˜ä¼šé€šè¿‡è¿™æ ·çš„é—®é¢˜æ¥è€ƒå¯Ÿä½ å¯¹è®¡ç®—æœºç½‘ç»œçŸ¥è¯†ä½“ç³»çš„ç†è§£ã€‚ HTTPé•¿è¿æ¥ã€çŸ­è¿æ¥ HTTPåè®®çš„é•¿è¿æ¥å’ŒçŸ­è¿æ¥ï¼Œå®è´¨ä¸Šæ˜¯TCPåè®®çš„é•¿è¿æ¥å’ŒçŸ­è¿æ¥ã€‚ çŸ­è¿æ¥ åœ¨HTTP/1.0ä¸­é»˜è®¤ä½¿ç”¨çŸ­è¿æ¥ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨æ¯è¿›è¡Œä¸€æ¬¡HTTPæ“ä½œï¼Œå°±å»ºç«‹ä¸€æ¬¡è¿æ¥ï¼Œä»»åŠ¡ç»“æŸå°±ä¸­æ–­è¿æ¥ã€‚å½“å®¢æˆ·ç«¯æµè§ˆå™¨è®¿é—®çš„æŸä¸ªHTMLæˆ–å…¶ä»–ç±»å‹çš„Webé¡µä¸­åŒ…å«æœ‰å…¶ä»–çš„Webèµ„æºï¼ˆå¦‚JavaScriptæ–‡ä»¶ã€å›¾åƒæ–‡ä»¶ã€CSSæ–‡ä»¶ç­‰ï¼‰ï¼Œæ¯é‡åˆ°è¿™æ ·ä¸€ä¸ªWebèµ„æºï¼Œæµè§ˆå™¨å°±ä¼šé‡æ–°å»ºç«‹ä¸€ä¸ªHTTPä¼šè¯ã€‚ é•¿è¿æ¥ ä»HTTP/1.1èµ·ï¼Œé»˜è®¤ä½¿ç”¨é•¿è¿æ¥ï¼Œç”¨ä»¥ä¿æŒè¿æ¥ç‰¹æ€§ã€‚ä½¿ç”¨é•¿è¿æ¥çš„HTTPåè®®ï¼Œä¼šåœ¨å“åº”å¤´åŠ å…¥è¿™è¡Œä»£ç ï¼š 1Connection:keep-alive åœ¨ä½¿ç”¨é•¿è¿æ¥çš„æƒ…å†µä¸‹ï¼Œå½“ä¸€ä¸ªç½‘é¡µæ‰“å¼€å®Œæˆåï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´ç”¨äºä¼ è¾“HTTPæ•°æ®çš„TCPè¿æ¥ä¸ä¼šå…³é—­ï¼Œå®¢æˆ·ç«¯å†æ¬¡è®¿é—®è¿™ä¸ªæœåŠ¡å™¨æ—¶ï¼Œä¼šç»§ç»­ä½¿ç”¨è¿™ä¸€æ¡å·²ç»å»ºç«‹çš„è¿æ¥ã€‚Keep-Aliveä¸ä¼šæ°¸ä¹…ä¿æŒè¿æ¥ï¼Œå®ƒæœ‰ä¸€ä¸ªä¿æŒæ—¶é—´ï¼Œå¯ä»¥åœ¨ä¸åŒçš„æœåŠ¡å™¨è½¯ä»¶ï¼ˆå¦‚Apacheï¼‰ä¸­è®¾å®šè¿™ä¸ªæ—¶é—´ã€‚å®ç°é•¿è¿æ¥éœ€è¦å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯éƒ½æ”¯æŒé•¿è¿æ¥ã€‚ HTTPå’ŒHTTPSçš„åŒºåˆ« Httpï¼šè¶…æ–‡æœ¬ä¼ è¾“åè®®ï¼ˆHttpï¼ŒHyperText Transfer Protocol)æ˜¯äº’è”ç½‘ä¸Šåº”ç”¨æœ€ä¸ºå¹¿æ³›çš„ä¸€ç§ç½‘ç»œåè®®ã€‚ Httpsï¼šæ˜¯ä»¥å®‰å…¨ä¸ºç›®æ ‡çš„Httpé€šé“ï¼Œæ˜¯Httpçš„å®‰å…¨ç‰ˆã€‚Httpsçš„å®‰å…¨åŸºç¡€æ˜¯SSLã€‚ 1ã€httpsåè®®éœ€è¦åˆ°CAç”³è¯·è¯ä¹¦ï¼Œä¸€èˆ¬å…è´¹è¯ä¹¦è¾ƒå°‘ï¼Œå› è€Œéœ€è¦ä¸€å®šè´¹ç”¨ã€‚(åŸæ¥ç½‘æ˜“å®˜ç½‘æ˜¯httpï¼Œè€Œç½‘æ˜“é‚®ç®±æ˜¯httpsã€‚) 2ã€httpæ˜¯è¶…æ–‡æœ¬ä¼ è¾“åè®®ï¼Œä¿¡æ¯æ˜¯æ˜æ–‡ä¼ è¾“ï¼Œhttpsåˆ™æ˜¯å…·æœ‰å®‰å…¨æ€§çš„sslåŠ å¯†ä¼ è¾“åè®®ã€‚ 3ã€httpå’Œhttpsä½¿ç”¨çš„æ˜¯å®Œå…¨ä¸åŒçš„è¿æ¥æ–¹å¼ï¼Œç”¨çš„ç«¯å£ä¹Ÿä¸ä¸€æ ·ï¼Œå‰è€…æ˜¯80ï¼Œåè€…æ˜¯443ã€‚ 4ã€httpçš„è¿æ¥å¾ˆç®€å•ï¼Œæ˜¯æ— çŠ¶æ€çš„ã€‚Httpsåè®®æ˜¯ç”±SSL+Httpåè®®æ„å»ºçš„å¯è¿›è¡ŒåŠ å¯†ä¼ è¾“ã€èº«ä»½è®¤è¯çš„ç½‘ç»œåè®®ï¼Œæ¯”httpåè®®å®‰å…¨ã€‚(æ— çŠ¶æ€çš„æ„æ€æ˜¯å…¶æ•°æ®åŒ…çš„å‘é€ã€ä¼ è¾“å’Œæ¥æ”¶éƒ½æ˜¯ç›¸äº’ç‹¬ç«‹çš„ã€‚æ— è¿æ¥çš„æ„æ€æ˜¯æŒ‡é€šä¿¡åŒæ–¹éƒ½ä¸é•¿ä¹…çš„ç»´æŒå¯¹æ–¹çš„ä»»ä½•ä¿¡æ¯ã€‚) Httpsçš„ç¼ºç‚¹ï¼ˆå¯¹æ¯”ä¼˜ç‚¹ï¼‰ 1ã€Httpsåè®®æ¡æ‰‹é˜¶æ®µæ¯”è¾ƒè´¹æ—¶ï¼Œä¼šä½¿é¡µé¢çš„åŠ è½½æ—¶é—´å»¶é•¿è¿‘ã€‚ 2ã€Httpsè¿æ¥ç¼“å­˜ä¸å¦‚Httpé«˜æ•ˆï¼Œä¼šå¢åŠ æ•°æ®å¼€é”€ï¼Œç”šè‡³å·²æœ‰çš„å®‰å…¨æªæ–½ä¹Ÿä¼šå› æ­¤è€Œå—åˆ°å½±å“ï¼› 3ã€SSLè¯ä¹¦é€šå¸¸éœ€è¦ç»‘å®šIPï¼Œä¸èƒ½åœ¨åŒä¸€IPä¸Šç»‘å®šå¤šä¸ªåŸŸåï¼ŒIPv4èµ„æºä¸å¯èƒ½æ”¯æ’‘è¿™ä¸ªæ¶ˆè€—ã€‚ 4ã€Httpsåè®®çš„åŠ å¯†èŒƒå›´ä¹Ÿæ¯”è¾ƒæœ‰é™ã€‚æœ€å…³é”®çš„ï¼ŒSSLè¯ä¹¦çš„ä¿¡ç”¨é“¾ä½“ç³»å¹¶ä¸å®‰å…¨ï¼Œç‰¹åˆ«æ˜¯åœ¨æŸäº›å›½å®¶å¯ä»¥æ§åˆ¶CAæ ¹è¯ä¹¦çš„æƒ…å†µä¸‹ï¼Œä¸­é—´äººæ”»å‡»ä¸€æ ·å¯è¡Œã€‚ HTTPå’ŒRPCæ¦‚å¿µ HTTPå°±æ˜¯ä¸€ç§RPC, åªè¦æ˜¯è¿œç¨‹è°ƒç”¨éƒ½å¯ä»¥å«RPCï¼Œå’Œæ˜¯ä¸æ˜¯é€šè¿‡httpæ²¡ä»€ä¹ˆå…³ç³»ã€‚ httpå¥½æ¯”æ™®é€šè¯ï¼Œrpcå¥½æ¯”å›¢ä¼™å†…éƒ¨é»‘è¯ã€‚è®²æ™®é€šè¯ï¼Œå¥½å¤„å°±æ˜¯è°éƒ½å¬å¾—æ‡‚ï¼Œè°éƒ½ä¼šè®²ã€‚ è®²é»‘è¯ï¼Œå¥½å¤„æ˜¯å¯ä»¥æ›´ç²¾ç®€ã€æ›´åŠ ä¿å¯†ã€æ›´åŠ å¯å®šåˆ¶ï¼Œåå¤„å°±æ˜¯è¦æ±‚â€œè¯´â€é»‘è¯çš„é‚£ä¸€æ–¹ï¼ˆclientç«¯ï¼‰ä¹Ÿè¦æ‡‚ï¼Œè€Œä¸”ä¸€æ—¦å¤§å®¶éƒ½è¯´ä¸€ç§é»‘è¯äº†ï¼Œæ¢é»‘è¯å°±å›°éš¾äº†ã€‚ è¿™ä¸ªå›ç­”é‡Œæ°å·§è®²äº†ä¸€äº›rpcé€šä¿¡åè®®çš„ç»†èŠ‚ï¼Œä½†æ˜¯å¼ºè°ƒä¸€éé€šä¿¡åè®®ä¸æ˜¯rpcæœ€é‡è¦çš„éƒ¨åˆ†ï¼Œä¸è¦è¢«è¿™ä¸ªå›ç­”å¸¦åäº†ã€‚å¦‚æœè¦äº†è§£rpcè¯·æ›´å¤šçš„å»äº†è§£æœåŠ¡æ²»ç†(soa)çš„ä¸€äº›åŸºæœ¬ç­–ç•¥,æ¨èå»çœ‹çœ‹dubboçš„æ–‡æ¡£ã€‚ é¦–å…ˆ http å’Œ rpc å¹¶ä¸æ˜¯ä¸€ä¸ªå¹¶è¡Œæ¦‚å¿µã€‚ rpcæ˜¯è¿œç«¯è¿‡ç¨‹è°ƒç”¨ï¼Œå…¶è°ƒç”¨åè®®é€šå¸¸åŒ…å«ä¼ è¾“åè®®å’Œåºåˆ—åŒ–åè®®ã€‚ ä¼ è¾“åè®®åŒ…å«: å¦‚è‘—åçš„ [gRPC](grpc / grpc.io) ä½¿ç”¨çš„ http2 åè®®ï¼Œä¹Ÿæœ‰å¦‚dubboä¸€ç±»çš„è‡ªå®šä¹‰æŠ¥æ–‡çš„tcpåè®®ã€‚ åºåˆ—åŒ–åè®®åŒ…å«: å¦‚åŸºäºæ–‡æœ¬ç¼–ç çš„ xml jsonï¼Œä¹Ÿæœ‰äºŒè¿›åˆ¶ç¼–ç çš„ protobuf hessianç­‰ã€‚ Httpä¸Rpcçš„åŒºåˆ« é¦–å…ˆè¦å¦è®¤ä¸€ç‚¹ http åè®®ç›¸è¾ƒäºè‡ªå®šä¹‰tcpæŠ¥æ–‡åè®®rpcï¼Œå¢åŠ çš„å¼€é”€åœ¨äºè¿æ¥çš„å»ºç«‹ä¸æ–­å¼€ã€‚httpåè®®æ˜¯æ”¯æŒè¿æ¥æ± å¤ç”¨çš„ï¼Œä¹Ÿå°±æ˜¯å»ºç«‹ä¸€å®šæ•°é‡çš„è¿æ¥ä¸æ–­å¼€ï¼Œå¹¶ä¸ä¼šé¢‘ç¹çš„åˆ›å»ºå’Œé”€æ¯è¿æ¥ã€‚äºŒè¦è¯´çš„æ˜¯httpä¹Ÿå¯ä»¥ä½¿ç”¨protobufè¿™ç§äºŒè¿›åˆ¶ç¼–ç åè®®å¯¹å†…å®¹è¿›è¡Œç¼–ç ï¼Œå› æ­¤äºŒè€…æœ€å¤§çš„åŒºåˆ«è¿˜æ˜¯åœ¨ä¼ è¾“åè®®ä¸Šã€‚ ä¼ è¾“åè®® RPCï¼Œå¯ä»¥åŸºäºTCPåè®®ï¼Œä¹Ÿå¯ä»¥åŸºäºHTTPåè®® HTTPï¼ŒåŸºäºHTTPåè®® ä¼ è¾“æ•ˆç‡ RPCï¼Œä½¿ç”¨è‡ªå®šä¹‰çš„TCPåè®®ï¼Œå¯ä»¥è®©è¯·æ±‚æŠ¥æ–‡ä½“ç§¯æ›´å°ï¼Œæˆ–è€…ä½¿ç”¨HTTP2åè®®ï¼Œä¹Ÿå¯ä»¥å¾ˆå¥½çš„å‡å°‘æŠ¥æ–‡çš„ä½“ç§¯ï¼Œæé«˜ä¼ è¾“æ•ˆç‡ 12345678910HTTP/1.0 200 OK Content-Type: text/plainContent-Length: 137582Expires: Thu, 05 Dec 1997 16:00:00 GMTLast-Modified: Wed, 5 August 1996 15:55:28 GMTServer: Apache 0.84&lt;html&gt; &lt;body&gt;Hello World&lt;/body&gt;&lt;/html&gt; å³ä½¿ç¼–ç åè®®ä¹Ÿå°±æ˜¯bodyæ˜¯ä½¿ç”¨äºŒè¿›åˆ¶ç¼–ç åè®®ï¼ŒæŠ¥æ–‡å…ƒæ•°æ®ä¹Ÿå°±æ˜¯headerå¤´çš„é”®å€¼å¯¹å´ç”¨äº†æ–‡æœ¬ç¼–ç ï¼Œéå¸¸å å­—èŠ‚æ•°ã€‚å¦‚ä¸Šå›¾æ‰€ä½¿ç”¨çš„æŠ¥æ–‡ä¸­æœ‰æ•ˆå­—èŠ‚æ•°ä»…ä»…å çº¦ 30%ï¼Œä¹Ÿå°±æ˜¯70%çš„æ—¶é—´ç”¨äºä¼ è¾“å…ƒæ•°æ®åºŸç¼–ç ã€‚å½“ç„¶å®é™…æƒ…å†µä¸‹æŠ¥æ–‡å†…å®¹å¯èƒ½ä¼šæ¯”è¿™ä¸ªé•¿ï¼Œä½†æ˜¯æŠ¥å¤´æ‰€å çš„æ¯”ä¾‹ä¹Ÿæ˜¯éå¸¸å¯è§‚çš„ã€‚ é‚£ä¹ˆå‡å¦‚æˆ‘ä»¬ä½¿ç”¨è‡ªå®šä¹‰tcpåè®®çš„æŠ¥æ–‡å¦‚ä¸‹ æŠ¥å¤´å ç”¨çš„å­—èŠ‚æ•°ä¹Ÿå°±åªæœ‰16ä¸ªbyteï¼Œæå¤§åœ°ç²¾ç®€äº†ä¼ è¾“å†…å®¹ã€‚ è¿™ä¹Ÿå°±æ˜¯ä¸ºä»€ä¹ˆåç«¯è¿›ç¨‹é—´é€šå¸¸ä¼šé‡‡ç”¨è‡ªå®šä¹‰tcpåè®®çš„rpcæ¥è¿›è¡Œé€šä¿¡çš„åŸå› ã€‚ æ‰€è°“çš„æ•ˆç‡ä¼˜åŠ¿æ˜¯é’ˆå¯¹http1.1åè®®æ¥è®²çš„ï¼Œhttp2.0åè®®å·²ç»ä¼˜åŒ–ç¼–ç æ•ˆç‡é—®é¢˜ï¼Œåƒgrpcè¿™ç§rpcåº“ä½¿ç”¨çš„å°±æ˜¯http2.0åè®®ã€‚è¿™ä¹ˆæ¥è¯´å§httpå®¹å™¨çš„æ€§èƒ½æµ‹è¯•å•ä½é€šå¸¸æ˜¯kqpsï¼Œè‡ªå®šä¹‰tcpåè®®åˆ™é€šå¸¸æ˜¯ä»¥10kqpsåˆ°100kqpsä¸ºåŸºå‡† HTTPï¼Œå¦‚æœæ˜¯åŸºäºHTTP1.1çš„åè®®ï¼Œè¯·æ±‚ä¸­ä¼šåŒ…å«å¾ˆå¤šæ— ç”¨çš„å†…å®¹ï¼Œå¦‚æœæ˜¯åŸºäºHTTP2.0ï¼Œé‚£ä¹ˆç®€å•çš„å°è£…ä»¥ä¸‹æ˜¯å¯ä»¥ä½œä¸ºä¸€ä¸ªRPCæ¥ä½¿ç”¨çš„ï¼Œè¿™æ—¶æ ‡å‡†RPCæ¡†æ¶æ›´å¤šçš„æ˜¯æœåŠ¡æ²»ç† æ€§èƒ½æ¶ˆè€—ï¼Œä¸»è¦åœ¨äºåºåˆ—åŒ–å’Œååºåˆ—åŒ–çš„è€—æ—¶ RPCï¼Œå¯ä»¥åŸºäºthriftå®ç°é«˜æ•ˆçš„äºŒè¿›åˆ¶ä¼ è¾“ HTTPï¼Œå¤§éƒ¨åˆ†æ˜¯é€šè¿‡jsonæ¥å®ç°çš„ï¼Œå­—èŠ‚å¤§å°å’Œåºåˆ—åŒ–è€—æ—¶éƒ½æ¯”thriftè¦æ›´æ¶ˆè€—æ€§èƒ½ è´Ÿè½½å‡è¡¡ RPCï¼ŒåŸºæœ¬éƒ½è‡ªå¸¦äº†è´Ÿè½½å‡è¡¡ç­–ç•¥ HTTPï¼Œéœ€è¦é…ç½®Nginxï¼ŒHAProxyæ¥å®ç° æœåŠ¡æ²»ç†ï¼ˆä¸‹æ¸¸æœåŠ¡æ–°å¢ï¼Œé‡å¯ï¼Œä¸‹çº¿æ—¶å¦‚ä½•ä¸å½±å“ä¸Šæ¸¸è°ƒç”¨è€…ï¼‰ RPCï¼Œèƒ½åšåˆ°è‡ªåŠ¨é€šçŸ¥ï¼Œä¸å½±å“ä¸Šæ¸¸ ç®€å•æ¥è¯´æˆç†Ÿçš„rpcåº“ç›¸å¯¹httpå®¹å™¨ï¼Œæ›´å¤šçš„æ˜¯å°è£…äº†â€œæœåŠ¡å‘ç°â€ï¼Œâ€è´Ÿè½½å‡è¡¡â€œï¼Œâ€œç†”æ–­é™çº§â€ä¸€ç±»é¢å‘æœåŠ¡çš„é«˜çº§ç‰¹æ€§ã€‚å¯ä»¥è¿™ä¹ˆç†è§£ï¼Œrpcæ¡†æ¶æ˜¯é¢å‘[åŠ¡çš„æ›´é«˜çº§çš„å°è£…ã€‚å¦‚æœæŠŠä¸€ä¸ªhttp servletå®¹å™¨ä¸Šå°è£…ä¸€å±‚æœåŠ¡å‘ç°å’Œå‡½æ•°ä»£ç†è°ƒç”¨ï¼Œé‚£å®ƒå°±å·²ç»å¯ä»¥åšä¸€ä¸ªrpcæ¡†æ¶äº†ã€‚ HTTPï¼Œéœ€è¦äº‹å…ˆé€šçŸ¥ï¼Œä¿®æ”¹Nginx/HAProxyé…ç½® æ€»ç»“ï¼š RPCä¸»è¦ç”¨äºå…¬å¸å†…éƒ¨çš„æœåŠ¡è°ƒç”¨ï¼Œæ€§èƒ½æ¶ˆè€—ä½ï¼Œä¼ è¾“æ•ˆç‡é«˜ï¼ŒæœåŠ¡æ²»ç†æ–¹ä¾¿ã€‚HTTPä¸»è¦ç”¨äºå¯¹å¤–çš„å¼‚æ„ç¯å¢ƒï¼Œæµè§ˆå™¨æ¥å£è°ƒç”¨ï¼ŒAPPæ¥å£è°ƒç”¨ï¼Œç¬¬ä¸‰æ–¹æ¥å£è°ƒç”¨ç­‰ã€‚å› ä¸ºè‰¯å¥½çš„rpcè°ƒç”¨æ˜¯é¢å‘æœåŠ¡çš„å°è£…ï¼Œé’ˆå¯¹æœåŠ¡çš„å¯ç”¨æ€§å’Œæ•ˆç‡ç­‰éƒ½åšäº†ä¼˜åŒ–ã€‚å•çº¯ä½¿ç”¨httpè°ƒç”¨åˆ™ç¼ºå°‘äº†è¿™äº›ç‰¹æ€§ã€‚ Cookieå’ŒSessionçš„åŒºåˆ« è¿™é‡Œæœ‰è¯´åˆ°ï¼ŒHTTPåè®®æ˜¯æ— çŠ¶æ€çš„ï¼ŒæœåŠ¡å™¨ä¸­æ²¡æœ‰ä¿å­˜å®¢æˆ·ç«¯çš„çŠ¶æ€ï¼Œå®¢æˆ·ç«¯å¿…é¡»æ¯æ¬¡å¸¦ä¸Šè‡ªå·±çš„çŠ¶æ€å»è¯·æ±‚æœåŠ¡å™¨ åŸºäºHTTPè¿™ç§ç‰¹ç‚¹ï¼Œå°±äº§ç”Ÿäº†cookie/session 1ã€cookieæ•°æ®å­˜æ”¾åœ¨å®¢æˆ·çš„æµè§ˆå™¨ä¸Šï¼Œsessionæ•°æ®æ”¾åœ¨æœåŠ¡å™¨ä¸Šã€‚ 2ã€cookieç›¸æ¯”sessionä¸æ˜¯å¾ˆå®‰å…¨ï¼Œåˆ«äººå¯ä»¥åˆ†æå­˜æ”¾åœ¨æœ¬åœ°çš„cookieå¹¶è¿›è¡Œcookieæ¬ºéª—,è€ƒè™‘åˆ°å®‰å…¨åº”å½“ä½¿ç”¨sessionã€‚ 3ã€sessionä¼šåœ¨ä¸€å®šæ—¶é—´å†…ä¿å­˜åœ¨æœåŠ¡å™¨ä¸Šã€‚å½“è®¿é—®å¢å¤šï¼Œä¼šæ¯”è¾ƒå ç”¨ä½ æœåŠ¡å™¨çš„æ€§èƒ½,è€ƒè™‘åˆ°å‡è½»æœåŠ¡å™¨æ€§èƒ½æ–¹é¢ï¼Œåº”å½“ä½¿ç”¨cookieã€‚ 4ã€å•ä¸ªcookieä¿å­˜çš„æ•°æ®ä¸èƒ½è¶…è¿‡4Kï¼Œå¾ˆå¤šæµè§ˆå™¨éƒ½é™åˆ¶ä¸€ä¸ªç«™ç‚¹æœ€å¤šä¿å­˜20ä¸ªcookieã€‚è€Œsessionå­˜å‚¨åœ¨æœåŠ¡ç«¯ï¼Œå¯ä»¥æ— é™é‡å­˜å‚¨ 5ã€æ‰€ä»¥ï¼šå°†ç™»å½•ä¿¡æ¯ç­‰é‡è¦ä¿¡æ¯å­˜æ”¾ä¸ºsession;å…¶ä»–ä¿¡æ¯å¦‚æœéœ€è¦ä¿ç•™ï¼Œå¯ä»¥æ”¾åœ¨cookieä¸­ è·å–requestçš„å®¢æˆ·ç«¯IPåœ°å€123request.getHeader(\"X-Forwarded-For\")//è¿™3ä¸­æ–¹æ³•éƒ½å¯ä»¥ç”¨æ¥è¿›è¡Œè§£æHeaderä¸­çš„IPåœ°å€request.getHeader(\"Proxy-Client-IP\")request.getHeader(\"Remote_Addr\")","categories":[],"tags":[{"name":"IT","slug":"IT","permalink":"/tags/IT/"},{"name":"æŠ€æœ¯ç¬”è®°","slug":"æŠ€æœ¯ç¬”è®°","permalink":"/tags/%E6%8A%80%E6%9C%AF%E7%AC%94%E8%AE%B0/"},{"name":"Job","slug":"Job","permalink":"/tags/Job/"},{"name":"ç½‘ç»œ","slug":"ç½‘ç»œ","permalink":"/tags/%E7%BD%91%E7%BB%9C/"}]},{"title":"æ•°æ®åº“","slug":"æ•°æ®åº“","date":"2019-10-20T11:51:12.000Z","updated":"2019-10-20T05:57:37.548Z","comments":true,"path":"2019/10/20/æ•°æ®åº“/","link":"","permalink":"/2019/10/20/%E6%95%B0%E6%8D%AE%E5%BA%93/","excerpt":"","text":"æ•°æ®å®Œæ•´æ€§çº¦æŸ æ•°æ®å®Œæ•´æ€§çº¦æŸæŒ‡çš„æ˜¯ä¸ºäº†é˜²æ­¢ä¸ç¬¦åˆè§„èŒƒçš„æ•°æ®è¿›å…¥æ•°æ®åº“ï¼Œåœ¨ç”¨æˆ·å¯¹æ•°æ®è¿›è¡Œæ’å…¥ã€ä¿®æ”¹ã€åˆ é™¤ç­‰æ“ä½œæ—¶ï¼ŒDBMSè‡ªåŠ¨æŒ‰ç…§ä¸€å®šçš„çº¦æŸæ¡ä»¶å¯¹æ•°æ®è¿›è¡Œç›‘æµ‹ï¼Œä½¿ä¸ç¬¦åˆè§„èŒƒçš„æ•°æ®ä¸èƒ½è¿›å…¥æ•°æ®åº“ï¼Œä»¥ç¡®ä¿æ•°æ®åº“ä¸­å­˜å‚¨çš„æ•°æ®æ­£ç¡®ã€æœ‰æ•ˆã€ç›¸å®¹ã€‚ 1) å®ä½“å®Œæ•´æ€§ï¼šè§„å®šè¡¨çš„æ¯ä¸€è¡Œåœ¨è¡¨ä¸­æ˜¯æƒŸä¸€çš„å®ä½“(ä¸»é”®å”¯ä¸€)ã€‚ 2) åŸŸå®Œæ•´æ€§ï¼šæ˜¯æŒ‡è¡¨ä¸­çš„åˆ—å¿…é¡»æ»¡è¶³æŸç§ç‰¹å®šçš„æ•°æ®ç±»å‹çº¦æŸï¼Œå…¶ä¸­çº¦æŸåˆåŒ…æ‹¬å–å€¼èŒƒå›´ã€ç²¾åº¦ç­‰è§„å®šã€‚ 3) å‚ç…§å®Œæ•´æ€§ï¼šæ˜¯æŒ‡ä¸¤ä¸ªè¡¨çš„ä¸»å…³é”®å­—å’Œå¤–å…³é”®å­—çš„æ•°æ®åº”ä¸€è‡´ï¼Œä¿è¯äº†è¡¨ä¹‹é—´çš„æ•°æ®çš„ä¸€è‡´æ€§ï¼Œé˜²æ­¢äº†æ•°æ®ä¸¢å¤±æˆ–æ— æ„ä¹‰çš„æ•°æ®åœ¨æ•°æ®åº“ä¸­æ‰©æ•£ã€‚ 4) ç”¨æˆ·å®šä¹‰çš„å®Œæ•´æ€§ï¼šä¸åŒçš„å…³ç³»æ•°æ®åº“ç³»ç»Ÿæ ¹æ®å…¶åº”ç”¨ç¯å¢ƒçš„ä¸åŒï¼Œå¾€å¾€è¿˜éœ€è¦ä¸€äº›ç‰¹æ®Šçš„çº¦æŸæ¡ä»¶ã€‚ç”¨æˆ·å®šä¹‰çš„å®Œæ•´æ€§å³æ˜¯é’ˆå¯¹æŸä¸ªç‰¹å®šå…³ç³»æ•°æ®åº“çš„çº¦æŸæ¡ä»¶ï¼Œå®ƒåæ˜ æŸä¸€å…·ä½“åº”ç”¨å¿…é¡»æ»¡è¶³çš„è¯­ä¹‰è¦æ±‚ã€‚ ä»€ä¹ˆæ˜¯sql? SQLï¼šStructured Query Language ç»“æ„åŒ–æŸ¥è¯¢è¯­è¨€ DQLï¼šData Query Language æ•°æ®æŸ¥è¯¢è¯­ ï¼Œå¦‚select * from è¡¨å DDLï¼šData Defintion Language æ•°æ®å®šä¹‰è¯­è¨€ createã€alterã€ drop DMLï¼šData Manipulation Language æ•°æ®æ“çºµè¯­è¨€ updataã€instertã€delete mysqlæ•°æ®åº“çš„éš”ç¦»çº§åˆ«æ•°æ®è¯»å–çŠ¶æ€ è„è¯»ï¼šäº‹åŠ¡Aè¯»å–äº†äº‹åŠ¡Bæ›´æ–°çš„æ•°æ®ï¼Œç„¶åBæ‰§è¡Œå›æ»šæ“ä½œï¼Œé‚£ä¹ˆAè¯»åˆ°çš„å°±æ˜¯è„æ•°æ®ã€‚ ä¸å¯é‡å¤è¯»ï¼šäº‹åŠ¡Aå¤šæ¬¡è¯»å–åŒä¸€ä¸ªæ•°æ®ï¼Œäº‹åŠ¡Båœ¨äº‹åŠ¡Aå¤šæ¬¡è¯»å–çš„è¿‡ç¨‹ä¸­ï¼Œå¯¹æ•°æ®åšäº†æ›´æ–°å¹¶æäº¤ï¼Œå¯¼è‡´äº‹åŠ¡Aå¤šæ¬¡è¯»å–åŒä¸€ä¸ªæ•°æ®æ—¶ï¼Œç»“æœä¸ä¸€è‡´ã€‚ å¹»è¯»ï¼šæ¯”å¦‚äº‹åŠ¡Aå°†æ‰€æœ‰æˆç»©ä»å…·ä½“åˆ†æ•°æ”¹ä¸ºäº†ABCDEç­‰çº§ï¼Œä½†æ˜¯äº‹åŠ¡Båœ¨è¿™ä¸ªæ—¶å€™æ’å…¥äº†ä¸€æ¡å…·ä½“çš„åˆ†æ•°ï¼Œæœ€åäº‹åŠ¡Aç»“æŸåå‘ç°è¿˜æœ‰ä¸€æ¡è®°å½•æ²¡æ”¹è¿‡æ¥ï¼Œå¥½åƒå‘ç”Ÿäº†å¹»è§‰ã€‚æŠ½è±¡æ¥è¯´æ˜¯äº‹åŠ¡Aåœ¨æ“ä½œçš„è¿‡ç¨‹ä¸­æ’å…¥äº†äº‹åŠ¡Bçš„æ“ä½œã€‚ ==ä¸å¯é‡å¤è¯»ä¾§é‡äºä¿®æ”¹ï¼Œå¹»è¯»ä¾§é‡äºæ–°å¢æˆ–è€…åˆ é™¤ã€‚è§£å†³ä¸å¯é‡å¤è¯»åªéœ€è¦é”ä½æ»¡è¶³æ¡ä»¶çš„è¡Œï¼Œè§£å†³å¹»è¯»éœ€è¦é”è¡¨ã€‚== MySqlçš„äº‹åŠ¡éš”ç¦»çº§åˆ«å°±æ˜¯æ¥è§£å†³è¿™ä¸ªé—®é¢˜çš„ éš”ç¦»çº§åˆ« è„è¯» ä¸å¯é‡å¤è¯» å¹»è¯» è¯»æœªæäº¤ æ˜¯ æ˜¯ æ˜¯ è¯»å·²æäº¤ å¦ æ˜¯ æ˜¯ å¯é‡å¤è¯» å¦ å¦ æ˜¯ ä¸²è¡ŒåŒ– å¦ å¦ å¦ è¯»æœªæäº¤ï¼Œè¿è„è¯»ä¹Ÿé¿å…ä¸äº†ï¼Œäº‹åŠ¡Aå¯ä»¥è¯»åˆ°äº‹åŠ¡Bæ›´æ–°ä½†è¿˜æœªæäº¤çš„æ•°æ®ã€‚ è¯»å·²æäº¤ï¼Œå¯ä»¥è§£å†³è„è¯»çš„é—®é¢˜ï¼Œä½†æ˜¯å¦‚æœæ­¤æ—¶å¦ä¸€ä¸ªäº‹åŠ¡ä¿®æ”¹äº†æ•°æ®ï¼Œå°±ä¼šé€ æˆä¸å¯é‡å¤è¯»çš„é—®é¢˜ã€‚ è¯»æäº¤æ—¶å†™æ“ä½œä¼šé”ä½è¡Œ å¯é‡å¤è¯»ï¼Œè§£å†³äº†è„è¯»å’Œä¸å¯é‡å¤è¯»çš„é—®é¢˜ï¼Œç”¨çš„æ¯”è¾ƒå¤šã€‚ å¯é‡å¤è¯»æ—¶ï¼Œå½“æ£€ç´¢æ¡ä»¶æœ‰ç´¢å¼•æ—¶ï¼ŒåŒ…æ‹¬ä¸»é”®ç´¢å¼•ï¼Œé»˜è®¤åŠ é”æ–¹å¼æ˜¯next-keyï¼Œå¦‚æœæ²¡æœ‰ç´¢å¼•ï¼Œæ›´æ–°æ•°æ®æ—¶ä¼šé”ä½æ•´å¼ è¡¨ã€‚ã€ ä¸²è¡ŒåŒ–ï¼Œè§£å†³äº†æ‰€æœ‰é—®é¢˜ï¼Œä½†æ˜¯æ˜¯è¡¨é”ï¼Œé«˜å¹¶å‘ä¸‹æ€§èƒ½éå¸¸å·®ï¼Œåœ¨å®é™…å¼€å‘ä¸­å¾ˆå°‘ç”¨åˆ°ã€‚ä¸€ä¸ªé—´éš™è¢«äº‹åŠ¡åŠ äº†é”ï¼Œå…¶ä»–äº‹åŠ¡æ˜¯ä¸èƒ½åœ¨è¿™ä¸ªé—´éš™æ’å…¥è®°å½•çš„ï¼Œè¿™æ ·å¯ä»¥é˜²æ­¢å¹»è¯»ã€‚ä¸²è¡ŒåŒ–æ—¶è¯»å†™æ•°æ®éƒ½ä¼šé”ä½æ•´å¼ è¡¨ Mysqlå¼•æ“InnoDB,MyinsM,MEMORY åœ¨ MySQL ä¸­æœ‰ä¸¤ä¸ªå­˜å‚¨å¼•æ“ MyISAM å’Œ InnoDBï¼Œæ¯ä¸ªå¼•æ“éƒ½æœ‰åˆ©æœ‰å¼Šã€‚é…·å£³ä»¥å‰æ–‡ç« ã€ŠMySQL: InnoDB è¿˜æ˜¯ MyISAM?ã€‹è®¨è®ºå’Œè¿™ä¸ªäº‹æƒ…ã€‚ MyISAM é€‚åˆäºä¸€äº›éœ€è¦å¤§é‡æŸ¥è¯¢çš„åº”ç”¨ï¼Œä½†å…¶å¯¹äºæœ‰å¤§é‡å†™æ“ä½œå¹¶ä¸æ˜¯å¾ˆå¥½ã€‚ç”šè‡³ä½ åªæ˜¯éœ€è¦updateä¸€ä¸ªå­—æ®µï¼Œæ•´ä¸ªè¡¨éƒ½ä¼šè¢«é”èµ·æ¥ï¼Œè€Œåˆ«çš„è¿›ç¨‹ï¼Œå°±ç®—æ˜¯è¯»è¿›ç¨‹éƒ½æ— æ³•æ“ä½œç›´åˆ°è¯»æ“ä½œå®Œæˆã€‚å¦å¤–ï¼ŒMyISAM å¯¹äº SELECT COUNT(*) è¿™ç±»çš„è®¡ç®—æ˜¯è¶…å¿«æ— æ¯”çš„ã€‚ InnoDB çš„è¶‹åŠ¿ä¼šæ˜¯ä¸€ä¸ªéå¸¸å¤æ‚çš„å­˜å‚¨å¼•æ“ï¼Œå¯¹äºä¸€äº›å°çš„åº”ç”¨ï¼Œå®ƒä¼šæ¯” MyISAM è¿˜æ…¢ã€‚ä»–æ˜¯å®ƒæ”¯æŒâ€œè¡Œé”â€ ï¼Œäºæ˜¯åœ¨å†™æ“ä½œæ¯”è¾ƒå¤šçš„æ—¶å€™ï¼Œä¼šæ›´ä¼˜ç§€ã€‚å¹¶ä¸”ï¼Œä»–è¿˜æ”¯æŒæ›´å¤šçš„é«˜çº§åº”ç”¨ï¼Œæ¯”å¦‚ï¼šäº‹åŠ¡ã€‚ ç´¢å¼•é”äº‹åŠ¡äº‹åŠ¡çš„ç‰¹æ€§ ACID åŸå­æ€§ï¼ˆAtomicity) äº‹åŠ¡è¢«è§†ä¸ºä¸å¯åˆ†å‰²çš„æœ€å°å•å…ƒï¼Œäº‹åŠ¡çš„æ‰€æœ‰æ“ä½œè¦ä¹ˆå…¨éƒ¨æäº¤æˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨å¤±è´¥å›æ»šã€‚ å›æ»šå¯ä»¥ç”¨å›æ»šæ—¥å¿—æ¥å®ç°ï¼Œå›æ»šæ—¥å¿—è®°å½•ç€äº‹åŠ¡æ‰€æ‰§è¡Œçš„ä¿®æ”¹æ“ä½œï¼Œåœ¨å›æ»šæ—¶åå‘æ‰§è¡Œè¿™äº›ä¿®æ”¹æ“ä½œå³å¯ã€‚ ä¸€è‡´æ€§ï¼ˆConsistencyï¼‰ æ•°æ®åº“åœ¨äº‹åŠ¡æ‰§è¡Œå‰åéƒ½ä¿æŒä¸€è‡´æ€§çŠ¶æ€ã€‚åœ¨ä¸€è‡´æ€§çŠ¶æ€ä¸‹ï¼Œæ‰€æœ‰äº‹åŠ¡å¯¹ä¸€ä¸ªæ•°æ®çš„è¯»å–ç»“æœéƒ½æ˜¯ç›¸åŒçš„ã€‚ éš”ç¦»æ€§ï¼ˆIsolation) ä¸€ä¸ªäº‹åŠ¡æ‰€åšçš„ä¿®æ”¹åœ¨æœ€ç»ˆæäº¤ä»¥å‰ï¼Œå¯¹å…¶å®ƒäº‹åŠ¡æ˜¯ä¸å¯è§çš„ã€‚ æŒä¹…æ€§ï¼ˆDurabilityï¼‰ ä¸€æ—¦äº‹åŠ¡æäº¤ï¼Œåˆ™å…¶æ‰€åšçš„ä¿®æ”¹å°†ä¼šæ°¸è¿œä¿å­˜åˆ°æ•°æ®åº“ä¸­ã€‚å³ä½¿ç³»ç»Ÿå‘ç”Ÿå´©æºƒï¼Œäº‹åŠ¡æ‰§è¡Œçš„ç»“æœä¹Ÿä¸èƒ½ä¸¢å¤±ã€‚ ä½¿ç”¨é‡åšæ—¥å¿—æ¥ä¿è¯æŒä¹…æ€§ã€‚ æ€§èƒ½ä¼˜åŒ– æ•°æ®åº“çš„ä¼˜åŒ–æ–¹æ³•æœ‰å¾ˆå¤šç§ï¼Œåœ¨åº”ç”¨å±‚æ¥è¯´ï¼Œä¸»è¦æ˜¯åŸºäºç´¢å¼•çš„ä¼˜åŒ–ã€‚ 1. ä¼˜åŒ–åˆ†æ å¿…é¡»ç†Ÿæ‚‰æ•°æ®åº“åº”ç”¨ç¨‹åºä¸­çš„æ‰€æœ‰SQLè¯­å¥ï¼Œä»ä¸­ç»Ÿè®¡å‡ºå¸¸ç”¨çš„å¯èƒ½å¯¹æ€§èƒ½æœ‰å½±å“çš„éƒ¨åˆ†SQLï¼Œåˆ†æã€å½’çº³å‡ºä½œä¸ºWhereæ¡ä»¶å­å¥çš„å­—æ®µåŠå…¶ç»„åˆæ–¹å¼ï¼›åœ¨è¿™ä¸€åŸºç¡€ä¸Šå¯ä»¥åˆæ­¥åˆ¤æ–­å‡ºå“ªäº›è¡¨çš„å“ªäº›å­—æ®µåº”è¯¥å»ºç«‹ç´¢å¼•ã€‚ å¿…é¡»äº†è§£å“ªäº›è¡¨æ˜¯æ•°æ®æ“ä½œé¢‘ç¹çš„è¡¨ï¼›å“ªäº›è¡¨ç»å¸¸ä¸å…¶ä»–è¡¨è¿›è¡Œè¿æ¥ï¼›å“ªäº›è¡¨ä¸­çš„æ•°æ®é‡å¯èƒ½å¾ˆå¤§ï¼›å¯¹äºæ•°æ®é‡å¤§çš„è¡¨ï¼Œå…¶ä¸­å„ä¸ªå­—æ®µçš„æ•°æ®åˆ†å¸ƒæƒ…å†µå¦‚ä½•ï¼› 2. ç´¢å¼•å»ºç«‹çš„åŸåˆ™ è¡¨çš„ä¸»é”®, å¤–é”®å¿…é¡»è¦æœ‰ç´¢å¼• æ•°æ®é‡è¶…è¿‡300çš„è¡¨åº”è¯¥æœ‰ç´¢å¼•ï¼› ç»å¸¸ä¸å…¶ä»–è¡¨è¿›è¡Œè¿æ¥çš„è¡¨ï¼Œåœ¨è¿æ¥å­—æ®µä¸Šåº”è¯¥å»ºç«‹ç´¢å¼•ï¼› ç»å¸¸å‡ºç°åœ¨Whereå­å¥ä¸­çš„å­—æ®µï¼Œç‰¹åˆ«æ˜¯å¤§è¡¨çš„å­—æ®µï¼Œåº”è¯¥å»ºç«‹ç´¢å¼•ï¼› ç´¢å¼•åº”è¯¥å»ºåœ¨é€‰æ‹©æ€§é«˜(åŒºåˆ†åº¦é«˜)çš„å­—æ®µä¸Šï¼› ç´¢å¼•åº”è¯¥å»ºåœ¨å°å­—æ®µä¸Šï¼Œå¯¹äºå¤§çš„æ–‡æœ¬å­—æ®µç”šè‡³è¶…é•¿å­—æ®µï¼Œä¸è¦å»ºç´¢å¼•ï¼› å¤åˆç´¢å¼•çš„å»ºç«‹éœ€è¦è¿›è¡Œä»”ç»†åˆ†æï¼›å°½é‡è€ƒè™‘ç”¨å•å­—æ®µç´¢å¼•ä»£æ›¿ï¼š Aã€æ­£ç¡®é€‰æ‹©å¤åˆç´¢å¼•ä¸­çš„ä¸»åˆ—å­—æ®µï¼Œä¸€èˆ¬æ˜¯é€‰æ‹©æ€§è¾ƒå¥½çš„å­—æ®µï¼› Bã€å¤åˆç´¢å¼•çš„å‡ ä¸ªå­—æ®µæ˜¯å¦ç»å¸¸åŒæ—¶ä»¥ANDæ–¹å¼å‡ºç°åœ¨Whereå­å¥ä¸­ï¼Ÿå•å­—æ®µæŸ¥è¯¢æ˜¯å¦æå°‘ç”šè‡³æ²¡æœ‰ï¼Ÿå¦‚æœæ˜¯ï¼Œåˆ™å¯ä»¥å»ºå¤åˆç´¢å¼•ï¼›å¦åˆ™è€ƒè™‘å•å­—æ®µç´¢å¼•ï¼› Cã€å¦‚æœå¤åˆç´¢å¼•ä¸­åŒ…å«çš„å­—æ®µç»å¸¸å•ç‹¬å‡ºç°åœ¨Whereå­å¥ä¸­ï¼Œåˆ™åˆ†è§£ä¸ºå¤šä¸ªå•å­—æ®µç´¢å¼•ï¼› Dã€å¦‚æœå¤åˆç´¢å¼•æ‰€åŒ…å«çš„å­—æ®µè¶…è¿‡3ä¸ªï¼Œé‚£ä¹ˆä»”ç»†è€ƒè™‘å…¶å¿…è¦æ€§ï¼Œè€ƒè™‘å‡å°‘å¤åˆçš„å­—æ®µï¼› ==ç»´æŠ¤æˆæœ¬è¾ƒé«˜== Eã€å¦‚æœæ—¢æœ‰å•å­—æ®µç´¢å¼•ï¼Œåˆæœ‰è¿™å‡ ä¸ªå­—æ®µä¸Šçš„å¤åˆç´¢å¼•ï¼Œä¸€èˆ¬å¯ä»¥åˆ é™¤å¤åˆç´¢å¼•ï¼› é¢‘ç¹è¿›è¡Œæ•°æ®æ“ä½œçš„è¡¨ï¼Œä¸è¦å»ºç«‹å¤ªå¤šçš„ç´¢å¼•ï¼› åˆ é™¤æ— ç”¨çš„ç´¢å¼•ï¼Œé¿å…å¯¹æ‰§è¡Œè®¡åˆ’é€ æˆè´Ÿé¢å½±å“ï¼› é”™è¯¯æ¡ˆä¾‹ ä»»ä½•å¯¹åˆ—çš„æ“ä½œéƒ½å¯èƒ½å¯¼è‡´å…¨è¡¨æ‰«æï¼Œè¿™é‡Œæ‰€è°“çš„æ“ä½œåŒ…æ‹¬æ•°æ®åº“å‡½æ•°ã€è®¡ç®—è¡¨è¾¾å¼ç­‰ç­‰ï¼ŒæŸ¥è¯¢æ—¶è¦å°½å¯èƒ½å°†æ“ä½œç§»è‡³ç­‰å¼çš„å³è¾¹ï¼Œç”šè‡³å»æ‰å‡½æ•°ã€‚ select * from record where substrb(CardNo,1,4)=â€™5378â€™(13ç§’) ä¼˜åŒ–: substrbå‡½æ•°å¯¹åˆ—æ“ä½œ, ä¸ä¼šä½¿ç”¨ç´¢å¼• select * from record where substrb(CardNo,1,4)=â€™5378â€™(13ç§’) select * from record where amount/30&lt; 1000ï¼ˆ11ç§’ï¼‰ *ä¼˜åŒ–: * select * from record where amount &lt; 1000*30ï¼ˆ&lt; 1ç§’ï¼‰ select * from record where to_char(ActionTime,â€™yyyymmddâ€™)=â€™19991201â€™ï¼ˆ10ç§’ï¼‰ ä¼˜åŒ–: select * from record where ActionTime= to_date (â€˜19991201â€™ ,â€™yyyymmddâ€™)ï¼ˆ&lt; 1ç§’ï¼‰ 3.é¿å…ç´¢å¼•å¤±æ•ˆ å»æ‰ IN, OR å«æœ‰â€INâ€ã€â€ORâ€çš„Whereå­å¥å¸¸ä¼šä½¿ç”¨å·¥ä½œè¡¨ï¼Œä½¿ç´¢å¼•å¤±æ•ˆï¼›å¦‚æœä¸äº§ç”Ÿå¤§é‡é‡å¤å€¼ï¼Œå¯ä»¥è€ƒè™‘æŠŠå­å¥æ‹†å¼€ï¼›æ‹†å¼€çš„å­å¥ä¸­åº”è¯¥åŒ…å«ç´¢å¼•ã€‚ å°½é‡å»æ‰ â€œ&lt;&gt;â€ å°½é‡å»æ‰ â€œ&lt;&gt;â€ï¼Œé¿å…å…¨è¡¨æ‰«æï¼Œå¦‚æœæ•°æ®æ˜¯æšä¸¾å€¼ï¼Œä¸”å–å€¼èŒƒå›´å›ºå®šï¼Œåˆ™ä¿®æ”¹ä¸ºâ€ORâ€æ–¹å¼ã€‚ UPDATE SERVICEINFO SET STATE=0 WHERE STATE&lt;&gt;0; ä»¥ ä¸Šè¯­å¥ç”±äºå…¶ä¸­åŒ…å«äº†â€&lt;&gt;â€ï¼Œæ‰§è¡Œè®¡åˆ’ä¸­ç”¨äº†å…¨è¡¨æ‰«æï¼ˆTABLE ACCESSFULLï¼‰ï¼Œæ²¡æœ‰ç”¨åˆ°stateå­—æ®µä¸Šçš„ç´¢å¼• å»æ‰ IS NULLå’ŒIS NOT NULL Whereå­—å¥ä¸­çš„IS NULLå’ŒIS NOT NULLå°†ä¸ä¼šä½¿ç”¨ç´¢å¼•è€Œæ˜¯è¿›è¡Œå…¨è¡¨æœç´¢ï¼Œå› æ­¤éœ€è¦é€šè¿‡æ”¹å˜æŸ¥è¯¢æ–¹å¼ï¼Œåˆ†æƒ…å†µè®¨è®ºç­‰æ–¹æ³•ï¼Œå»æ‰Whereå­å¥ä¸­çš„IS NULLå’ŒIS NOT NULLã€‚ likeå­—å¥å°½é‡å‰ç«¯åŒ¹é… å› ä¸ºlikeå‚æ•°ä½¿ç”¨çš„éå¸¸é¢‘ç¹ï¼Œå› æ­¤å¦‚æœèƒ½å¤Ÿå¯¹likeå­å¥ä½¿ç”¨ç´¢å¼•ï¼Œå°†å¾ˆé«˜çš„æé«˜æŸ¥è¯¢çš„æ•ˆç‡ã€‚ select * from city where name like â€˜%S%â€™ ä»¥ä¸ŠæŸ¥è¯¢çš„æ‰§è¡Œè®¡åˆ’ç”¨äº†å…¨è¡¨æ‰«æï¼ˆTABLE ACCESS FULLï¼‰ï¼Œå¦‚æœèƒ½å¤Ÿä¿®æ”¹ä¸ºï¼š select * from city where name like â€˜S%â€™ é‚£ ä¹ˆæŸ¥è¯¢çš„æ‰§è¡Œè®¡åˆ’å°†ä¼šå˜æˆï¼ˆINDEX RANGE SCANï¼‰ï¼ŒæˆåŠŸçš„åˆ©ç”¨äº†nameå­—æ®µçš„ç´¢å¼•ã€‚ 4.é¿å…å…¨è¡¨æ‰«æ éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå°½é‡é¿å…æ½œåœ¨çš„æ•°æ®ç±»å‹è½¬æ¢ã€‚å¦‚å°†å­—ç¬¦å‹æ•°æ®ä¸æ•°å€¼å‹æ•°æ®æ¯”è¾ƒï¼ŒORACLEä¼šè‡ªåŠ¨å°†å­—ç¬¦å‹ç”¨to_number()å‡½æ•°è¿›è¡Œè½¬æ¢ï¼Œä»è€Œå¯¼è‡´å…¨è¡¨æ‰«æã€‚ select col1,col2 from tab1 where col1&gt;10ï¼Œ åº”è¯¥å†™ä¸ºï¼š select col1,col2 from tab1 where col1&gt;â€™10â€™ã€‚ 5.ä¸ºæŸ¥è¯¢ç¼“å­˜ä¼˜åŒ–sql å¤§å¤šæ•°çš„MySQLæœåŠ¡å™¨éƒ½å¼€å¯äº†æŸ¥è¯¢ç¼“å­˜ã€‚è¿™æ˜¯æé«˜æ€§æœ€æœ‰æ•ˆçš„æ–¹æ³•ä¹‹ä¸€ï¼Œè€Œä¸”è¿™æ˜¯è¢«MySQLçš„æ•°æ®åº“å¼•æ“å¤„ç†çš„ã€‚ ä½ æ‰€éœ€è¦çš„å°±æ˜¯ç”¨ä¸€ä¸ªå˜é‡æ¥ä»£æ›¿MySQLçš„å‡½æ•°ï¼Œä»è€Œå¼€å¯ç¼“å­˜ã€‚ 123456// æŸ¥è¯¢ç¼“å­˜ä¸å¼€å¯$r = mysql_query(\"SELECT username FROM user WHERE signup_date &gt;= CURDATE()\");// å¼€å¯æŸ¥è¯¢ç¼“å­˜$today = date(\"Y-m-d\");$r = mysql_query(\"SELECT username FROM user WHERE signup_date &gt;= '$today'\"); 6. EXPLAIN ä½ çš„ SELECT æŸ¥è¯¢ EXPLAIN å…³é”®å­—å¯ä»¥è®©ä½ çŸ¥é“MySQLæ˜¯å¦‚ä½•å¤„ç†ä½ çš„SQLè¯­å¥çš„ã€‚è¿™å¯ä»¥å¸®ä½ åˆ†æä½ çš„æŸ¥è¯¢è¯­å¥æˆ–æ˜¯è¡¨ç»“æ„çš„æ€§èƒ½ç“¶é¢ˆã€‚ å¦‚: EXPLAIN çš„æŸ¥è¯¢ç»“æœè¿˜ä¼šå‘Šè¯‰ä½ ä½ çš„ç´¢å¼•ä¸»é”®è¢«å¦‚ä½•åˆ©ç”¨çš„ï¼Œä½ çš„æ•°æ®è¡¨æ˜¯å¦‚ä½•è¢«æœç´¢å’Œæ’åº","categories":[],"tags":[{"name":"mysql","slug":"mysql","permalink":"/tags/mysql/"},{"name":"IT","slug":"IT","permalink":"/tags/IT/"},{"name":"æŠ€æœ¯ç¬”è®°","slug":"æŠ€æœ¯ç¬”è®°","permalink":"/tags/%E6%8A%80%E6%9C%AF%E7%AC%94%E8%AE%B0/"},{"name":"æ•°æ®åº“","slug":"æ•°æ®åº“","permalink":"/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/"},{"name":"Job","slug":"Job","permalink":"/tags/Job/"}]},{"title":"Linux","slug":"Linux","date":"2019-10-20T11:45:12.000Z","updated":"2019-10-20T12:20:10.990Z","comments":true,"path":"2019/10/20/Linux/","link":"","permalink":"/2019/10/20/Linux/","excerpt":"","text":"åŸºæœ¬ç†è®ºçŸ¥ä¸€ã€å¸¸ç”¨æ“ä½œä»¥åŠæ¦‚å¿µå¿«æ·é”® Tabï¼šå‘½ä»¤å’Œæ–‡ä»¶åè¡¥å…¨ï¼› Ctrl+Cï¼šä¸­æ–­æ­£åœ¨è¿è¡Œçš„ç¨‹åºï¼› Ctrl+Dï¼šç»“æŸé”®ç›˜è¾“å…¥ï¼ˆEnd Of Fileï¼ŒEOFï¼‰ æ±‚åŠ©1. â€“helpæŒ‡ä»¤çš„åŸºæœ¬ç”¨æ³•ä¸é€‰é¡¹ä»‹ç»ã€‚ 2. manman æ˜¯ manual çš„ç¼©å†™ï¼Œå°†æŒ‡ä»¤çš„å…·ä½“ä¿¡æ¯æ˜¾ç¤ºå‡ºæ¥ã€‚ å½“æ‰§è¡Œ man date æ—¶ï¼Œæœ‰ DATE(1) å‡ºç°ï¼Œå…¶ä¸­çš„æ•°å­—ä»£è¡¨æŒ‡ä»¤çš„ç±»å‹ï¼Œå¸¸ç”¨çš„æ•°å­—åŠå…¶ç±»å‹å¦‚ä¸‹ï¼š ä»£å· ç±»å‹ 1 ç”¨æˆ·åœ¨ shell ç¯å¢ƒä¸­å¯ä»¥æ“ä½œçš„æŒ‡ä»¤æˆ–è€…å¯æ‰§è¡Œæ–‡ä»¶ 5 é…ç½®æ–‡ä»¶ 8 ç³»ç»Ÿç®¡ç†å‘˜å¯ä»¥ä½¿ç”¨çš„ç®¡ç†æŒ‡ä»¤ 3. infoinfo ä¸ man ç±»ä¼¼ï¼Œä½†æ˜¯ info å°†æ–‡æ¡£åˆ†æˆä¸€ä¸ªä¸ªé¡µé¢ï¼Œæ¯ä¸ªé¡µé¢å¯ä»¥è¿›è¡Œè·³è½¬ã€‚ 4. doc/usr/share/doc å­˜æ”¾ç€è½¯ä»¶çš„ä¸€æ•´å¥—è¯´æ˜æ–‡ä»¶ã€‚ å…³æœº1. whoåœ¨å…³æœºå‰éœ€è¦å…ˆä½¿ç”¨ who å‘½ä»¤æŸ¥çœ‹æœ‰æ²¡æœ‰å…¶å®ƒç”¨æˆ·åœ¨çº¿ã€‚ 2. syncä¸ºäº†åŠ å¿«å¯¹ç£ç›˜æ–‡ä»¶çš„è¯»å†™é€Ÿåº¦ï¼Œä½äºå†…å­˜ä¸­çš„æ–‡ä»¶æ•°æ®ä¸ä¼šç«‹å³åŒæ­¥åˆ°ç£ç›˜ä¸Šï¼Œå› æ­¤å…³æœºä¹‹å‰éœ€è¦å…ˆè¿›è¡Œ sync åŒæ­¥æ“ä½œã€‚ 3. shutdown12345# shutdown [-krhc] æ—¶é—´ [ä¿¡æ¯]-k ï¼š ä¸ä¼šå…³æœºï¼Œåªæ˜¯å‘é€è­¦å‘Šä¿¡æ¯ï¼Œé€šçŸ¥æ‰€æœ‰åœ¨çº¿çš„ç”¨æˆ·-r ï¼š å°†ç³»ç»Ÿçš„æœåŠ¡åœæ‰åå°±é‡æ–°å¯åŠ¨-h ï¼š å°†ç³»ç»Ÿçš„æœåŠ¡åœæ‰åå°±ç«‹å³å…³æœº-c ï¼š å–æ¶ˆå·²ç»åœ¨è¿›è¡Œçš„ shutdown æŒ‡ä»¤å†…å®¹ PATHå¯ä»¥åœ¨ç¯å¢ƒå˜é‡ PATH ä¸­å£°æ˜å¯æ‰§è¡Œæ–‡ä»¶çš„è·¯å¾„ï¼Œè·¯å¾„ä¹‹é—´ç”¨ : åˆ†éš”ã€‚ 1/usr/local/bin:/usr/bin:/usr/local/sbin:/usr/sbin:/home/dmtsai/.local/bin:/home/dmtsai/bin sudosudo å…è®¸ä¸€èˆ¬ç”¨æˆ·ä½¿ç”¨ root å¯æ‰§è¡Œçš„å‘½ä»¤ï¼Œä¸è¿‡åªæœ‰åœ¨ /etc/sudoers é…ç½®æ–‡ä»¶ä¸­æ·»åŠ çš„ç”¨æˆ·æ‰èƒ½ä½¿ç”¨è¯¥æŒ‡ä»¤ã€‚ åŒ…ç®¡ç†å·¥å…·RPM å’Œ DPKG ä¸ºæœ€å¸¸è§çš„ä¸¤ç±»è½¯ä»¶åŒ…ç®¡ç†å·¥å…·ï¼š RPM å…¨ç§°ä¸º Redhat Package Managerï¼Œæœ€æ—©ç”± Red Hat å…¬å¸åˆ¶å®šå®æ–½ï¼Œéšåè¢« GNU å¼€æºæ“ä½œç³»ç»Ÿæ¥å—å¹¶æˆä¸ºè®¸å¤š Linux ç³»ç»Ÿçš„æ—¢å®šè½¯ä»¶æ ‡å‡†ã€‚YUM åŸºäº RPMï¼Œå…·æœ‰ä¾èµ–ç®¡ç†å’Œè½¯ä»¶å‡çº§åŠŸèƒ½ã€‚ ä¸ RPM ç«äº‰çš„æ˜¯åŸºäº Debian æ“ä½œç³»ç»Ÿçš„ DEB è½¯ä»¶åŒ…ç®¡ç†å·¥å…· DPKGï¼Œå…¨ç§°ä¸º Debian Packageï¼ŒåŠŸèƒ½æ–¹é¢ä¸ RPM ç›¸ä¼¼ã€‚ å‘è¡Œç‰ˆLinux å‘è¡Œç‰ˆæ˜¯ Linux å†…æ ¸åŠå„ç§åº”ç”¨è½¯ä»¶çš„é›†æˆç‰ˆæœ¬ã€‚ åŸºäºçš„åŒ…ç®¡ç†å·¥å…· å•†ä¸šå‘è¡Œç‰ˆ ç¤¾åŒºå‘è¡Œç‰ˆ RPM Red Hat Fedora / CentOS DPKG Ubuntu Debian VIM ä¸‰ä¸ªæ¨¡å¼ ä¸€èˆ¬æŒ‡ä»¤æ¨¡å¼ï¼ˆCommand modeï¼‰ï¼šVIM çš„é»˜è®¤æ¨¡å¼ï¼Œå¯ä»¥ç”¨äºç§»åŠ¨æ¸¸æ ‡æŸ¥çœ‹å†…å®¹ï¼› ç¼–è¾‘æ¨¡å¼ï¼ˆInsert modeï¼‰ï¼šæŒ‰ä¸‹ â€œiâ€ ç­‰æŒ‰é”®ä¹‹åè¿›å…¥ï¼Œå¯ä»¥å¯¹æ–‡æœ¬è¿›è¡Œç¼–è¾‘ï¼› æŒ‡ä»¤åˆ—æ¨¡å¼ï¼ˆBottom-line modeï¼‰ï¼šæŒ‰ä¸‹ â€œ:â€ æŒ‰é”®ä¹‹åè¿›å…¥ï¼Œç”¨äºä¿å­˜é€€å‡ºç­‰æ“ä½œã€‚ åœ¨æŒ‡ä»¤åˆ—æ¨¡å¼ä¸‹ï¼Œæœ‰ä»¥ä¸‹å‘½ä»¤ç”¨äºç¦»å¼€æˆ–è€…ä¿å­˜æ–‡ä»¶ã€‚ å‘½ä»¤ ä½œç”¨ :w å†™å…¥ç£ç›˜ :w! å½“æ–‡ä»¶ä¸ºåªè¯»æ—¶ï¼Œå¼ºåˆ¶å†™å…¥ç£ç›˜ã€‚åˆ°åº•èƒ½ä¸èƒ½å†™å…¥ï¼Œä¸ç”¨æˆ·å¯¹è¯¥æ–‡ä»¶çš„æƒé™æœ‰å…³ :q ç¦»å¼€ :q! å¼ºåˆ¶ç¦»å¼€ä¸ä¿å­˜ :wq å†™å…¥ç£ç›˜åç¦»å¼€ :wq! å¼ºåˆ¶å†™å…¥ç£ç›˜åç¦»å¼€ GNUGNU è®¡åˆ’ï¼Œè¯‘ä¸ºé©å¥´è®¡åˆ’ï¼Œå®ƒçš„ç›®æ ‡æ˜¯åˆ›å»ºä¸€å¥—å®Œå…¨è‡ªç”±çš„æ“ä½œç³»ç»Ÿï¼Œç§°ä¸º GNUï¼Œå…¶å†…å®¹è½¯ä»¶å®Œå…¨ä»¥ GPL æ–¹å¼å‘å¸ƒã€‚å…¶ä¸­ GPL å…¨ç§°ä¸º GNU é€šç”¨å…¬å…±è®¸å¯åè®®ï¼ˆGNU General Public Licenseï¼‰ï¼ŒåŒ…å«äº†ä»¥ä¸‹å†…å®¹ï¼š ä»¥ä»»ä½•ç›®çš„è¿è¡Œæ­¤ç¨‹åºçš„è‡ªç”±ï¼› å†å¤åˆ¶çš„è‡ªç”±ï¼› æ”¹è¿›æ­¤ç¨‹åºï¼Œå¹¶å…¬å¼€å‘å¸ƒæ”¹è¿›çš„è‡ªç”±ã€‚ å¼€æºåè®® Choose an open source license å¦‚ä½•é€‰æ‹©å¼€æºè®¸å¯è¯ï¼Ÿ äºŒã€ç£ç›˜ç£ç›˜æ¥å£1. IDEIDEï¼ˆATAï¼‰å…¨ç§° Advanced Technology Attachmentï¼Œæ¥å£é€Ÿåº¦æœ€å¤§ä¸º 133MB/sï¼Œå› ä¸ºå¹¶å£çº¿çš„æŠ—å¹²æ‰°æ€§å¤ªå·®ï¼Œä¸”æ’çº¿å ç”¨ç©ºé—´è¾ƒå¤§ï¼Œä¸åˆ©ç”µè„‘å†…éƒ¨æ•£çƒ­ï¼Œå·²é€æ¸è¢« SATA æ‰€å–ä»£ã€‚ 2. SATASATA å…¨ç§° Serial ATAï¼Œä¹Ÿå°±æ˜¯ä½¿ç”¨ä¸²å£çš„ ATA æ¥å£ï¼ŒæŠ—å¹²æ‰°æ€§å¼ºï¼Œä¸”å¯¹æ•°æ®çº¿çš„é•¿åº¦è¦æ±‚æ¯” ATA ä½å¾ˆå¤šï¼Œæ”¯æŒçƒ­æ’æ‹”ç­‰åŠŸèƒ½ã€‚SATA-II çš„æ¥å£é€Ÿåº¦ä¸º 300MiB/sï¼Œè€Œ SATA-III æ ‡å‡†å¯è¾¾åˆ° 600MiB/s çš„ä¼ è¾“é€Ÿåº¦ã€‚SATA çš„æ•°æ®çº¿ä¹Ÿæ¯” ATA çš„ç»†å¾—å¤šï¼Œæœ‰åˆ©äºæœºç®±å†…çš„ç©ºæ°”æµé€šï¼Œæ•´ç†çº¿æä¹Ÿæ¯”è¾ƒæ–¹ä¾¿ã€‚ 3. SCSISCSI å…¨ç§°æ˜¯ Small Computer System Interfaceï¼ˆå°å‹æœºç³»ç»Ÿæ¥å£ï¼‰ï¼ŒSCSI ç¡¬ç›˜å¹¿ä¸ºå·¥ä½œç«™ä»¥åŠä¸ªäººç”µè„‘ä»¥åŠæœåŠ¡å™¨æ‰€ä½¿ç”¨ï¼Œå› æ­¤ä¼šä½¿ç”¨è¾ƒä¸ºå…ˆè¿›çš„æŠ€æœ¯ï¼Œå¦‚ç¢Ÿç‰‡è½¬é€Ÿ 15000rpm çš„é«˜è½¬é€Ÿï¼Œä¸”ä¼ è¾“æ—¶ CPU å ç”¨ç‡è¾ƒä½ï¼Œä½†æ˜¯å•ä»·ä¹Ÿæ¯”ç›¸åŒå®¹é‡çš„ ATA åŠ SATA ç¡¬ç›˜æ›´åŠ æ˜‚è´µã€‚ 4. SASSASï¼ˆSerial Attached SCSIï¼‰æ˜¯æ–°ä¸€ä»£çš„ SCSI æŠ€æœ¯ï¼Œå’Œ SATA ç¡¬ç›˜ç›¸åŒï¼Œéƒ½æ˜¯é‡‡å–åºåˆ—å¼æŠ€æœ¯ä»¥è·å¾—æ›´é«˜çš„ä¼ è¾“é€Ÿåº¦ï¼Œå¯è¾¾åˆ° 6Gb/sã€‚æ­¤å¤–ä¹Ÿé€šè¿‡ç¼©å°è¿æ¥çº¿æ”¹å–„ç³»ç»Ÿå†…éƒ¨ç©ºé—´ç­‰ã€‚ ç£ç›˜çš„æ–‡ä»¶åLinux ä¸­æ¯ä¸ªç¡¬ä»¶éƒ½è¢«å½“åšä¸€ä¸ªæ–‡ä»¶ï¼ŒåŒ…æ‹¬ç£ç›˜ã€‚ç£ç›˜ä»¥ç£ç›˜æ¥å£ç±»å‹è¿›è¡Œå‘½åï¼Œå¸¸è§ç£ç›˜çš„æ–‡ä»¶åå¦‚ä¸‹ï¼š IDE ç£ç›˜ï¼š/dev/hd[a-d] SATA/SCSI/SAS ç£ç›˜ï¼š/dev/sd[a-p] å…¶ä¸­æ–‡ä»¶ååé¢çš„åºå·çš„ç¡®å®šä¸ç³»ç»Ÿæ£€æµ‹åˆ°ç£ç›˜çš„é¡ºåºæœ‰å…³ï¼Œè€Œä¸ç£ç›˜æ‰€æ’å…¥çš„æ’æ§½ä½ç½®æ— å…³ã€‚ ä¸‰ã€åˆ†åŒºåˆ†åŒºè¡¨ç£ç›˜åˆ†åŒºè¡¨ä¸»è¦æœ‰ä¸¤ç§æ ¼å¼ï¼Œä¸€ç§æ˜¯é™åˆ¶è¾ƒå¤šçš„ MBR åˆ†åŒºè¡¨ï¼Œä¸€ç§æ˜¯è¾ƒæ–°ä¸”é™åˆ¶è¾ƒå°‘çš„ GPT åˆ†åŒºè¡¨ã€‚ 1. MBRMBR ä¸­ï¼Œç¬¬ä¸€ä¸ªæ‰‡åŒºæœ€é‡è¦ï¼Œé‡Œé¢æœ‰ä¸»è¦å¼€æœºè®°å½•ï¼ˆMaster boot record, MBRï¼‰åŠåˆ†åŒºè¡¨ï¼ˆpartition tableï¼‰ï¼Œå…¶ä¸­ä¸»è¦å¼€æœºè®°å½•å  446 bytesï¼Œåˆ†åŒºè¡¨å  64 bytesã€‚ åˆ†åŒºè¡¨åªæœ‰ 64 bytesï¼Œæœ€å¤šåªèƒ½å­˜å‚¨ 4 ä¸ªåˆ†åŒºï¼Œè¿™ 4 ä¸ªåˆ†åŒºä¸ºä¸»åˆ†åŒºï¼ˆPrimaryï¼‰å’Œæ‰©å±•åˆ†åŒºï¼ˆExtendedï¼‰ã€‚å…¶ä¸­æ‰©å±•åˆ†åŒºåªæœ‰ä¸€ä¸ªï¼Œå®ƒä½¿ç”¨å…¶å®ƒæ‰‡åŒºæ¥è®°å½•é¢å¤–çš„åˆ†åŒºè¡¨ï¼Œå› æ­¤é€šè¿‡æ‰©å±•åˆ†åŒºå¯ä»¥åˆ†å‡ºæ›´å¤šåˆ†åŒºï¼Œè¿™äº›åˆ†åŒºç§°ä¸ºé€»è¾‘åˆ†åŒºã€‚ Linux ä¹ŸæŠŠåˆ†åŒºå½“æˆæ–‡ä»¶ï¼Œåˆ†åŒºæ–‡ä»¶çš„å‘½åæ–¹å¼ä¸ºï¼šç£ç›˜æ–‡ä»¶å + ç¼–å·ï¼Œä¾‹å¦‚ /dev/sda1ã€‚æ³¨æ„ï¼Œé€»è¾‘åˆ†åŒºçš„ç¼–å·ä» 5 å¼€å§‹ã€‚ 2. GPTæ‰‡åŒºæ˜¯ç£ç›˜çš„æœ€å°å­˜å‚¨å•ä½ï¼Œæ—§ç£ç›˜çš„æ‰‡åŒºå¤§å°é€šå¸¸ä¸º 512 bytesï¼Œè€Œæœ€æ–°çš„ç£ç›˜æ”¯æŒ 4 kã€‚GPT ä¸ºäº†å…¼å®¹æ‰€æœ‰ç£ç›˜ï¼Œåœ¨å®šä¹‰æ‰‡åŒºä¸Šä½¿ç”¨é€»è¾‘åŒºå—åœ°å€ï¼ˆLogical Block Address, LBAï¼‰ï¼ŒLBA é»˜è®¤å¤§å°ä¸º 512 bytesã€‚ GPT ç¬¬ 1 ä¸ªåŒºå—è®°å½•äº†ä¸»è¦å¼€æœºè®°å½•ï¼ˆMBRï¼‰ï¼Œç´§æ¥ç€æ˜¯ 33 ä¸ªåŒºå—è®°å½•åˆ†åŒºä¿¡æ¯ï¼Œå¹¶æŠŠæœ€åçš„ 33 ä¸ªåŒºå—ç”¨äºå¯¹åˆ†åŒºä¿¡æ¯è¿›è¡Œå¤‡ä»½ã€‚è¿™ 33 ä¸ªåŒºå—ç¬¬ä¸€ä¸ªä¸º GPT è¡¨å¤´çºªå½•ï¼Œè¿™ä¸ªéƒ¨ä»½çºªå½•äº†åˆ†åŒºè¡¨æœ¬èº«çš„ä½ç½®ä¸å¤§å°å’Œå¤‡ä»½åˆ†åŒºçš„ä½ç½®ï¼ŒåŒæ—¶æ”¾ç½®äº†åˆ†åŒºè¡¨çš„æ ¡éªŒç  (CRC32)ï¼Œæ“ä½œç³»ç»Ÿå¯ä»¥æ ¹æ®è¿™ä¸ªæ ¡éªŒç æ¥åˆ¤æ–­ GPT æ˜¯å¦æ­£ç¡®ã€‚è‹¥æœ‰é”™è¯¯ï¼Œå¯ä»¥ä½¿ç”¨å¤‡ä»½åˆ†åŒºè¿›è¡Œæ¢å¤ã€‚ GPT æ²¡æœ‰æ‰©å±•åˆ†åŒºæ¦‚å¿µï¼Œéƒ½æ˜¯ä¸»åˆ†åŒºï¼Œæ¯ä¸ª LBA å¯ä»¥åˆ† 4 ä¸ªåˆ†åŒºï¼Œå› æ­¤æ€»å…±å¯ä»¥åˆ† 4 * 32 = 128 ä¸ªåˆ†åŒºã€‚ MBR ä¸æ”¯æŒ 2.2 TB ä»¥ä¸Šçš„ç¡¬ç›˜ï¼ŒGPT åˆ™æœ€å¤šæ”¯æŒåˆ° 233 TB = 8 ZBã€‚ å¼€æœºæ£€æµ‹ç¨‹åº1. BIOSBIOSï¼ˆBasic Input/Output Systemï¼ŒåŸºæœ¬è¾“å…¥è¾“å‡ºç³»ç»Ÿï¼‰ï¼Œå®ƒæ˜¯ä¸€ä¸ªå›ºä»¶ï¼ˆåµŒå…¥åœ¨ç¡¬ä»¶ä¸­çš„è½¯ä»¶ï¼‰ï¼ŒBIOS ç¨‹åºå­˜æ”¾åœ¨æ–­ç”µåå†…å®¹ä¸ä¼šä¸¢å¤±çš„åªè¯»å†…å­˜ä¸­ã€‚ BIOS æ˜¯å¼€æœºçš„æ—¶å€™è®¡ç®—æœºæ‰§è¡Œçš„ç¬¬ä¸€ä¸ªç¨‹åºï¼Œè¿™ä¸ªç¨‹åºçŸ¥é“å¯ä»¥å¼€æœºçš„ç£ç›˜ï¼Œå¹¶è¯»å–ç£ç›˜ç¬¬ä¸€ä¸ªæ‰‡åŒºçš„ä¸»è¦å¼€æœºè®°å½•ï¼ˆMBRï¼‰ï¼Œç”±ä¸»è¦å¼€æœºè®°å½•ï¼ˆMBRï¼‰æ‰§è¡Œå…¶ä¸­çš„å¼€æœºç®¡ç†ç¨‹åºï¼Œè¿™ä¸ªå¼€æœºç®¡ç†ç¨‹åºä¼šåŠ è½½æ“ä½œç³»ç»Ÿçš„æ ¸å¿ƒæ–‡ä»¶ã€‚ ä¸»è¦å¼€æœºè®°å½•ï¼ˆMBRï¼‰ä¸­çš„å¼€æœºç®¡ç†ç¨‹åºæä¾›ä»¥ä¸‹åŠŸèƒ½ï¼šé€‰å•ã€è½½å…¥æ ¸å¿ƒæ–‡ä»¶ä»¥åŠè½¬äº¤å…¶å®ƒå¼€æœºç®¡ç†ç¨‹åºã€‚è½¬äº¤è¿™ä¸ªåŠŸèƒ½å¯ä»¥ç”¨æ¥å®ç°å¤šé‡å¼•å¯¼ï¼Œåªéœ€è¦å°†å¦ä¸€ä¸ªæ“ä½œç³»ç»Ÿçš„å¼€æœºç®¡ç†ç¨‹åºå®‰è£…åœ¨å…¶å®ƒåˆ†åŒºçš„å¯åŠ¨æ‰‡åŒºä¸Šï¼Œåœ¨å¯åŠ¨å¼€æœºç®¡ç†ç¨‹åºæ—¶ï¼Œå°±å¯ä»¥é€šè¿‡é€‰å•é€‰æ‹©å¯åŠ¨å½“å‰çš„æ“ä½œç³»ç»Ÿæˆ–è€…è½¬äº¤ç»™å…¶å®ƒå¼€æœºç®¡ç†ç¨‹åºä»è€Œå¯åŠ¨å¦ä¸€ä¸ªæ“ä½œç³»ç»Ÿã€‚ ä¸‹å›¾ä¸­ï¼Œç¬¬ä¸€æ‰‡åŒºçš„ä¸»è¦å¼€æœºè®°å½•ï¼ˆMBRï¼‰ä¸­çš„å¼€æœºç®¡ç†ç¨‹åºæä¾›äº†ä¸¤ä¸ªé€‰å•ï¼šM1ã€M2ï¼ŒM1 æŒ‡å‘äº† Windows æ“ä½œç³»ç»Ÿï¼Œè€Œ M2 æŒ‡å‘å…¶å®ƒåˆ†åŒºçš„å¯åŠ¨æ‰‡åŒºï¼Œé‡Œé¢åŒ…å«äº†å¦å¤–ä¸€ä¸ªå¼€æœºç®¡ç†ç¨‹åºï¼Œæä¾›äº†ä¸€ä¸ªæŒ‡å‘ Linux çš„é€‰å•ã€‚ å®‰è£…å¤šé‡å¼•å¯¼ï¼Œæœ€å¥½å…ˆå®‰è£… Windows å†å®‰è£… Linuxã€‚å› ä¸ºå®‰è£… Windows æ—¶ä¼šè¦†ç›–æ‰ä¸»è¦å¼€æœºè®°å½•ï¼ˆMBRï¼‰ï¼Œè€Œ Linux å¯ä»¥é€‰æ‹©å°†å¼€æœºç®¡ç†ç¨‹åºå®‰è£…åœ¨ä¸»è¦å¼€æœºè®°å½•ï¼ˆMBRï¼‰æˆ–è€…å…¶å®ƒåˆ†åŒºçš„å¯åŠ¨æ‰‡åŒºï¼Œå¹¶ä¸”å¯ä»¥è®¾ç½®å¼€æœºç®¡ç†ç¨‹åºçš„é€‰å•ã€‚ 2. UEFIBIOS ä¸å¯ä»¥è¯»å– GPT åˆ†åŒºè¡¨ï¼Œè€Œ UEFI å¯ä»¥ã€‚ å››ã€æ–‡ä»¶ç³»ç»Ÿåˆ†åŒºä¸æ–‡ä»¶ç³»ç»Ÿå¯¹åˆ†åŒºè¿›è¡Œæ ¼å¼åŒ–æ˜¯ä¸ºäº†åœ¨åˆ†åŒºä¸Šå»ºç«‹æ–‡ä»¶ç³»ç»Ÿã€‚ä¸€ä¸ªåˆ†åŒºé€šå¸¸åªèƒ½æ ¼å¼åŒ–ä¸ºä¸€ä¸ªæ–‡ä»¶ç³»ç»Ÿï¼Œä½†æ˜¯ç£ç›˜é˜µåˆ—ç­‰æŠ€æœ¯å¯ä»¥å°†ä¸€ä¸ªåˆ†åŒºæ ¼å¼åŒ–ä¸ºå¤šä¸ªæ–‡ä»¶ç³»ç»Ÿã€‚ ç»„æˆæœ€ä¸»è¦çš„å‡ ä¸ªç»„æˆéƒ¨åˆ†å¦‚ä¸‹ï¼š inodeï¼šä¸€ä¸ªæ–‡ä»¶å ç”¨ä¸€ä¸ª inodeï¼Œè®°å½•æ–‡ä»¶çš„å±æ€§ï¼ŒåŒæ—¶è®°å½•æ­¤æ–‡ä»¶çš„å†…å®¹æ‰€åœ¨çš„ block ç¼–å·ï¼› blockï¼šè®°å½•æ–‡ä»¶çš„å†…å®¹ï¼Œæ–‡ä»¶å¤ªå¤§æ—¶ï¼Œä¼šå ç”¨å¤šä¸ª blockã€‚ é™¤æ­¤ä¹‹å¤–è¿˜åŒ…æ‹¬ï¼š superblockï¼šè®°å½•æ–‡ä»¶ç³»ç»Ÿçš„æ•´ä½“ä¿¡æ¯ï¼ŒåŒ…æ‹¬ inode å’Œ block çš„æ€»é‡ã€ä½¿ç”¨é‡ã€å‰©ä½™é‡ï¼Œä»¥åŠæ–‡ä»¶ç³»ç»Ÿçš„æ ¼å¼ä¸ç›¸å…³ä¿¡æ¯ç­‰ï¼› block bitmapï¼šè®°å½• block æ˜¯å¦è¢«ä½¿ç”¨çš„ä½å›¾ã€‚ æ–‡ä»¶è¯»å–å¯¹äº Ext2 æ–‡ä»¶ç³»ç»Ÿï¼Œå½“è¦è¯»å–ä¸€ä¸ªæ–‡ä»¶çš„å†…å®¹æ—¶ï¼Œå…ˆåœ¨ inode ä¸­æŸ¥æ‰¾æ–‡ä»¶å†…å®¹æ‰€åœ¨çš„æ‰€æœ‰ blockï¼Œç„¶åæŠŠæ‰€æœ‰ block çš„å†…å®¹è¯»å‡ºæ¥ã€‚ è€Œå¯¹äº FAT æ–‡ä»¶ç³»ç»Ÿï¼Œå®ƒæ²¡æœ‰ inodeï¼Œæ¯ä¸ª block ä¸­å­˜å‚¨ç€ä¸‹ä¸€ä¸ª block çš„ç¼–å·ã€‚ ç£ç›˜ç¢ç‰‡æŒ‡ä¸€ä¸ªæ–‡ä»¶å†…å®¹æ‰€åœ¨çš„ block è¿‡äºåˆ†æ•£ï¼Œå¯¼è‡´ç£ç›˜ç£å¤´ç§»åŠ¨è·ç¦»è¿‡å¤§ï¼Œä»è€Œé™ä½ç£ç›˜è¯»å†™æ€§èƒ½ã€‚ blockåœ¨ Ext2 æ–‡ä»¶ç³»ç»Ÿä¸­æ‰€æ”¯æŒçš„ block å¤§å°æœ‰ 1Kï¼Œ2K åŠ 4K ä¸‰ç§ï¼Œä¸åŒçš„å¤§å°é™åˆ¶äº†å•ä¸ªæ–‡ä»¶å’Œæ–‡ä»¶ç³»ç»Ÿçš„æœ€å¤§å¤§å°ã€‚ å¤§å° 1KB 2KB 4KB æœ€å¤§å•ä¸€æ–‡ä»¶ 16GB 256GB 2TB æœ€å¤§æ–‡ä»¶ç³»ç»Ÿ 2TB 8TB 16TB ä¸€ä¸ª block åªèƒ½è¢«ä¸€ä¸ªæ–‡ä»¶æ‰€ä½¿ç”¨ï¼Œæœªä½¿ç”¨çš„éƒ¨åˆ†ç›´æ¥æµªè´¹äº†ã€‚å› æ­¤å¦‚æœéœ€è¦å­˜å‚¨å¤§é‡çš„å°æ–‡ä»¶ï¼Œé‚£ä¹ˆæœ€å¥½é€‰ç”¨æ¯”è¾ƒå°çš„ blockã€‚ inodeinode å…·ä½“åŒ…å«ä»¥ä¸‹ä¿¡æ¯ï¼š æƒé™ (read/write/excute)ï¼› æ‹¥æœ‰è€…ä¸ç¾¤ç»„ (owner/group)ï¼› å®¹é‡ï¼› å»ºç«‹æˆ–çŠ¶æ€æ”¹å˜çš„æ—¶é—´ (ctime)ï¼› æœ€è¿‘è¯»å–æ—¶é—´ (atime)ï¼› æœ€è¿‘ä¿®æ”¹æ—¶é—´ (mtime)ï¼› å®šä¹‰æ–‡ä»¶ç‰¹æ€§çš„æ——æ ‡ (flag)ï¼Œå¦‚ SetUIDâ€¦ï¼› è¯¥æ–‡ä»¶çœŸæ­£å†…å®¹çš„æŒ‡å‘ (pointer)ã€‚ inode å…·æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š æ¯ä¸ª inode å¤§å°å‡å›ºå®šä¸º 128 bytes (æ–°çš„ ext4 ä¸ xfs å¯è®¾å®šåˆ° 256 bytes)ï¼› æ¯ä¸ªæ–‡ä»¶éƒ½ä»…ä¼šå ç”¨ä¸€ä¸ª inodeã€‚ inode ä¸­è®°å½•äº†æ–‡ä»¶å†…å®¹æ‰€åœ¨çš„ block ç¼–å·ï¼Œä½†æ˜¯æ¯ä¸ª block éå¸¸å°ï¼Œä¸€ä¸ªå¤§æ–‡ä»¶éšä¾¿éƒ½éœ€è¦å‡ åä¸‡çš„ blockã€‚è€Œä¸€ä¸ª inode å¤§å°æœ‰é™ï¼Œæ— æ³•ç›´æ¥å¼•ç”¨è¿™ä¹ˆå¤š block ç¼–å·ã€‚å› æ­¤å¼•å…¥äº†é—´æ¥ã€åŒé—´æ¥ã€ä¸‰é—´æ¥å¼•ç”¨ã€‚é—´æ¥å¼•ç”¨è®© inode è®°å½•çš„å¼•ç”¨ block å—è®°å½•å¼•ç”¨ä¿¡æ¯ã€‚ ç›®å½•å»ºç«‹ä¸€ä¸ªç›®å½•æ—¶ï¼Œä¼šåˆ†é…ä¸€ä¸ª inode ä¸è‡³å°‘ä¸€ä¸ª blockã€‚block è®°å½•çš„å†…å®¹æ˜¯ç›®å½•ä¸‹æ‰€æœ‰æ–‡ä»¶çš„ inode ç¼–å·ä»¥åŠæ–‡ä»¶åã€‚ å¯ä»¥çœ‹åˆ°æ–‡ä»¶çš„ inode æœ¬èº«ä¸è®°å½•æ–‡ä»¶åï¼Œæ–‡ä»¶åè®°å½•åœ¨ç›®å½•ä¸­ï¼Œå› æ­¤æ–°å¢æ–‡ä»¶ã€åˆ é™¤æ–‡ä»¶ã€æ›´æ”¹æ–‡ä»¶åè¿™äº›æ“ä½œä¸ç›®å½•çš„å†™æƒé™æœ‰å…³ã€‚ æ—¥å¿—å¦‚æœçªç„¶æ–­ç”µï¼Œé‚£ä¹ˆæ–‡ä»¶ç³»ç»Ÿä¼šå‘ç”Ÿé”™è¯¯ï¼Œä¾‹å¦‚æ–­ç”µå‰åªä¿®æ”¹äº† block bitmapï¼Œè€Œè¿˜æ²¡æœ‰å°†æ•°æ®çœŸæ­£å†™å…¥ block ä¸­ã€‚ ext3/ext4 æ–‡ä»¶ç³»ç»Ÿå¼•å…¥äº†æ—¥å¿—åŠŸèƒ½ï¼Œå¯ä»¥åˆ©ç”¨æ—¥å¿—æ¥ä¿®å¤æ–‡ä»¶ç³»ç»Ÿã€‚ æŒ‚è½½æŒ‚è½½åˆ©ç”¨ç›®å½•ä½œä¸ºæ–‡ä»¶ç³»ç»Ÿçš„è¿›å…¥ç‚¹ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œè¿›å…¥ç›®å½•ä¹‹åå°±å¯ä»¥è¯»å–æ–‡ä»¶ç³»ç»Ÿçš„æ•°æ®ã€‚ ç›®å½•é…ç½®ä¸ºäº†ä½¿ä¸åŒ Linux å‘è¡Œç‰ˆæœ¬çš„ç›®å½•ç»“æ„ä¿æŒä¸€è‡´æ€§ï¼ŒFilesystem Hierarchy Standard (FHS) è§„å®šäº† Linux çš„ç›®å½•ç»“æ„ã€‚æœ€åŸºç¡€çš„ä¸‰ä¸ªç›®å½•å¦‚ä¸‹ï¼š / (root, æ ¹ç›®å½•) /usr (unix software resource)ï¼šæ‰€æœ‰ç³»ç»Ÿé»˜è®¤è½¯ä»¶éƒ½ä¼šå®‰è£…åˆ°è¿™ä¸ªç›®å½•ï¼› /var (variable)ï¼šå­˜æ”¾ç³»ç»Ÿæˆ–ç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­çš„æ•°æ®æ–‡ä»¶ã€‚ äº”ã€æ–‡ä»¶æ–‡ä»¶å±æ€§ç”¨æˆ·åˆ†ä¸ºä¸‰ç§ï¼šæ–‡ä»¶æ‹¥æœ‰è€…ã€ç¾¤ç»„ä»¥åŠå…¶å®ƒäººï¼Œå¯¹ä¸åŒçš„ç”¨æˆ·æœ‰ä¸åŒçš„æ–‡ä»¶æƒé™ã€‚ ä½¿ç”¨ ls æŸ¥çœ‹ä¸€ä¸ªæ–‡ä»¶æ—¶ï¼Œä¼šæ˜¾ç¤ºä¸€ä¸ªæ–‡ä»¶çš„ä¿¡æ¯ï¼Œä¾‹å¦‚ drwxr-xr-x 3 root root 17 May 6 00:14 .configï¼Œå¯¹è¿™ä¸ªä¿¡æ¯çš„è§£é‡Šå¦‚ä¸‹ï¼š drwxr-xr-xï¼šæ–‡ä»¶ç±»å‹ä»¥åŠæƒé™ï¼Œç¬¬ 1 ä½ä¸ºæ–‡ä»¶ç±»å‹å­—æ®µï¼Œå 9 ä½ä¸ºæ–‡ä»¶æƒé™å­—æ®µ 3ï¼šé“¾æ¥æ•° rootï¼šæ–‡ä»¶æ‹¥æœ‰è€… rootï¼šæ‰€å±ç¾¤ç»„ 17ï¼šæ–‡ä»¶å¤§å° May 6 00:14ï¼šæ–‡ä»¶æœ€åè¢«ä¿®æ”¹çš„æ—¶é—´ .configï¼šæ–‡ä»¶å å¸¸è§çš„æ–‡ä»¶ç±»å‹åŠå…¶å«ä¹‰æœ‰ï¼š dï¼šç›®å½• -ï¼šæ–‡ä»¶ lï¼šé“¾æ¥æ–‡ä»¶ 9 ä½çš„æ–‡ä»¶æƒé™å­—æ®µä¸­ï¼Œæ¯ 3 ä¸ªä¸ºä¸€ç»„ï¼Œå…± 3 ç»„ï¼Œæ¯ä¸€ç»„åˆ†åˆ«ä»£è¡¨å¯¹æ–‡ä»¶æ‹¥æœ‰è€…ã€æ‰€å±ç¾¤ç»„ä»¥åŠå…¶å®ƒäººçš„æ–‡ä»¶æƒé™ã€‚ä¸€ç»„æƒé™ä¸­çš„ 3 ä½åˆ†åˆ«ä¸º rã€wã€x æƒé™ï¼Œè¡¨ç¤ºå¯è¯»ã€å¯å†™ã€å¯æ‰§è¡Œã€‚ æ–‡ä»¶æ—¶é—´æœ‰ä»¥ä¸‹ä¸‰ç§ï¼š modification time (mtime)ï¼šæ–‡ä»¶çš„å†…å®¹æ›´æ–°å°±ä¼šæ›´æ–°ï¼› status time (ctime)ï¼šæ–‡ä»¶çš„çŠ¶æ€ï¼ˆæƒé™ã€å±æ€§ï¼‰æ›´æ–°å°±ä¼šæ›´æ–°ï¼› access time (atime)ï¼šè¯»å–æ–‡ä»¶æ—¶å°±ä¼šæ›´æ–°ã€‚ æ–‡ä»¶ä¸ç›®å½•çš„åŸºæœ¬æ“ä½œ1. lsåˆ—å‡ºæ–‡ä»¶æˆ–è€…ç›®å½•çš„ä¿¡æ¯ï¼Œç›®å½•çš„ä¿¡æ¯å°±æ˜¯å…¶ä¸­åŒ…å«çš„æ–‡ä»¶ã€‚ 1234# ls [-aAdfFhilnrRSt] file|dir-a ï¼šåˆ—å‡ºå…¨éƒ¨çš„æ–‡ä»¶-d ï¼šä»…åˆ—å‡ºç›®å½•æœ¬èº«-l ï¼šä»¥é•¿æ•°æ®ä¸²è¡Œåˆ—å‡ºï¼ŒåŒ…å«æ–‡ä»¶çš„å±æ€§ä¸æƒé™ç­‰ç­‰æ•°æ® 2. du ç”¨æ¥æŸ¥çœ‹ç›®å½•æˆ–æ–‡ä»¶æ‰€å ç”¨ç£ç›˜ç©ºé—´çš„å¤§å°ã€‚å¸¸ç”¨é€‰é¡¹ç»„åˆä¸ºï¼šdu -sh duå¸¸ç”¨çš„é€‰é¡¹ï¼š -hï¼šä»¥äººç±»å¯è¯»çš„æ–¹å¼æ˜¾ç¤º -aï¼šæ˜¾ç¤ºç›®å½•å ç”¨çš„ç£ç›˜ç©ºé—´å¤§å°ï¼Œè¿˜è¦æ˜¾ç¤ºå…¶ä¸‹ç›®å½•å’Œæ–‡ä»¶å ç”¨ç£ç›˜ç©ºé—´çš„å¤§å° -sï¼šæ˜¾ç¤ºç›®å½•å ç”¨çš„ç£ç›˜ç©ºé—´å¤§å°ï¼Œä¸è¦æ˜¾ç¤ºå…¶ä¸‹å­ç›®å½•å’Œæ–‡ä»¶å ç”¨çš„ç£ç›˜ç©ºé—´å¤§å° -cï¼šæ˜¾ç¤ºå‡ ä¸ªç›®å½•æˆ–æ–‡ä»¶å ç”¨çš„ç£ç›˜ç©ºé—´å¤§å°ï¼Œè¿˜è¦ç»Ÿè®¡å®ƒä»¬çš„æ€»å’Œ â€“apparent-sizeï¼šæ˜¾ç¤ºç›®å½•æˆ–æ–‡ä»¶è‡ªèº«çš„å¤§å° -l ï¼šç»Ÿè®¡ç¡¬é“¾æ¥å ç”¨ç£ç›˜ç©ºé—´çš„å¤§å° -Lï¼šç»Ÿè®¡ç¬¦å·é“¾æ¥æ‰€æŒ‡å‘çš„æ–‡ä»¶å ç”¨çš„ç£ç›˜ç©ºé—´å¤§å° du -sh : æŸ¥çœ‹å½“å‰ç›®å½•æ€»å…±å çš„å®¹é‡ã€‚è€Œä¸å•ç‹¬åˆ—å‡ºå„å­é¡¹å ç”¨çš„å®¹é‡ du -lh â€“max-depth=1 : æŸ¥çœ‹å½“å‰ç›®å½•ä¸‹ä¸€çº§å­æ–‡ä»¶å’Œå­ç›®å½•å ç”¨çš„ç£ç›˜å®¹é‡ã€‚ du -sh * | sort -n ç»Ÿè®¡å½“å‰æ–‡ä»¶å¤¹(ç›®å½•)å¤§å°ï¼Œå¹¶æŒ‰æ–‡ä»¶å¤§å°æ’åºdu -sk filename æŸ¥çœ‹æŒ‡å®šæ–‡ä»¶å¤§å° 3. mkdiråˆ›å»ºç›®å½•ã€‚ 123# mkdir [-mp] ç›®å½•åç§°-m ï¼šé…ç½®ç›®å½•æƒé™-p ï¼šé€’å½’åˆ›å»ºç›®å½• 4. rmdiråˆ é™¤ç›®å½•ï¼Œç›®å½•å¿…é¡»ä¸ºç©ºã€‚ 12rmdir [-p] ç›®å½•åç§°-p ï¼šé€’å½’åˆ é™¤ç›®å½• 5. touchæ›´æ–°æ–‡ä»¶æ—¶é—´æˆ–è€…å»ºç«‹æ–°æ–‡ä»¶ã€‚ 123456# touch [-acdmt] filename-a ï¼š æ›´æ–° atime-c ï¼š æ›´æ–° ctimeï¼Œè‹¥è¯¥æ–‡ä»¶ä¸å­˜åœ¨åˆ™ä¸å»ºç«‹æ–°æ–‡ä»¶-m ï¼š æ›´æ–° mtime-d ï¼š åé¢å¯ä»¥æ¥æ›´æ–°æ—¥æœŸè€Œä¸ä½¿ç”¨å½“å‰æ—¥æœŸï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ --date=\"æ—¥æœŸæˆ–æ—¶é—´\"-t ï¼š åé¢å¯ä»¥æ¥æ›´æ–°æ—¶é—´è€Œä¸ä½¿ç”¨å½“å‰æ—¶é—´ï¼Œæ ¼å¼ä¸º[YYYYMMDDhhmm] 6. cpå¤åˆ¶æ–‡ä»¶ã€‚å¦‚æœæºæ–‡ä»¶æœ‰ä¸¤ä¸ªä»¥ä¸Šï¼Œåˆ™ç›®çš„æ–‡ä»¶ä¸€å®šè¦æ˜¯ç›®å½•æ‰è¡Œã€‚ 12345678cp [-adfilprsu] source destination-a ï¼šç›¸å½“äº -dr --preserve=all-d ï¼šè‹¥æ¥æºæ–‡ä»¶ä¸ºé“¾æ¥æ–‡ä»¶ï¼Œåˆ™å¤åˆ¶é“¾æ¥æ–‡ä»¶å±æ€§è€Œéæ–‡ä»¶æœ¬èº«-i ï¼šè‹¥ç›®æ ‡æ–‡ä»¶å·²ç»å­˜åœ¨æ—¶ï¼Œåœ¨è¦†ç›–å‰ä¼šå…ˆè¯¢é—®-p ï¼šè¿åŒæ–‡ä»¶çš„å±æ€§ä¸€èµ·å¤åˆ¶è¿‡å»-r ï¼šé€’å½’å¤åˆ¶-u ï¼šdestination æ¯” source æ—§æ‰æ›´æ–° destinationï¼Œæˆ– destination ä¸å­˜åœ¨çš„æƒ…å†µä¸‹æ‰å¤åˆ¶--preserve=all ï¼šé™¤äº† -p çš„æƒé™ç›¸å…³å‚æ•°å¤–ï¼Œè¿˜åŠ å…¥ SELinux çš„å±æ€§, links, xattr ç­‰ä¹Ÿå¤åˆ¶äº† 7. rmåˆ é™¤æ–‡ä»¶ã€‚ 12# rm [-fir] æ–‡ä»¶æˆ–ç›®å½•-r ï¼šé€’å½’åˆ é™¤ 8. mvç§»åŠ¨æ–‡ä»¶ã€‚ 123# mv [-fiu] source destination# mv [options] source1 source2 source3 .... directory-f ï¼š force å¼ºåˆ¶çš„æ„æ€ï¼Œå¦‚æœç›®æ ‡æ–‡ä»¶å·²ç»å­˜åœ¨ï¼Œä¸ä¼šè¯¢é—®è€Œç›´æ¥è¦†ç›– ä¿®æ”¹æƒé™å¯ä»¥å°†ä¸€ç»„æƒé™ç”¨æ•°å­—æ¥è¡¨ç¤ºï¼Œæ­¤æ—¶ä¸€ç»„æƒé™çš„ 3 ä¸ªä½å½“åšäºŒè¿›åˆ¶æ•°å­—çš„ä½ï¼Œä»å·¦åˆ°å³æ¯ä¸ªä½çš„æƒå€¼ä¸º 4ã€2ã€1ï¼Œå³æ¯ä¸ªæƒé™å¯¹åº”çš„æ•°å­—æƒå€¼ä¸º r : 4ã€w : 2ã€x : 1ã€‚ 1# chmod [-R] xyz dirname/filename ç¤ºä¾‹ï¼šå°† .bashrc æ–‡ä»¶çš„æƒé™ä¿®æ”¹ä¸º -rwxr-xrâ€“ã€‚ 1# chmod 754 .bashrc ä¹Ÿå¯ä»¥ä½¿ç”¨ç¬¦å·æ¥è®¾å®šæƒé™ã€‚ 12345678# chmod [ugoa] [+-=] [rwx] dirname/filename- uï¼šæ‹¥æœ‰è€…- gï¼šæ‰€å±ç¾¤ç»„- oï¼šå…¶ä»–äºº- aï¼šæ‰€æœ‰äºº- +ï¼šæ·»åŠ æƒé™- -ï¼šç§»é™¤æƒé™- =ï¼šè®¾å®šæƒé™ ç¤ºä¾‹ï¼šä¸º .bashrc æ–‡ä»¶çš„æ‰€æœ‰ç”¨æˆ·æ·»åŠ å†™æƒé™ã€‚ 1# chmod a+w .bashrc é»˜è®¤æƒé™ æ–‡ä»¶é»˜è®¤æƒé™ï¼šæ–‡ä»¶é»˜è®¤æ²¡æœ‰å¯æ‰§è¡Œæƒé™ï¼Œå› æ­¤ä¸º 666ï¼Œä¹Ÿå°±æ˜¯ -rw-rw-rw- ã€‚ ç›®å½•é»˜è®¤æƒé™ï¼šç›®å½•å¿…é¡»è¦èƒ½å¤Ÿè¿›å…¥ï¼Œä¹Ÿå°±æ˜¯å¿…é¡»æ‹¥æœ‰å¯æ‰§è¡Œæƒé™ï¼Œå› æ­¤ä¸º 777 ï¼Œä¹Ÿå°±æ˜¯ drwxrwxrwxã€‚ å¯ä»¥é€šè¿‡ umask è®¾ç½®æˆ–è€…æŸ¥çœ‹é»˜è®¤æƒé™ï¼Œé€šå¸¸ä»¥æ©ç çš„å½¢å¼æ¥è¡¨ç¤ºï¼Œä¾‹å¦‚ 002 è¡¨ç¤ºå…¶å®ƒç”¨æˆ·çš„æƒé™å»é™¤äº†ä¸€ä¸ª 2 çš„æƒé™ï¼Œä¹Ÿå°±æ˜¯å†™æƒé™ï¼Œå› æ­¤å»ºç«‹æ–°æ–‡ä»¶æ—¶é»˜è®¤çš„æƒé™ä¸º -rw-rw-râ€“ã€‚ ç›®å½•çš„æƒé™æ–‡ä»¶åä¸æ˜¯å­˜å‚¨åœ¨ä¸€ä¸ªæ–‡ä»¶çš„å†…å®¹ä¸­ï¼Œè€Œæ˜¯å­˜å‚¨åœ¨ä¸€ä¸ªæ–‡ä»¶æ‰€åœ¨çš„ç›®å½•ä¸­ã€‚å› æ­¤ï¼Œæ‹¥æœ‰æ–‡ä»¶çš„ w æƒé™å¹¶ä¸èƒ½å¯¹æ–‡ä»¶åè¿›è¡Œä¿®æ”¹ã€‚ ç›®å½•å­˜å‚¨æ–‡ä»¶åˆ—è¡¨ï¼Œä¸€ä¸ªç›®å½•çš„æƒé™ä¹Ÿå°±æ˜¯å¯¹å…¶æ–‡ä»¶åˆ—è¡¨çš„æƒé™ã€‚å› æ­¤ï¼Œç›®å½•çš„ r æƒé™è¡¨ç¤ºå¯ä»¥è¯»å–æ–‡ä»¶åˆ—è¡¨ï¼›w æƒé™è¡¨ç¤ºå¯ä»¥ä¿®æ”¹æ–‡ä»¶åˆ—è¡¨ï¼Œå…·ä½“æ¥è¯´ï¼Œå°±æ˜¯æ·»åŠ åˆ é™¤æ–‡ä»¶ï¼Œå¯¹æ–‡ä»¶åè¿›è¡Œä¿®æ”¹ï¼›x æƒé™å¯ä»¥è®©è¯¥ç›®å½•æˆä¸ºå·¥ä½œç›®å½•ï¼Œx æƒé™æ˜¯ r å’Œ w æƒé™çš„åŸºç¡€ï¼Œå¦‚æœä¸èƒ½ä½¿ä¸€ä¸ªç›®å½•æˆä¸ºå·¥ä½œç›®å½•ï¼Œä¹Ÿå°±æ²¡åŠæ³•è¯»å–æ–‡ä»¶åˆ—è¡¨ä»¥åŠå¯¹æ–‡ä»¶åˆ—è¡¨è¿›è¡Œä¿®æ”¹äº†ã€‚ é“¾æ¥ 123# ln [-sf] source_filename dist_filename-s ï¼šé»˜è®¤æ˜¯å®ä½“é“¾æ¥ï¼ŒåŠ  -s ä¸ºç¬¦å·é“¾æ¥-f ï¼šå¦‚æœç›®æ ‡æ–‡ä»¶å­˜åœ¨æ—¶ï¼Œå…ˆåˆ é™¤ç›®æ ‡æ–‡ä»¶ 1. å®ä½“é“¾æ¥åœ¨ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªæ¡ç›®ï¼Œè®°å½•ç€æ–‡ä»¶åä¸ inode ç¼–å·ï¼Œè¿™ä¸ª inode å°±æ˜¯æºæ–‡ä»¶çš„ inodeã€‚ åˆ é™¤ä»»æ„ä¸€ä¸ªæ¡ç›®ï¼Œæ–‡ä»¶è¿˜æ˜¯å­˜åœ¨ï¼Œåªè¦å¼•ç”¨æ•°é‡ä¸ä¸º 0ã€‚ æœ‰ä»¥ä¸‹é™åˆ¶ï¼šä¸èƒ½è·¨è¶Šæ–‡ä»¶ç³»ç»Ÿã€ä¸èƒ½å¯¹ç›®å½•è¿›è¡Œé“¾æ¥ã€‚ 1234# ln /etc/crontab .# ll -i /etc/crontab crontab34474855 -rw-r--r--. 2 root root 451 Jun 10 2014 crontab34474855 -rw-r--r--. 2 root root 451 Jun 10 2014 /etc/crontab 2. ç¬¦å·é“¾æ¥ç¬¦å·é“¾æ¥æ–‡ä»¶ä¿å­˜ç€æºæ–‡ä»¶æ‰€åœ¨çš„ç»å¯¹è·¯å¾„ï¼Œåœ¨è¯»å–æ—¶ä¼šå®šä½åˆ°æºæ–‡ä»¶ä¸Šï¼Œå¯ä»¥ç†è§£ä¸º Windows çš„å¿«æ·æ–¹å¼ã€‚ å½“æºæ–‡ä»¶è¢«åˆ é™¤äº†ï¼Œé“¾æ¥æ–‡ä»¶å°±æ‰“ä¸å¼€äº†ã€‚ å› ä¸ºè®°å½•çš„æ˜¯è·¯å¾„ï¼Œæ‰€ä»¥å¯ä»¥ä¸ºç›®å½•å»ºç«‹ç¬¦å·é“¾æ¥ã€‚ 123# ll -i /etc/crontab /root/crontab234474855 -rw-r--r--. 2 root root 451 Jun 10 2014 /etc/crontab53745909 lrwxrwxrwx. 1 root root 12 Jun 23 22:31 /root/crontab2 -&gt; /etc/crontab è·å–æ–‡ä»¶å†…å®¹å®¹)1. catå–å¾—æ–‡ä»¶å†…å®¹ã€‚ 12# cat [-AbEnTv] filename-n ï¼šæ‰“å°å‡ºè¡Œå·ï¼Œè¿åŒç©ºç™½è¡Œä¹Ÿä¼šæœ‰è¡Œå·ï¼Œ-b ä¸ä¼š 2. tacæ˜¯ cat çš„åå‘æ“ä½œï¼Œä»æœ€åä¸€è¡Œå¼€å§‹æ‰“å°ã€‚ 3. moreå’Œ cat ä¸åŒçš„æ˜¯å®ƒå¯ä»¥ä¸€é¡µä¸€é¡µæŸ¥çœ‹æ–‡ä»¶å†…å®¹ï¼Œæ¯”è¾ƒé€‚åˆå¤§æ–‡ä»¶çš„æŸ¥çœ‹ã€‚ 4. lesså’Œ more ç±»ä¼¼ï¼Œä½†æ˜¯å¤šäº†ä¸€ä¸ªå‘å‰ç¿»é¡µçš„åŠŸèƒ½ã€‚ 5. headå–å¾—æ–‡ä»¶å‰å‡ è¡Œã€‚ 12# head [-n number] filename-n ï¼šåé¢æ¥æ•°å­—ï¼Œä»£è¡¨æ˜¾ç¤ºå‡ è¡Œçš„æ„æ€ 6. tailæ˜¯ head çš„åå‘æ“ä½œï¼Œåªæ˜¯å–å¾—æ˜¯åå‡ è¡Œã€‚ 7. odä»¥å­—ç¬¦æˆ–è€…åå…­è¿›åˆ¶çš„å½¢å¼æ˜¾ç¤ºäºŒè¿›åˆ¶æ–‡ä»¶ã€‚ æŒ‡ä»¤ä¸æ–‡ä»¶æœç´¢1. whichæŒ‡ä»¤æœç´¢ã€‚ 12# which [-a] command-a ï¼šå°†æ‰€æœ‰æŒ‡ä»¤åˆ—å‡ºï¼Œè€Œä¸æ˜¯åªåˆ—ç¬¬ä¸€ä¸ª 2. whereisæ–‡ä»¶æœç´¢ã€‚é€Ÿåº¦æ¯”è¾ƒå¿«ï¼Œå› ä¸ºå®ƒåªæœç´¢å‡ ä¸ªç‰¹å®šçš„ç›®å½•ã€‚ 1# whereis [-bmsu] dirname/filename 3. locateæ–‡ä»¶æœç´¢ã€‚å¯ä»¥ç”¨å…³é”®å­—æˆ–è€…æ­£åˆ™è¡¨è¾¾å¼è¿›è¡Œæœç´¢ã€‚ locate ä½¿ç”¨ /var/lib/mlocate/ è¿™ä¸ªæ•°æ®åº“æ¥è¿›è¡Œæœç´¢ï¼Œå®ƒå­˜å‚¨åœ¨å†…å­˜ä¸­ï¼Œå¹¶ä¸”æ¯å¤©æ›´æ–°ä¸€æ¬¡ï¼Œæ‰€ä»¥æ— æ³•ç”¨ locate æœç´¢æ–°å»ºçš„æ–‡ä»¶ã€‚å¯ä»¥ä½¿ç”¨ updatedb æ¥ç«‹å³æ›´æ–°æ•°æ®åº“ã€‚ 12# locate [-ir] keyword-rï¼šæ­£åˆ™è¡¨è¾¾å¼ 4. findæ–‡ä»¶æœç´¢ã€‚å¯ä»¥ä½¿ç”¨æ–‡ä»¶çš„å±æ€§å’Œæƒé™è¿›è¡Œæœç´¢ã€‚ 12# find [basedir] [option]example: find . -name \"shadow*\" â‘  ä¸æ—¶é—´æœ‰å…³çš„é€‰é¡¹ 1234-mtime n ï¼šåˆ—å‡ºåœ¨ n å¤©å‰çš„é‚£ä¸€å¤©ä¿®æ”¹è¿‡å†…å®¹çš„æ–‡ä»¶-mtime +n ï¼šåˆ—å‡ºåœ¨ n å¤©ä¹‹å‰ (ä¸å« n å¤©æœ¬èº«) ä¿®æ”¹è¿‡å†…å®¹çš„æ–‡ä»¶-mtime -n ï¼šåˆ—å‡ºåœ¨ n å¤©ä¹‹å†… (å« n å¤©æœ¬èº«) ä¿®æ”¹è¿‡å†…å®¹çš„æ–‡ä»¶-newer file ï¼š åˆ—å‡ºæ¯” file æ›´æ–°çš„æ–‡ä»¶ +4ã€4 å’Œ -4 çš„æŒ‡ç¤ºçš„æ—¶é—´èŒƒå›´å¦‚ä¸‹ï¼š â‘¡ ä¸æ–‡ä»¶æ‹¥æœ‰è€…å’Œæ‰€å±ç¾¤ç»„æœ‰å…³çš„é€‰é¡¹ 123456-uid n-gid n-user name-group name-nouser ï¼šæœç´¢æ‹¥æœ‰è€…ä¸å­˜åœ¨ /etc/passwd çš„æ–‡ä»¶-nogroupï¼šæœç´¢æ‰€å±ç¾¤ç»„ä¸å­˜åœ¨äº /etc/group çš„æ–‡ä»¶ â‘¢ ä¸æ–‡ä»¶æƒé™å’Œåç§°æœ‰å…³çš„é€‰é¡¹ 123456-name filename-size [+-]SIZEï¼šæœå¯»æ¯” SIZE è¿˜è¦å¤§ (+) æˆ–å° (-) çš„æ–‡ä»¶ã€‚è¿™ä¸ª SIZE çš„è§„æ ¼æœ‰ï¼šc: ä»£è¡¨ byteï¼Œk: ä»£è¡¨ 1024bytesã€‚æ‰€ä»¥ï¼Œè¦æ‰¾æ¯” 50KB è¿˜è¦å¤§çš„æ–‡ä»¶ï¼Œå°±æ˜¯ -size +50k-type TYPE-perm mode ï¼šæœç´¢æƒé™ç­‰äº mode çš„æ–‡ä»¶-perm -mode ï¼šæœç´¢æƒé™åŒ…å« mode çš„æ–‡ä»¶-perm /mode ï¼šæœç´¢æƒé™åŒ…å«ä»»ä¸€ mode çš„æ–‡ä»¶ å…­ã€å‹ç¼©ä¸æ‰“åŒ…å‹ç¼©æ–‡ä»¶åLinux åº•ä¸‹æœ‰å¾ˆå¤šå‹ç¼©æ–‡ä»¶åï¼Œå¸¸è§çš„å¦‚ä¸‹ï¼š æ‰©å±•å å‹ç¼©ç¨‹åº *.Z compress *.zip zip *.gz gzip *.bz2 bzip2 *.xz xz *.tar tar ç¨‹åºæ‰“åŒ…çš„æ•°æ®ï¼Œæ²¡æœ‰ç»è¿‡å‹ç¼© *.tar.gz tar ç¨‹åºæ‰“åŒ…çš„æ–‡ä»¶ï¼Œç»è¿‡ gzip çš„å‹ç¼© *.tar.bz2 tar ç¨‹åºæ‰“åŒ…çš„æ–‡ä»¶ï¼Œç»è¿‡ bzip2 çš„å‹ç¼© *.tar.xz tar ç¨‹åºæ‰“åŒ…çš„æ–‡ä»¶ï¼Œç»è¿‡ xz çš„å‹ç¼© å‹ç¼©æŒ‡ä»¤1. gzipgzip æ˜¯ Linux ä½¿ç”¨æœ€å¹¿çš„å‹ç¼©æŒ‡ä»¤ï¼Œå¯ä»¥è§£å¼€ compressã€zip ä¸ gzip æ‰€å‹ç¼©çš„æ–‡ä»¶ã€‚ ç»è¿‡ gzip å‹ç¼©è¿‡ï¼Œæºæ–‡ä»¶å°±ä¸å­˜åœ¨äº†ã€‚ æœ‰ 9 ä¸ªä¸åŒçš„å‹ç¼©ç­‰çº§å¯ä»¥ä½¿ç”¨ã€‚ å¯ä»¥ä½¿ç”¨ zcatã€zmoreã€zless æ¥è¯»å–å‹ç¼©æ–‡ä»¶çš„å†…å®¹ã€‚ 123456$ gzip [-cdtv#] filename-c ï¼šå°†å‹ç¼©çš„æ•°æ®è¾“å‡ºåˆ°å±å¹•ä¸Š-d ï¼šè§£å‹ç¼©-t ï¼šæ£€éªŒå‹ç¼©æ–‡ä»¶æ˜¯å¦å‡ºé”™-v ï¼šæ˜¾ç¤ºå‹ç¼©æ¯”ç­‰ä¿¡æ¯-# ï¼š # ä¸ºæ•°å­—çš„æ„æ€ï¼Œä»£è¡¨å‹ç¼©ç­‰çº§ï¼Œæ•°å­—è¶Šå¤§å‹ç¼©æ¯”è¶Šé«˜ï¼Œé»˜è®¤ä¸º 6 2. bzip2æä¾›æ¯” gzip æ›´é«˜çš„å‹ç¼©æ¯”ã€‚ æŸ¥çœ‹å‘½ä»¤ï¼šbzcatã€bzmoreã€bzlessã€bzgrepã€‚ 12$ bzip2 [-cdkzv#] filename-k ï¼šä¿ç•™æºæ–‡ä»¶ 3. xzæä¾›æ¯” bzip2 æ›´ä½³çš„å‹ç¼©æ¯”ã€‚ å¯ä»¥çœ‹åˆ°ï¼Œgzipã€bzip2ã€xz çš„å‹ç¼©æ¯”ä¸æ–­ä¼˜åŒ–ã€‚ä¸è¿‡è¦æ³¨æ„çš„æ˜¯ï¼Œå‹ç¼©æ¯”è¶Šé«˜ï¼Œå‹ç¼©çš„æ—¶é—´ä¹Ÿè¶Šé•¿ã€‚ æŸ¥çœ‹å‘½ä»¤ï¼šxzcatã€xzmoreã€xzlessã€xzgrepã€‚ 1$ xz [-dtlkc#] filename æ‰“åŒ…å‹ç¼©æŒ‡ä»¤åªèƒ½å¯¹ä¸€ä¸ªæ–‡ä»¶è¿›è¡Œå‹ç¼©ï¼Œè€Œæ‰“åŒ…èƒ½å¤Ÿå°†å¤šä¸ªæ–‡ä»¶æ‰“åŒ…æˆä¸€ä¸ªå¤§æ–‡ä»¶ã€‚tar ä¸ä»…å¯ä»¥ç”¨äºæ‰“åŒ…ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ gzipã€bzip2ã€xz å°†æ‰“åŒ…æ–‡ä»¶è¿›è¡Œå‹ç¼©ã€‚ 123456789101112$ tar [-z|-j|-J] [cv] [-f æ–°å»ºçš„ tar æ–‡ä»¶] filename... ==æ‰“åŒ…å‹ç¼©$ tar [-z|-j|-J] [tv] [-f å·²æœ‰çš„ tar æ–‡ä»¶] ==æŸ¥çœ‹$ tar [-z|-j|-J] [xv] [-f å·²æœ‰çš„ tar æ–‡ä»¶] [-C ç›®å½•] ==è§£å‹ç¼©-z ï¼šä½¿ç”¨ zipï¼›-j ï¼šä½¿ç”¨ bzip2ï¼›-J ï¼šä½¿ç”¨ xzï¼›-c ï¼šæ–°å»ºæ‰“åŒ…æ–‡ä»¶ï¼›-t ï¼šæŸ¥çœ‹æ‰“åŒ…æ–‡ä»¶é‡Œé¢æœ‰å“ªäº›æ–‡ä»¶ï¼›-x ï¼šè§£æ‰“åŒ…æˆ–è§£å‹ç¼©çš„åŠŸèƒ½ï¼›-v ï¼šåœ¨å‹ç¼©/è§£å‹ç¼©çš„è¿‡ç¨‹ä¸­ï¼Œæ˜¾ç¤ºæ­£åœ¨å¤„ç†çš„æ–‡ä»¶åï¼›-f : filenameï¼šè¦å¤„ç†çš„æ–‡ä»¶ï¼›-C ç›®å½• ï¼š åœ¨ç‰¹å®šç›®å½•è§£å‹ç¼©ã€‚ ä½¿ç”¨æ–¹å¼ å‘½ä»¤ æ‰“åŒ…å‹ç¼© tar -jcv -f filename.tar.bz2 è¦è¢«å‹ç¼©çš„æ–‡ä»¶æˆ–ç›®å½•åç§° æŸ¥ çœ‹ tar -jtv -f filename.tar.bz2 è§£å‹ç¼© tar -jxv -f filename.tar.bz2 -C è¦è§£å‹ç¼©çš„ç›®å½• ä¸ƒã€Bashå¯ä»¥é€šè¿‡ Shell è¯·æ±‚å†…æ ¸æä¾›æœåŠ¡ï¼ŒBash æ­£æ˜¯ Shell çš„ä¸€ç§ã€‚ ç‰¹æ€§ å‘½ä»¤å†å²ï¼šè®°å½•ä½¿ç”¨è¿‡çš„å‘½ä»¤ å‘½ä»¤ä¸æ–‡ä»¶è¡¥å…¨ï¼šå¿«æ·é”®ï¼štab å‘½ååˆ«åï¼šä¾‹å¦‚ ll æ˜¯ ls -al çš„åˆ«å shell scripts é€šé…ç¬¦ï¼šä¾‹å¦‚ ls -l /usr/bin/X* åˆ—å‡º /usr/bin ä¸‹é¢æ‰€æœ‰ä»¥ X å¼€å¤´çš„æ–‡ä»¶ å˜é‡æ“ä½œå¯¹ä¸€ä¸ªå˜é‡èµ‹å€¼ç›´æ¥ä½¿ç”¨ =ã€‚ å¯¹å˜é‡å–ç”¨éœ€è¦åœ¨å˜é‡å‰åŠ ä¸Š $ ï¼Œä¹Ÿå¯ä»¥ç”¨ ${} çš„å½¢å¼ï¼› è¾“å‡ºå˜é‡ä½¿ç”¨ echo å‘½ä»¤ã€‚ 123$ x=abc$ echo $x$ echo $&#123;x&#125; å˜é‡å†…å®¹å¦‚æœæœ‰ç©ºæ ¼ï¼Œå¿…é¡»ä½¿ç”¨åŒå¼•å·æˆ–è€…å•å¼•å·ã€‚ åŒå¼•å·å†…çš„ç‰¹æ®Šå­—ç¬¦å¯ä»¥ä¿ç•™åŸæœ¬ç‰¹æ€§ï¼Œä¾‹å¦‚ x=â€lang is $LANGâ€ï¼Œåˆ™ x çš„å€¼ä¸º lang is zh_TW.UTF-8ï¼› å•å¼•å·å†…çš„ç‰¹æ®Šå­—ç¬¦å°±æ˜¯ç‰¹æ®Šå­—ç¬¦æœ¬èº«ï¼Œä¾‹å¦‚ x=â€™lang is $LANGâ€™ï¼Œåˆ™ x çš„å€¼ä¸º lang is $LANGã€‚ å¯ä»¥ä½¿ç”¨ æŒ‡ä»¤ æˆ–è€… $(æŒ‡ä»¤) çš„æ–¹å¼å°†æŒ‡ä»¤çš„æ‰§è¡Œç»“æœèµ‹å€¼ç»™å˜é‡ã€‚ä¾‹å¦‚ version=$(uname -r)ï¼Œåˆ™ version çš„å€¼ä¸º 4.15.0-22-genericã€‚ å¯ä»¥ä½¿ç”¨ export å‘½ä»¤å°†è‡ªå®šä¹‰å˜é‡è½¬æˆç¯å¢ƒå˜é‡ï¼Œç¯å¢ƒå˜é‡å¯ä»¥åœ¨å­ç¨‹åºä¸­ä½¿ç”¨ï¼Œæ‰€è°“å­ç¨‹åºå°±æ˜¯ç”±å½“å‰ Bash è€Œäº§ç”Ÿçš„å­ Bashã€‚ Bash çš„å˜é‡å¯ä»¥å£°æ˜ä¸ºæ•°ç»„å’Œæ•´æ•°æ•°å­—ã€‚æ³¨æ„æ•°å­—ç±»å‹æ²¡æœ‰æµ®ç‚¹æ•°ã€‚å¦‚æœä¸è¿›è¡Œå£°æ˜ï¼Œé»˜è®¤æ˜¯å­—ç¬¦ä¸²ç±»å‹ã€‚å˜é‡çš„å£°æ˜ä½¿ç”¨ declare å‘½ä»¤ï¼š 12345$ declare [-aixr] variable-a ï¼š å®šä¹‰ä¸ºæ•°ç»„ç±»å‹-i ï¼š å®šä¹‰ä¸ºæ•´æ•°ç±»å‹-x ï¼š å®šä¹‰ä¸ºç¯å¢ƒå˜é‡-r ï¼š å®šä¹‰ä¸º readonly ç±»å‹ ä½¿ç”¨ [ ] æ¥å¯¹æ•°ç»„è¿›è¡Œç´¢å¼•æ“ä½œï¼š 123$ array[1]=a$ array[2]=b$ echo $&#123;array[1]&#125; æŒ‡ä»¤æœç´¢é¡ºåº ä»¥ç»å¯¹æˆ–ç›¸å¯¹è·¯å¾„æ¥æ‰§è¡ŒæŒ‡ä»¤ï¼Œä¾‹å¦‚ /bin/ls æˆ–è€… ./ls ï¼› ç”±åˆ«åæ‰¾åˆ°è¯¥æŒ‡ä»¤æ¥æ‰§è¡Œï¼› ç”± Bash å†…ç½®çš„æŒ‡ä»¤æ¥æ‰§è¡Œï¼› æŒ‰ $PATH å˜é‡æŒ‡å®šçš„æœç´¢è·¯å¾„çš„é¡ºåºæ‰¾åˆ°ç¬¬ä¸€ä¸ªæŒ‡ä»¤æ¥æ‰§è¡Œã€‚ æ•°æ®æµé‡å®šå‘é‡å®šå‘æŒ‡çš„æ˜¯ä½¿ç”¨æ–‡ä»¶ä»£æ›¿æ ‡å‡†è¾“å…¥ã€æ ‡å‡†è¾“å‡ºå’Œæ ‡å‡†é”™è¯¯è¾“å‡ºã€‚ 1 ä»£ç  è¿ç®—ç¬¦ æ ‡å‡†è¾“å…¥ (stdin) 0 &lt; æˆ– &lt;&lt; æ ‡å‡†è¾“å‡º (stdout) 1 &gt; æˆ– &gt;&gt; æ ‡å‡†é”™è¯¯è¾“å‡º (stderr) 2 2&gt; æˆ– 2&gt;&gt; å…¶ä¸­ï¼Œæœ‰ä¸€ä¸ªç®­å¤´çš„è¡¨ç¤ºä»¥è¦†ç›–çš„æ–¹å¼é‡å®šå‘ï¼Œè€Œæœ‰ä¸¤ä¸ªç®­å¤´çš„è¡¨ç¤ºä»¥è¿½åŠ çš„æ–¹å¼é‡å®šå‘ã€‚ å¯ä»¥å°†ä¸éœ€è¦çš„æ ‡å‡†è¾“å‡ºä»¥åŠæ ‡å‡†é”™è¯¯è¾“å‡ºé‡å®šå‘åˆ° /dev/nullï¼Œç›¸å½“äºæ‰”è¿›åƒåœ¾ç®±ã€‚ å¦‚æœéœ€è¦å°†æ ‡å‡†è¾“å‡ºä»¥åŠæ ‡å‡†é”™è¯¯è¾“å‡ºåŒæ—¶é‡å®šå‘åˆ°ä¸€ä¸ªæ–‡ä»¶ï¼Œéœ€è¦å°†æŸä¸ªè¾“å‡ºè½¬æ¢ä¸ºå¦ä¸€ä¸ªè¾“å‡ºï¼Œä¾‹å¦‚ 2&gt;&amp;1 è¡¨ç¤ºå°†æ ‡å‡†é”™è¯¯è¾“å‡ºè½¬æ¢ä¸ºæ ‡å‡†è¾“å‡ºã€‚ 1$ find /home -name .bashrc &gt; list 2&gt;&amp;1 å…«ã€ç®¡é“æŒ‡ä»¤ç®¡é“æ˜¯å°†ä¸€ä¸ªå‘½ä»¤çš„æ ‡å‡†è¾“å‡ºä½œä¸ºå¦ä¸€ä¸ªå‘½ä»¤çš„æ ‡å‡†è¾“å…¥ï¼Œåœ¨æ•°æ®éœ€è¦ç»è¿‡å¤šä¸ªæ­¥éª¤çš„å¤„ç†ä¹‹åæ‰èƒ½å¾—åˆ°æˆ‘ä»¬æƒ³è¦çš„å†…å®¹æ—¶å°±å¯ä»¥ä½¿ç”¨ç®¡é“ã€‚ åœ¨å‘½ä»¤ä¹‹é—´ä½¿ç”¨ | åˆ†éš”å„ä¸ªç®¡é“å‘½ä»¤ã€‚ 1$ ls -al /etc | less æå–æŒ‡ä»¤cut å¯¹æ•°æ®è¿›è¡Œåˆ‡åˆ†ï¼Œå–å‡ºæƒ³è¦çš„éƒ¨åˆ†ã€‚ åˆ‡åˆ†è¿‡ç¨‹ä¸€è¡Œä¸€è¡Œåœ°è¿›è¡Œã€‚ 1234$ cut-d ï¼šåˆ†éš”ç¬¦-f ï¼šç»è¿‡ -d åˆ†éš”åï¼Œä½¿ç”¨ -f n å–å‡ºç¬¬ n ä¸ªåŒºé—´-c ï¼šä»¥å­—ç¬¦ä¸ºå•ä½å–å‡ºåŒºé—´ ç¤ºä¾‹ 1ï¼šlast æ˜¾ç¤ºç™»å…¥è€…çš„ä¿¡æ¯ï¼Œå–å‡ºç”¨æˆ·åã€‚ 123456$ lastroot pts/1 192.168.201.101 Sat Feb 7 12:35 still logged inroot pts/1 192.168.201.101 Fri Feb 6 12:13 - 18:46 (06:33)root pts/1 192.168.201.254 Thu Feb 5 22:37 - 23:53 (01:16)$ last | cut -d ' ' -f 1 ç¤ºä¾‹ 2ï¼šå°† export è¾“å‡ºçš„ä¿¡æ¯ï¼Œå–å‡ºç¬¬ 12 å­—ç¬¦ä»¥åçš„æ‰€æœ‰å­—ç¬¦ä¸²ã€‚ 12345678$ exportdeclare -x HISTCONTROL=\"ignoredups\"declare -x HISTSIZE=\"1000\"declare -x HOME=\"/home/dmtsai\"declare -x HOSTNAME=\"study.centos.vbird\".....(å…¶ä»–çœç•¥).....$ export | cut -c 12- æ’åºæŒ‡ä»¤sort ç”¨äºæ’åºã€‚ 123456789$ sort [-fbMnrtuk] [file or stdin]-f ï¼šå¿½ç•¥å¤§å°å†™-b ï¼šå¿½ç•¥æœ€å‰é¢çš„ç©ºæ ¼-M ï¼šä»¥æœˆä»½çš„åå­—æ¥æ’åºï¼Œä¾‹å¦‚ JANï¼ŒDEC-n ï¼šä½¿ç”¨æ•°å­—-r ï¼šåå‘æ’åº-u ï¼šç›¸å½“äº uniqueï¼Œé‡å¤çš„å†…å®¹åªå‡ºç°ä¸€æ¬¡-t ï¼šåˆ†éš”ç¬¦ï¼Œé»˜è®¤ä¸º tab-k ï¼šæŒ‡å®šæ’åºçš„åŒºé—´ ç¤ºä¾‹ï¼š/etc/passwd æ–‡ä»¶å†…å®¹ä»¥ : æ¥åˆ†éš”ï¼Œè¦æ±‚ä»¥ç¬¬ä¸‰åˆ—è¿›è¡Œæ’åºã€‚ 12345$ cat /etc/passwd | sort -t ':' -k 3root:x:0:0:root:/root:/bin/bashdmtsai:x:1000:1000:dmtsai:/home/dmtsai:/bin/bashalex:x:1001:1002::/home/alex:/bin/basharod:x:1002:1003::/home/arod:/bin/bash uniq å¯ä»¥å°†é‡å¤çš„æ•°æ®åªå–ä¸€ä¸ªã€‚ 123$ uniq [-ic]-i ï¼šå¿½ç•¥å¤§å°å†™-c ï¼šè¿›è¡Œè®¡æ•° ç¤ºä¾‹ï¼šå–å¾—æ¯ä¸ªäººçš„ç™»å½•æ€»æ¬¡æ•° 1234567$ last | cut -d ' ' -f 1 | sort | uniq -c16 (unknown47 dmtsai4 reboot7 root1 wtmp åŒå‘è¾“å‡ºé‡å®šå‘è¾“å‡ºé‡å®šå‘ä¼šå°†è¾“å‡ºå†…å®¹é‡å®šå‘åˆ°æ–‡ä»¶ä¸­ï¼Œè€Œ tee ä¸ä»…èƒ½å¤Ÿå®Œæˆè¿™ä¸ªåŠŸèƒ½ï¼Œè¿˜èƒ½ä¿ç•™å±å¹•ä¸Šçš„è¾“å‡ºã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä½¿ç”¨ tee æŒ‡ä»¤ï¼Œä¸€ä¸ªè¾“å‡ºä¼šåŒæ—¶ä¼ é€åˆ°æ–‡ä»¶å’Œå±å¹•ä¸Šã€‚ 1$ tee [-a] file å­—ç¬¦è½¬æ¢æŒ‡ä»¤tr ç”¨æ¥åˆ é™¤ä¸€è¡Œä¸­çš„å­—ç¬¦ï¼Œæˆ–è€…å¯¹å­—ç¬¦è¿›è¡Œæ›¿æ¢ã€‚ 12$ tr [-ds] SET1 ...-d ï¼š åˆ é™¤è¡Œä¸­ SET1 è¿™ä¸ªå­—ç¬¦ä¸² ç¤ºä¾‹ï¼Œå°† last è¾“å‡ºçš„ä¿¡æ¯æ‰€æœ‰å°å†™è½¬æ¢ä¸ºå¤§å†™ã€‚ 1$ last | tr '[a-z]' '[A-Z]' col å°† tab å­—ç¬¦è½¬ä¸ºç©ºæ ¼å­—ç¬¦ã€‚ 12$ col [-xb]-x ï¼š å°† tab é”®è½¬æ¢æˆå¯¹ç­‰çš„ç©ºæ ¼é”® expand å°† tab è½¬æ¢ä¸€å®šæ•°é‡çš„ç©ºæ ¼ï¼Œé»˜è®¤æ˜¯ 8 ä¸ªã€‚ 12$ expand [-t] file-t ï¼štab è½¬ä¸ºç©ºæ ¼çš„æ•°é‡ join å°†æœ‰ç›¸åŒæ•°æ®çš„é‚£ä¸€è¡Œåˆå¹¶åœ¨ä¸€èµ·ã€‚ 12345$ join [-ti12] file1 file2-t ï¼šåˆ†éš”ç¬¦ï¼Œé»˜è®¤ä¸ºç©ºæ ¼-i ï¼šå¿½ç•¥å¤§å°å†™çš„å·®å¼‚-1 ï¼šç¬¬ä¸€ä¸ªæ–‡ä»¶æ‰€ç”¨çš„æ¯”è¾ƒå­—æ®µ-2 ï¼šç¬¬äºŒä¸ªæ–‡ä»¶æ‰€ç”¨çš„æ¯”è¾ƒå­—æ®µ paste ç›´æ¥å°†ä¸¤è¡Œç²˜è´´åœ¨ä¸€èµ·ã€‚ 12$ paste [-d] file1 file2-d ï¼šåˆ†éš”ç¬¦ï¼Œé»˜è®¤ä¸º tab åˆ†åŒºæŒ‡ä»¤split å°†ä¸€ä¸ªæ–‡ä»¶åˆ’åˆ†æˆå¤šä¸ªæ–‡ä»¶ã€‚ 1234$ split [-bl] file PREFIX-b ï¼šä»¥å¤§å°æ¥è¿›è¡Œåˆ†åŒºï¼Œå¯åŠ å•ä½ï¼Œä¾‹å¦‚ b, k, m ç­‰-l ï¼šä»¥è¡Œæ•°æ¥è¿›è¡Œåˆ†åŒºã€‚- PREFIX ï¼šåˆ†åŒºæ–‡ä»¶çš„å‰å¯¼åç§° ä¹ã€æ­£åˆ™è¡¨è¾¾å¼grepg/re/pï¼ˆglobally search a regular expression and print)ï¼Œä½¿ç”¨æ­£åˆ™è¡¨ç¤ºå¼è¿›è¡Œå…¨å±€æŸ¥æ‰¾å¹¶æ‰“å°ã€‚ 123456$ grep [-acinv] [--color=auto] æœå¯»å­—ç¬¦ä¸² filename-c ï¼š ç»Ÿè®¡ä¸ªæ•°-i ï¼š å¿½ç•¥å¤§å°å†™-n ï¼š è¾“å‡ºè¡Œå·-v ï¼š åå‘é€‰æ‹©ï¼Œä¹Ÿå°±æ˜¯æ˜¾ç¤ºå‡ºæ²¡æœ‰ æœå¯»å­—ç¬¦ä¸² å†…å®¹çš„é‚£ä¸€è¡Œ--color=auto ï¼šæ‰¾åˆ°çš„å…³é”®å­—åŠ é¢œè‰²æ˜¾ç¤º ç¤ºä¾‹ï¼šæŠŠå«æœ‰ the å­—ç¬¦ä¸²çš„è¡Œæå–å‡ºæ¥ï¼ˆæ³¨æ„é»˜è®¤ä¼šæœ‰ â€“color=auto é€‰é¡¹ï¼Œå› æ­¤ä»¥ä¸‹å†…å®¹åœ¨ Linux ä¸­æœ‰é¢œè‰²æ˜¾ç¤º the å­—ç¬¦ä¸²ï¼‰ 123456$ grep -n 'the' regular_express.txt8:I can't finish the test.12:the symbol '*' is represented as start.15:You are the best is mean you are the no. 1.16:The world Happy is the same with \"glad\".18:google is the best tools for search keyword å› ä¸º { å’Œ } åœ¨ shell æ˜¯æœ‰ç‰¹æ®Šæ„ä¹‰çš„ï¼Œå› æ­¤å¿…é¡»è¦ä½¿ç”¨è½¬ä¹‰å­—ç¬¦è¿›è¡Œè½¬ä¹‰ã€‚ 1$ grep -n 'go\\&#123;2,5\\&#125;g' regular_express.txt printfç”¨äºæ ¼å¼åŒ–è¾“å‡ºã€‚å®ƒä¸å±äºç®¡é“å‘½ä»¤ï¼Œåœ¨ç»™ printf ä¼ æ•°æ®æ—¶éœ€è¦ä½¿ç”¨ $( ) å½¢å¼ã€‚ 1234$ printf '%10s %5i %5i %5i %8.2f \\n' $(cat printf.txt) DmTsai 80 60 92 77.33 VBird 75 55 80 70.00 Ken 60 90 70 73.33 awkæ˜¯ç”± Alfred Ahoï¼ŒPeter Weinberger, å’Œ Brian Kernighan åˆ›é€ ï¼Œawk è¿™ä¸ªåå­—å°±æ˜¯è¿™ä¸‰ä¸ªåˆ›å§‹äººåå­—çš„é¦–å­—æ¯ã€‚ awk æ¯æ¬¡å¤„ç†ä¸€è¡Œï¼Œå¤„ç†çš„æœ€å°å•ä½æ˜¯å­—æ®µï¼Œæ¯ä¸ªå­—æ®µçš„å‘½åæ–¹å¼ä¸ºï¼š$nï¼Œn ä¸ºå­—æ®µå·ï¼Œä» 1 å¼€å§‹ï¼Œ$0 è¡¨ç¤ºä¸€æ•´è¡Œã€‚ ç¤ºä¾‹ï¼šå–å‡ºæœ€è¿‘äº”ä¸ªç™»å½•ç”¨æˆ·çš„ç”¨æˆ·åå’Œ IP 1234567$ last -n 5dmtsai pts/0 192.168.1.100 Tue Jul 14 17:32 still logged indmtsai pts/0 192.168.1.100 Thu Jul 9 23:36 - 02:58 (03:22)dmtsai pts/0 192.168.1.100 Thu Jul 9 17:23 - 23:36 (06:12)dmtsai pts/0 192.168.1.100 Thu Jul 9 08:02 - 08:17 (00:14)dmtsai tty1 Fri May 29 11:55 - 12:11 (00:15)$ last -n 5 | awk '&#123;print $1 \"\\t\" $3&#125;' å¯ä»¥æ ¹æ®å­—æ®µçš„æŸäº›æ¡ä»¶è¿›è¡ŒåŒ¹é…ï¼Œä¾‹å¦‚åŒ¹é…å­—æ®µå°äºæŸä¸ªå€¼çš„é‚£ä¸€è¡Œæ•°æ®ã€‚ 1$ awk 'æ¡ä»¶ç±»å‹ 1 &#123;åŠ¨ä½œ 1&#125; æ¡ä»¶ç±»å‹ 2 &#123;åŠ¨ä½œ 2&#125; ...' filename ç¤ºä¾‹ï¼š/etc/passwd æ–‡ä»¶ç¬¬ä¸‰ä¸ªå­—æ®µä¸º UIDï¼Œå¯¹ UID å°äº 10 çš„æ•°æ®è¿›è¡Œå¤„ç†ã€‚ 1234$ cat /etc/passwd | awk &apos;BEGIN &#123;FS=&quot;:&quot;&#125; $3 &lt; 10 &#123;print $1 &quot;\\t &quot; $3&#125;&apos;root 0bin 1daemon 2 awk å˜é‡ï¼š å˜é‡åç§° ä»£è¡¨æ„ä¹‰ NF æ¯ä¸€è¡Œæ‹¥æœ‰çš„å­—æ®µæ€»æ•° NR ç›®å‰æ‰€å¤„ç†çš„æ˜¯ç¬¬å‡ è¡Œæ•°æ® FS ç›®å‰çš„åˆ†éš”å­—ç¬¦ï¼Œé»˜è®¤æ˜¯ç©ºæ ¼é”® ç¤ºä¾‹ï¼šæ˜¾ç¤ºæ­£åœ¨å¤„ç†çš„è¡Œå·ä»¥åŠæ¯ä¸€è¡Œæœ‰å¤šå°‘å­—æ®µ 123456$ last -n 5 | awk '&#123;print $1 \"\\t lines: \" NR \"\\t columns: \" NF&#125;'dmtsai lines: 1 columns: 10dmtsai lines: 2 columns: 10dmtsai lines: 3 columns: 10dmtsai lines: 4 columns: 10dmtsai lines: 5 columns: 9 åã€è¿›ç¨‹ç®¡ç†æŸ¥çœ‹è¿›ç¨‹1. psæŸ¥çœ‹æŸä¸ªæ—¶é—´ç‚¹çš„è¿›ç¨‹ä¿¡æ¯ã€‚ ç¤ºä¾‹ä¸€ï¼šæŸ¥çœ‹è‡ªå·±çš„è¿›ç¨‹ 1# ps -l ç¤ºä¾‹äºŒï¼šæŸ¥çœ‹ç³»ç»Ÿæ‰€æœ‰è¿›ç¨‹ 1# ps aux ç¤ºä¾‹ä¸‰ï¼šæŸ¥çœ‹ç‰¹å®šçš„è¿›ç¨‹ 1# ps aux | grep threadx 2. pstreeæŸ¥çœ‹è¿›ç¨‹æ ‘ã€‚ ç¤ºä¾‹ï¼šæŸ¥çœ‹æ‰€æœ‰è¿›ç¨‹æ ‘ 1# pstree -A 3. topå®æ—¶æ˜¾ç¤ºè¿›ç¨‹å ç”¨èµ„æºä¿¡æ¯(cpu, å†…å­˜)ã€‚ ç¤ºä¾‹ï¼šä¸¤ç§’é’Ÿåˆ·æ–°ä¸€æ¬¡ 1# top -d 2 4. netstatæŸ¥çœ‹å ç”¨ç«¯å£çš„è¿›ç¨‹ ç¤ºä¾‹ï¼šæŸ¥çœ‹ç‰¹å®šç«¯å£çš„è¿›ç¨‹ 1# netstat -anp | grep port è¿›ç¨‹çŠ¶æ€ çŠ¶æ€ è¯´æ˜ R running or runnable (on run queue) æ­£åœ¨æ‰§è¡Œæˆ–è€…å¯æ‰§è¡Œï¼Œæ­¤æ—¶è¿›ç¨‹ä½äºæ‰§è¡Œé˜Ÿåˆ—ä¸­ã€‚ D uninterruptible sleep (usually I/O) ä¸å¯ä¸­æ–­é˜»å¡ï¼Œé€šå¸¸ä¸º IO é˜»å¡ã€‚ S interruptible sleep (waiting for an event to complete) å¯ä¸­æ–­é˜»å¡ï¼Œæ­¤æ—¶è¿›ç¨‹æ­£åœ¨ç­‰å¾…æŸä¸ªäº‹ä»¶å®Œæˆã€‚ Z zombie (terminated but not reaped by its parent) åƒµæ­»ï¼Œè¿›ç¨‹å·²ç»ç»ˆæ­¢ä½†æ˜¯å°šæœªè¢«å…¶çˆ¶è¿›ç¨‹è·å–ä¿¡æ¯ã€‚ T stopped (either by a job control signal or because it is being traced) ç»“æŸï¼Œè¿›ç¨‹æ—¢å¯ä»¥è¢«ä½œä¸šæ§åˆ¶ä¿¡å·ç»“æŸï¼Œä¹Ÿå¯èƒ½æ˜¯æ­£åœ¨è¢«è¿½è¸ªã€‚ SIGCHLDå½“ä¸€ä¸ªå­è¿›ç¨‹æ”¹å˜äº†å®ƒçš„çŠ¶æ€æ—¶ï¼ˆåœæ­¢è¿è¡Œï¼Œç»§ç»­è¿è¡Œæˆ–è€…é€€å‡ºï¼‰ï¼Œæœ‰ä¸¤ä»¶äº‹ä¼šå‘ç”Ÿåœ¨çˆ¶è¿›ç¨‹ä¸­ï¼š å¾—åˆ° SIGCHLD ä¿¡å·ï¼› waitpid() æˆ–è€… wait() è°ƒç”¨ä¼šè¿”å›ã€‚ å…¶ä¸­å­è¿›ç¨‹å‘é€çš„ SIGCHLD ä¿¡å·åŒ…å«äº†å­è¿›ç¨‹çš„ä¿¡æ¯ï¼Œæ¯”å¦‚è¿›ç¨‹ IDã€è¿›ç¨‹çŠ¶æ€ã€è¿›ç¨‹ä½¿ç”¨ CPU çš„æ—¶é—´ç­‰ã€‚ åœ¨å­è¿›ç¨‹é€€å‡ºæ—¶ï¼Œå®ƒçš„è¿›ç¨‹æè¿°ç¬¦ä¸ä¼šç«‹å³é‡Šæ”¾ï¼Œè¿™æ˜¯ä¸ºäº†è®©çˆ¶è¿›ç¨‹å¾—åˆ°å­è¿›ç¨‹ä¿¡æ¯ï¼Œçˆ¶è¿›ç¨‹é€šè¿‡ wait() å’Œ waitpid() æ¥è·å¾—ä¸€ä¸ªå·²ç»é€€å‡ºçš„å­è¿›ç¨‹çš„ä¿¡æ¯ã€‚ wait()1pid_t wait(int *status) çˆ¶è¿›ç¨‹è°ƒç”¨ wait() ä¼šä¸€ç›´é˜»å¡ï¼Œç›´åˆ°æ”¶åˆ°ä¸€ä¸ªå­è¿›ç¨‹é€€å‡ºçš„ SIGCHLD ä¿¡å·ï¼Œä¹‹å wait() å‡½æ•°ä¼šé”€æ¯å­è¿›ç¨‹å¹¶è¿”å›ã€‚ å¦‚æœæˆåŠŸï¼Œè¿”å›è¢«æ”¶é›†çš„å­è¿›ç¨‹çš„è¿›ç¨‹ IDï¼›å¦‚æœè°ƒç”¨è¿›ç¨‹æ²¡æœ‰å­è¿›ç¨‹ï¼Œè°ƒç”¨å°±ä¼šå¤±è´¥ï¼Œæ­¤æ—¶è¿”å› -1ï¼ŒåŒæ—¶ errno è¢«ç½®ä¸º ECHILDã€‚ å‚æ•° status ç”¨æ¥ä¿å­˜è¢«æ”¶é›†çš„å­è¿›ç¨‹é€€å‡ºæ—¶çš„ä¸€äº›çŠ¶æ€ï¼Œå¦‚æœå¯¹è¿™ä¸ªå­è¿›ç¨‹æ˜¯å¦‚ä½•æ­»æ‰çš„æ¯«ä¸åœ¨æ„ï¼Œåªæƒ³æŠŠè¿™ä¸ªå­è¿›ç¨‹æ¶ˆç­æ‰ï¼Œå¯ä»¥è®¾ç½®è¿™ä¸ªå‚æ•°ä¸º NULLã€‚ waitpid()1pid_t waitpid(pid_t pid, int *status, int options) ä½œç”¨å’Œ wait() å®Œå…¨ç›¸åŒï¼Œä½†æ˜¯å¤šäº†ä¸¤ä¸ªå¯ç”±ç”¨æˆ·æ§åˆ¶çš„å‚æ•° pid å’Œ optionsã€‚ pid å‚æ•°æŒ‡ç¤ºä¸€ä¸ªå­è¿›ç¨‹çš„ IDï¼Œè¡¨ç¤ºåªå…³å¿ƒè¿™ä¸ªå­è¿›ç¨‹é€€å‡ºçš„ SIGCHLD ä¿¡å·ã€‚å¦‚æœ pid=-1 æ—¶ï¼Œé‚£ä¹ˆå’Œ wait() ä½œç”¨ç›¸åŒï¼Œéƒ½æ˜¯å…³å¿ƒæ‰€æœ‰å­è¿›ç¨‹é€€å‡ºçš„ SIGCHLD ä¿¡å·ã€‚ options å‚æ•°ä¸»è¦æœ‰ WNOHANG å’Œ WUNTRACED ä¸¤ä¸ªé€‰é¡¹ï¼ŒWNOHANG å¯ä»¥ä½¿ waitpid() è°ƒç”¨å˜æˆéé˜»å¡çš„ï¼Œä¹Ÿå°±æ˜¯è¯´å®ƒä¼šç«‹å³è¿”å›ï¼Œçˆ¶è¿›ç¨‹å¯ä»¥ç»§ç»­æ‰§è¡Œå…¶å®ƒä»»åŠ¡ã€‚ å­¤å„¿è¿›ç¨‹ä¸€ä¸ªçˆ¶è¿›ç¨‹é€€å‡ºï¼Œè€Œå®ƒçš„ä¸€ä¸ªæˆ–å¤šä¸ªå­è¿›ç¨‹è¿˜åœ¨è¿è¡Œï¼Œé‚£ä¹ˆè¿™äº›å­è¿›ç¨‹å°†æˆä¸ºå­¤å„¿è¿›ç¨‹ã€‚ å­¤å„¿è¿›ç¨‹å°†è¢« init è¿›ç¨‹ï¼ˆè¿›ç¨‹å·ä¸º 1ï¼‰æ‰€æ”¶å…»ï¼Œå¹¶ç”± init è¿›ç¨‹å¯¹å®ƒä»¬å®ŒæˆçŠ¶æ€æ”¶é›†å·¥ä½œã€‚ ç”±äºå­¤å„¿è¿›ç¨‹ä¼šè¢« init è¿›ç¨‹æ”¶å…»ï¼Œæ‰€ä»¥å­¤å„¿è¿›ç¨‹ä¸ä¼šå¯¹ç³»ç»Ÿé€ æˆå±å®³ã€‚ åƒµå°¸è¿›ç¨‹ä¸€ä¸ªå­è¿›ç¨‹çš„è¿›ç¨‹æè¿°ç¬¦åœ¨å­è¿›ç¨‹é€€å‡ºæ—¶ä¸ä¼šé‡Šæ”¾ï¼Œåªæœ‰å½“çˆ¶è¿›ç¨‹é€šè¿‡ wait() æˆ– waitpid() è·å–äº†å­è¿›ç¨‹ä¿¡æ¯åæ‰ä¼šé‡Šæ”¾ã€‚å¦‚æœå­è¿›ç¨‹é€€å‡ºï¼Œè€Œçˆ¶è¿›ç¨‹å¹¶æ²¡æœ‰è°ƒç”¨ wait() æˆ– waitpid()ï¼Œé‚£ä¹ˆå­è¿›ç¨‹çš„è¿›ç¨‹æè¿°ç¬¦ä»ç„¶ä¿å­˜åœ¨ç³»ç»Ÿä¸­ï¼Œè¿™ç§è¿›ç¨‹ç§°ä¹‹ä¸ºåƒµå°¸è¿›ç¨‹ã€‚ åƒµå°¸è¿›ç¨‹é€šè¿‡ ps å‘½ä»¤æ˜¾ç¤ºå‡ºæ¥çš„çŠ¶æ€ä¸º Zï¼ˆzombieï¼‰ã€‚ ç³»ç»Ÿæ‰€èƒ½ä½¿ç”¨çš„è¿›ç¨‹å·æ˜¯æœ‰é™çš„ï¼Œå¦‚æœäº§ç”Ÿå¤§é‡åƒµå°¸è¿›ç¨‹ï¼Œå°†å› ä¸ºæ²¡æœ‰å¯ç”¨çš„è¿›ç¨‹å·è€Œå¯¼è‡´ç³»ç»Ÿä¸èƒ½äº§ç”Ÿæ–°çš„è¿›ç¨‹ã€‚ è¦æ¶ˆç­ç³»ç»Ÿä¸­å¤§é‡çš„åƒµå°¸è¿›ç¨‹ï¼Œåªéœ€è¦å°†å…¶çˆ¶è¿›ç¨‹æ€æ­»ï¼Œæ­¤æ—¶åƒµå°¸è¿›ç¨‹å°±ä¼šå˜æˆå­¤å„¿è¿›ç¨‹ï¼Œä»è€Œè¢« init è¿›ç¨‹æ‰€æ”¶å…»ï¼Œè¿™æ · init è¿›ç¨‹å°±ä¼šé‡Šæ”¾æ‰€æœ‰çš„åƒµå°¸è¿›ç¨‹æ‰€å æœ‰çš„èµ„æºï¼Œä»è€Œç»“æŸåƒµå°¸è¿›ç¨‹ã€‚ å‚è€ƒèµ„æ–™ é¸Ÿå“¥. é¸Ÿ å“¥ çš„ Linux ç§ æˆ¿ èœ åŸº ç¡€ ç¯‡ ç¬¬ ä¸‰ ç‰ˆ[J]. 2009. Linux å¹³å°ä¸Šçš„è½¯ä»¶åŒ…ç®¡ç† Linux ä¹‹å®ˆæŠ¤è¿›ç¨‹ã€åƒµæ­»è¿›ç¨‹ä¸å­¤å„¿è¿›ç¨‹ What is the difference between a symbolic link and a hard link? Linux process states GUID Partition Table è¯¦è§£ wait å’Œ waitpid å‡½æ•° IDEã€SATAã€SCSIã€SASã€FCã€SSD ç¡¬ç›˜ç±»å‹ä»‹ç» Akai IB-301S SCSI Interface for S2800,S3000 Parallel ATA ADATA XPG SX900 256GB SATA 3 SSD Review â€“ Expanded Capacity and SandForce Driven Speed Decoding UCS Invicta â€“ Part 1 ç¡¬ç›˜ Difference between SAS and SATA BIOS File system design case studies Programming Project #4 FILE SYSTEM DESIGN","categories":[],"tags":[{"name":"IT","slug":"IT","permalink":"/tags/IT/"},{"name":"æŠ€æœ¯ç¬”è®°","slug":"æŠ€æœ¯ç¬”è®°","permalink":"/tags/%E6%8A%80%E6%9C%AF%E7%AC%94%E8%AE%B0/"},{"name":"Job","slug":"Job","permalink":"/tags/Job/"},{"name":"Linux","slug":"Linux","permalink":"/tags/Linux/"}]}]}
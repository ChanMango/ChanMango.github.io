<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  
  <title>zookeeper的使用 | Hexo</title>
  
  

  

  <meta name="HandheldFriendly" content="True" />
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <!-- meta -->
  

  <!-- link -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css" />
  
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-waves@0.7.6/dist/waves.min.css">
  
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.10.1/css/all.min.css">
  

  

  
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/xaoxuu/cdn-material-x@19.9.9/css/style.css">
  

  <script>
    function setLoadingBarProgress(num) {
      document.getElementById('loading-bar').style.width=num+"%";
    }
  </script>

  
  
</head>

<body>
  
  
  <div class="cover-wrapper">
    <cover class='cover post half'>
      
        
  <h1 class='title'>Demo</h1>


  <div class="m_search">
    <form name="searchform" class="form u-search-form">
      <input type="text" class="input u-search-input" placeholder="" />
      <i class="icon fas fa-search fa-fw"></i>
    </form>
  </div>

<div class='menu navgation'>
  <ul class='h-list'>
    
      
        <li>
          <a class="nav home" href="/"
            
            
            id="home">
            <i class='fas fa-rss fa-fw'></i>&nbsp;博文
          </a>
        </li>
      
        <li>
          <a class="nav home" href="/projects/"
            
            
            id="projects">
            <i class='fas fa-code-branch fa-fw'></i>&nbsp;项目
          </a>
        </li>
      
        <li>
          <a class="nav home" href="/friends/"
            
              rel="nofollow"
            
            
            id="friends">
            <i class='fas fa-link fa-fw'></i>&nbsp;友链
          </a>
        </li>
      
        <li>
          <a class="nav home" href="/about/"
            
              rel="nofollow"
            
            
            id="about">
            <i class='fas fa-info-circle fa-fw'></i>&nbsp;关于
          </a>
        </li>
      
    
  </ul>
</div>

      
    </cover>
    <header class="l_header pure">
  <div id="loading-bar-wrapper">
    <div id="loading-bar" class="pure"></div>
  </div>

	<div class='wrapper'>
		<div class="nav-main container container--flex">
      <a class="logo flat-box" href='/' >
        
          Hexo
        
      </a>
			<div class='menu navgation'>
				<ul class='h-list'>
          
  					
  						<li>
								<a class="nav flat-box" href="/"
                  
                  
                  id="home">
									<i class='fas fa-grin fa-fw'></i>&nbsp;示例
								</a>
							</li>
      			
  						<li>
								<a class="nav flat-box" href="/categories/"
                  
                    rel="nofollow"
                  
                  
                  id="categories">
									<i class='fas fa-folder-open fa-fw'></i>&nbsp;分类
								</a>
							</li>
      			
  						<li>
								<a class="nav flat-box" href="/tags/"
                  
                    rel="nofollow"
                  
                  
                  id="tags">
									<i class='fas fa-hashtag fa-fw'></i>&nbsp;标签
								</a>
							</li>
      			
  						<li>
								<a class="nav flat-box" href="/archives/"
                  
                    rel="nofollow"
                  
                  
                  id="archives">
									<i class='fas fa-archive fa-fw'></i>&nbsp;归档
								</a>
							</li>
      			
      		
				</ul>
			</div>

			
				<div class="m_search">
					<form name="searchform" class="form u-search-form">
						<input type="text" class="input u-search-input" placeholder="Search" />
						<i class="icon fas fa-search fa-fw"></i>
					</form>
				</div>
			
			<ul class='switcher h-list'>
				
					<li class='s-search'><a class="fas fa-search fa-fw" href='javascript:void(0)'></a></li>
				
				<li class='s-menu'><a class="fas fa-bars fa-fw" href='javascript:void(0)'></a></li>
			</ul>
		</div>

		<div class='nav-sub container container--flex'>
			<a class="logo flat-box"></a>
			<ul class='switcher h-list'>
				<li class='s-comment'><a class="flat-btn fas fa-comments fa-fw" href='javascript:void(0)'></a></li>
        
          <li class='s-toc'><a class="flat-btn fas fa-list fa-fw" href='javascript:void(0)'></a></li>
        
			</ul>
		</div>
	</div>
</header>
	<aside class="menu-phone">
    <header>
		<nav class="menu navgation">
      <ul>
        
          
            <li>
							<a class="nav flat-box" href="/"
                
                
                id="home">
								<i class='fas fa-clock fa-fw'></i>&nbsp;近期文章
							</a>
            </li>
          
            <li>
							<a class="nav flat-box" href="/archives/"
                
                  rel="nofollow"
                
                
                id="archives">
								<i class='fas fa-archive fa-fw'></i>&nbsp;文章归档
							</a>
            </li>
          
            <li>
							<a class="nav flat-box" href="/projects/"
                
                
                id="projects">
								<i class='fas fa-code-branch fa-fw'></i>&nbsp;开源项目
							</a>
            </li>
          
            <li>
							<a class="nav flat-box" href="/friends/"
                
                  rel="nofollow"
                
                
                id="friends">
								<i class='fas fa-link fa-fw'></i>&nbsp;我的友链
							</a>
            </li>
          
            <li>
							<a class="nav flat-box" href="https://xaoxuu.com/wiki/material-x/"
                
                  rel="nofollow"
                
                
                id="https:xaoxuu.comwikimaterial-x">
								<i class='fas fa-book fa-fw'></i>&nbsp;主题文档
							</a>
            </li>
          
            <li>
							<a class="nav flat-box" href="/about/"
                
                  rel="nofollow"
                
                
                id="about">
								<i class='fas fa-info-circle fa-fw'></i>&nbsp;关于小站
							</a>
            </li>
          
       
      </ul>
		</nav>
    </header>
	</aside>
<script>setLoadingBarProgress(40);</script>

  </div>


  <div class="l_body">
    <div class='body-wrapper'>
      <div class='l_main'>
  

  <article id="post" class="post white-box article-type-post" itemscope itemprop="blogPost">
    


  <section class='meta'>
    
    
    <div class="meta" id="header-meta">
      
        
  
    <h1 class="title">
      <a href="/2019/10/20/zookeeper%E6%95%99%E7%A8%8B/">
        zookeeper的使用
      </a>
    </h1>
  


      
      <div class='new-meta-box'>
        
          
        
          
            
  <div class='new-meta-item author'>
    
      <a href="/" rel="nofollow">
        
          <i class="fas fa-user" aria-hidden="true"></i>
        
        <p>蜗牛君</p>
      </a>
    
  </div>


          
        
          
            <div class="new-meta-item date">
  <a class='notlink'>
    <i class="fas fa-calendar-alt" aria-hidden="true"></i>
    <p>2019-10-20</p>
  </a>
</div>

          
        
          
            

          
        
          
            
  
    <div class="new-meta-item browse busuanzi">
      <a class='notlink'>
        <i class="fas fa-eye" aria-hidden="true"></i>
        <p>
          <span id="busuanzi_value_page_pv">
            <i class="fas fa-spinner fa-spin fa-fw" aria-hidden="true"></i>
          </span>
        </p>
      </a>
    </div>
  


          
        
          
            

          
        
      </div>
      
        <hr>
      
    </div>
  </section>


    <section class="article typo">
      <div class="article-entry" itemprop="articleBody">
        <h3 id="1-zookeeper的概述"><a href="/2019/10/20/zookeeper教程/#1-zookeeper的概述" class="headerlink" title="1.zookeeper的概述"></a>1.zookeeper的概述</h3><p>Zookeeper是一个开源的分布式的，为分布式应用提供协调服务的Apache项目。</p>
<p>Zookeeper从设计模式角度来理解：是一个基于观察者模式设计的分布式服务管理框架，它负责存储和管理大家都关心的数据，然后接受观察者的注册，一旦这些数据的状态发生变化，Zookeeper就将负责通知已经在Zookeeper上注册的那些观察者做出相应的反应，从而实现集群中类似Master/Slave管理模式</p>
<p>Zookeeper=文件系统+通知机制</p>
<h3 id="2-应用场景"><a href="/2019/10/20/zookeeper教程/#2-应用场景" class="headerlink" title="2.应用场景"></a>2.应用场景</h3><p>提供的服务包括：分布式消息同步和协调机制、服务器节点动态上下线、统一配置管理、负载均衡、集群管理，分布式锁</p>
<p><img src="/2019/10/20/zookeeper教程//20181130162109952.png" alt="img"></p>
<p><img src="/2019/10/20/zookeeper教程//2018113016225522.png" alt="img"></p>
<p><img src="/2019/10/20/zookeeper教程//20181130162424349.png" alt="img"></p>
<h3 id="3-实战"><a href="/2019/10/20/zookeeper教程/#3-实战" class="headerlink" title="3.实战"></a>3.实战</h3><h4 id="3-1-安装前准备："><a href="/2019/10/20/zookeeper教程/#3-1-安装前准备：" class="headerlink" title="3.1 安装前准备："></a>3.1 安装前准备：</h4><ul>
<li><h6 id="（1）安装jdk"><a href="/2019/10/20/zookeeper教程/#（1）安装jdk" class="headerlink" title="（1）安装jdk"></a>（1）安装jdk</h6></li>
<li><h6 id="（2）通过filezilla工具拷贝zookeeper到到linux系统下"><a href="/2019/10/20/zookeeper教程/#（2）通过filezilla工具拷贝zookeeper到到linux系统下" class="headerlink" title="（2）通过filezilla工具拷贝zookeeper到到linux系统下"></a>（2）通过filezilla工具拷贝zookeeper到到linux系统下</h6></li>
<li><h6 id="（3）修改tar包权限"><a href="/2019/10/20/zookeeper教程/#（3）修改tar包权限" class="headerlink" title="（3）修改tar包权限"></a>（3）修改tar包权限</h6><p>chmod u+x zookeeper-3.4.10.tar.gz</p>
</li>
<li><h6 id="（4）解压到指定目录"><a href="/2019/10/20/zookeeper教程/#（4）解压到指定目录" class="headerlink" title="（4）解压到指定目录"></a>（4）解压到指定目录</h6><p>[atguigu@hadoop102 software]$ tar -zxvf zookeeper-3.4.10.tar.gz -C /opt/module/</p>
</li>
</ul>
<h4 id="3-2-配置修改"><a href="/2019/10/20/zookeeper教程/#3-2-配置修改" class="headerlink" title="3.2 配置修改"></a>3.2 配置修改</h4><p>将/opt/module/zookeeper-3.4.10/conf这个路径下的zoo_sample.cfg修改为zoo.cfg；</p>
<p>进入zoo.cfg文件：vim zoo.cfg</p>
<p>修改dataDir路径为</p>
<p>dataDir=/opt/module/zookeeper-3.4.10/data/zkData</p>
<p>在/opt/module/zookeeper-3.4.10/这个目录上创建data/zkData文件夹</p>
<p>mkdir -p data/zkData</p>
<h4 id="3-3-操作zookeeper"><a href="/2019/10/20/zookeeper教程/#3-3-操作zookeeper" class="headerlink" title="3.3 操作zookeeper"></a>3.3 操作zookeeper</h4><h6 id="（1）启动zookeeper"><a href="/2019/10/20/zookeeper教程/#（1）启动zookeeper" class="headerlink" title="（1）启动zookeeper"></a>（1）启动zookeeper</h6><p>[atguigu@hadoop102 zookeeper-3.4.10]$ bin/zkServer.sh start</p>
<h6 id="（2）查看进程是否启动"><a href="/2019/10/20/zookeeper教程/#（2）查看进程是否启动" class="headerlink" title="（2）查看进程是否启动"></a>（2）查看进程是否启动</h6><p>[atguigu@hadoop102 zookeeper-3.4.10]$ jps</p>
<p>4020 Jps</p>
<p>4001 QuorumPeerMain</p>
<h6 id="（3）查看状态："><a href="/2019/10/20/zookeeper教程/#（3）查看状态：" class="headerlink" title="（3）查看状态："></a>（3）查看状态：</h6><p>[atguigu@hadoop102 zookeeper-3.4.10]$ bin/zkServer.sh status</p>
<p>ZooKeeper JMX enabled by default</p>
<p>Using config: /opt/module/zookeeper-3.4.10/bin/../conf/zoo.cfg</p>
<p>Mode: standalone</p>
<h6 id="（4）启动客户端："><a href="/2019/10/20/zookeeper教程/#（4）启动客户端：" class="headerlink" title="（4）启动客户端："></a>（4）启动客户端：</h6><p>[atguigu@hadoop102 zookeeper-3.4.10]$ bin/zkCli.sh</p>
<h6 id="（5）退出客户端："><a href="/2019/10/20/zookeeper教程/#（5）退出客户端：" class="headerlink" title="（5）退出客户端："></a>（5）退出客户端：</h6><p>[zk: localhost:2181(CONNECTED) 0] quit</p>
<h6 id="（6）停止zookeeper"><a href="/2019/10/20/zookeeper教程/#（6）停止zookeeper" class="headerlink" title="（6）停止zookeeper"></a>（6）停止zookeeper</h6><p>[atguigu@hadoop102 zookeeper-3.4.10]$ bin/zkServer.sh stop</p>
<h4 id="3-4-配置参数解读"><a href="/2019/10/20/zookeeper教程/#3-4-配置参数解读" class="headerlink" title="3.4 配置参数解读"></a>3.4 配置参数解读</h4><h5 id="3-41-解读zoo-cfg-文件中参数含义"><a href="/2019/10/20/zookeeper教程/#3-41-解读zoo-cfg-文件中参数含义" class="headerlink" title="3.41 解读zoo.cfg 文件中参数含义"></a>3.41 解读zoo.cfg 文件中参数含义</h5><ul>
<li><h6 id="1）tickTime：通信心跳数，Zookeeper服务器心跳时间，单位毫秒"><a href="/2019/10/20/zookeeper教程/#1）tickTime：通信心跳数，Zookeeper服务器心跳时间，单位毫秒" class="headerlink" title="1）tickTime：通信心跳数，Zookeeper服务器心跳时间，单位毫秒"></a>1）tickTime：通信心跳数，Zookeeper服务器心跳时间，单位毫秒</h6><p>Zookeeper使用的基本时间，服务器之间或客户端与服务器之间维持心跳的时间间隔，也就是每个tickTime时间就会发送一个心跳，时间单位为毫秒。</p>
<p>它用于心跳机制，并且设置最小的session超时时间为两倍心跳时间。(session的最小超时时间是2*tickTime)</p>
</li>
<li><h6 id="2）initLimit：LF初始通信时限"><a href="/2019/10/20/zookeeper教程/#2）initLimit：LF初始通信时限" class="headerlink" title="2）initLimit：LF初始通信时限"></a>2）initLimit：LF初始通信时限</h6><p>集群中的follower跟随者服务器(F)与leader领导者服务器(L)之间初始连接时能容忍的最多心跳数（tickTime的数量），用它来限定集群中的Zookeeper服务器连接到Leader的时限。</p>
<p>投票选举新leader的初始化时间</p>
<p>Follower在启动过程中，会从Leader同步所有最新数据，然后确定自己能够对外服务的起始状态。</p>
<p>Leader允许F在initLimit时间内完成这个工作。</p>
</li>
<li><h6 id="3）syncLimit：LF同步通信时限"><a href="/2019/10/20/zookeeper教程/#3）syncLimit：LF同步通信时限" class="headerlink" title="3）syncLimit：LF同步通信时限"></a>3）syncLimit：LF同步通信时限</h6><p>集群中Leader与Follower之间的最大响应时间单位，假如响应超过syncLimit * tickTime，</p>
<p>Leader认为Follwer死掉，从服务器列表中删除Follwer。</p>
<p>在运行过程中，Leader负责与ZK集群中所有机器进行通信，例如通过一些心跳检测机制，来检测机器的存活状态。</p>
<p>如果L发出心跳包在syncLimit之后，还没有从F那收到响应，那么就认为这个F已经不在线了。</p>
</li>
<li><h6 id="4）dataDir：数据文件目录-数据持久化路径保存内存数据库快照信息的位置，如果没有其他说明，更新的事务日志也保存到数据库。"><a href="/2019/10/20/zookeeper教程/#4）dataDir：数据文件目录-数据持久化路径保存内存数据库快照信息的位置，如果没有其他说明，更新的事务日志也保存到数据库。" class="headerlink" title="4）dataDir：数据文件目录+数据持久化路径保存内存数据库快照信息的位置，如果没有其他说明，更新的事务日志也保存到数据库。"></a>4）dataDir：数据文件目录+数据持久化路径保存内存数据库快照信息的位置，如果没有其他说明，更新的事务日志也保存到数据库。</h6></li>
</ul>
<ul>
<li><h6 id="5）clientPort：客户端连接端口"><a href="/2019/10/20/zookeeper教程/#5）clientPort：客户端连接端口" class="headerlink" title="5）clientPort：客户端连接端口"></a>5）clientPort：客户端连接端口</h6><p>监听客户端连接的端口</p>
</li>
</ul>
<h3 id="4-数据结构"><a href="/2019/10/20/zookeeper教程/#4-数据结构" class="headerlink" title="4. 数据结构"></a>4. 数据结构</h3><p>ZooKeeper数据模型的结构与Unix文件系统很类似，整体上可以看作是一棵树，每个节点称做一个ZNode。</p>
<p> 很显然zookeeper集群自身维护了一套数据结构。这个存储结构是一个树形结构，其上的每一个节点，我们称之为”znode”，每一个znode默认能够存储1MB的数据，每个ZNode都可以通过其路径唯一标识</p>
<h3 id="5-节点类型"><a href="/2019/10/20/zookeeper教程/#5-节点类型" class="headerlink" title="5. 节点类型"></a>5. 节点类型</h3><h5 id="1）Znode有两种类型："><a href="/2019/10/20/zookeeper教程/#1）Znode有两种类型：" class="headerlink" title="1）Znode有两种类型："></a>1）Znode有两种类型：</h5><ul>
<li><p>短暂（ephemeral）：客户端和服务器端断开连接后，创建的节点自己删除</p>
</li>
<li><p>持久（persistent）：客户端和服务器端断开连接后，创建的节点不删除</p>
</li>
</ul>
<h5 id="2）Znode有四种形式的目录节点（默认是persistent-）"><a href="/2019/10/20/zookeeper教程/#2）Znode有四种形式的目录节点（默认是persistent-）" class="headerlink" title="2）Znode有四种形式的目录节点（默认是persistent ）"></a>2）Znode有四种形式的目录节点（默认是persistent ）</h5><ul>
<li><p>（1）持久化目录节点（PERSISTENT）</p>
<p>客户端与zookeeper断开连接后，该节点依旧存在</p>
</li>
<li><p>（2）持久化顺序编号目录节点（PERSISTENT_SEQUENTIAL）</p>
<p>客户端与zookeeper断开连接后，该节点依旧存在，只是Zookeeper给该节点名称进行顺序编号</p>
</li>
<li><p>（3）临时目录节点（EPHEMERAL）</p>
<p>客户端与zookeeper断开连接后，该节点被删除</p>
</li>
<li><p>（4）临时顺序编号目录节点（EPHEMERAL_SEQUENTIAL）</p>
<p>客户端与zookeeper断开连接后，该节点被删除，只是Zookeeper给该节点名称进行顺序编号</p>
</li>
</ul>
<h3 id="6-特点"><a href="/2019/10/20/zookeeper教程/#6-特点" class="headerlink" title="6. 特点"></a>6. 特点</h3><ul>
<li><p>1）Zookeeper：一个领导者（leader），多个跟随者（follower）组成的集群。</p>
</li>
<li><p>2）Leader负责进行投票的发起和决议，更新系统状态</p>
</li>
<li><p>3）Follower用于接收客户请求并向客户端返回结果，在选举Leader过程中参与投票</p>
</li>
<li><p>4）集群中只要有半数以上节点存活，Zookeeper集群就能正常服务。</p>
</li>
<li><p>5）全局数据一致：每个server保存一份相同的数据副本，client无论连接到哪个server，数据都是一致的。</p>
</li>
<li><p>6）更新请求顺序进行，来自同一个client的更新请求按其发送顺序依次执行。</p>
</li>
<li><p>7）数据更新原子性，一次数据更新要么成功，要么失败。</p>
</li>
<li><p>8）实时性，在一定时间范围内，client能读到最新数据。</p>
</li>
</ul>
<h3 id="7-选举机制"><a href="/2019/10/20/zookeeper教程/#7-选举机制" class="headerlink" title="7. 选举机制"></a>7. 选举机制</h3><ul>
<li><p>1）半数机制：集群中半数以上机器存活，集群可用。所以zookeeper适合装在奇数台机器上。</p>
</li>
<li><p>2）Zookeeper虽然在配置文件中并没有指定master和slave。但是，zookeeper工作时，是有一个节点为leader，其他则为follower，Leader是通过内部的选举机制临时产生的</p>
</li>
<li><p>3）以一个简单的例子来说明整个选举的过程。</p>
<p>假设有五台服务器组成的zookeeper集群，它们的id从1-5，同时它们都是最新启动的，也就是没有历史数据，在存放数据量这一点上，都是一样的。假设这些服务器依序启动，来看看会发生什么。</p>
</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">选举leader案例</span></span><br><span class="line">（1）服务器1启动，此时只有它一台服务器启动了，它发出去的报没有任何响应，所以它的选举状态一直是LOOKING状态。</span><br><span class="line"></span><br><span class="line">（2）服务器2启动，它与最开始启动的服务器1进行通信，互相交换自己的选举结果，由于两者都没有历史数据，所以id值较大的服务器2胜出，但是由于没有达到超过半数以上的服务器都同意选举它(这个例子中的半数以上是3)，所以服务器1、2还是继续保持LOOKING状态。</span><br><span class="line"></span><br><span class="line">（3）服务器3启动，根据前面的理论分析，服务器3成为服务器1、2、3中的老大，而与上面不同的是，此时有三台服务器选举了它，所以它成为了这次选举的leader。</span><br><span class="line"></span><br><span class="line">（4）服务器4启动，根据前面的分析，理论上服务器4应该是服务器1、2、3、4中最大的，但是由于前面已经有半数以上的服务器选举了服务器3，所以它只能接收当小弟的命了。</span><br><span class="line"></span><br><span class="line">（5）服务器5启动，同4一样当小弟。</span><br></pre></td></tr></table></figure>



<h3 id="8-监听器原理"><a href="/2019/10/20/zookeeper教程/#8-监听器原理" class="headerlink" title="8. 监听器原理"></a>8. 监听器原理</h3><p>监听器是一个接口，我们的代码中可以实现Wather这个接口，实现其中的process方法，方法中即我们自己的业务逻辑</p>
<p>监听器的注册是在获取数据的操作中实现：</p>
<p>getData(path,watch?)监听的事件是：节点数据变化事件</p>
<p>getChildren(path,watch?)监听的事件是：节点下的子节点增减变化事件</p>
<h3 id="9-0-分布式zookeeper的搭建"><a href="/2019/10/20/zookeeper教程/#9-0-分布式zookeeper的搭建" class="headerlink" title="9.0 分布式zookeeper的搭建"></a>9.0 分布式zookeeper的搭建</h3><h4 id="9-1-集群规划"><a href="/2019/10/20/zookeeper教程/#9-1-集群规划" class="headerlink" title="9.1 集群规划"></a>9.1 集群规划</h4><p>在hadoop2、hadoop3和hadoop4三个节点上部署Zookeeper。</p>
<h4 id="9-2-解压安装"><a href="/2019/10/20/zookeeper教程/#9-2-解压安装" class="headerlink" title="9.2 解压安装"></a>9.2 解压安装</h4><h6 id="（1）解压zookeeper安装包到-opt-module-目录下"><a href="/2019/10/20/zookeeper教程/#（1）解压zookeeper安装包到-opt-module-目录下" class="headerlink" title="（1）解压zookeeper安装包到/opt/module/目录下"></a>（1）解压zookeeper安装包到/opt/module/目录下</h6><p>[atguigu@hadoop102 software]$ tar -zxvf zookeeper-3.4.10.tar.gz -C /opt/module/</p>
<h6 id="（2）在-opt-module-zookeeper-3-4-10-这个目录下创建data-zkData"><a href="/2019/10/20/zookeeper教程/#（2）在-opt-module-zookeeper-3-4-10-这个目录下创建data-zkData" class="headerlink" title="（2）在/opt/module/zookeeper-3.4.10/这个目录下创建data/zkData"></a>（2）在/opt/module/zookeeper-3.4.10/这个目录下创建data/zkData</h6><p>mkdir -p data/zkData</p>
<h6 id="（3）重命名-opt-module-zookeeper-3-4-10-conf这个目录下的zoo-sample-cfg为zoo-cfg"><a href="/2019/10/20/zookeeper教程/#（3）重命名-opt-module-zookeeper-3-4-10-conf这个目录下的zoo-sample-cfg为zoo-cfg" class="headerlink" title="（3）重命名/opt/module/zookeeper-3.4.10/conf这个目录下的zoo_sample.cfg为zoo.cfg"></a>（3）重命名/opt/module/zookeeper-3.4.10/conf这个目录下的zoo_sample.cfg为zoo.cfg</h6><p>mv zoo_sample.cfg zoo.cfg</p>
<h4 id="9-3-配置zoo-cfg文件"><a href="/2019/10/20/zookeeper教程/#9-3-配置zoo-cfg文件" class="headerlink" title="9.3 配置zoo.cfg文件"></a>9.3 配置zoo.cfg文件</h4><h6 id="（1）具体配置"><a href="/2019/10/20/zookeeper教程/#（1）具体配置" class="headerlink" title="（1）具体配置"></a>（1）具体配置</h6><p>dataDir=/opt/module/zookeeper-3.4.10/data/zkData</p>
<p>增加如下配置</p>
<p>#######################cluster##########################</p>
<p>server.2=hadoop102:2888:3888</p>
<p>server.3=hadoop103:2888:3888</p>
<p>server.4=hadoop104:2888:3888</p>
<h6 id="（2）配置参数解读"><a href="/2019/10/20/zookeeper教程/#（2）配置参数解读" class="headerlink" title="（2）配置参数解读"></a>（2）配置参数解读</h6><p>Server.A=B:C:D。</p>
<p>A是一个数字，表示这个是第几号服务器；</p>
<p>B是这个服务器的ip地址；</p>
<p>C是这个服务器与集群中的Leader服务器交换信息的端口；</p>
<p>D是万一集群中的Leader服务器挂了，需要一个端口来重新进行选举，选出一个新的Leader，而这个端口就是用来执行选举时服务器相互通信的端口。</p>
<p>集群模式下配置一个文件myid，这个文件在dataDir目录下，这个文件里面有一个数据就是A的值，Zookeeper启动时读取此文件，拿到里面的数据与zoo.cfg里面的配置信息比较从而判断到底是哪个server。</p>
<h4 id="9-4-集群操作"><a href="/2019/10/20/zookeeper教程/#9-4-集群操作" class="headerlink" title="9.4 集群操作"></a>9.4 集群操作</h4><h6 id="（1）在-opt-module-zookeeper-3-4-10-data-zkData目录下创建一个myid的文件"><a href="/2019/10/20/zookeeper教程/#（1）在-opt-module-zookeeper-3-4-10-data-zkData目录下创建一个myid的文件" class="headerlink" title="（1）在/opt/module/zookeeper-3.4.10/data/zkData目录下创建一个myid的文件"></a>（1）在/opt/module/zookeeper-3.4.10/data/zkData目录下创建一个myid的文件</h6><p>touch myid</p>
<p>添加myid文件，注意一定要在linux里面创建，在notepad++里面很可能乱码</p>
<h6 id="（2）编辑myid文件"><a href="/2019/10/20/zookeeper教程/#（2）编辑myid文件" class="headerlink" title="（2）编辑myid文件"></a>（2）编辑myid文件</h6><p>vi myid</p>
<p>在文件中添加与server对应的编号：如2</p>
<h6 id="（3）拷贝配置好的zookeeper到其他机器上"><a href="/2019/10/20/zookeeper教程/#（3）拷贝配置好的zookeeper到其他机器上" class="headerlink" title="（3）拷贝配置好的zookeeper到其他机器上"></a>（3）拷贝配置好的zookeeper到其他机器上</h6><p>scp -r zookeeper-3.4.10/ <a href="/2019/10/20/zookeeper教程/mailto:root@hadoop3.atguigu.com">root@hadoop3.atguigu.com</a>:/opt/app/</p>
<p>scp -r zookeeper-3.4.10/ <a href="/2019/10/20/zookeeper教程/mailto:root@hadoop4.atguigu.com">root@hadoop4.atguigu.com</a>:/opt/app/</p>
<p>并分别修改myid文件中内容为3、4</p>
<h6 id="（4）分别启动zookeeper"><a href="/2019/10/20/zookeeper教程/#（4）分别启动zookeeper" class="headerlink" title="（4）分别启动zookeeper"></a>（4）分别启动zookeeper</h6><p>[root@hadoop2 zookeeper-3.4.10]# bin/zkServer.sh start</p>
<p>[root@hadoop3 zookeeper-3.4.10]# bin/zkServer.sh start</p>
<p>[root@hadoop4 zookeeper-3.4.10]# bin/zkServer.sh start</p>
<h6 id="（5）查看状态"><a href="/2019/10/20/zookeeper教程/#（5）查看状态" class="headerlink" title="（5）查看状态"></a>（5）查看状态</h6><p>[root@hadoop2 zookeeper-3.4.10]# bin/zkServer.sh status</p>
<p>JMX enabled by default</p>
<p>Using config: /opt/module/zookeeper-3.4.10/bin/../conf/zoo.cfg</p>
<p>Mode: follower</p>
<p>[root@hadoop3 zookeeper-3.4.10]# bin/zkServer.sh status</p>
<p>JMX enabled by default</p>
<p>Using config: /opt/module/zookeeper-3.4.10/bin/../conf/zoo.cfg</p>
<p>Mode: leader</p>
<p>[root@hadoop4 zookeeper-3.4.5]# bin/zkServer.sh status</p>
<p>JMX enabled by default</p>
<p>Using config: /opt/module/zookeeper-3.4.10/bin/../conf/zoo.cfg</p>
<p>Mode: follower</p>
<h4 id="9-5-客户端命令行操作"><a href="/2019/10/20/zookeeper教程/#9-5-客户端命令行操作" class="headerlink" title="9.5 客户端命令行操作"></a>9.5 客户端命令行操作</h4><h5 id="1）启动客户端"><a href="/2019/10/20/zookeeper教程/#1）启动客户端" class="headerlink" title="1）启动客户端"></a>1）启动客户端</h5><p>[atguigu@hadoop103 zookeeper-3.4.10]$ bin/zkCli.sh</p>
<h5 id="2）显示所有操作命令"><a href="/2019/10/20/zookeeper教程/#2）显示所有操作命令" class="headerlink" title="2）显示所有操作命令"></a>2）显示所有操作命令</h5><p>[zk: localhost:2181(CONNECTED) 1] help</p>
<h5 id="3）查看当前znode中所包含的内容"><a href="/2019/10/20/zookeeper教程/#3）查看当前znode中所包含的内容" class="headerlink" title="3）查看当前znode中所包含的内容"></a>3）查看当前znode中所包含的内容</h5><p>[zk: localhost:2181(CONNECTED) 0] ls /</p>
<p>[zookeeper]</p>
<h5 id="4）查看当前节点数据并能看到更新次数等数据"><a href="/2019/10/20/zookeeper教程/#4）查看当前节点数据并能看到更新次数等数据" class="headerlink" title="4）查看当前节点数据并能看到更新次数等数据"></a>4）查看当前节点数据并能看到更新次数等数据</h5><p>[zk: localhost:2181(CONNECTED) 1] ls2 /</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">根目录下的数据</span></span><br><span class="line">[zookeeper]</span><br><span class="line">cZxid = 0x0</span><br><span class="line">ctime = Thu Jan 01 08:00:00 CST 1970</span><br><span class="line">mZxid = 0x0</span><br><span class="line">mtime = Thu Jan 01 08:00:00 CST 1970</span><br><span class="line">pZxid = 0x0</span><br><span class="line">cversion = -1</span><br><span class="line">dataVersion = 0</span><br><span class="line">aclVersion = 0</span><br><span class="line">ephemeralOwner = 0x0</span><br><span class="line">dataLength = 0</span><br><span class="line">numChildren = 1</span><br></pre></td></tr></table></figure>



<h5 id="5）创建普通节点"><a href="/2019/10/20/zookeeper教程/#5）创建普通节点" class="headerlink" title="5）创建普通节点"></a>5）创建普通节点</h5><p>[zk: localhost:2181(CONNECTED) 2] create /app1 “hello app1”</p>
<p>Created /app1</p>
<p>[zk: localhost:2181(CONNECTED) 4] <strong>create /app1/server101 “192.168.1.101”</strong></p>
<p>Created /app1/server101</p>
<h5 id="6）获得节点的值"><a href="/2019/10/20/zookeeper教程/#6）获得节点的值" class="headerlink" title="6）获得节点的值"></a>6）获得节点的值</h5><p>[zk: localhost:2181(CONNECTED) 6] get /app1</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">hello app1</span><br><span class="line">cZxid = 0x20000000a</span><br><span class="line">ctime = Mon Jul 17 16:08:35 CST 2017</span><br><span class="line">mZxid = 0x20000000a</span><br><span class="line">mtime = Mon Jul 17 16:08:35 CST 2017</span><br><span class="line">pZxid = 0x20000000b</span><br><span class="line">cversion = 1</span><br><span class="line">dataVersion = 0</span><br><span class="line">aclVersion = 0</span><br><span class="line">ephemeralOwner = 0x0</span><br><span class="line">dataLength = 10</span><br><span class="line">numChildren = 1</span><br></pre></td></tr></table></figure>

<p>[zk: localhost:2181(CONNECTED) 8] <strong>get /app1/server101</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">192.168.1.101</span><br><span class="line">cZxid = 0x20000000b</span><br><span class="line">ctime = Mon Jul 17 16:11:04 CST 2017</span><br><span class="line">mZxid = 0x20000000b</span><br><span class="line">mtime = Mon Jul 17 16:11:04 CST 2017</span><br><span class="line">pZxid = 0x20000000b</span><br><span class="line">cversion = 0</span><br><span class="line">dataVersion = 0</span><br><span class="line">aclVersion = 0</span><br><span class="line">ephemeralOwner = 0x0</span><br><span class="line">dataLength = 13</span><br><span class="line">numChildren = 0</span><br></pre></td></tr></table></figure>

<h5 id="7）创建短暂节点"><a href="/2019/10/20/zookeeper教程/#7）创建短暂节点" class="headerlink" title="7）创建短暂节点"></a>7）创建短暂节点</h5><p>[zk: localhost:2181(CONNECTED) 9] create <strong>-e</strong> /app-emphemeral 8888</p>
<h6 id="（1）在当前客户端是能查看到的"><a href="/2019/10/20/zookeeper教程/#（1）在当前客户端是能查看到的" class="headerlink" title="（1）在当前客户端是能查看到的"></a>（1）在当前客户端是能查看到的</h6><p>[zk: localhost:2181(CONNECTED) 10] ls /</p>
<p>[app1, app-emphemeral, zookeeper]</p>
<h6 id="（2）退出当前客户端然后再重启启动客户端"><a href="/2019/10/20/zookeeper教程/#（2）退出当前客户端然后再重启启动客户端" class="headerlink" title="（2）退出当前客户端然后再重启启动客户端"></a>（2）退出当前客户端然后再重启启动客户端</h6><p>[zk: localhost:2181(CONNECTED) 12] quit</p>
<p>[atguigu@hadoop104 zookeeper-3.4.10]$ bin/zkCli.sh</p>
<h6 id="（3）再次查看根目录下短暂节点已经删除"><a href="/2019/10/20/zookeeper教程/#（3）再次查看根目录下短暂节点已经删除" class="headerlink" title="（3）再次查看根目录下短暂节点已经删除"></a>（3）再次查看根目录下短暂节点已经删除</h6><p>[zk: localhost:2181(CONNECTED) 0] ls /</p>
<p>[app1, zookeeper]</p>
<h5 id="8）创建带序号的节点"><a href="/2019/10/20/zookeeper教程/#8）创建带序号的节点" class="headerlink" title="8）创建带序号的节点"></a>8）创建带序号的节点</h5><h6 id="（1）先创建一个普通的根节点app2"><a href="/2019/10/20/zookeeper教程/#（1）先创建一个普通的根节点app2" class="headerlink" title="（1）先创建一个普通的根节点app2"></a>（1）先创建一个普通的根节点app2</h6><p>[zk: localhost:2181(CONNECTED) 11] create /app2 “app2”</p>
<h6 id="（2）创建带序号的节点"><a href="/2019/10/20/zookeeper教程/#（2）创建带序号的节点" class="headerlink" title="（2）创建带序号的节点"></a>（2）创建<strong>带序号</strong>的节点</h6><p>[zk: localhost:2181(CONNECTED) 13] create <strong>-s</strong> /app2/aa 888</p>
<p>Created /app2/aa0000000000</p>
<p>[zk: localhost:2181(CONNECTED) 14] create -s /app2/bb 888</p>
<p>Created /app2/bb0000000001</p>
<p>[zk: localhost:2181(CONNECTED) 15] create -s /app2/cc 888</p>
<p>Created /app2/cc0000000002</p>
<p>如果原节点下有1个节点，则再排序时从1开始，以此类推。</p>
<p>[zk: localhost:2181(CONNECTED) 16] create -s /app1/aa 888</p>
<p>Created /app1/aa0000000001</p>
<h5 id="9）修改节点数据值"><a href="/2019/10/20/zookeeper教程/#9）修改节点数据值" class="headerlink" title="9）修改节点数据值"></a>9）修改节点数据值</h5><p>[zk: localhost:2181(CONNECTED) 2] set /app1 999</p>
<h5 id="10）节点的值变化监听"><a href="/2019/10/20/zookeeper教程/#10）节点的值变化监听" class="headerlink" title="10）节点的值变化监听"></a>10）节点的值变化监听</h5><p>（1）在104主机上注册监听/app1节点数据变化</p>
<p>[zk: localhost:2181(CONNECTED) 26] get /app1 watch</p>
<p>（2）在103主机上修改/app1节点的数据</p>
<p>[zk: localhost:2181(CONNECTED) 5] set /app1  777</p>
<p>（3）观察104主机收到数据变化的监听</p>
<p>WATCHER::</p>
<p>WatchedEvent state:SyncConnected type:NodeDataChanged path:/app1</p>
<h5 id="11）节点的子节点变化监听（路径变化）"><a href="/2019/10/20/zookeeper教程/#11）节点的子节点变化监听（路径变化）" class="headerlink" title="11）节点的子节点变化监听（路径变化）"></a>11）节点的子节点变化监听（路径变化）</h5><h6 id="（1）在104主机上注册监听-app1节点的子节点变化"><a href="/2019/10/20/zookeeper教程/#（1）在104主机上注册监听-app1节点的子节点变化" class="headerlink" title="（1）在104主机上注册监听/app1节点的子节点变化"></a>（1）在104主机上注册监听/app1节点的子节点变化</h6><p>[zk: localhost:2181(CONNECTED) 1] ls /app1 watch</p>
<p>[aa0000000001, server101]</p>
<h6 id="（2）在103主机-app1节点上创建子节点"><a href="/2019/10/20/zookeeper教程/#（2）在103主机-app1节点上创建子节点" class="headerlink" title="（2）在103主机/app1节点上创建子节点"></a>（2）在103主机/app1节点上创建子节点</h6><p>[zk: localhost:2181(CONNECTED) 6] create /app1/bb 666</p>
<p>Created /app1/bb</p>
<h6 id="（3）观察104主机收到子节点变化的监听"><a href="/2019/10/20/zookeeper教程/#（3）观察104主机收到子节点变化的监听" class="headerlink" title="（3）观察104主机收到子节点变化的监听"></a>（3）观察104主机收到子节点变化的监听</h6><p>WATCHER::</p>
<p>WatchedEvent state:SyncConnected type:NodeChildrenChanged path:/app1</p>
<h5 id="12）删除节点"><a href="/2019/10/20/zookeeper教程/#12）删除节点" class="headerlink" title="12）删除节点"></a>12）删除节点</h5><p>[zk: localhost:2181(CONNECTED) 4] delete /app1/bb</p>
<h5 id="13）递归删除节点"><a href="/2019/10/20/zookeeper教程/#13）递归删除节点" class="headerlink" title="13）递归删除节点"></a>13）递归删除节点</h5><p>[zk: localhost:2181(CONNECTED) 7] rmr /app2</p>
<h5 id="14）查看节点状态"><a href="/2019/10/20/zookeeper教程/#14）查看节点状态" class="headerlink" title="14）查看节点状态"></a>14）查看节点状态</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[zk: localhost:2181(CONNECTED) 12] stat /app1</span><br><span class="line">cZxid = 0x20000000a</span><br><span class="line">ctime = Mon Jul 17 16:08:35 CST 2017</span><br><span class="line">mZxid = 0x200000018</span><br><span class="line">mtime = Mon Jul 17 16:54:38 CST 2017</span><br><span class="line">pZxid = 0x20000001c</span><br><span class="line">cversion = 4</span><br><span class="line">dataVersion = 2</span><br><span class="line">aclVersion = 0</span><br><span class="line">ephemeralOwner = 0x0</span><br><span class="line">dataLength = 3</span><br><span class="line">numChildren = 2</span><br></pre></td></tr></table></figure>

<h4 id="9-6-操作命令"><a href="/2019/10/20/zookeeper教程/#9-6-操作命令" class="headerlink" title="9.6 操作命令"></a>9.6 操作命令</h4><ul>
<li><p><strong>创建节点</strong>：create /路径 值</p>
<p>创建时的可选参数： -e（表示短暂节点）， -s（表示顺序节点）</p>
</li>
<li><p><strong>删除节点值</strong>： delete /路径</p>
</li>
<li><p><strong>递归删除</strong>：rmr /路径</p>
</li>
<li><p><strong>修改数据</strong>：set /路径 新的值</p>
</li>
<li><p><strong>获取数据</strong>：get /路径</p>
</li>
<li><p><strong>查看所有节点</strong>：ls /路径</p>
</li>
</ul>

      </div>
      
        <br>
        


  <section class='meta' id="footer-meta">
    <div class='new-meta-box'>
      
        
          <div class="new-meta-item date" itemprop="dateUpdated" datetime="2019-10-20T14:05:26+08:00">
  <a class='notlink'>
    <i class="fas fa-clock" aria-hidden="true"></i>
    <p>updated at Oct 20, 2019</p>
  </a>
</div>

        
      
        
          
  
  <div class="new-meta-item meta-tags"><a class="tag" href="/tags/IT/" rel="nofollow"><i class="fas fa-tag" aria-hidden="true"></i><p>IT</p></a></div> <div class="new-meta-item meta-tags"><a class="tag" href="/tags/%E6%8A%80%E6%9C%AF%E7%AC%94%E8%AE%B0/" rel="nofollow"><i class="fas fa-tag" aria-hidden="true"></i><p>技术笔记</p></a></div> <div class="new-meta-item meta-tags"><a class="tag" href="/tags/Job/" rel="nofollow"><i class="fas fa-tag" aria-hidden="true"></i><p>Job</p></a></div> <div class="new-meta-item meta-tags"><a class="tag" href="/tags/%E6%9C%8D%E5%8A%A1%E7%AB%AF%E5%BC%80%E5%8F%91/" rel="nofollow"><i class="fas fa-tag" aria-hidden="true"></i><p>服务端开发</p></a></div> <div class="new-meta-item meta-tags"><a class="tag" href="/tags/zookeeper/" rel="nofollow"><i class="fas fa-tag" aria-hidden="true"></i><p>zookeeper</p></a></div>


        
      
        
          
  <div class="new-meta-item share -mob-share-list">
  <div class="-mob-share-list share-body">
    
      
        <a class="-mob-share-qq" title="QQ好友" rel="external nofollow noopener noreferrer"
          
          href="http://connect.qq.com/widget/shareqq/index.html?url=/2019/10/20/zookeeper%E6%95%99%E7%A8%8B/&title=zookeeper的使用 | Hexo&summary="
          
          >
          
            <img src="https://cdn.jsdelivr.net/gh/xaoxuu/assets@19.1.9/logo/128/qq.png">
          
        </a>
      
    
      
        <a class="-mob-share-qzone" title="QQ空间" rel="external nofollow noopener noreferrer"
          
          href="https://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url=/2019/10/20/zookeeper%E6%95%99%E7%A8%8B/&title=zookeeper的使用 | Hexo&summary="
          
          >
          
            <img src="https://cdn.jsdelivr.net/gh/xaoxuu/assets@19.1.9/logo/128/qzone.png">
          
        </a>
      
    
      
        <a class="-mob-share-weibo" title="微博" rel="external nofollow noopener noreferrer"
          
          href="http://service.weibo.com/share/share.php?url=/2019/10/20/zookeeper%E6%95%99%E7%A8%8B/&title=zookeeper的使用 | Hexo&summary="
          
          >
          
            <img src="https://cdn.jsdelivr.net/gh/xaoxuu/assets@19.1.9/logo/128/weibo.png">
          
        </a>
      
    
  </div>
</div>



        
      
    </div>
  </section>


      
      
          <div class="prev-next">
              
                  <section class="prev">
                      <span class="art-item-left">
                          <h6><i class="fas fa-chevron-left" aria-hidden="true"></i>&nbsp;Previous</h6>
                          <h4>
                              <a href="/2019/10/20/Redis%E9%9D%A2%E8%AF%95/" rel="prev" title="Redis面试">
                                
                                    Redis面试
                                
                              </a>
                          </h4>
                          
                              
                              <h6 class="tags">
                                  <a class="tag" href="/tags/IT/"><i class="fas fa-tag fa-fw" aria-hidden="true"></i> IT</a> <a class="tag" href="/tags/%E6%8A%80%E6%9C%AF%E7%AC%94%E8%AE%B0/"><i class="fas fa-tag fa-fw" aria-hidden="true"></i> 技术笔记</a> <a class="tag" href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/"><i class="fas fa-tag fa-fw" aria-hidden="true"></i> 数据库</a> <a class="tag" href="/tags/Job/"><i class="fas fa-tag fa-fw" aria-hidden="true"></i> Job</a> <a class="tag" href="/tags/Redis/"><i class="fas fa-tag fa-fw" aria-hidden="true"></i> Redis</a>
                              </h6>
                          
                      </span>
                  </section>
              
              
                  <section class="next">
                      <span class="art-item-right" aria-hidden="true">
                          <h6>Next&nbsp;<i class="fas fa-chevron-right" aria-hidden="true"></i></h6>
                          <h4>
                              <a href="/2019/10/20/%E6%95%B0%E6%8D%AE%E5%BA%93/" rel="prev" title="数据库">
                                  
                                      数据库
                                  
                              </a>
                          </h4>
                          
                              
                              <h6 class="tags">
                                  <a class="tag" href="/tags/IT/"><i class="fas fa-tag fa-fw" aria-hidden="true"></i> IT</a> <a class="tag" href="/tags/%E6%8A%80%E6%9C%AF%E7%AC%94%E8%AE%B0/"><i class="fas fa-tag fa-fw" aria-hidden="true"></i> 技术笔记</a> <a class="tag" href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/"><i class="fas fa-tag fa-fw" aria-hidden="true"></i> 数据库</a> <a class="tag" href="/tags/Job/"><i class="fas fa-tag fa-fw" aria-hidden="true"></i> Job</a> <a class="tag" href="/tags/mysql/"><i class="fas fa-tag fa-fw" aria-hidden="true"></i> mysql</a>
                              </h6>
                          
                      </span>
                  </section>
              
          </div>
      
    </section>
  </article>



  <!-- 显示推荐文章和评论 -->



  






<!-- 根据页面mathjax变量决定是否加载MathJax数学公式js -->



  <script>
    window.subData = {
      title: 'zookeeper的使用',
      tools: true
    }
  </script>


</div>
<aside class='l_side'>
  
    
    
      
      
        
          
          
            
              <section class='widget author'>
  <div class='content pure'>
    
      <div class='avatar'>
        <img class='avatar' src='https://cdn.jsdelivr.net/gh/xaoxuu/assets@master/avatar/avatar.png'/>
      </div>
    
    
    
      <div class="social-wrapper">
        
          
            <a href="/atom.xml"
              class="social fas fa-rss flat-btn"
              target="_blank"
              rel="external nofollow noopener noreferrer">
            </a>
          
        
          
            <a href="mailto:dmlys@live.com"
              class="social fas fa-envelope flat-btn"
              target="_blank"
              rel="external nofollow noopener noreferrer">
            </a>
          
        
          
            <a href="https://github.com/ChanMango"
              class="social fab fa-github flat-btn"
              target="_blank"
              rel="external nofollow noopener noreferrer">
            </a>
          
        
          
            <a href="https://music.163.com/#/user/home?id=118376074"
              class="social fas fa-headphones-alt flat-btn"
              target="_blank"
              rel="external nofollow noopener noreferrer">
            </a>
          
        
      </div>
    
  </div>
</section>

            
          
        
          
          
        
          
          
        
          
          
        
          
          
        
          
          
        
          
          
        
      
        
          
          
        
          
          
            
              
  <section class='widget toc-wrapper'>
    
<header class='pure'>
  <div><i class="fas fa-list fa-fw" aria-hidden="true"></i>&nbsp;&nbsp;TOC</div>
  
    <!-- <div class='wrapper'><a class="s-toc rightBtn" rel="external nofollow noopener noreferrer" href="javascript:void(0)"><i class="fas fa-thumbtack fa-fw"></i></a></div> -->
  
</header>

    <div class='content pure'>
      <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-zookeeper的概述"><span class="toc-text">1.zookeeper的概述</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-应用场景"><span class="toc-text">2.应用场景</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-实战"><span class="toc-text">3.实战</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1-安装前准备："><span class="toc-text">3.1 安装前准备：</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#（1）安装jdk"><span class="toc-text">（1）安装jdk</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#（2）通过filezilla工具拷贝zookeeper到到linux系统下"><span class="toc-text">（2）通过filezilla工具拷贝zookeeper到到linux系统下</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#（3）修改tar包权限"><span class="toc-text">（3）修改tar包权限</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#（4）解压到指定目录"><span class="toc-text">（4）解压到指定目录</span></a></li></ol></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-配置修改"><span class="toc-text">3.2 配置修改</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-3-操作zookeeper"><span class="toc-text">3.3 操作zookeeper</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#（1）启动zookeeper"><span class="toc-text">（1）启动zookeeper</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#（2）查看进程是否启动"><span class="toc-text">（2）查看进程是否启动</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#（3）查看状态："><span class="toc-text">（3）查看状态：</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#（4）启动客户端："><span class="toc-text">（4）启动客户端：</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#（5）退出客户端："><span class="toc-text">（5）退出客户端：</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#（6）停止zookeeper"><span class="toc-text">（6）停止zookeeper</span></a></li></ol></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-4-配置参数解读"><span class="toc-text">3.4 配置参数解读</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#3-41-解读zoo-cfg-文件中参数含义"><span class="toc-text">3.41 解读zoo.cfg 文件中参数含义</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#1）tickTime：通信心跳数，Zookeeper服务器心跳时间，单位毫秒"><span class="toc-text">1）tickTime：通信心跳数，Zookeeper服务器心跳时间，单位毫秒</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#2）initLimit：LF初始通信时限"><span class="toc-text">2）initLimit：LF初始通信时限</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#3）syncLimit：LF同步通信时限"><span class="toc-text">3）syncLimit：LF同步通信时限</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#4）dataDir：数据文件目录-数据持久化路径保存内存数据库快照信息的位置，如果没有其他说明，更新的事务日志也保存到数据库。"><span class="toc-text">4）dataDir：数据文件目录+数据持久化路径保存内存数据库快照信息的位置，如果没有其他说明，更新的事务日志也保存到数据库。</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#5）clientPort：客户端连接端口"><span class="toc-text">5）clientPort：客户端连接端口</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-数据结构"><span class="toc-text">4. 数据结构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-节点类型"><span class="toc-text">5. 节点类型</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1）Znode有两种类型："><span class="toc-text">1）Znode有两种类型：</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2）Znode有四种形式的目录节点（默认是persistent-）"><span class="toc-text">2）Znode有四种形式的目录节点（默认是persistent ）</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-特点"><span class="toc-text">6. 特点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-选举机制"><span class="toc-text">7. 选举机制</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-监听器原理"><span class="toc-text">8. 监听器原理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-0-分布式zookeeper的搭建"><span class="toc-text">9.0 分布式zookeeper的搭建</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#9-1-集群规划"><span class="toc-text">9.1 集群规划</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-2-解压安装"><span class="toc-text">9.2 解压安装</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#（1）解压zookeeper安装包到-opt-module-目录下"><span class="toc-text">（1）解压zookeeper安装包到/opt/module/目录下</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#（2）在-opt-module-zookeeper-3-4-10-这个目录下创建data-zkData"><span class="toc-text">（2）在/opt/module/zookeeper-3.4.10/这个目录下创建data/zkData</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#（3）重命名-opt-module-zookeeper-3-4-10-conf这个目录下的zoo-sample-cfg为zoo-cfg"><span class="toc-text">（3）重命名/opt/module/zookeeper-3.4.10/conf这个目录下的zoo_sample.cfg为zoo.cfg</span></a></li></ol></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-3-配置zoo-cfg文件"><span class="toc-text">9.3 配置zoo.cfg文件</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#（1）具体配置"><span class="toc-text">（1）具体配置</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#（2）配置参数解读"><span class="toc-text">（2）配置参数解读</span></a></li></ol></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-4-集群操作"><span class="toc-text">9.4 集群操作</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#（1）在-opt-module-zookeeper-3-4-10-data-zkData目录下创建一个myid的文件"><span class="toc-text">（1）在/opt/module/zookeeper-3.4.10/data/zkData目录下创建一个myid的文件</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#（2）编辑myid文件"><span class="toc-text">（2）编辑myid文件</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#（3）拷贝配置好的zookeeper到其他机器上"><span class="toc-text">（3）拷贝配置好的zookeeper到其他机器上</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#（4）分别启动zookeeper"><span class="toc-text">（4）分别启动zookeeper</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#（5）查看状态"><span class="toc-text">（5）查看状态</span></a></li></ol></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-5-客户端命令行操作"><span class="toc-text">9.5 客户端命令行操作</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1）启动客户端"><span class="toc-text">1）启动客户端</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2）显示所有操作命令"><span class="toc-text">2）显示所有操作命令</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3）查看当前znode中所包含的内容"><span class="toc-text">3）查看当前znode中所包含的内容</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4）查看当前节点数据并能看到更新次数等数据"><span class="toc-text">4）查看当前节点数据并能看到更新次数等数据</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#5）创建普通节点"><span class="toc-text">5）创建普通节点</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#6）获得节点的值"><span class="toc-text">6）获得节点的值</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#7）创建短暂节点"><span class="toc-text">7）创建短暂节点</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#（1）在当前客户端是能查看到的"><span class="toc-text">（1）在当前客户端是能查看到的</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#（2）退出当前客户端然后再重启启动客户端"><span class="toc-text">（2）退出当前客户端然后再重启启动客户端</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#（3）再次查看根目录下短暂节点已经删除"><span class="toc-text">（3）再次查看根目录下短暂节点已经删除</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#8）创建带序号的节点"><span class="toc-text">8）创建带序号的节点</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#（1）先创建一个普通的根节点app2"><span class="toc-text">（1）先创建一个普通的根节点app2</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#（2）创建带序号的节点"><span class="toc-text">（2）创建带序号的节点</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#9）修改节点数据值"><span class="toc-text">9）修改节点数据值</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#10）节点的值变化监听"><span class="toc-text">10）节点的值变化监听</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#11）节点的子节点变化监听（路径变化）"><span class="toc-text">11）节点的子节点变化监听（路径变化）</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#（1）在104主机上注册监听-app1节点的子节点变化"><span class="toc-text">（1）在104主机上注册监听/app1节点的子节点变化</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#（2）在103主机-app1节点上创建子节点"><span class="toc-text">（2）在103主机/app1节点上创建子节点</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#（3）观察104主机收到子节点变化的监听"><span class="toc-text">（3）观察104主机收到子节点变化的监听</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#12）删除节点"><span class="toc-text">12）删除节点</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#13）递归删除节点"><span class="toc-text">13）递归删除节点</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#14）查看节点状态"><span class="toc-text">14）查看节点状态</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-6-操作命令"><span class="toc-text">9.6 操作命令</span></a></li></ol></li></ol>
    </div>
  </section>


            
          
        
          
          
        
          
          
        
          
          
        
          
          
        
          
          
        
      
        
          
          
        
          
          
        
          
          
            
              <section class='widget grid'>
  
<header class='pure'>
  <div><i class="fas fa-map-signs fa-fw" aria-hidden="true"></i>&nbsp;&nbsp;站内导航</div>
  
</header>

  <div class='content pure'>
    <ul class="grid navgation">
      
        <li><a class="flat-box" title="/" href="/"
          
          
          id="home">
          
            <i class="fas fa-clock fa-fw" aria-hidden="true"></i>
          
          近期文章
        </a></li>
      
        <li><a class="flat-box" title="/archives/" href="/archives/"
          
            rel="nofollow"
          
          
          id="archives">
          
            <i class="fas fa-archive fa-fw" aria-hidden="true"></i>
          
          文章归档
        </a></li>
      
        <li><a class="flat-box" title="/projects/" href="/projects/"
          
          
          id="projects">
          
            <i class="fas fa-code-branch fa-fw" aria-hidden="true"></i>
          
          开源项目
        </a></li>
      
        <li><a class="flat-box" title="/friends/" href="/friends/"
          
            rel="nofollow"
          
          
          id="friends">
          
            <i class="fas fa-link fa-fw" aria-hidden="true"></i>
          
          我的友链
        </a></li>
      
        <li><a class="flat-box" title="https://xaoxuu.com/wiki/material-x/" href="https://xaoxuu.com/wiki/material-x/"
          
            rel="nofollow"
          
          
          id="https:xaoxuu.comwikimaterial-x">
          
            <i class="fas fa-book fa-fw" aria-hidden="true"></i>
          
          主题文档
        </a></li>
      
        <li><a class="flat-box" title="/about/" href="/about/"
          
            rel="nofollow"
          
          
          id="about">
          
            <i class="fas fa-info-circle fa-fw" aria-hidden="true"></i>
          
          关于小站
        </a></li>
      
    </ul>
  </div>
</section>

            
          
        
          
          
        
          
          
        
          
          
        
          
          
        
      
        
          
          
        
          
          
        
          
          
        
          
          
            
              

            
          
        
          
          
        
          
          
        
          
          
        
      
        
          
          
        
          
          
        
          
          
        
          
          
        
          
          
            
              
  <section class='widget tagcloud'>
    
<header class='pure'>
  <div><i class="fas fa-tags fa-fw" aria-hidden="true"></i>&nbsp;&nbsp;Hot Tags</div>
  
    <a class="rightBtn"
    
      rel="nofollow"
    
    
    href="/tags/"
    title="tags/">
    <i class="fas fa-expand-arrows-alt fa-fw"></i></a>
  
</header>

    <div class='content pure'>
      <a href="/tags/Hibernate/" style="font-size: 14px; color: #999">Hibernate</a> <a href="/tags/IT/" style="font-size: 24px; color: #555">IT</a> <a href="/tags/IT-%E6%8A%80%E6%9C%AF%E7%AC%94%E8%AE%B0-Job-zookeeper/" style="font-size: 14px; color: #999">IT - 技术笔记 - Job - zookeeper</a> <a href="/tags/Java/" style="font-size: 14px; color: #999">Java</a> <a href="/tags/Job/" style="font-size: 24px; color: #555">Job</a> <a href="/tags/Kafka/" style="font-size: 14px; color: #999">Kafka</a> <a href="/tags/Linux/" style="font-size: 14px; color: #999">Linux</a> <a href="/tags/Mybatis/" style="font-size: 14px; color: #999">Mybatis</a> <a href="/tags/Redis/" style="font-size: 14px; color: #999">Redis</a> <a href="/tags/Spring/" style="font-size: 14px; color: #999">Spring</a> <a href="/tags/mysql/" style="font-size: 14px; color: #999">mysql</a> <a href="/tags/zookeeper/" style="font-size: 14px; color: #999">zookeeper</a> <a href="/tags/%E6%8A%80%E6%9C%AF%E7%AC%94%E8%AE%B0/" style="font-size: 24px; color: #555">技术笔记</a> <a href="/tags/%E6%8E%92%E5%BA%8F/" style="font-size: 14px; color: #999">排序</a> <a href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/" style="font-size: 20.67px; color: #6c6c6c">数据库</a> <a href="/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/" style="font-size: 14px; color: #999">数据结构</a> <a href="/tags/%E6%9C%8D%E5%8A%A1%E7%AB%AF%E5%BC%80%E5%8F%91/" style="font-size: 17.33px; color: #828282">服务端开发</a> <a href="/tags/%E7%AE%97%E6%B3%95/" style="font-size: 14px; color: #999">算法</a> <a href="/tags/%E7%BD%91%E7%BB%9C/" style="font-size: 14px; color: #999">网络</a>
    </div>
  </section>


            
          
        
          
          
        
          
          
        
      
        
          
          
        
          
          
        
          
          
        
          
          
        
          
          
        
          
          
        
          
          
            
              <section class='widget list'>
  
<header class='pure'>
  <div><i class="fas fa-thumbs-up fa-fw" aria-hidden="true"></i>&nbsp;&nbsp;强烈推荐</div>
  
</header>

  <div class='content pure'>
    <ul class="entry">
      
        <li><a class="flat-box" title="https://xaoxuu.com/wiki/hexo.sh/" href="https://xaoxuu.com/wiki/hexo.sh/"
          
          
          >
          <div class='name'>
            
              <i class=" fa-fw" aria-hidden="true"></i>
            
            &nbsp;&nbsp;Hexo脚本（Mac）
          </div>
          
        </a></li>
      
        <li><a class="flat-box" title="https://xaoxuu.com/wiki/vim-cn.sh/" href="https://xaoxuu.com/wiki/vim-cn.sh/"
          
          
          >
          <div class='name'>
            
              <i class=" fa-fw" aria-hidden="true"></i>
            
            &nbsp;&nbsp;图床脚本（Mac）
          </div>
          
        </a></li>
      
        <li><a class="flat-box" title="https://yasuotu.com" href="https://yasuotu.com"
          
          
          >
          <div class='name'>
            
              <i class=" fa-fw" aria-hidden="true"></i>
            
            &nbsp;&nbsp;图片在线压缩
          </div>
          
        </a></li>
      
        <li><a class="flat-box" title="https://realfavicongenerator.net" href="https://realfavicongenerator.net"
          
          
          >
          <div class='name'>
            
              <i class=" fa-fw" aria-hidden="true"></i>
            
            &nbsp;&nbsp;生成Favicon
          </div>
          
        </a></li>
      
        <li><a class="flat-box" title="https://mxclub.github.io/resume/" href="https://mxclub.github.io/resume/"
          
          
          >
          <div class='name'>
            
              <i class=" fa-fw" aria-hidden="true"></i>
            
            &nbsp;&nbsp;简历主题
          </div>
          
        </a></li>
      
    </ul>
  </div>
</section>

            
          
        
      
        
          
          
        
          
          
        
          
          
        
          
          
        
          
          
        
          
          
        
          
          
        
      
    

  
</aside>

<footer id="footer" class="clearfix">
  
  
    <div class="social-wrapper">
      
        
          <a href="/atom.xml"
            class="social fas fa-rss flat-btn"
            target="_blank"
            rel="external nofollow noopener noreferrer">
          </a>
        
      
        
          <a href="mailto:dmlys@live.com"
            class="social fas fa-envelope flat-btn"
            target="_blank"
            rel="external nofollow noopener noreferrer">
          </a>
        
      
        
          <a href="https://github.com/ChanMango"
            class="social fab fa-github flat-btn"
            target="_blank"
            rel="external nofollow noopener noreferrer">
          </a>
        
      
        
          <a href="https://music.163.com/#/user/home?id=118376074"
            class="social fas fa-headphones-alt flat-btn"
            target="_blank"
            rel="external nofollow noopener noreferrer">
          </a>
        
      
    </div>
  
  <br>
  <div><p>Blog content follows the <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.en">Attribution-NonCommercial-ShareAlike 4.0 International (CC BY-NC-SA 4.0) License</a></p>
</div>
  <div>
    Use
    <a href="https://xaoxuu.com/wiki/material-x/" target="_blank" class="codename">Material X</a>
    as theme
    
      , 
      total visits
      <span id="busuanzi_value_site_pv"><i class="fas fa-spinner fa-spin fa-fw" aria-hidden="true"></i></span>
      times
    
    . 
  </div>
</footer>
<script>setLoadingBarProgress(80);</script>


      <script>setLoadingBarProgress(60);</script>
    </div>
    <a class="s-top fas fa-arrow-up fa-fw" href='javascript:void(0)'></a>
  </div>
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script>

  <script>
    var GOOGLE_CUSTOM_SEARCH_API_KEY = "";
    var GOOGLE_CUSTOM_SEARCH_ENGINE_ID = "";
    var ALGOLIA_API_KEY = "";
    var ALGOLIA_APP_ID = "";
    var ALGOLIA_INDEX_NAME = "";
    var AZURE_SERVICE_NAME = "";
    var AZURE_INDEX_NAME = "";
    var AZURE_QUERY_KEY = "";
    var BAIDU_API_ID = "";
    var SEARCH_SERVICE = "hexo" || "hexo";
    var ROOT = "/"||"/";
    if(!ROOT.endsWith('/'))ROOT += '/';
  </script>

<script src="//instant.page/1.2.2" type="module" integrity="sha384-2xV8M5griQmzyiY3CDqh1dn4z3llDVqZDqzjzcY+jCBCk/a5fXJmuZ/40JJAPeoU"></script>


  <script async src="https://cdn.jsdelivr.net/npm/scrollreveal@4.0.5/dist/scrollreveal.min.js"></script>
  <script type="text/javascript">
    $(function() {
      const $reveal = $('.reveal');
      if ($reveal.length === 0) return;
      const sr = ScrollReveal({ distance: 0 });
      sr.reveal('.reveal');
    });
  </script>


  <script src="https://cdn.jsdelivr.net/npm/node-waves@0.7.6/dist/waves.min.js"></script>
  <script type="text/javascript">
    $(function() {
      Waves.attach('.flat-btn', ['waves-button']);
      Waves.attach('.float-btn', ['waves-button', 'waves-float']);
      Waves.attach('.float-btn-light', ['waves-button', 'waves-float', 'waves-light']);
      Waves.attach('.flat-box', ['waves-block']);
      Waves.attach('.float-box', ['waves-block', 'waves-float']);
      Waves.attach('.waves-image');
      Waves.init();
    });
  </script>


  <script async src="https://cdn.jsdelivr.net/gh/xaoxuu/cdn-busuanzi@2.3/js/busuanzi.pure.mini.js"></script>




  
  
  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-backstretch/2.0.4/jquery.backstretch.min.js"></script>
    <script type="text/javascript">
      $(function(){
        if ('.cover') {
          $('.cover').backstretch(
          ["https://img.vim-cn.com/29/91197b04c13f512f734a76d4ac422d89dbe229.jpg"],
          {
            duration: "6000",
            fade: "2500"
          });
        } else {
          $.backstretch(
          ["https://img.vim-cn.com/29/91197b04c13f512f734a76d4ac422d89dbe229.jpg"],
          {
            duration: "6000",
            fade: "2500"
          });
        }
      });
    </script>
  











  <script src="https://cdn.jsdelivr.net/gh/xaoxuu/cdn-material-x@19.9/js/app.js"></script>


  <script src="https://cdn.jsdelivr.net/gh/xaoxuu/cdn-material-x@19.9/js/search.js"></script>




<!-- 复制 -->
<script src="https://cdn.jsdelivr.net/npm/clipboard@2/dist/clipboard.min.js"></script>
<script>
  let COPY_SUCCESS = "Copied";
  let COPY_FAILURE = "Copy failed";
  /*页面载入完成后，创建复制按钮*/
  !function (e, t, a) {
    /* code */
    var initCopyCode = function(){
      var copyHtml = '';
      copyHtml += '<button class="btn-copy" data-clipboard-snippet="">';
      copyHtml += '  <i class="fa fa-copy"></i><span>Copy</span>';
      copyHtml += '</button>';
      $(".highlight .code pre").before(copyHtml);
      var clipboard = new ClipboardJS('.btn-copy', {
        target: function(trigger) {
          return trigger.nextElementSibling;
        }
      });

      clipboard.on('success', function(e) {
        //您可以加入成功提示
        console.info('Action:', e.action);
        console.info('Text:', e.text);
        console.info('Trigger:', e.trigger);
        success_prompt(COPY_SUCCESS);
        e.clearSelection();
      });
      clipboard.on('error', function(e) {
        //您可以加入失败提示
        console.error('Action:', e.action);
        console.error('Trigger:', e.trigger);
        fail_prompt(COPY_FAILURE);
      });
    }
    initCopyCode();

  }(window, document);

  /**
   * 弹出式提示框，默认1.5秒自动消失
   * @param message 提示信息
   * @param style 提示样式，有alert-success、alert-danger、alert-warning、alert-info
   * @param time 消失时间
   */
  var prompt = function (message, style, time)
  {
      style = (style === undefined) ? 'alert-success' : style;
      time = (time === undefined) ? 1500 : time*1000;
      $('<div>')
          .appendTo('body')
          .addClass('alert ' + style)
          .html(message)
          .show()
          .delay(time)
          .fadeOut();
  };

  // 成功提示
  var success_prompt = function(message, time)
  {
      prompt(message, 'alert-success', time);
  };

  // 失败提示
  var fail_prompt = function(message, time)
  {
      prompt(message, 'alert-danger', time);
  };

  // 提醒
  var warning_prompt = function(message, time)
  {
      prompt(message, 'alert-warning', time);
  };

  // 信息提示
  var info_prompt = function(message, time)
  {
      prompt(message, 'alert-info', time);
  };

</script>


<!-- fancybox -->
<script src="https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js"></script>
<script>
  let LAZY_LOAD_IMAGE = "";
  $(".article-entry").find("fancybox").find("img").each(function () {
      var element = document.createElement("a");
      $(element).attr("data-fancybox", "gallery");
      $(element).attr("href", $(this).attr("src"));
      /* 图片采用懒加载处理时,
       * 一般图片标签内会有个属性名来存放图片的真实地址，比如 data-original,
       * 那么此处将原本的属性名src替换为对应属性名data-original,
       * 修改如下
       */
       if (LAZY_LOAD_IMAGE) {
         $(element).attr("href", $(this).attr("data-original"));
       }
      $(this).wrap(element);
  });
</script>





  <script>setLoadingBarProgress(100);</script>
</body>
</html>
